var b2=Object.defineProperty;var S2=(n,o,c)=>o in n?b2(n,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):n[o]=c;var li=(n,o,c)=>S2(n,typeof o!="symbol"?o+"":o,c);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))p(v);new MutationObserver(v=>{for(const k of v)if(k.type==="childList")for(const S of k.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&p(S)}).observe(document,{childList:!0,subtree:!0});function c(v){const k={};return v.integrity&&(k.integrity=v.integrity),v.referrerPolicy&&(k.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?k.credentials="include":v.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function p(v){if(v.ep)return;v.ep=!0;const k=c(v);fetch(v.href,k)}})();var T2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},uv={exports:{}},lp={},hv={exports:{}},Pt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wu=Symbol.for("react.element"),k2=Symbol.for("react.portal"),I2=Symbol.for("react.fragment"),C2=Symbol.for("react.strict_mode"),E2=Symbol.for("react.profiler"),P2=Symbol.for("react.provider"),M2=Symbol.for("react.context"),A2=Symbol.for("react.forward_ref"),z2=Symbol.for("react.suspense"),D2=Symbol.for("react.memo"),L2=Symbol.for("react.lazy"),U_=Symbol.iterator;function R2(n){return n===null||typeof n!="object"?null:(n=U_&&n[U_]||n["@@iterator"],typeof n=="function"?n:null)}var dv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pv=Object.assign,fv={};function Xl(n,o,c){this.props=n,this.context=o,this.refs=fv,this.updater=c||dv}Xl.prototype.isReactComponent={};Xl.prototype.setState=function(n,o){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,o,"setState")};Xl.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function mv(){}mv.prototype=Xl.prototype;function cg(n,o,c){this.props=n,this.context=o,this.refs=fv,this.updater=c||dv}var ug=cg.prototype=new mv;ug.constructor=cg;pv(ug,Xl.prototype);ug.isPureReactComponent=!0;var $_=Array.isArray,gv=Object.prototype.hasOwnProperty,hg={current:null},yv={key:!0,ref:!0,__self:!0,__source:!0};function _v(n,o,c){var p,v={},k=null,S=null;if(o!=null)for(p in o.ref!==void 0&&(S=o.ref),o.key!==void 0&&(k=""+o.key),o)gv.call(o,p)&&!yv.hasOwnProperty(p)&&(v[p]=o[p]);var d=arguments.length-2;if(d===1)v.children=c;else if(1<d){for(var $=Array(d),ie=0;ie<d;ie++)$[ie]=arguments[ie+2];v.children=$}if(n&&n.defaultProps)for(p in d=n.defaultProps,d)v[p]===void 0&&(v[p]=d[p]);return{$$typeof:Wu,type:n,key:k,ref:S,props:v,_owner:hg.current}}function F2(n,o){return{$$typeof:Wu,type:n.type,key:o,ref:n.ref,props:n.props,_owner:n._owner}}function dg(n){return typeof n=="object"&&n!==null&&n.$$typeof===Wu}function B2(n){var o={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(c){return o[c]})}var Z_=/\/+/g;function jf(n,o){return typeof n=="object"&&n!==null&&n.key!=null?B2(""+n.key):o.toString(36)}function Id(n,o,c,p,v){var k=typeof n;(k==="undefined"||k==="boolean")&&(n=null);var S=!1;if(n===null)S=!0;else switch(k){case"string":case"number":S=!0;break;case"object":switch(n.$$typeof){case Wu:case k2:S=!0}}if(S)return S=n,v=v(S),n=p===""?"."+jf(S,0):p,$_(v)?(c="",n!=null&&(c=n.replace(Z_,"$&/")+"/"),Id(v,o,c,"",function(ie){return ie})):v!=null&&(dg(v)&&(v=F2(v,c+(!v.key||S&&S.key===v.key?"":(""+v.key).replace(Z_,"$&/")+"/")+n)),o.push(v)),1;if(S=0,p=p===""?".":p+":",$_(n))for(var d=0;d<n.length;d++){k=n[d];var $=p+jf(k,d);S+=Id(k,o,c,$,v)}else if($=R2(n),typeof $=="function")for(n=$.call(n),d=0;!(k=n.next()).done;)k=k.value,$=p+jf(k,d++),S+=Id(k,o,c,$,v);else if(k==="object")throw o=String(n),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return S}function ld(n,o,c){if(n==null)return n;var p=[],v=0;return Id(n,p,"","",function(k){return o.call(c,k,v++)}),p}function O2(n){if(n._status===-1){var o=n._result;o=o(),o.then(function(c){(n._status===0||n._status===-1)&&(n._status=1,n._result=c)},function(c){(n._status===0||n._status===-1)&&(n._status=2,n._result=c)}),n._status===-1&&(n._status=0,n._result=o)}if(n._status===1)return n._result.default;throw n._result}var Un={current:null},Cd={transition:null},N2={ReactCurrentDispatcher:Un,ReactCurrentBatchConfig:Cd,ReactCurrentOwner:hg};function vv(){throw Error("act(...) is not supported in production builds of React.")}Pt.Children={map:ld,forEach:function(n,o,c){ld(n,function(){o.apply(this,arguments)},c)},count:function(n){var o=0;return ld(n,function(){o++}),o},toArray:function(n){return ld(n,function(o){return o})||[]},only:function(n){if(!dg(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Pt.Component=Xl;Pt.Fragment=I2;Pt.Profiler=E2;Pt.PureComponent=cg;Pt.StrictMode=C2;Pt.Suspense=z2;Pt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N2;Pt.act=vv;Pt.cloneElement=function(n,o,c){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var p=pv({},n.props),v=n.key,k=n.ref,S=n._owner;if(o!=null){if(o.ref!==void 0&&(k=o.ref,S=hg.current),o.key!==void 0&&(v=""+o.key),n.type&&n.type.defaultProps)var d=n.type.defaultProps;for($ in o)gv.call(o,$)&&!yv.hasOwnProperty($)&&(p[$]=o[$]===void 0&&d!==void 0?d[$]:o[$])}var $=arguments.length-2;if($===1)p.children=c;else if(1<$){d=Array($);for(var ie=0;ie<$;ie++)d[ie]=arguments[ie+2];p.children=d}return{$$typeof:Wu,type:n.type,key:v,ref:k,props:p,_owner:S}};Pt.createContext=function(n){return n={$$typeof:M2,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:P2,_context:n},n.Consumer=n};Pt.createElement=_v;Pt.createFactory=function(n){var o=_v.bind(null,n);return o.type=n,o};Pt.createRef=function(){return{current:null}};Pt.forwardRef=function(n){return{$$typeof:A2,render:n}};Pt.isValidElement=dg;Pt.lazy=function(n){return{$$typeof:L2,_payload:{_status:-1,_result:n},_init:O2}};Pt.memo=function(n,o){return{$$typeof:D2,type:n,compare:o===void 0?null:o}};Pt.startTransition=function(n){var o=Cd.transition;Cd.transition={};try{n()}finally{Cd.transition=o}};Pt.unstable_act=vv;Pt.useCallback=function(n,o){return Un.current.useCallback(n,o)};Pt.useContext=function(n){return Un.current.useContext(n)};Pt.useDebugValue=function(){};Pt.useDeferredValue=function(n){return Un.current.useDeferredValue(n)};Pt.useEffect=function(n,o){return Un.current.useEffect(n,o)};Pt.useId=function(){return Un.current.useId()};Pt.useImperativeHandle=function(n,o,c){return Un.current.useImperativeHandle(n,o,c)};Pt.useInsertionEffect=function(n,o){return Un.current.useInsertionEffect(n,o)};Pt.useLayoutEffect=function(n,o){return Un.current.useLayoutEffect(n,o)};Pt.useMemo=function(n,o){return Un.current.useMemo(n,o)};Pt.useReducer=function(n,o,c){return Un.current.useReducer(n,o,c)};Pt.useRef=function(n){return Un.current.useRef(n)};Pt.useState=function(n){return Un.current.useState(n)};Pt.useSyncExternalStore=function(n,o,c){return Un.current.useSyncExternalStore(n,o,c)};Pt.useTransition=function(){return Un.current.useTransition()};Pt.version="18.3.1";hv.exports=Pt;var Ve=hv.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j2=Ve,V2=Symbol.for("react.element"),U2=Symbol.for("react.fragment"),$2=Object.prototype.hasOwnProperty,Z2=j2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,q2={key:!0,ref:!0,__self:!0,__source:!0};function xv(n,o,c){var p,v={},k=null,S=null;c!==void 0&&(k=""+c),o.key!==void 0&&(k=""+o.key),o.ref!==void 0&&(S=o.ref);for(p in o)$2.call(o,p)&&!q2.hasOwnProperty(p)&&(v[p]=o[p]);if(n&&n.defaultProps)for(p in o=n.defaultProps,o)v[p]===void 0&&(v[p]=o[p]);return{$$typeof:V2,type:n,key:k,ref:S,props:v,_owner:Z2.current}}lp.Fragment=U2;lp.jsx=xv;lp.jsxs=xv;uv.exports=lp;var at=uv.exports,gm={},wv={exports:{}},dr={},bv={exports:{}},Sv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function o(Ye,ft){var mt=Ye.length;Ye.push(ft);e:for(;0<mt;){var Et=mt-1>>>1,zt=Ye[Et];if(0<v(zt,ft))Ye[Et]=ft,Ye[mt]=zt,mt=Et;else break e}}function c(Ye){return Ye.length===0?null:Ye[0]}function p(Ye){if(Ye.length===0)return null;var ft=Ye[0],mt=Ye.pop();if(mt!==ft){Ye[0]=mt;e:for(var Et=0,zt=Ye.length,Ui=zt>>>1;Et<Ui;){var dn=2*(Et+1)-1,Mn=Ye[dn],Bi=dn+1,$i=Ye[Bi];if(0>v(Mn,mt))Bi<zt&&0>v($i,Mn)?(Ye[Et]=$i,Ye[Bi]=mt,Et=Bi):(Ye[Et]=Mn,Ye[dn]=mt,Et=dn);else if(Bi<zt&&0>v($i,mt))Ye[Et]=$i,Ye[Bi]=mt,Et=Bi;else break e}}return ft}function v(Ye,ft){var mt=Ye.sortIndex-ft.sortIndex;return mt!==0?mt:Ye.id-ft.id}if(typeof performance=="object"&&typeof performance.now=="function"){var k=performance;n.unstable_now=function(){return k.now()}}else{var S=Date,d=S.now();n.unstable_now=function(){return S.now()-d}}var $=[],ie=[],me=1,X=null,V=3,Te=!1,ke=!1,Me=!1,yt=typeof setTimeout=="function"?setTimeout:null,oe=typeof clearTimeout=="function"?clearTimeout:null,ne=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function he(Ye){for(var ft=c(ie);ft!==null;){if(ft.callback===null)p(ie);else if(ft.startTime<=Ye)p(ie),ft.sortIndex=ft.expirationTime,o($,ft);else break;ft=c(ie)}}function Ie(Ye){if(Me=!1,he(Ye),!ke)if(c($)!==null)ke=!0,Pn(Be);else{var ft=c(ie);ft!==null&&Fi(Ie,ft.startTime-Ye)}}function Be(Ye,ft){ke=!1,Me&&(Me=!1,oe(Xe),Xe=-1),Te=!0;var mt=V;try{for(he(ft),X=c($);X!==null&&(!(X.expirationTime>ft)||Ye&&!pt());){var Et=X.callback;if(typeof Et=="function"){X.callback=null,V=X.priorityLevel;var zt=Et(X.expirationTime<=ft);ft=n.unstable_now(),typeof zt=="function"?X.callback=zt:X===c($)&&p($),he(ft)}else p($);X=c($)}if(X!==null)var Ui=!0;else{var dn=c(ie);dn!==null&&Fi(Ie,dn.startTime-ft),Ui=!1}return Ui}finally{X=null,V=mt,Te=!1}}var Re=!1,$e=null,Xe=-1,xt=5,rt=-1;function pt(){return!(n.unstable_now()-rt<xt)}function oi(){if($e!==null){var Ye=n.unstable_now();rt=Ye;var ft=!0;try{ft=$e(!0,Ye)}finally{ft?Ut():(Re=!1,$e=null)}}else Re=!1}var Ut;if(typeof ne=="function")Ut=function(){ne(oi)};else if(typeof MessageChannel<"u"){var ei=new MessageChannel,Ri=ei.port2;ei.port1.onmessage=oi,Ut=function(){Ri.postMessage(null)}}else Ut=function(){yt(oi,0)};function Pn(Ye){$e=Ye,Re||(Re=!0,Ut())}function Fi(Ye,ft){Xe=yt(function(){Ye(n.unstable_now())},ft)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ye){Ye.callback=null},n.unstable_continueExecution=function(){ke||Te||(ke=!0,Pn(Be))},n.unstable_forceFrameRate=function(Ye){0>Ye||125<Ye?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):xt=0<Ye?Math.floor(1e3/Ye):5},n.unstable_getCurrentPriorityLevel=function(){return V},n.unstable_getFirstCallbackNode=function(){return c($)},n.unstable_next=function(Ye){switch(V){case 1:case 2:case 3:var ft=3;break;default:ft=V}var mt=V;V=ft;try{return Ye()}finally{V=mt}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ye,ft){switch(Ye){case 1:case 2:case 3:case 4:case 5:break;default:Ye=3}var mt=V;V=Ye;try{return ft()}finally{V=mt}},n.unstable_scheduleCallback=function(Ye,ft,mt){var Et=n.unstable_now();switch(typeof mt=="object"&&mt!==null?(mt=mt.delay,mt=typeof mt=="number"&&0<mt?Et+mt:Et):mt=Et,Ye){case 1:var zt=-1;break;case 2:zt=250;break;case 5:zt=1073741823;break;case 4:zt=1e4;break;default:zt=5e3}return zt=mt+zt,Ye={id:me++,callback:ft,priorityLevel:Ye,startTime:mt,expirationTime:zt,sortIndex:-1},mt>Et?(Ye.sortIndex=mt,o(ie,Ye),c($)===null&&Ye===c(ie)&&(Me?(oe(Xe),Xe=-1):Me=!0,Fi(Ie,mt-Et))):(Ye.sortIndex=zt,o($,Ye),ke||Te||(ke=!0,Pn(Be))),Ye},n.unstable_shouldYield=pt,n.unstable_wrapCallback=function(Ye){var ft=V;return function(){var mt=V;V=ft;try{return Ye.apply(this,arguments)}finally{V=mt}}}})(Sv);bv.exports=Sv;var G2=bv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W2=Ve,hr=G2;function De(n){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+n,c=1;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+n+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Tv=new Set,Mu={};function ba(n,o){$l(n,o),$l(n+"Capture",o)}function $l(n,o){for(Mu[n]=o,n=0;n<o.length;n++)Tv.add(o[n])}var Do=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ym=Object.prototype.hasOwnProperty,H2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,q_={},G_={};function K2(n){return ym.call(G_,n)?!0:ym.call(q_,n)?!1:H2.test(n)?G_[n]=!0:(q_[n]=!0,!1)}function X2(n,o,c,p){if(c!==null&&c.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return p?!1:c!==null?!c.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Y2(n,o,c,p){if(o===null||typeof o>"u"||X2(n,o,c,p))return!0;if(p)return!1;if(c!==null)switch(c.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function $n(n,o,c,p,v,k,S){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=p,this.attributeNamespace=v,this.mustUseProperty=c,this.propertyName=n,this.type=o,this.sanitizeURL=k,this.removeEmptyString=S}var hn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){hn[n]=new $n(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var o=n[0];hn[o]=new $n(o,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){hn[n]=new $n(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){hn[n]=new $n(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){hn[n]=new $n(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){hn[n]=new $n(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){hn[n]=new $n(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){hn[n]=new $n(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){hn[n]=new $n(n,5,!1,n.toLowerCase(),null,!1,!1)});var pg=/[\-:]([a-z])/g;function fg(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var o=n.replace(pg,fg);hn[o]=new $n(o,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var o=n.replace(pg,fg);hn[o]=new $n(o,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var o=n.replace(pg,fg);hn[o]=new $n(o,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){hn[n]=new $n(n,1,!1,n.toLowerCase(),null,!1,!1)});hn.xlinkHref=new $n("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){hn[n]=new $n(n,1,!1,n.toLowerCase(),null,!0,!0)});function mg(n,o,c,p){var v=hn.hasOwnProperty(o)?hn[o]:null;(v!==null?v.type!==0:p||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(Y2(o,c,v,p)&&(c=null),p||v===null?K2(o)&&(c===null?n.removeAttribute(o):n.setAttribute(o,""+c)):v.mustUseProperty?n[v.propertyName]=c===null?v.type===3?!1:"":c:(o=v.attributeName,p=v.attributeNamespace,c===null?n.removeAttribute(o):(v=v.type,c=v===3||v===4&&c===!0?"":""+c,p?n.setAttributeNS(p,o,c):n.setAttribute(o,c))))}var Bo=W2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,cd=Symbol.for("react.element"),Tl=Symbol.for("react.portal"),kl=Symbol.for("react.fragment"),gg=Symbol.for("react.strict_mode"),_m=Symbol.for("react.profiler"),kv=Symbol.for("react.provider"),Iv=Symbol.for("react.context"),yg=Symbol.for("react.forward_ref"),vm=Symbol.for("react.suspense"),xm=Symbol.for("react.suspense_list"),_g=Symbol.for("react.memo"),gs=Symbol.for("react.lazy"),Cv=Symbol.for("react.offscreen"),W_=Symbol.iterator;function lu(n){return n===null||typeof n!="object"?null:(n=W_&&n[W_]||n["@@iterator"],typeof n=="function"?n:null)}var vi=Object.assign,Vf;function yu(n){if(Vf===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);Vf=o&&o[1]||""}return`
`+Vf+n}var Uf=!1;function $f(n,o){if(!n||Uf)return"";Uf=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(ie){var p=ie}Reflect.construct(n,[],o)}else{try{o.call()}catch(ie){p=ie}n.call(o.prototype)}else{try{throw Error()}catch(ie){p=ie}n()}}catch(ie){if(ie&&p&&typeof ie.stack=="string"){for(var v=ie.stack.split(`
`),k=p.stack.split(`
`),S=v.length-1,d=k.length-1;1<=S&&0<=d&&v[S]!==k[d];)d--;for(;1<=S&&0<=d;S--,d--)if(v[S]!==k[d]){if(S!==1||d!==1)do if(S--,d--,0>d||v[S]!==k[d]){var $=`
`+v[S].replace(" at new "," at ");return n.displayName&&$.includes("<anonymous>")&&($=$.replace("<anonymous>",n.displayName)),$}while(1<=S&&0<=d);break}}}finally{Uf=!1,Error.prepareStackTrace=c}return(n=n?n.displayName||n.name:"")?yu(n):""}function J2(n){switch(n.tag){case 5:return yu(n.type);case 16:return yu("Lazy");case 13:return yu("Suspense");case 19:return yu("SuspenseList");case 0:case 2:case 15:return n=$f(n.type,!1),n;case 11:return n=$f(n.type.render,!1),n;case 1:return n=$f(n.type,!0),n;default:return""}}function wm(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case kl:return"Fragment";case Tl:return"Portal";case _m:return"Profiler";case gg:return"StrictMode";case vm:return"Suspense";case xm:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Iv:return(n.displayName||"Context")+".Consumer";case kv:return(n._context.displayName||"Context")+".Provider";case yg:var o=n.render;return n=n.displayName,n||(n=o.displayName||o.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case _g:return o=n.displayName||null,o!==null?o:wm(n.type)||"Memo";case gs:o=n._payload,n=n._init;try{return wm(n(o))}catch{}}return null}function Q2(n){var o=n.type;switch(n.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=o.render,n=n.displayName||n.name||"",o.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return wm(o);case 8:return o===gg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Ms(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Ev(n){var o=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function eb(n){var o=Ev(n)?"checked":"value",c=Object.getOwnPropertyDescriptor(n.constructor.prototype,o),p=""+n[o];if(!n.hasOwnProperty(o)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var v=c.get,k=c.set;return Object.defineProperty(n,o,{configurable:!0,get:function(){return v.call(this)},set:function(S){p=""+S,k.call(this,S)}}),Object.defineProperty(n,o,{enumerable:c.enumerable}),{getValue:function(){return p},setValue:function(S){p=""+S},stopTracking:function(){n._valueTracker=null,delete n[o]}}}}function ud(n){n._valueTracker||(n._valueTracker=eb(n))}function Pv(n){if(!n)return!1;var o=n._valueTracker;if(!o)return!0;var c=o.getValue(),p="";return n&&(p=Ev(n)?n.checked?"true":"false":n.value),n=p,n!==c?(o.setValue(n),!0):!1}function Od(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function bm(n,o){var c=o.checked;return vi({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??n._wrapperState.initialChecked})}function H_(n,o){var c=o.defaultValue==null?"":o.defaultValue,p=o.checked!=null?o.checked:o.defaultChecked;c=Ms(o.value!=null?o.value:c),n._wrapperState={initialChecked:p,initialValue:c,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function Mv(n,o){o=o.checked,o!=null&&mg(n,"checked",o,!1)}function Sm(n,o){Mv(n,o);var c=Ms(o.value),p=o.type;if(c!=null)p==="number"?(c===0&&n.value===""||n.value!=c)&&(n.value=""+c):n.value!==""+c&&(n.value=""+c);else if(p==="submit"||p==="reset"){n.removeAttribute("value");return}o.hasOwnProperty("value")?Tm(n,o.type,c):o.hasOwnProperty("defaultValue")&&Tm(n,o.type,Ms(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(n.defaultChecked=!!o.defaultChecked)}function K_(n,o,c){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var p=o.type;if(!(p!=="submit"&&p!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+n._wrapperState.initialValue,c||o===n.value||(n.value=o),n.defaultValue=o}c=n.name,c!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,c!==""&&(n.name=c)}function Tm(n,o,c){(o!=="number"||Od(n.ownerDocument)!==n)&&(c==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+c&&(n.defaultValue=""+c))}var _u=Array.isArray;function Fl(n,o,c,p){if(n=n.options,o){o={};for(var v=0;v<c.length;v++)o["$"+c[v]]=!0;for(c=0;c<n.length;c++)v=o.hasOwnProperty("$"+n[c].value),n[c].selected!==v&&(n[c].selected=v),v&&p&&(n[c].defaultSelected=!0)}else{for(c=""+Ms(c),o=null,v=0;v<n.length;v++){if(n[v].value===c){n[v].selected=!0,p&&(n[v].defaultSelected=!0);return}o!==null||n[v].disabled||(o=n[v])}o!==null&&(o.selected=!0)}}function km(n,o){if(o.dangerouslySetInnerHTML!=null)throw Error(De(91));return vi({},o,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function X_(n,o){var c=o.value;if(c==null){if(c=o.children,o=o.defaultValue,c!=null){if(o!=null)throw Error(De(92));if(_u(c)){if(1<c.length)throw Error(De(93));c=c[0]}o=c}o==null&&(o=""),c=o}n._wrapperState={initialValue:Ms(c)}}function Av(n,o){var c=Ms(o.value),p=Ms(o.defaultValue);c!=null&&(c=""+c,c!==n.value&&(n.value=c),o.defaultValue==null&&n.defaultValue!==c&&(n.defaultValue=c)),p!=null&&(n.defaultValue=""+p)}function Y_(n){var o=n.textContent;o===n._wrapperState.initialValue&&o!==""&&o!==null&&(n.value=o)}function zv(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Im(n,o){return n==null||n==="http://www.w3.org/1999/xhtml"?zv(o):n==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var hd,Dv=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,c,p,v){MSApp.execUnsafeLocalFunction(function(){return n(o,c,p,v)})}:n}(function(n,o){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=o;else{for(hd=hd||document.createElement("div"),hd.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=hd.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;o.firstChild;)n.appendChild(o.firstChild)}});function Au(n,o){if(o){var c=n.firstChild;if(c&&c===n.lastChild&&c.nodeType===3){c.nodeValue=o;return}}n.textContent=o}var wu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tb=["Webkit","ms","Moz","O"];Object.keys(wu).forEach(function(n){tb.forEach(function(o){o=o+n.charAt(0).toUpperCase()+n.substring(1),wu[o]=wu[n]})});function Lv(n,o,c){return o==null||typeof o=="boolean"||o===""?"":c||typeof o!="number"||o===0||wu.hasOwnProperty(n)&&wu[n]?(""+o).trim():o+"px"}function Rv(n,o){n=n.style;for(var c in o)if(o.hasOwnProperty(c)){var p=c.indexOf("--")===0,v=Lv(c,o[c],p);c==="float"&&(c="cssFloat"),p?n.setProperty(c,v):n[c]=v}}var ib=vi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Cm(n,o){if(o){if(ib[n]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(De(137,n));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(De(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(De(61))}if(o.style!=null&&typeof o.style!="object")throw Error(De(62))}}function Em(n,o){if(n.indexOf("-")===-1)return typeof o.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Pm=null;function vg(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Mm=null,Bl=null,Ol=null;function J_(n){if(n=Xu(n)){if(typeof Mm!="function")throw Error(De(280));var o=n.stateNode;o&&(o=pp(o),Mm(n.stateNode,n.type,o))}}function Fv(n){Bl?Ol?Ol.push(n):Ol=[n]:Bl=n}function Bv(){if(Bl){var n=Bl,o=Ol;if(Ol=Bl=null,J_(n),o)for(n=0;n<o.length;n++)J_(o[n])}}function Ov(n,o){return n(o)}function Nv(){}var Zf=!1;function jv(n,o,c){if(Zf)return n(o,c);Zf=!0;try{return Ov(n,o,c)}finally{Zf=!1,(Bl!==null||Ol!==null)&&(Nv(),Bv())}}function zu(n,o){var c=n.stateNode;if(c===null)return null;var p=pp(c);if(p===null)return null;c=p[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(n=n.type,p=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!p;break e;default:n=!1}if(n)return null;if(c&&typeof c!="function")throw Error(De(231,o,typeof c));return c}var Am=!1;if(Do)try{var cu={};Object.defineProperty(cu,"passive",{get:function(){Am=!0}}),window.addEventListener("test",cu,cu),window.removeEventListener("test",cu,cu)}catch{Am=!1}function nb(n,o,c,p,v,k,S,d,$){var ie=Array.prototype.slice.call(arguments,3);try{o.apply(c,ie)}catch(me){this.onError(me)}}var bu=!1,Nd=null,jd=!1,zm=null,rb={onError:function(n){bu=!0,Nd=n}};function ob(n,o,c,p,v,k,S,d,$){bu=!1,Nd=null,nb.apply(rb,arguments)}function sb(n,o,c,p,v,k,S,d,$){if(ob.apply(this,arguments),bu){if(bu){var ie=Nd;bu=!1,Nd=null}else throw Error(De(198));jd||(jd=!0,zm=ie)}}function Sa(n){var o=n,c=n;if(n.alternate)for(;o.return;)o=o.return;else{n=o;do o=n,o.flags&4098&&(c=o.return),n=o.return;while(n)}return o.tag===3?c:null}function Vv(n){if(n.tag===13){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function Q_(n){if(Sa(n)!==n)throw Error(De(188))}function ab(n){var o=n.alternate;if(!o){if(o=Sa(n),o===null)throw Error(De(188));return o!==n?null:n}for(var c=n,p=o;;){var v=c.return;if(v===null)break;var k=v.alternate;if(k===null){if(p=v.return,p!==null){c=p;continue}break}if(v.child===k.child){for(k=v.child;k;){if(k===c)return Q_(v),n;if(k===p)return Q_(v),o;k=k.sibling}throw Error(De(188))}if(c.return!==p.return)c=v,p=k;else{for(var S=!1,d=v.child;d;){if(d===c){S=!0,c=v,p=k;break}if(d===p){S=!0,p=v,c=k;break}d=d.sibling}if(!S){for(d=k.child;d;){if(d===c){S=!0,c=k,p=v;break}if(d===p){S=!0,p=k,c=v;break}d=d.sibling}if(!S)throw Error(De(189))}}if(c.alternate!==p)throw Error(De(190))}if(c.tag!==3)throw Error(De(188));return c.stateNode.current===c?n:o}function Uv(n){return n=ab(n),n!==null?$v(n):null}function $v(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var o=$v(n);if(o!==null)return o;n=n.sibling}return null}var Zv=hr.unstable_scheduleCallback,e0=hr.unstable_cancelCallback,lb=hr.unstable_shouldYield,cb=hr.unstable_requestPaint,Pi=hr.unstable_now,ub=hr.unstable_getCurrentPriorityLevel,xg=hr.unstable_ImmediatePriority,qv=hr.unstable_UserBlockingPriority,Vd=hr.unstable_NormalPriority,hb=hr.unstable_LowPriority,Gv=hr.unstable_IdlePriority,cp=null,lo=null;function db(n){if(lo&&typeof lo.onCommitFiberRoot=="function")try{lo.onCommitFiberRoot(cp,n,void 0,(n.current.flags&128)===128)}catch{}}var $r=Math.clz32?Math.clz32:mb,pb=Math.log,fb=Math.LN2;function mb(n){return n>>>=0,n===0?32:31-(pb(n)/fb|0)|0}var dd=64,pd=4194304;function vu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Ud(n,o){var c=n.pendingLanes;if(c===0)return 0;var p=0,v=n.suspendedLanes,k=n.pingedLanes,S=c&268435455;if(S!==0){var d=S&~v;d!==0?p=vu(d):(k&=S,k!==0&&(p=vu(k)))}else S=c&~v,S!==0?p=vu(S):k!==0&&(p=vu(k));if(p===0)return 0;if(o!==0&&o!==p&&!(o&v)&&(v=p&-p,k=o&-o,v>=k||v===16&&(k&4194240)!==0))return o;if(p&4&&(p|=c&16),o=n.entangledLanes,o!==0)for(n=n.entanglements,o&=p;0<o;)c=31-$r(o),v=1<<c,p|=n[c],o&=~v;return p}function gb(n,o){switch(n){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yb(n,o){for(var c=n.suspendedLanes,p=n.pingedLanes,v=n.expirationTimes,k=n.pendingLanes;0<k;){var S=31-$r(k),d=1<<S,$=v[S];$===-1?(!(d&c)||d&p)&&(v[S]=gb(d,o)):$<=o&&(n.expiredLanes|=d),k&=~d}}function Dm(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Wv(){var n=dd;return dd<<=1,!(dd&4194240)&&(dd=64),n}function qf(n){for(var o=[],c=0;31>c;c++)o.push(n);return o}function Hu(n,o,c){n.pendingLanes|=o,o!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,o=31-$r(o),n[o]=c}function _b(n,o){var c=n.pendingLanes&~o;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=o,n.mutableReadLanes&=o,n.entangledLanes&=o,o=n.entanglements;var p=n.eventTimes;for(n=n.expirationTimes;0<c;){var v=31-$r(c),k=1<<v;o[v]=0,p[v]=-1,n[v]=-1,c&=~k}}function wg(n,o){var c=n.entangledLanes|=o;for(n=n.entanglements;c;){var p=31-$r(c),v=1<<p;v&o|n[p]&o&&(n[p]|=o),c&=~v}}var Gt=0;function Hv(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Kv,bg,Xv,Yv,Jv,Lm=!1,fd=[],bs=null,Ss=null,Ts=null,Du=new Map,Lu=new Map,_s=[],vb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function t0(n,o){switch(n){case"focusin":case"focusout":bs=null;break;case"dragenter":case"dragleave":Ss=null;break;case"mouseover":case"mouseout":Ts=null;break;case"pointerover":case"pointerout":Du.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lu.delete(o.pointerId)}}function uu(n,o,c,p,v,k){return n===null||n.nativeEvent!==k?(n={blockedOn:o,domEventName:c,eventSystemFlags:p,nativeEvent:k,targetContainers:[v]},o!==null&&(o=Xu(o),o!==null&&bg(o)),n):(n.eventSystemFlags|=p,o=n.targetContainers,v!==null&&o.indexOf(v)===-1&&o.push(v),n)}function xb(n,o,c,p,v){switch(o){case"focusin":return bs=uu(bs,n,o,c,p,v),!0;case"dragenter":return Ss=uu(Ss,n,o,c,p,v),!0;case"mouseover":return Ts=uu(Ts,n,o,c,p,v),!0;case"pointerover":var k=v.pointerId;return Du.set(k,uu(Du.get(k)||null,n,o,c,p,v)),!0;case"gotpointercapture":return k=v.pointerId,Lu.set(k,uu(Lu.get(k)||null,n,o,c,p,v)),!0}return!1}function Qv(n){var o=da(n.target);if(o!==null){var c=Sa(o);if(c!==null){if(o=c.tag,o===13){if(o=Vv(c),o!==null){n.blockedOn=o,Jv(n.priority,function(){Xv(c)});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){n.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ed(n){if(n.blockedOn!==null)return!1;for(var o=n.targetContainers;0<o.length;){var c=Rm(n.domEventName,n.eventSystemFlags,o[0],n.nativeEvent);if(c===null){c=n.nativeEvent;var p=new c.constructor(c.type,c);Pm=p,c.target.dispatchEvent(p),Pm=null}else return o=Xu(c),o!==null&&bg(o),n.blockedOn=c,!1;o.shift()}return!0}function i0(n,o,c){Ed(n)&&c.delete(o)}function wb(){Lm=!1,bs!==null&&Ed(bs)&&(bs=null),Ss!==null&&Ed(Ss)&&(Ss=null),Ts!==null&&Ed(Ts)&&(Ts=null),Du.forEach(i0),Lu.forEach(i0)}function hu(n,o){n.blockedOn===o&&(n.blockedOn=null,Lm||(Lm=!0,hr.unstable_scheduleCallback(hr.unstable_NormalPriority,wb)))}function Ru(n){function o(v){return hu(v,n)}if(0<fd.length){hu(fd[0],n);for(var c=1;c<fd.length;c++){var p=fd[c];p.blockedOn===n&&(p.blockedOn=null)}}for(bs!==null&&hu(bs,n),Ss!==null&&hu(Ss,n),Ts!==null&&hu(Ts,n),Du.forEach(o),Lu.forEach(o),c=0;c<_s.length;c++)p=_s[c],p.blockedOn===n&&(p.blockedOn=null);for(;0<_s.length&&(c=_s[0],c.blockedOn===null);)Qv(c),c.blockedOn===null&&_s.shift()}var Nl=Bo.ReactCurrentBatchConfig,$d=!0;function bb(n,o,c,p){var v=Gt,k=Nl.transition;Nl.transition=null;try{Gt=1,Sg(n,o,c,p)}finally{Gt=v,Nl.transition=k}}function Sb(n,o,c,p){var v=Gt,k=Nl.transition;Nl.transition=null;try{Gt=4,Sg(n,o,c,p)}finally{Gt=v,Nl.transition=k}}function Sg(n,o,c,p){if($d){var v=Rm(n,o,c,p);if(v===null)tm(n,o,p,Zd,c),t0(n,p);else if(xb(v,n,o,c,p))p.stopPropagation();else if(t0(n,p),o&4&&-1<vb.indexOf(n)){for(;v!==null;){var k=Xu(v);if(k!==null&&Kv(k),k=Rm(n,o,c,p),k===null&&tm(n,o,p,Zd,c),k===v)break;v=k}v!==null&&p.stopPropagation()}else tm(n,o,p,null,c)}}var Zd=null;function Rm(n,o,c,p){if(Zd=null,n=vg(p),n=da(n),n!==null)if(o=Sa(n),o===null)n=null;else if(c=o.tag,c===13){if(n=Vv(o),n!==null)return n;n=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null);return Zd=n,null}function e1(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ub()){case xg:return 1;case qv:return 4;case Vd:case hb:return 16;case Gv:return 536870912;default:return 16}default:return 16}}var xs=null,Tg=null,Pd=null;function t1(){if(Pd)return Pd;var n,o=Tg,c=o.length,p,v="value"in xs?xs.value:xs.textContent,k=v.length;for(n=0;n<c&&o[n]===v[n];n++);var S=c-n;for(p=1;p<=S&&o[c-p]===v[k-p];p++);return Pd=v.slice(n,1<p?1-p:void 0)}function Md(n){var o=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&o===13&&(n=13)):n=o,n===10&&(n=13),32<=n||n===13?n:0}function md(){return!0}function n0(){return!1}function pr(n){function o(c,p,v,k,S){this._reactName=c,this._targetInst=v,this.type=p,this.nativeEvent=k,this.target=S,this.currentTarget=null;for(var d in n)n.hasOwnProperty(d)&&(c=n[d],this[d]=c?c(k):k[d]);return this.isDefaultPrevented=(k.defaultPrevented!=null?k.defaultPrevented:k.returnValue===!1)?md:n0,this.isPropagationStopped=n0,this}return vi(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=md)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=md)},persist:function(){},isPersistent:md}),o}var Yl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},kg=pr(Yl),Ku=vi({},Yl,{view:0,detail:0}),Tb=pr(Ku),Gf,Wf,du,up=vi({},Ku,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ig,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==du&&(du&&n.type==="mousemove"?(Gf=n.screenX-du.screenX,Wf=n.screenY-du.screenY):Wf=Gf=0,du=n),Gf)},movementY:function(n){return"movementY"in n?n.movementY:Wf}}),r0=pr(up),kb=vi({},up,{dataTransfer:0}),Ib=pr(kb),Cb=vi({},Ku,{relatedTarget:0}),Hf=pr(Cb),Eb=vi({},Yl,{animationName:0,elapsedTime:0,pseudoElement:0}),Pb=pr(Eb),Mb=vi({},Yl,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Ab=pr(Mb),zb=vi({},Yl,{data:0}),o0=pr(zb),Db={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Lb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Rb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Fb(n){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(n):(n=Rb[n])?!!o[n]:!1}function Ig(){return Fb}var Bb=vi({},Ku,{key:function(n){if(n.key){var o=Db[n.key]||n.key;if(o!=="Unidentified")return o}return n.type==="keypress"?(n=Md(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Lb[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ig,charCode:function(n){return n.type==="keypress"?Md(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Md(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Ob=pr(Bb),Nb=vi({},up,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),s0=pr(Nb),jb=vi({},Ku,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ig}),Vb=pr(jb),Ub=vi({},Yl,{propertyName:0,elapsedTime:0,pseudoElement:0}),$b=pr(Ub),Zb=vi({},up,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),qb=pr(Zb),Gb=[9,13,27,32],Cg=Do&&"CompositionEvent"in window,Su=null;Do&&"documentMode"in document&&(Su=document.documentMode);var Wb=Do&&"TextEvent"in window&&!Su,i1=Do&&(!Cg||Su&&8<Su&&11>=Su),a0=" ",l0=!1;function n1(n,o){switch(n){case"keyup":return Gb.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function r1(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Il=!1;function Hb(n,o){switch(n){case"compositionend":return r1(o);case"keypress":return o.which!==32?null:(l0=!0,a0);case"textInput":return n=o.data,n===a0&&l0?null:n;default:return null}}function Kb(n,o){if(Il)return n==="compositionend"||!Cg&&n1(n,o)?(n=t1(),Pd=Tg=xs=null,Il=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return i1&&o.locale!=="ko"?null:o.data;default:return null}}var Xb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function c0(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o==="input"?!!Xb[n.type]:o==="textarea"}function o1(n,o,c,p){Fv(p),o=qd(o,"onChange"),0<o.length&&(c=new kg("onChange","change",null,c,p),n.push({event:c,listeners:o}))}var Tu=null,Fu=null;function Yb(n){g1(n,0)}function hp(n){var o=Pl(n);if(Pv(o))return n}function Jb(n,o){if(n==="change")return o}var s1=!1;if(Do){var Kf;if(Do){var Xf="oninput"in document;if(!Xf){var u0=document.createElement("div");u0.setAttribute("oninput","return;"),Xf=typeof u0.oninput=="function"}Kf=Xf}else Kf=!1;s1=Kf&&(!document.documentMode||9<document.documentMode)}function h0(){Tu&&(Tu.detachEvent("onpropertychange",a1),Fu=Tu=null)}function a1(n){if(n.propertyName==="value"&&hp(Fu)){var o=[];o1(o,Fu,n,vg(n)),jv(Yb,o)}}function Qb(n,o,c){n==="focusin"?(h0(),Tu=o,Fu=c,Tu.attachEvent("onpropertychange",a1)):n==="focusout"&&h0()}function e4(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return hp(Fu)}function t4(n,o){if(n==="click")return hp(o)}function i4(n,o){if(n==="input"||n==="change")return hp(o)}function n4(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var qr=typeof Object.is=="function"?Object.is:n4;function Bu(n,o){if(qr(n,o))return!0;if(typeof n!="object"||n===null||typeof o!="object"||o===null)return!1;var c=Object.keys(n),p=Object.keys(o);if(c.length!==p.length)return!1;for(p=0;p<c.length;p++){var v=c[p];if(!ym.call(o,v)||!qr(n[v],o[v]))return!1}return!0}function d0(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function p0(n,o){var c=d0(n);n=0;for(var p;c;){if(c.nodeType===3){if(p=n+c.textContent.length,n<=o&&p>=o)return{node:c,offset:o-n};n=p}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=d0(c)}}function l1(n,o){return n&&o?n===o?!0:n&&n.nodeType===3?!1:o&&o.nodeType===3?l1(n,o.parentNode):"contains"in n?n.contains(o):n.compareDocumentPosition?!!(n.compareDocumentPosition(o)&16):!1:!1}function c1(){for(var n=window,o=Od();o instanceof n.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)n=o.contentWindow;else break;o=Od(n.document)}return o}function Eg(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o&&(o==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||o==="textarea"||n.contentEditable==="true")}function r4(n){var o=c1(),c=n.focusedElem,p=n.selectionRange;if(o!==c&&c&&c.ownerDocument&&l1(c.ownerDocument.documentElement,c)){if(p!==null&&Eg(c)){if(o=p.start,n=p.end,n===void 0&&(n=o),"selectionStart"in c)c.selectionStart=o,c.selectionEnd=Math.min(n,c.value.length);else if(n=(o=c.ownerDocument||document)&&o.defaultView||window,n.getSelection){n=n.getSelection();var v=c.textContent.length,k=Math.min(p.start,v);p=p.end===void 0?k:Math.min(p.end,v),!n.extend&&k>p&&(v=p,p=k,k=v),v=p0(c,k);var S=p0(c,p);v&&S&&(n.rangeCount!==1||n.anchorNode!==v.node||n.anchorOffset!==v.offset||n.focusNode!==S.node||n.focusOffset!==S.offset)&&(o=o.createRange(),o.setStart(v.node,v.offset),n.removeAllRanges(),k>p?(n.addRange(o),n.extend(S.node,S.offset)):(o.setEnd(S.node,S.offset),n.addRange(o)))}}for(o=[],n=c;n=n.parentNode;)n.nodeType===1&&o.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<o.length;c++)n=o[c],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var o4=Do&&"documentMode"in document&&11>=document.documentMode,Cl=null,Fm=null,ku=null,Bm=!1;function f0(n,o,c){var p=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Bm||Cl==null||Cl!==Od(p)||(p=Cl,"selectionStart"in p&&Eg(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),ku&&Bu(ku,p)||(ku=p,p=qd(Fm,"onSelect"),0<p.length&&(o=new kg("onSelect","select",null,o,c),n.push({event:o,listeners:p}),o.target=Cl)))}function gd(n,o){var c={};return c[n.toLowerCase()]=o.toLowerCase(),c["Webkit"+n]="webkit"+o,c["Moz"+n]="moz"+o,c}var El={animationend:gd("Animation","AnimationEnd"),animationiteration:gd("Animation","AnimationIteration"),animationstart:gd("Animation","AnimationStart"),transitionend:gd("Transition","TransitionEnd")},Yf={},u1={};Do&&(u1=document.createElement("div").style,"AnimationEvent"in window||(delete El.animationend.animation,delete El.animationiteration.animation,delete El.animationstart.animation),"TransitionEvent"in window||delete El.transitionend.transition);function dp(n){if(Yf[n])return Yf[n];if(!El[n])return n;var o=El[n],c;for(c in o)if(o.hasOwnProperty(c)&&c in u1)return Yf[n]=o[c];return n}var h1=dp("animationend"),d1=dp("animationiteration"),p1=dp("animationstart"),f1=dp("transitionend"),m1=new Map,m0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function zs(n,o){m1.set(n,o),ba(o,[n])}for(var Jf=0;Jf<m0.length;Jf++){var Qf=m0[Jf],s4=Qf.toLowerCase(),a4=Qf[0].toUpperCase()+Qf.slice(1);zs(s4,"on"+a4)}zs(h1,"onAnimationEnd");zs(d1,"onAnimationIteration");zs(p1,"onAnimationStart");zs("dblclick","onDoubleClick");zs("focusin","onFocus");zs("focusout","onBlur");zs(f1,"onTransitionEnd");$l("onMouseEnter",["mouseout","mouseover"]);$l("onMouseLeave",["mouseout","mouseover"]);$l("onPointerEnter",["pointerout","pointerover"]);$l("onPointerLeave",["pointerout","pointerover"]);ba("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ba("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ba("onBeforeInput",["compositionend","keypress","textInput","paste"]);ba("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ba("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ba("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),l4=new Set("cancel close invalid load scroll toggle".split(" ").concat(xu));function g0(n,o,c){var p=n.type||"unknown-event";n.currentTarget=c,sb(p,o,void 0,n),n.currentTarget=null}function g1(n,o){o=(o&4)!==0;for(var c=0;c<n.length;c++){var p=n[c],v=p.event;p=p.listeners;e:{var k=void 0;if(o)for(var S=p.length-1;0<=S;S--){var d=p[S],$=d.instance,ie=d.currentTarget;if(d=d.listener,$!==k&&v.isPropagationStopped())break e;g0(v,d,ie),k=$}else for(S=0;S<p.length;S++){if(d=p[S],$=d.instance,ie=d.currentTarget,d=d.listener,$!==k&&v.isPropagationStopped())break e;g0(v,d,ie),k=$}}}if(jd)throw n=zm,jd=!1,zm=null,n}function ci(n,o){var c=o[Um];c===void 0&&(c=o[Um]=new Set);var p=n+"__bubble";c.has(p)||(y1(o,n,2,!1),c.add(p))}function em(n,o,c){var p=0;o&&(p|=4),y1(c,n,p,o)}var yd="_reactListening"+Math.random().toString(36).slice(2);function Ou(n){if(!n[yd]){n[yd]=!0,Tv.forEach(function(c){c!=="selectionchange"&&(l4.has(c)||em(c,!1,n),em(c,!0,n))});var o=n.nodeType===9?n:n.ownerDocument;o===null||o[yd]||(o[yd]=!0,em("selectionchange",!1,o))}}function y1(n,o,c,p){switch(e1(o)){case 1:var v=bb;break;case 4:v=Sb;break;default:v=Sg}c=v.bind(null,o,c,n),v=void 0,!Am||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(v=!0),p?v!==void 0?n.addEventListener(o,c,{capture:!0,passive:v}):n.addEventListener(o,c,!0):v!==void 0?n.addEventListener(o,c,{passive:v}):n.addEventListener(o,c,!1)}function tm(n,o,c,p,v){var k=p;if(!(o&1)&&!(o&2)&&p!==null)e:for(;;){if(p===null)return;var S=p.tag;if(S===3||S===4){var d=p.stateNode.containerInfo;if(d===v||d.nodeType===8&&d.parentNode===v)break;if(S===4)for(S=p.return;S!==null;){var $=S.tag;if(($===3||$===4)&&($=S.stateNode.containerInfo,$===v||$.nodeType===8&&$.parentNode===v))return;S=S.return}for(;d!==null;){if(S=da(d),S===null)return;if($=S.tag,$===5||$===6){p=k=S;continue e}d=d.parentNode}}p=p.return}jv(function(){var ie=k,me=vg(c),X=[];e:{var V=m1.get(n);if(V!==void 0){var Te=kg,ke=n;switch(n){case"keypress":if(Md(c)===0)break e;case"keydown":case"keyup":Te=Ob;break;case"focusin":ke="focus",Te=Hf;break;case"focusout":ke="blur",Te=Hf;break;case"beforeblur":case"afterblur":Te=Hf;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Te=r0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Te=Ib;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Te=Vb;break;case h1:case d1:case p1:Te=Pb;break;case f1:Te=$b;break;case"scroll":Te=Tb;break;case"wheel":Te=qb;break;case"copy":case"cut":case"paste":Te=Ab;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Te=s0}var Me=(o&4)!==0,yt=!Me&&n==="scroll",oe=Me?V!==null?V+"Capture":null:V;Me=[];for(var ne=ie,he;ne!==null;){he=ne;var Ie=he.stateNode;if(he.tag===5&&Ie!==null&&(he=Ie,oe!==null&&(Ie=zu(ne,oe),Ie!=null&&Me.push(Nu(ne,Ie,he)))),yt)break;ne=ne.return}0<Me.length&&(V=new Te(V,ke,null,c,me),X.push({event:V,listeners:Me}))}}if(!(o&7)){e:{if(V=n==="mouseover"||n==="pointerover",Te=n==="mouseout"||n==="pointerout",V&&c!==Pm&&(ke=c.relatedTarget||c.fromElement)&&(da(ke)||ke[Lo]))break e;if((Te||V)&&(V=me.window===me?me:(V=me.ownerDocument)?V.defaultView||V.parentWindow:window,Te?(ke=c.relatedTarget||c.toElement,Te=ie,ke=ke?da(ke):null,ke!==null&&(yt=Sa(ke),ke!==yt||ke.tag!==5&&ke.tag!==6)&&(ke=null)):(Te=null,ke=ie),Te!==ke)){if(Me=r0,Ie="onMouseLeave",oe="onMouseEnter",ne="mouse",(n==="pointerout"||n==="pointerover")&&(Me=s0,Ie="onPointerLeave",oe="onPointerEnter",ne="pointer"),yt=Te==null?V:Pl(Te),he=ke==null?V:Pl(ke),V=new Me(Ie,ne+"leave",Te,c,me),V.target=yt,V.relatedTarget=he,Ie=null,da(me)===ie&&(Me=new Me(oe,ne+"enter",ke,c,me),Me.target=he,Me.relatedTarget=yt,Ie=Me),yt=Ie,Te&&ke)t:{for(Me=Te,oe=ke,ne=0,he=Me;he;he=bl(he))ne++;for(he=0,Ie=oe;Ie;Ie=bl(Ie))he++;for(;0<ne-he;)Me=bl(Me),ne--;for(;0<he-ne;)oe=bl(oe),he--;for(;ne--;){if(Me===oe||oe!==null&&Me===oe.alternate)break t;Me=bl(Me),oe=bl(oe)}Me=null}else Me=null;Te!==null&&y0(X,V,Te,Me,!1),ke!==null&&yt!==null&&y0(X,yt,ke,Me,!0)}}e:{if(V=ie?Pl(ie):window,Te=V.nodeName&&V.nodeName.toLowerCase(),Te==="select"||Te==="input"&&V.type==="file")var Be=Jb;else if(c0(V))if(s1)Be=i4;else{Be=e4;var Re=Qb}else(Te=V.nodeName)&&Te.toLowerCase()==="input"&&(V.type==="checkbox"||V.type==="radio")&&(Be=t4);if(Be&&(Be=Be(n,ie))){o1(X,Be,c,me);break e}Re&&Re(n,V,ie),n==="focusout"&&(Re=V._wrapperState)&&Re.controlled&&V.type==="number"&&Tm(V,"number",V.value)}switch(Re=ie?Pl(ie):window,n){case"focusin":(c0(Re)||Re.contentEditable==="true")&&(Cl=Re,Fm=ie,ku=null);break;case"focusout":ku=Fm=Cl=null;break;case"mousedown":Bm=!0;break;case"contextmenu":case"mouseup":case"dragend":Bm=!1,f0(X,c,me);break;case"selectionchange":if(o4)break;case"keydown":case"keyup":f0(X,c,me)}var $e;if(Cg)e:{switch(n){case"compositionstart":var Xe="onCompositionStart";break e;case"compositionend":Xe="onCompositionEnd";break e;case"compositionupdate":Xe="onCompositionUpdate";break e}Xe=void 0}else Il?n1(n,c)&&(Xe="onCompositionEnd"):n==="keydown"&&c.keyCode===229&&(Xe="onCompositionStart");Xe&&(i1&&c.locale!=="ko"&&(Il||Xe!=="onCompositionStart"?Xe==="onCompositionEnd"&&Il&&($e=t1()):(xs=me,Tg="value"in xs?xs.value:xs.textContent,Il=!0)),Re=qd(ie,Xe),0<Re.length&&(Xe=new o0(Xe,n,null,c,me),X.push({event:Xe,listeners:Re}),$e?Xe.data=$e:($e=r1(c),$e!==null&&(Xe.data=$e)))),($e=Wb?Hb(n,c):Kb(n,c))&&(ie=qd(ie,"onBeforeInput"),0<ie.length&&(me=new o0("onBeforeInput","beforeinput",null,c,me),X.push({event:me,listeners:ie}),me.data=$e))}g1(X,o)})}function Nu(n,o,c){return{instance:n,listener:o,currentTarget:c}}function qd(n,o){for(var c=o+"Capture",p=[];n!==null;){var v=n,k=v.stateNode;v.tag===5&&k!==null&&(v=k,k=zu(n,c),k!=null&&p.unshift(Nu(n,k,v)),k=zu(n,o),k!=null&&p.push(Nu(n,k,v))),n=n.return}return p}function bl(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function y0(n,o,c,p,v){for(var k=o._reactName,S=[];c!==null&&c!==p;){var d=c,$=d.alternate,ie=d.stateNode;if($!==null&&$===p)break;d.tag===5&&ie!==null&&(d=ie,v?($=zu(c,k),$!=null&&S.unshift(Nu(c,$,d))):v||($=zu(c,k),$!=null&&S.push(Nu(c,$,d)))),c=c.return}S.length!==0&&n.push({event:o,listeners:S})}var c4=/\r\n?/g,u4=/\u0000|\uFFFD/g;function _0(n){return(typeof n=="string"?n:""+n).replace(c4,`
`).replace(u4,"")}function _d(n,o,c){if(o=_0(o),_0(n)!==o&&c)throw Error(De(425))}function Gd(){}var Om=null,Nm=null;function jm(n,o){return n==="textarea"||n==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Vm=typeof setTimeout=="function"?setTimeout:void 0,h4=typeof clearTimeout=="function"?clearTimeout:void 0,v0=typeof Promise=="function"?Promise:void 0,d4=typeof queueMicrotask=="function"?queueMicrotask:typeof v0<"u"?function(n){return v0.resolve(null).then(n).catch(p4)}:Vm;function p4(n){setTimeout(function(){throw n})}function im(n,o){var c=o,p=0;do{var v=c.nextSibling;if(n.removeChild(c),v&&v.nodeType===8)if(c=v.data,c==="/$"){if(p===0){n.removeChild(v),Ru(o);return}p--}else c!=="$"&&c!=="$?"&&c!=="$!"||p++;c=v}while(c);Ru(o)}function ks(n){for(;n!=null;n=n.nextSibling){var o=n.nodeType;if(o===1||o===3)break;if(o===8){if(o=n.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return n}function x0(n){n=n.previousSibling;for(var o=0;n;){if(n.nodeType===8){var c=n.data;if(c==="$"||c==="$!"||c==="$?"){if(o===0)return n;o--}else c==="/$"&&o++}n=n.previousSibling}return null}var Jl=Math.random().toString(36).slice(2),ao="__reactFiber$"+Jl,ju="__reactProps$"+Jl,Lo="__reactContainer$"+Jl,Um="__reactEvents$"+Jl,f4="__reactListeners$"+Jl,m4="__reactHandles$"+Jl;function da(n){var o=n[ao];if(o)return o;for(var c=n.parentNode;c;){if(o=c[Lo]||c[ao]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(n=x0(n);n!==null;){if(c=n[ao])return c;n=x0(n)}return o}n=c,c=n.parentNode}return null}function Xu(n){return n=n[ao]||n[Lo],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Pl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(De(33))}function pp(n){return n[ju]||null}var $m=[],Ml=-1;function Ds(n){return{current:n}}function ui(n){0>Ml||(n.current=$m[Ml],$m[Ml]=null,Ml--)}function ri(n,o){Ml++,$m[Ml]=n.current,n.current=o}var As={},En=Ds(As),Xn=Ds(!1),ya=As;function Zl(n,o){var c=n.type.contextTypes;if(!c)return As;var p=n.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===o)return p.__reactInternalMemoizedMaskedChildContext;var v={},k;for(k in c)v[k]=o[k];return p&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=o,n.__reactInternalMemoizedMaskedChildContext=v),v}function Yn(n){return n=n.childContextTypes,n!=null}function Wd(){ui(Xn),ui(En)}function w0(n,o,c){if(En.current!==As)throw Error(De(168));ri(En,o),ri(Xn,c)}function _1(n,o,c){var p=n.stateNode;if(o=o.childContextTypes,typeof p.getChildContext!="function")return c;p=p.getChildContext();for(var v in p)if(!(v in o))throw Error(De(108,Q2(n)||"Unknown",v));return vi({},c,p)}function Hd(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||As,ya=En.current,ri(En,n),ri(Xn,Xn.current),!0}function b0(n,o,c){var p=n.stateNode;if(!p)throw Error(De(169));c?(n=_1(n,o,ya),p.__reactInternalMemoizedMergedChildContext=n,ui(Xn),ui(En),ri(En,n)):ui(Xn),ri(Xn,c)}var Po=null,fp=!1,nm=!1;function v1(n){Po===null?Po=[n]:Po.push(n)}function g4(n){fp=!0,v1(n)}function Ls(){if(!nm&&Po!==null){nm=!0;var n=0,o=Gt;try{var c=Po;for(Gt=1;n<c.length;n++){var p=c[n];do p=p(!0);while(p!==null)}Po=null,fp=!1}catch(v){throw Po!==null&&(Po=Po.slice(n+1)),Zv(xg,Ls),v}finally{Gt=o,nm=!1}}return null}var Al=[],zl=0,Kd=null,Xd=0,xr=[],wr=0,_a=null,Mo=1,Ao="";function ua(n,o){Al[zl++]=Xd,Al[zl++]=Kd,Kd=n,Xd=o}function x1(n,o,c){xr[wr++]=Mo,xr[wr++]=Ao,xr[wr++]=_a,_a=n;var p=Mo;n=Ao;var v=32-$r(p)-1;p&=~(1<<v),c+=1;var k=32-$r(o)+v;if(30<k){var S=v-v%5;k=(p&(1<<S)-1).toString(32),p>>=S,v-=S,Mo=1<<32-$r(o)+v|c<<v|p,Ao=k+n}else Mo=1<<k|c<<v|p,Ao=n}function Pg(n){n.return!==null&&(ua(n,1),x1(n,1,0))}function Mg(n){for(;n===Kd;)Kd=Al[--zl],Al[zl]=null,Xd=Al[--zl],Al[zl]=null;for(;n===_a;)_a=xr[--wr],xr[wr]=null,Ao=xr[--wr],xr[wr]=null,Mo=xr[--wr],xr[wr]=null}var ur=null,cr=null,mi=!1,Ur=null;function w1(n,o){var c=br(5,null,null,0);c.elementType="DELETED",c.stateNode=o,c.return=n,o=n.deletions,o===null?(n.deletions=[c],n.flags|=16):o.push(c)}function S0(n,o){switch(n.tag){case 5:var c=n.type;return o=o.nodeType!==1||c.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(n.stateNode=o,ur=n,cr=ks(o.firstChild),!0):!1;case 6:return o=n.pendingProps===""||o.nodeType!==3?null:o,o!==null?(n.stateNode=o,ur=n,cr=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(c=_a!==null?{id:Mo,overflow:Ao}:null,n.memoizedState={dehydrated:o,treeContext:c,retryLane:1073741824},c=br(18,null,null,0),c.stateNode=o,c.return=n,n.child=c,ur=n,cr=null,!0):!1;default:return!1}}function Zm(n){return(n.mode&1)!==0&&(n.flags&128)===0}function qm(n){if(mi){var o=cr;if(o){var c=o;if(!S0(n,o)){if(Zm(n))throw Error(De(418));o=ks(c.nextSibling);var p=ur;o&&S0(n,o)?w1(p,c):(n.flags=n.flags&-4097|2,mi=!1,ur=n)}}else{if(Zm(n))throw Error(De(418));n.flags=n.flags&-4097|2,mi=!1,ur=n}}}function T0(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;ur=n}function vd(n){if(n!==ur)return!1;if(!mi)return T0(n),mi=!0,!1;var o;if((o=n.tag!==3)&&!(o=n.tag!==5)&&(o=n.type,o=o!=="head"&&o!=="body"&&!jm(n.type,n.memoizedProps)),o&&(o=cr)){if(Zm(n))throw b1(),Error(De(418));for(;o;)w1(n,o),o=ks(o.nextSibling)}if(T0(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(De(317));e:{for(n=n.nextSibling,o=0;n;){if(n.nodeType===8){var c=n.data;if(c==="/$"){if(o===0){cr=ks(n.nextSibling);break e}o--}else c!=="$"&&c!=="$!"&&c!=="$?"||o++}n=n.nextSibling}cr=null}}else cr=ur?ks(n.stateNode.nextSibling):null;return!0}function b1(){for(var n=cr;n;)n=ks(n.nextSibling)}function ql(){cr=ur=null,mi=!1}function Ag(n){Ur===null?Ur=[n]:Ur.push(n)}var y4=Bo.ReactCurrentBatchConfig;function pu(n,o,c){if(n=c.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(De(309));var p=c.stateNode}if(!p)throw Error(De(147,n));var v=p,k=""+n;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===k?o.ref:(o=function(S){var d=v.refs;S===null?delete d[k]:d[k]=S},o._stringRef=k,o)}if(typeof n!="string")throw Error(De(284));if(!c._owner)throw Error(De(290,n))}return n}function xd(n,o){throw n=Object.prototype.toString.call(o),Error(De(31,n==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":n))}function k0(n){var o=n._init;return o(n._payload)}function S1(n){function o(oe,ne){if(n){var he=oe.deletions;he===null?(oe.deletions=[ne],oe.flags|=16):he.push(ne)}}function c(oe,ne){if(!n)return null;for(;ne!==null;)o(oe,ne),ne=ne.sibling;return null}function p(oe,ne){for(oe=new Map;ne!==null;)ne.key!==null?oe.set(ne.key,ne):oe.set(ne.index,ne),ne=ne.sibling;return oe}function v(oe,ne){return oe=Ps(oe,ne),oe.index=0,oe.sibling=null,oe}function k(oe,ne,he){return oe.index=he,n?(he=oe.alternate,he!==null?(he=he.index,he<ne?(oe.flags|=2,ne):he):(oe.flags|=2,ne)):(oe.flags|=1048576,ne)}function S(oe){return n&&oe.alternate===null&&(oe.flags|=2),oe}function d(oe,ne,he,Ie){return ne===null||ne.tag!==6?(ne=um(he,oe.mode,Ie),ne.return=oe,ne):(ne=v(ne,he),ne.return=oe,ne)}function $(oe,ne,he,Ie){var Be=he.type;return Be===kl?me(oe,ne,he.props.children,Ie,he.key):ne!==null&&(ne.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===gs&&k0(Be)===ne.type)?(Ie=v(ne,he.props),Ie.ref=pu(oe,ne,he),Ie.return=oe,Ie):(Ie=Bd(he.type,he.key,he.props,null,oe.mode,Ie),Ie.ref=pu(oe,ne,he),Ie.return=oe,Ie)}function ie(oe,ne,he,Ie){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==he.containerInfo||ne.stateNode.implementation!==he.implementation?(ne=hm(he,oe.mode,Ie),ne.return=oe,ne):(ne=v(ne,he.children||[]),ne.return=oe,ne)}function me(oe,ne,he,Ie,Be){return ne===null||ne.tag!==7?(ne=ga(he,oe.mode,Ie,Be),ne.return=oe,ne):(ne=v(ne,he),ne.return=oe,ne)}function X(oe,ne,he){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return ne=um(""+ne,oe.mode,he),ne.return=oe,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case cd:return he=Bd(ne.type,ne.key,ne.props,null,oe.mode,he),he.ref=pu(oe,null,ne),he.return=oe,he;case Tl:return ne=hm(ne,oe.mode,he),ne.return=oe,ne;case gs:var Ie=ne._init;return X(oe,Ie(ne._payload),he)}if(_u(ne)||lu(ne))return ne=ga(ne,oe.mode,he,null),ne.return=oe,ne;xd(oe,ne)}return null}function V(oe,ne,he,Ie){var Be=ne!==null?ne.key:null;if(typeof he=="string"&&he!==""||typeof he=="number")return Be!==null?null:d(oe,ne,""+he,Ie);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case cd:return he.key===Be?$(oe,ne,he,Ie):null;case Tl:return he.key===Be?ie(oe,ne,he,Ie):null;case gs:return Be=he._init,V(oe,ne,Be(he._payload),Ie)}if(_u(he)||lu(he))return Be!==null?null:me(oe,ne,he,Ie,null);xd(oe,he)}return null}function Te(oe,ne,he,Ie,Be){if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number")return oe=oe.get(he)||null,d(ne,oe,""+Ie,Be);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case cd:return oe=oe.get(Ie.key===null?he:Ie.key)||null,$(ne,oe,Ie,Be);case Tl:return oe=oe.get(Ie.key===null?he:Ie.key)||null,ie(ne,oe,Ie,Be);case gs:var Re=Ie._init;return Te(oe,ne,he,Re(Ie._payload),Be)}if(_u(Ie)||lu(Ie))return oe=oe.get(he)||null,me(ne,oe,Ie,Be,null);xd(ne,Ie)}return null}function ke(oe,ne,he,Ie){for(var Be=null,Re=null,$e=ne,Xe=ne=0,xt=null;$e!==null&&Xe<he.length;Xe++){$e.index>Xe?(xt=$e,$e=null):xt=$e.sibling;var rt=V(oe,$e,he[Xe],Ie);if(rt===null){$e===null&&($e=xt);break}n&&$e&&rt.alternate===null&&o(oe,$e),ne=k(rt,ne,Xe),Re===null?Be=rt:Re.sibling=rt,Re=rt,$e=xt}if(Xe===he.length)return c(oe,$e),mi&&ua(oe,Xe),Be;if($e===null){for(;Xe<he.length;Xe++)$e=X(oe,he[Xe],Ie),$e!==null&&(ne=k($e,ne,Xe),Re===null?Be=$e:Re.sibling=$e,Re=$e);return mi&&ua(oe,Xe),Be}for($e=p(oe,$e);Xe<he.length;Xe++)xt=Te($e,oe,Xe,he[Xe],Ie),xt!==null&&(n&&xt.alternate!==null&&$e.delete(xt.key===null?Xe:xt.key),ne=k(xt,ne,Xe),Re===null?Be=xt:Re.sibling=xt,Re=xt);return n&&$e.forEach(function(pt){return o(oe,pt)}),mi&&ua(oe,Xe),Be}function Me(oe,ne,he,Ie){var Be=lu(he);if(typeof Be!="function")throw Error(De(150));if(he=Be.call(he),he==null)throw Error(De(151));for(var Re=Be=null,$e=ne,Xe=ne=0,xt=null,rt=he.next();$e!==null&&!rt.done;Xe++,rt=he.next()){$e.index>Xe?(xt=$e,$e=null):xt=$e.sibling;var pt=V(oe,$e,rt.value,Ie);if(pt===null){$e===null&&($e=xt);break}n&&$e&&pt.alternate===null&&o(oe,$e),ne=k(pt,ne,Xe),Re===null?Be=pt:Re.sibling=pt,Re=pt,$e=xt}if(rt.done)return c(oe,$e),mi&&ua(oe,Xe),Be;if($e===null){for(;!rt.done;Xe++,rt=he.next())rt=X(oe,rt.value,Ie),rt!==null&&(ne=k(rt,ne,Xe),Re===null?Be=rt:Re.sibling=rt,Re=rt);return mi&&ua(oe,Xe),Be}for($e=p(oe,$e);!rt.done;Xe++,rt=he.next())rt=Te($e,oe,Xe,rt.value,Ie),rt!==null&&(n&&rt.alternate!==null&&$e.delete(rt.key===null?Xe:rt.key),ne=k(rt,ne,Xe),Re===null?Be=rt:Re.sibling=rt,Re=rt);return n&&$e.forEach(function(oi){return o(oe,oi)}),mi&&ua(oe,Xe),Be}function yt(oe,ne,he,Ie){if(typeof he=="object"&&he!==null&&he.type===kl&&he.key===null&&(he=he.props.children),typeof he=="object"&&he!==null){switch(he.$$typeof){case cd:e:{for(var Be=he.key,Re=ne;Re!==null;){if(Re.key===Be){if(Be=he.type,Be===kl){if(Re.tag===7){c(oe,Re.sibling),ne=v(Re,he.props.children),ne.return=oe,oe=ne;break e}}else if(Re.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===gs&&k0(Be)===Re.type){c(oe,Re.sibling),ne=v(Re,he.props),ne.ref=pu(oe,Re,he),ne.return=oe,oe=ne;break e}c(oe,Re);break}else o(oe,Re);Re=Re.sibling}he.type===kl?(ne=ga(he.props.children,oe.mode,Ie,he.key),ne.return=oe,oe=ne):(Ie=Bd(he.type,he.key,he.props,null,oe.mode,Ie),Ie.ref=pu(oe,ne,he),Ie.return=oe,oe=Ie)}return S(oe);case Tl:e:{for(Re=he.key;ne!==null;){if(ne.key===Re)if(ne.tag===4&&ne.stateNode.containerInfo===he.containerInfo&&ne.stateNode.implementation===he.implementation){c(oe,ne.sibling),ne=v(ne,he.children||[]),ne.return=oe,oe=ne;break e}else{c(oe,ne);break}else o(oe,ne);ne=ne.sibling}ne=hm(he,oe.mode,Ie),ne.return=oe,oe=ne}return S(oe);case gs:return Re=he._init,yt(oe,ne,Re(he._payload),Ie)}if(_u(he))return ke(oe,ne,he,Ie);if(lu(he))return Me(oe,ne,he,Ie);xd(oe,he)}return typeof he=="string"&&he!==""||typeof he=="number"?(he=""+he,ne!==null&&ne.tag===6?(c(oe,ne.sibling),ne=v(ne,he),ne.return=oe,oe=ne):(c(oe,ne),ne=um(he,oe.mode,Ie),ne.return=oe,oe=ne),S(oe)):c(oe,ne)}return yt}var Gl=S1(!0),T1=S1(!1),Yd=Ds(null),Jd=null,Dl=null,zg=null;function Dg(){zg=Dl=Jd=null}function Lg(n){var o=Yd.current;ui(Yd),n._currentValue=o}function Gm(n,o,c){for(;n!==null;){var p=n.alternate;if((n.childLanes&o)!==o?(n.childLanes|=o,p!==null&&(p.childLanes|=o)):p!==null&&(p.childLanes&o)!==o&&(p.childLanes|=o),n===c)break;n=n.return}}function jl(n,o){Jd=n,zg=Dl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&o&&(Kn=!0),n.firstContext=null)}function Tr(n){var o=n._currentValue;if(zg!==n)if(n={context:n,memoizedValue:o,next:null},Dl===null){if(Jd===null)throw Error(De(308));Dl=n,Jd.dependencies={lanes:0,firstContext:n}}else Dl=Dl.next=n;return o}var pa=null;function Rg(n){pa===null?pa=[n]:pa.push(n)}function k1(n,o,c,p){var v=o.interleaved;return v===null?(c.next=c,Rg(o)):(c.next=v.next,v.next=c),o.interleaved=c,Ro(n,p)}function Ro(n,o){n.lanes|=o;var c=n.alternate;for(c!==null&&(c.lanes|=o),c=n,n=n.return;n!==null;)n.childLanes|=o,c=n.alternate,c!==null&&(c.childLanes|=o),c=n,n=n.return;return c.tag===3?c.stateNode:null}var ys=!1;function Fg(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function I1(n,o){n=n.updateQueue,o.updateQueue===n&&(o.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function zo(n,o){return{eventTime:n,lane:o,tag:0,payload:null,callback:null,next:null}}function Is(n,o,c){var p=n.updateQueue;if(p===null)return null;if(p=p.shared,Bt&2){var v=p.pending;return v===null?o.next=o:(o.next=v.next,v.next=o),p.pending=o,Ro(n,c)}return v=p.interleaved,v===null?(o.next=o,Rg(p)):(o.next=v.next,v.next=o),p.interleaved=o,Ro(n,c)}function Ad(n,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194240)!==0)){var p=o.lanes;p&=n.pendingLanes,c|=p,o.lanes=c,wg(n,c)}}function I0(n,o){var c=n.updateQueue,p=n.alternate;if(p!==null&&(p=p.updateQueue,c===p)){var v=null,k=null;if(c=c.firstBaseUpdate,c!==null){do{var S={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};k===null?v=k=S:k=k.next=S,c=c.next}while(c!==null);k===null?v=k=o:k=k.next=o}else v=k=o;c={baseState:p.baseState,firstBaseUpdate:v,lastBaseUpdate:k,shared:p.shared,effects:p.effects},n.updateQueue=c;return}n=c.lastBaseUpdate,n===null?c.firstBaseUpdate=o:n.next=o,c.lastBaseUpdate=o}function Qd(n,o,c,p){var v=n.updateQueue;ys=!1;var k=v.firstBaseUpdate,S=v.lastBaseUpdate,d=v.shared.pending;if(d!==null){v.shared.pending=null;var $=d,ie=$.next;$.next=null,S===null?k=ie:S.next=ie,S=$;var me=n.alternate;me!==null&&(me=me.updateQueue,d=me.lastBaseUpdate,d!==S&&(d===null?me.firstBaseUpdate=ie:d.next=ie,me.lastBaseUpdate=$))}if(k!==null){var X=v.baseState;S=0,me=ie=$=null,d=k;do{var V=d.lane,Te=d.eventTime;if((p&V)===V){me!==null&&(me=me.next={eventTime:Te,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var ke=n,Me=d;switch(V=o,Te=c,Me.tag){case 1:if(ke=Me.payload,typeof ke=="function"){X=ke.call(Te,X,V);break e}X=ke;break e;case 3:ke.flags=ke.flags&-65537|128;case 0:if(ke=Me.payload,V=typeof ke=="function"?ke.call(Te,X,V):ke,V==null)break e;X=vi({},X,V);break e;case 2:ys=!0}}d.callback!==null&&d.lane!==0&&(n.flags|=64,V=v.effects,V===null?v.effects=[d]:V.push(d))}else Te={eventTime:Te,lane:V,tag:d.tag,payload:d.payload,callback:d.callback,next:null},me===null?(ie=me=Te,$=X):me=me.next=Te,S|=V;if(d=d.next,d===null){if(d=v.shared.pending,d===null)break;V=d,d=V.next,V.next=null,v.lastBaseUpdate=V,v.shared.pending=null}}while(!0);if(me===null&&($=X),v.baseState=$,v.firstBaseUpdate=ie,v.lastBaseUpdate=me,o=v.shared.interleaved,o!==null){v=o;do S|=v.lane,v=v.next;while(v!==o)}else k===null&&(v.shared.lanes=0);xa|=S,n.lanes=S,n.memoizedState=X}}function C0(n,o,c){if(n=o.effects,o.effects=null,n!==null)for(o=0;o<n.length;o++){var p=n[o],v=p.callback;if(v!==null){if(p.callback=null,p=c,typeof v!="function")throw Error(De(191,v));v.call(p)}}}var Yu={},co=Ds(Yu),Vu=Ds(Yu),Uu=Ds(Yu);function fa(n){if(n===Yu)throw Error(De(174));return n}function Bg(n,o){switch(ri(Uu,o),ri(Vu,n),ri(co,Yu),n=o.nodeType,n){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Im(null,"");break;default:n=n===8?o.parentNode:o,o=n.namespaceURI||null,n=n.tagName,o=Im(o,n)}ui(co),ri(co,o)}function Wl(){ui(co),ui(Vu),ui(Uu)}function C1(n){fa(Uu.current);var o=fa(co.current),c=Im(o,n.type);o!==c&&(ri(Vu,n),ri(co,c))}function Og(n){Vu.current===n&&(ui(co),ui(Vu))}var yi=Ds(0);function ep(n){for(var o=n;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var rm=[];function Ng(){for(var n=0;n<rm.length;n++)rm[n]._workInProgressVersionPrimary=null;rm.length=0}var zd=Bo.ReactCurrentDispatcher,om=Bo.ReactCurrentBatchConfig,va=0,_i=null,ji=null,en=null,tp=!1,Iu=!1,$u=0,_4=0;function kn(){throw Error(De(321))}function jg(n,o){if(o===null)return!1;for(var c=0;c<o.length&&c<n.length;c++)if(!qr(n[c],o[c]))return!1;return!0}function Vg(n,o,c,p,v,k){if(va=k,_i=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,zd.current=n===null||n.memoizedState===null?b4:S4,n=c(p,v),Iu){k=0;do{if(Iu=!1,$u=0,25<=k)throw Error(De(301));k+=1,en=ji=null,o.updateQueue=null,zd.current=T4,n=c(p,v)}while(Iu)}if(zd.current=ip,o=ji!==null&&ji.next!==null,va=0,en=ji=_i=null,tp=!1,o)throw Error(De(300));return n}function Ug(){var n=$u!==0;return $u=0,n}function so(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return en===null?_i.memoizedState=en=n:en=en.next=n,en}function kr(){if(ji===null){var n=_i.alternate;n=n!==null?n.memoizedState:null}else n=ji.next;var o=en===null?_i.memoizedState:en.next;if(o!==null)en=o,ji=n;else{if(n===null)throw Error(De(310));ji=n,n={memoizedState:ji.memoizedState,baseState:ji.baseState,baseQueue:ji.baseQueue,queue:ji.queue,next:null},en===null?_i.memoizedState=en=n:en=en.next=n}return en}function Zu(n,o){return typeof o=="function"?o(n):o}function sm(n){var o=kr(),c=o.queue;if(c===null)throw Error(De(311));c.lastRenderedReducer=n;var p=ji,v=p.baseQueue,k=c.pending;if(k!==null){if(v!==null){var S=v.next;v.next=k.next,k.next=S}p.baseQueue=v=k,c.pending=null}if(v!==null){k=v.next,p=p.baseState;var d=S=null,$=null,ie=k;do{var me=ie.lane;if((va&me)===me)$!==null&&($=$.next={lane:0,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null}),p=ie.hasEagerState?ie.eagerState:n(p,ie.action);else{var X={lane:me,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null};$===null?(d=$=X,S=p):$=$.next=X,_i.lanes|=me,xa|=me}ie=ie.next}while(ie!==null&&ie!==k);$===null?S=p:$.next=d,qr(p,o.memoizedState)||(Kn=!0),o.memoizedState=p,o.baseState=S,o.baseQueue=$,c.lastRenderedState=p}if(n=c.interleaved,n!==null){v=n;do k=v.lane,_i.lanes|=k,xa|=k,v=v.next;while(v!==n)}else v===null&&(c.lanes=0);return[o.memoizedState,c.dispatch]}function am(n){var o=kr(),c=o.queue;if(c===null)throw Error(De(311));c.lastRenderedReducer=n;var p=c.dispatch,v=c.pending,k=o.memoizedState;if(v!==null){c.pending=null;var S=v=v.next;do k=n(k,S.action),S=S.next;while(S!==v);qr(k,o.memoizedState)||(Kn=!0),o.memoizedState=k,o.baseQueue===null&&(o.baseState=k),c.lastRenderedState=k}return[k,p]}function E1(){}function P1(n,o){var c=_i,p=kr(),v=o(),k=!qr(p.memoizedState,v);if(k&&(p.memoizedState=v,Kn=!0),p=p.queue,$g(z1.bind(null,c,p,n),[n]),p.getSnapshot!==o||k||en!==null&&en.memoizedState.tag&1){if(c.flags|=2048,qu(9,A1.bind(null,c,p,v,o),void 0,null),tn===null)throw Error(De(349));va&30||M1(c,o,v)}return v}function M1(n,o,c){n.flags|=16384,n={getSnapshot:o,value:c},o=_i.updateQueue,o===null?(o={lastEffect:null,stores:null},_i.updateQueue=o,o.stores=[n]):(c=o.stores,c===null?o.stores=[n]:c.push(n))}function A1(n,o,c,p){o.value=c,o.getSnapshot=p,D1(o)&&L1(n)}function z1(n,o,c){return c(function(){D1(o)&&L1(n)})}function D1(n){var o=n.getSnapshot;n=n.value;try{var c=o();return!qr(n,c)}catch{return!0}}function L1(n){var o=Ro(n,1);o!==null&&Zr(o,n,1,-1)}function E0(n){var o=so();return typeof n=="function"&&(n=n()),o.memoizedState=o.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zu,lastRenderedState:n},o.queue=n,n=n.dispatch=w4.bind(null,_i,n),[o.memoizedState,n]}function qu(n,o,c,p){return n={tag:n,create:o,destroy:c,deps:p,next:null},o=_i.updateQueue,o===null?(o={lastEffect:null,stores:null},_i.updateQueue=o,o.lastEffect=n.next=n):(c=o.lastEffect,c===null?o.lastEffect=n.next=n:(p=c.next,c.next=n,n.next=p,o.lastEffect=n)),n}function R1(){return kr().memoizedState}function Dd(n,o,c,p){var v=so();_i.flags|=n,v.memoizedState=qu(1|o,c,void 0,p===void 0?null:p)}function mp(n,o,c,p){var v=kr();p=p===void 0?null:p;var k=void 0;if(ji!==null){var S=ji.memoizedState;if(k=S.destroy,p!==null&&jg(p,S.deps)){v.memoizedState=qu(o,c,k,p);return}}_i.flags|=n,v.memoizedState=qu(1|o,c,k,p)}function P0(n,o){return Dd(8390656,8,n,o)}function $g(n,o){return mp(2048,8,n,o)}function F1(n,o){return mp(4,2,n,o)}function B1(n,o){return mp(4,4,n,o)}function O1(n,o){if(typeof o=="function")return n=n(),o(n),function(){o(null)};if(o!=null)return n=n(),o.current=n,function(){o.current=null}}function N1(n,o,c){return c=c!=null?c.concat([n]):null,mp(4,4,O1.bind(null,o,n),c)}function Zg(){}function j1(n,o){var c=kr();o=o===void 0?null:o;var p=c.memoizedState;return p!==null&&o!==null&&jg(o,p[1])?p[0]:(c.memoizedState=[n,o],n)}function V1(n,o){var c=kr();o=o===void 0?null:o;var p=c.memoizedState;return p!==null&&o!==null&&jg(o,p[1])?p[0]:(n=n(),c.memoizedState=[n,o],n)}function U1(n,o,c){return va&21?(qr(c,o)||(c=Wv(),_i.lanes|=c,xa|=c,n.baseState=!0),o):(n.baseState&&(n.baseState=!1,Kn=!0),n.memoizedState=c)}function v4(n,o){var c=Gt;Gt=c!==0&&4>c?c:4,n(!0);var p=om.transition;om.transition={};try{n(!1),o()}finally{Gt=c,om.transition=p}}function $1(){return kr().memoizedState}function x4(n,o,c){var p=Es(n);if(c={lane:p,action:c,hasEagerState:!1,eagerState:null,next:null},Z1(n))q1(o,c);else if(c=k1(n,o,c,p),c!==null){var v=Vn();Zr(c,n,p,v),G1(c,o,p)}}function w4(n,o,c){var p=Es(n),v={lane:p,action:c,hasEagerState:!1,eagerState:null,next:null};if(Z1(n))q1(o,v);else{var k=n.alternate;if(n.lanes===0&&(k===null||k.lanes===0)&&(k=o.lastRenderedReducer,k!==null))try{var S=o.lastRenderedState,d=k(S,c);if(v.hasEagerState=!0,v.eagerState=d,qr(d,S)){var $=o.interleaved;$===null?(v.next=v,Rg(o)):(v.next=$.next,$.next=v),o.interleaved=v;return}}catch{}finally{}c=k1(n,o,v,p),c!==null&&(v=Vn(),Zr(c,n,p,v),G1(c,o,p))}}function Z1(n){var o=n.alternate;return n===_i||o!==null&&o===_i}function q1(n,o){Iu=tp=!0;var c=n.pending;c===null?o.next=o:(o.next=c.next,c.next=o),n.pending=o}function G1(n,o,c){if(c&4194240){var p=o.lanes;p&=n.pendingLanes,c|=p,o.lanes=c,wg(n,c)}}var ip={readContext:Tr,useCallback:kn,useContext:kn,useEffect:kn,useImperativeHandle:kn,useInsertionEffect:kn,useLayoutEffect:kn,useMemo:kn,useReducer:kn,useRef:kn,useState:kn,useDebugValue:kn,useDeferredValue:kn,useTransition:kn,useMutableSource:kn,useSyncExternalStore:kn,useId:kn,unstable_isNewReconciler:!1},b4={readContext:Tr,useCallback:function(n,o){return so().memoizedState=[n,o===void 0?null:o],n},useContext:Tr,useEffect:P0,useImperativeHandle:function(n,o,c){return c=c!=null?c.concat([n]):null,Dd(4194308,4,O1.bind(null,o,n),c)},useLayoutEffect:function(n,o){return Dd(4194308,4,n,o)},useInsertionEffect:function(n,o){return Dd(4,2,n,o)},useMemo:function(n,o){var c=so();return o=o===void 0?null:o,n=n(),c.memoizedState=[n,o],n},useReducer:function(n,o,c){var p=so();return o=c!==void 0?c(o):o,p.memoizedState=p.baseState=o,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:o},p.queue=n,n=n.dispatch=x4.bind(null,_i,n),[p.memoizedState,n]},useRef:function(n){var o=so();return n={current:n},o.memoizedState=n},useState:E0,useDebugValue:Zg,useDeferredValue:function(n){return so().memoizedState=n},useTransition:function(){var n=E0(!1),o=n[0];return n=v4.bind(null,n[1]),so().memoizedState=n,[o,n]},useMutableSource:function(){},useSyncExternalStore:function(n,o,c){var p=_i,v=so();if(mi){if(c===void 0)throw Error(De(407));c=c()}else{if(c=o(),tn===null)throw Error(De(349));va&30||M1(p,o,c)}v.memoizedState=c;var k={value:c,getSnapshot:o};return v.queue=k,P0(z1.bind(null,p,k,n),[n]),p.flags|=2048,qu(9,A1.bind(null,p,k,c,o),void 0,null),c},useId:function(){var n=so(),o=tn.identifierPrefix;if(mi){var c=Ao,p=Mo;c=(p&~(1<<32-$r(p)-1)).toString(32)+c,o=":"+o+"R"+c,c=$u++,0<c&&(o+="H"+c.toString(32)),o+=":"}else c=_4++,o=":"+o+"r"+c.toString(32)+":";return n.memoizedState=o},unstable_isNewReconciler:!1},S4={readContext:Tr,useCallback:j1,useContext:Tr,useEffect:$g,useImperativeHandle:N1,useInsertionEffect:F1,useLayoutEffect:B1,useMemo:V1,useReducer:sm,useRef:R1,useState:function(){return sm(Zu)},useDebugValue:Zg,useDeferredValue:function(n){var o=kr();return U1(o,ji.memoizedState,n)},useTransition:function(){var n=sm(Zu)[0],o=kr().memoizedState;return[n,o]},useMutableSource:E1,useSyncExternalStore:P1,useId:$1,unstable_isNewReconciler:!1},T4={readContext:Tr,useCallback:j1,useContext:Tr,useEffect:$g,useImperativeHandle:N1,useInsertionEffect:F1,useLayoutEffect:B1,useMemo:V1,useReducer:am,useRef:R1,useState:function(){return am(Zu)},useDebugValue:Zg,useDeferredValue:function(n){var o=kr();return ji===null?o.memoizedState=n:U1(o,ji.memoizedState,n)},useTransition:function(){var n=am(Zu)[0],o=kr().memoizedState;return[n,o]},useMutableSource:E1,useSyncExternalStore:P1,useId:$1,unstable_isNewReconciler:!1};function jr(n,o){if(n&&n.defaultProps){o=vi({},o),n=n.defaultProps;for(var c in n)o[c]===void 0&&(o[c]=n[c]);return o}return o}function Wm(n,o,c,p){o=n.memoizedState,c=c(p,o),c=c==null?o:vi({},o,c),n.memoizedState=c,n.lanes===0&&(n.updateQueue.baseState=c)}var gp={isMounted:function(n){return(n=n._reactInternals)?Sa(n)===n:!1},enqueueSetState:function(n,o,c){n=n._reactInternals;var p=Vn(),v=Es(n),k=zo(p,v);k.payload=o,c!=null&&(k.callback=c),o=Is(n,k,v),o!==null&&(Zr(o,n,v,p),Ad(o,n,v))},enqueueReplaceState:function(n,o,c){n=n._reactInternals;var p=Vn(),v=Es(n),k=zo(p,v);k.tag=1,k.payload=o,c!=null&&(k.callback=c),o=Is(n,k,v),o!==null&&(Zr(o,n,v,p),Ad(o,n,v))},enqueueForceUpdate:function(n,o){n=n._reactInternals;var c=Vn(),p=Es(n),v=zo(c,p);v.tag=2,o!=null&&(v.callback=o),o=Is(n,v,p),o!==null&&(Zr(o,n,p,c),Ad(o,n,p))}};function M0(n,o,c,p,v,k,S){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(p,k,S):o.prototype&&o.prototype.isPureReactComponent?!Bu(c,p)||!Bu(v,k):!0}function W1(n,o,c){var p=!1,v=As,k=o.contextType;return typeof k=="object"&&k!==null?k=Tr(k):(v=Yn(o)?ya:En.current,p=o.contextTypes,k=(p=p!=null)?Zl(n,v):As),o=new o(c,k),n.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=gp,n.stateNode=o,o._reactInternals=n,p&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=v,n.__reactInternalMemoizedMaskedChildContext=k),o}function A0(n,o,c,p){n=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,p),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,p),o.state!==n&&gp.enqueueReplaceState(o,o.state,null)}function Hm(n,o,c,p){var v=n.stateNode;v.props=c,v.state=n.memoizedState,v.refs={},Fg(n);var k=o.contextType;typeof k=="object"&&k!==null?v.context=Tr(k):(k=Yn(o)?ya:En.current,v.context=Zl(n,k)),v.state=n.memoizedState,k=o.getDerivedStateFromProps,typeof k=="function"&&(Wm(n,o,k,c),v.state=n.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(o=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),o!==v.state&&gp.enqueueReplaceState(v,v.state,null),Qd(n,c,v,p),v.state=n.memoizedState),typeof v.componentDidMount=="function"&&(n.flags|=4194308)}function Hl(n,o){try{var c="",p=o;do c+=J2(p),p=p.return;while(p);var v=c}catch(k){v=`
Error generating stack: `+k.message+`
`+k.stack}return{value:n,source:o,stack:v,digest:null}}function lm(n,o,c){return{value:n,source:null,stack:c??null,digest:o??null}}function Km(n,o){try{console.error(o.value)}catch(c){setTimeout(function(){throw c})}}var k4=typeof WeakMap=="function"?WeakMap:Map;function H1(n,o,c){c=zo(-1,c),c.tag=3,c.payload={element:null};var p=o.value;return c.callback=function(){rp||(rp=!0,og=p),Km(n,o)},c}function K1(n,o,c){c=zo(-1,c),c.tag=3;var p=n.type.getDerivedStateFromError;if(typeof p=="function"){var v=o.value;c.payload=function(){return p(v)},c.callback=function(){Km(n,o)}}var k=n.stateNode;return k!==null&&typeof k.componentDidCatch=="function"&&(c.callback=function(){Km(n,o),typeof p!="function"&&(Cs===null?Cs=new Set([this]):Cs.add(this));var S=o.stack;this.componentDidCatch(o.value,{componentStack:S!==null?S:""})}),c}function z0(n,o,c){var p=n.pingCache;if(p===null){p=n.pingCache=new k4;var v=new Set;p.set(o,v)}else v=p.get(o),v===void 0&&(v=new Set,p.set(o,v));v.has(c)||(v.add(c),n=N4.bind(null,n,o,c),o.then(n,n))}function D0(n){do{var o;if((o=n.tag===13)&&(o=n.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return n;n=n.return}while(n!==null);return null}function L0(n,o,c,p,v){return n.mode&1?(n.flags|=65536,n.lanes=v,n):(n===o?n.flags|=65536:(n.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(o=zo(-1,1),o.tag=2,Is(c,o,1))),c.lanes|=1),n)}var I4=Bo.ReactCurrentOwner,Kn=!1;function Nn(n,o,c,p){o.child=n===null?T1(o,null,c,p):Gl(o,n.child,c,p)}function R0(n,o,c,p,v){c=c.render;var k=o.ref;return jl(o,v),p=Vg(n,o,c,p,k,v),c=Ug(),n!==null&&!Kn?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~v,Fo(n,o,v)):(mi&&c&&Pg(o),o.flags|=1,Nn(n,o,p,v),o.child)}function F0(n,o,c,p,v){if(n===null){var k=c.type;return typeof k=="function"&&!Jg(k)&&k.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(o.tag=15,o.type=k,X1(n,o,k,p,v)):(n=Bd(c.type,null,p,o,o.mode,v),n.ref=o.ref,n.return=o,o.child=n)}if(k=n.child,!(n.lanes&v)){var S=k.memoizedProps;if(c=c.compare,c=c!==null?c:Bu,c(S,p)&&n.ref===o.ref)return Fo(n,o,v)}return o.flags|=1,n=Ps(k,p),n.ref=o.ref,n.return=o,o.child=n}function X1(n,o,c,p,v){if(n!==null){var k=n.memoizedProps;if(Bu(k,p)&&n.ref===o.ref)if(Kn=!1,o.pendingProps=p=k,(n.lanes&v)!==0)n.flags&131072&&(Kn=!0);else return o.lanes=n.lanes,Fo(n,o,v)}return Xm(n,o,c,p,v)}function Y1(n,o,c){var p=o.pendingProps,v=p.children,k=n!==null?n.memoizedState:null;if(p.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},ri(Rl,lr),lr|=c;else{if(!(c&1073741824))return n=k!==null?k.baseLanes|c:c,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:n,cachePool:null,transitions:null},o.updateQueue=null,ri(Rl,lr),lr|=n,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=k!==null?k.baseLanes:c,ri(Rl,lr),lr|=p}else k!==null?(p=k.baseLanes|c,o.memoizedState=null):p=c,ri(Rl,lr),lr|=p;return Nn(n,o,v,c),o.child}function J1(n,o){var c=o.ref;(n===null&&c!==null||n!==null&&n.ref!==c)&&(o.flags|=512,o.flags|=2097152)}function Xm(n,o,c,p,v){var k=Yn(c)?ya:En.current;return k=Zl(o,k),jl(o,v),c=Vg(n,o,c,p,k,v),p=Ug(),n!==null&&!Kn?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~v,Fo(n,o,v)):(mi&&p&&Pg(o),o.flags|=1,Nn(n,o,c,v),o.child)}function B0(n,o,c,p,v){if(Yn(c)){var k=!0;Hd(o)}else k=!1;if(jl(o,v),o.stateNode===null)Ld(n,o),W1(o,c,p),Hm(o,c,p,v),p=!0;else if(n===null){var S=o.stateNode,d=o.memoizedProps;S.props=d;var $=S.context,ie=c.contextType;typeof ie=="object"&&ie!==null?ie=Tr(ie):(ie=Yn(c)?ya:En.current,ie=Zl(o,ie));var me=c.getDerivedStateFromProps,X=typeof me=="function"||typeof S.getSnapshotBeforeUpdate=="function";X||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==p||$!==ie)&&A0(o,S,p,ie),ys=!1;var V=o.memoizedState;S.state=V,Qd(o,p,S,v),$=o.memoizedState,d!==p||V!==$||Xn.current||ys?(typeof me=="function"&&(Wm(o,c,me,p),$=o.memoizedState),(d=ys||M0(o,c,d,p,V,$,ie))?(X||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(o.flags|=4194308)):(typeof S.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=p,o.memoizedState=$),S.props=p,S.state=$,S.context=ie,p=d):(typeof S.componentDidMount=="function"&&(o.flags|=4194308),p=!1)}else{S=o.stateNode,I1(n,o),d=o.memoizedProps,ie=o.type===o.elementType?d:jr(o.type,d),S.props=ie,X=o.pendingProps,V=S.context,$=c.contextType,typeof $=="object"&&$!==null?$=Tr($):($=Yn(c)?ya:En.current,$=Zl(o,$));var Te=c.getDerivedStateFromProps;(me=typeof Te=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==X||V!==$)&&A0(o,S,p,$),ys=!1,V=o.memoizedState,S.state=V,Qd(o,p,S,v);var ke=o.memoizedState;d!==X||V!==ke||Xn.current||ys?(typeof Te=="function"&&(Wm(o,c,Te,p),ke=o.memoizedState),(ie=ys||M0(o,c,ie,p,V,ke,$)||!1)?(me||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(p,ke,$),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(p,ke,$)),typeof S.componentDidUpdate=="function"&&(o.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof S.componentDidUpdate!="function"||d===n.memoizedProps&&V===n.memoizedState||(o.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===n.memoizedProps&&V===n.memoizedState||(o.flags|=1024),o.memoizedProps=p,o.memoizedState=ke),S.props=p,S.state=ke,S.context=$,p=ie):(typeof S.componentDidUpdate!="function"||d===n.memoizedProps&&V===n.memoizedState||(o.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===n.memoizedProps&&V===n.memoizedState||(o.flags|=1024),p=!1)}return Ym(n,o,c,p,k,v)}function Ym(n,o,c,p,v,k){J1(n,o);var S=(o.flags&128)!==0;if(!p&&!S)return v&&b0(o,c,!1),Fo(n,o,k);p=o.stateNode,I4.current=o;var d=S&&typeof c.getDerivedStateFromError!="function"?null:p.render();return o.flags|=1,n!==null&&S?(o.child=Gl(o,n.child,null,k),o.child=Gl(o,null,d,k)):Nn(n,o,d,k),o.memoizedState=p.state,v&&b0(o,c,!0),o.child}function Q1(n){var o=n.stateNode;o.pendingContext?w0(n,o.pendingContext,o.pendingContext!==o.context):o.context&&w0(n,o.context,!1),Bg(n,o.containerInfo)}function O0(n,o,c,p,v){return ql(),Ag(v),o.flags|=256,Nn(n,o,c,p),o.child}var Jm={dehydrated:null,treeContext:null,retryLane:0};function Qm(n){return{baseLanes:n,cachePool:null,transitions:null}}function ex(n,o,c){var p=o.pendingProps,v=yi.current,k=!1,S=(o.flags&128)!==0,d;if((d=S)||(d=n!==null&&n.memoizedState===null?!1:(v&2)!==0),d?(k=!0,o.flags&=-129):(n===null||n.memoizedState!==null)&&(v|=1),ri(yi,v&1),n===null)return qm(o),n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(o.mode&1?n.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(S=p.children,n=p.fallback,k?(p=o.mode,k=o.child,S={mode:"hidden",children:S},!(p&1)&&k!==null?(k.childLanes=0,k.pendingProps=S):k=vp(S,p,0,null),n=ga(n,p,c,null),k.return=o,n.return=o,k.sibling=n,o.child=k,o.child.memoizedState=Qm(c),o.memoizedState=Jm,n):qg(o,S));if(v=n.memoizedState,v!==null&&(d=v.dehydrated,d!==null))return C4(n,o,S,p,d,v,c);if(k){k=p.fallback,S=o.mode,v=n.child,d=v.sibling;var $={mode:"hidden",children:p.children};return!(S&1)&&o.child!==v?(p=o.child,p.childLanes=0,p.pendingProps=$,o.deletions=null):(p=Ps(v,$),p.subtreeFlags=v.subtreeFlags&14680064),d!==null?k=Ps(d,k):(k=ga(k,S,c,null),k.flags|=2),k.return=o,p.return=o,p.sibling=k,o.child=p,p=k,k=o.child,S=n.child.memoizedState,S=S===null?Qm(c):{baseLanes:S.baseLanes|c,cachePool:null,transitions:S.transitions},k.memoizedState=S,k.childLanes=n.childLanes&~c,o.memoizedState=Jm,p}return k=n.child,n=k.sibling,p=Ps(k,{mode:"visible",children:p.children}),!(o.mode&1)&&(p.lanes=c),p.return=o,p.sibling=null,n!==null&&(c=o.deletions,c===null?(o.deletions=[n],o.flags|=16):c.push(n)),o.child=p,o.memoizedState=null,p}function qg(n,o){return o=vp({mode:"visible",children:o},n.mode,0,null),o.return=n,n.child=o}function wd(n,o,c,p){return p!==null&&Ag(p),Gl(o,n.child,null,c),n=qg(o,o.pendingProps.children),n.flags|=2,o.memoizedState=null,n}function C4(n,o,c,p,v,k,S){if(c)return o.flags&256?(o.flags&=-257,p=lm(Error(De(422))),wd(n,o,S,p)):o.memoizedState!==null?(o.child=n.child,o.flags|=128,null):(k=p.fallback,v=o.mode,p=vp({mode:"visible",children:p.children},v,0,null),k=ga(k,v,S,null),k.flags|=2,p.return=o,k.return=o,p.sibling=k,o.child=p,o.mode&1&&Gl(o,n.child,null,S),o.child.memoizedState=Qm(S),o.memoizedState=Jm,k);if(!(o.mode&1))return wd(n,o,S,null);if(v.data==="$!"){if(p=v.nextSibling&&v.nextSibling.dataset,p)var d=p.dgst;return p=d,k=Error(De(419)),p=lm(k,p,void 0),wd(n,o,S,p)}if(d=(S&n.childLanes)!==0,Kn||d){if(p=tn,p!==null){switch(S&-S){case 4:v=2;break;case 16:v=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:v=32;break;case 536870912:v=268435456;break;default:v=0}v=v&(p.suspendedLanes|S)?0:v,v!==0&&v!==k.retryLane&&(k.retryLane=v,Ro(n,v),Zr(p,n,v,-1))}return Yg(),p=lm(Error(De(421))),wd(n,o,S,p)}return v.data==="$?"?(o.flags|=128,o.child=n.child,o=j4.bind(null,n),v._reactRetry=o,null):(n=k.treeContext,cr=ks(v.nextSibling),ur=o,mi=!0,Ur=null,n!==null&&(xr[wr++]=Mo,xr[wr++]=Ao,xr[wr++]=_a,Mo=n.id,Ao=n.overflow,_a=o),o=qg(o,p.children),o.flags|=4096,o)}function N0(n,o,c){n.lanes|=o;var p=n.alternate;p!==null&&(p.lanes|=o),Gm(n.return,o,c)}function cm(n,o,c,p,v){var k=n.memoizedState;k===null?n.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:p,tail:c,tailMode:v}:(k.isBackwards=o,k.rendering=null,k.renderingStartTime=0,k.last=p,k.tail=c,k.tailMode=v)}function tx(n,o,c){var p=o.pendingProps,v=p.revealOrder,k=p.tail;if(Nn(n,o,p.children,c),p=yi.current,p&2)p=p&1|2,o.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=o.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&N0(n,c,o);else if(n.tag===19)N0(n,c,o);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===o)break e;for(;n.sibling===null;){if(n.return===null||n.return===o)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}p&=1}if(ri(yi,p),!(o.mode&1))o.memoizedState=null;else switch(v){case"forwards":for(c=o.child,v=null;c!==null;)n=c.alternate,n!==null&&ep(n)===null&&(v=c),c=c.sibling;c=v,c===null?(v=o.child,o.child=null):(v=c.sibling,c.sibling=null),cm(o,!1,v,c,k);break;case"backwards":for(c=null,v=o.child,o.child=null;v!==null;){if(n=v.alternate,n!==null&&ep(n)===null){o.child=v;break}n=v.sibling,v.sibling=c,c=v,v=n}cm(o,!0,c,null,k);break;case"together":cm(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Ld(n,o){!(o.mode&1)&&n!==null&&(n.alternate=null,o.alternate=null,o.flags|=2)}function Fo(n,o,c){if(n!==null&&(o.dependencies=n.dependencies),xa|=o.lanes,!(c&o.childLanes))return null;if(n!==null&&o.child!==n.child)throw Error(De(153));if(o.child!==null){for(n=o.child,c=Ps(n,n.pendingProps),o.child=c,c.return=o;n.sibling!==null;)n=n.sibling,c=c.sibling=Ps(n,n.pendingProps),c.return=o;c.sibling=null}return o.child}function E4(n,o,c){switch(o.tag){case 3:Q1(o),ql();break;case 5:C1(o);break;case 1:Yn(o.type)&&Hd(o);break;case 4:Bg(o,o.stateNode.containerInfo);break;case 10:var p=o.type._context,v=o.memoizedProps.value;ri(Yd,p._currentValue),p._currentValue=v;break;case 13:if(p=o.memoizedState,p!==null)return p.dehydrated!==null?(ri(yi,yi.current&1),o.flags|=128,null):c&o.child.childLanes?ex(n,o,c):(ri(yi,yi.current&1),n=Fo(n,o,c),n!==null?n.sibling:null);ri(yi,yi.current&1);break;case 19:if(p=(c&o.childLanes)!==0,n.flags&128){if(p)return tx(n,o,c);o.flags|=128}if(v=o.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),ri(yi,yi.current),p)break;return null;case 22:case 23:return o.lanes=0,Y1(n,o,c)}return Fo(n,o,c)}var ix,eg,nx,rx;ix=function(n,o){for(var c=o.child;c!==null;){if(c.tag===5||c.tag===6)n.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return;c=c.return}c.sibling.return=c.return,c=c.sibling}};eg=function(){};nx=function(n,o,c,p){var v=n.memoizedProps;if(v!==p){n=o.stateNode,fa(co.current);var k=null;switch(c){case"input":v=bm(n,v),p=bm(n,p),k=[];break;case"select":v=vi({},v,{value:void 0}),p=vi({},p,{value:void 0}),k=[];break;case"textarea":v=km(n,v),p=km(n,p),k=[];break;default:typeof v.onClick!="function"&&typeof p.onClick=="function"&&(n.onclick=Gd)}Cm(c,p);var S;c=null;for(ie in v)if(!p.hasOwnProperty(ie)&&v.hasOwnProperty(ie)&&v[ie]!=null)if(ie==="style"){var d=v[ie];for(S in d)d.hasOwnProperty(S)&&(c||(c={}),c[S]="")}else ie!=="dangerouslySetInnerHTML"&&ie!=="children"&&ie!=="suppressContentEditableWarning"&&ie!=="suppressHydrationWarning"&&ie!=="autoFocus"&&(Mu.hasOwnProperty(ie)?k||(k=[]):(k=k||[]).push(ie,null));for(ie in p){var $=p[ie];if(d=v!=null?v[ie]:void 0,p.hasOwnProperty(ie)&&$!==d&&($!=null||d!=null))if(ie==="style")if(d){for(S in d)!d.hasOwnProperty(S)||$&&$.hasOwnProperty(S)||(c||(c={}),c[S]="");for(S in $)$.hasOwnProperty(S)&&d[S]!==$[S]&&(c||(c={}),c[S]=$[S])}else c||(k||(k=[]),k.push(ie,c)),c=$;else ie==="dangerouslySetInnerHTML"?($=$?$.__html:void 0,d=d?d.__html:void 0,$!=null&&d!==$&&(k=k||[]).push(ie,$)):ie==="children"?typeof $!="string"&&typeof $!="number"||(k=k||[]).push(ie,""+$):ie!=="suppressContentEditableWarning"&&ie!=="suppressHydrationWarning"&&(Mu.hasOwnProperty(ie)?($!=null&&ie==="onScroll"&&ci("scroll",n),k||d===$||(k=[])):(k=k||[]).push(ie,$))}c&&(k=k||[]).push("style",c);var ie=k;(o.updateQueue=ie)&&(o.flags|=4)}};rx=function(n,o,c,p){c!==p&&(o.flags|=4)};function fu(n,o){if(!mi)switch(n.tailMode){case"hidden":o=n.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?n.tail=null:c.sibling=null;break;case"collapsed":c=n.tail;for(var p=null;c!==null;)c.alternate!==null&&(p=c),c=c.sibling;p===null?o||n.tail===null?n.tail=null:n.tail.sibling=null:p.sibling=null}}function In(n){var o=n.alternate!==null&&n.alternate.child===n.child,c=0,p=0;if(o)for(var v=n.child;v!==null;)c|=v.lanes|v.childLanes,p|=v.subtreeFlags&14680064,p|=v.flags&14680064,v.return=n,v=v.sibling;else for(v=n.child;v!==null;)c|=v.lanes|v.childLanes,p|=v.subtreeFlags,p|=v.flags,v.return=n,v=v.sibling;return n.subtreeFlags|=p,n.childLanes=c,o}function P4(n,o,c){var p=o.pendingProps;switch(Mg(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return In(o),null;case 1:return Yn(o.type)&&Wd(),In(o),null;case 3:return p=o.stateNode,Wl(),ui(Xn),ui(En),Ng(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(n===null||n.child===null)&&(vd(o)?o.flags|=4:n===null||n.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,Ur!==null&&(lg(Ur),Ur=null))),eg(n,o),In(o),null;case 5:Og(o);var v=fa(Uu.current);if(c=o.type,n!==null&&o.stateNode!=null)nx(n,o,c,p,v),n.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!p){if(o.stateNode===null)throw Error(De(166));return In(o),null}if(n=fa(co.current),vd(o)){p=o.stateNode,c=o.type;var k=o.memoizedProps;switch(p[ao]=o,p[ju]=k,n=(o.mode&1)!==0,c){case"dialog":ci("cancel",p),ci("close",p);break;case"iframe":case"object":case"embed":ci("load",p);break;case"video":case"audio":for(v=0;v<xu.length;v++)ci(xu[v],p);break;case"source":ci("error",p);break;case"img":case"image":case"link":ci("error",p),ci("load",p);break;case"details":ci("toggle",p);break;case"input":H_(p,k),ci("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!k.multiple},ci("invalid",p);break;case"textarea":X_(p,k),ci("invalid",p)}Cm(c,k),v=null;for(var S in k)if(k.hasOwnProperty(S)){var d=k[S];S==="children"?typeof d=="string"?p.textContent!==d&&(k.suppressHydrationWarning!==!0&&_d(p.textContent,d,n),v=["children",d]):typeof d=="number"&&p.textContent!==""+d&&(k.suppressHydrationWarning!==!0&&_d(p.textContent,d,n),v=["children",""+d]):Mu.hasOwnProperty(S)&&d!=null&&S==="onScroll"&&ci("scroll",p)}switch(c){case"input":ud(p),K_(p,k,!0);break;case"textarea":ud(p),Y_(p);break;case"select":case"option":break;default:typeof k.onClick=="function"&&(p.onclick=Gd)}p=v,o.updateQueue=p,p!==null&&(o.flags|=4)}else{S=v.nodeType===9?v:v.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=zv(c)),n==="http://www.w3.org/1999/xhtml"?c==="script"?(n=S.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof p.is=="string"?n=S.createElement(c,{is:p.is}):(n=S.createElement(c),c==="select"&&(S=n,p.multiple?S.multiple=!0:p.size&&(S.size=p.size))):n=S.createElementNS(n,c),n[ao]=o,n[ju]=p,ix(n,o,!1,!1),o.stateNode=n;e:{switch(S=Em(c,p),c){case"dialog":ci("cancel",n),ci("close",n),v=p;break;case"iframe":case"object":case"embed":ci("load",n),v=p;break;case"video":case"audio":for(v=0;v<xu.length;v++)ci(xu[v],n);v=p;break;case"source":ci("error",n),v=p;break;case"img":case"image":case"link":ci("error",n),ci("load",n),v=p;break;case"details":ci("toggle",n),v=p;break;case"input":H_(n,p),v=bm(n,p),ci("invalid",n);break;case"option":v=p;break;case"select":n._wrapperState={wasMultiple:!!p.multiple},v=vi({},p,{value:void 0}),ci("invalid",n);break;case"textarea":X_(n,p),v=km(n,p),ci("invalid",n);break;default:v=p}Cm(c,v),d=v;for(k in d)if(d.hasOwnProperty(k)){var $=d[k];k==="style"?Rv(n,$):k==="dangerouslySetInnerHTML"?($=$?$.__html:void 0,$!=null&&Dv(n,$)):k==="children"?typeof $=="string"?(c!=="textarea"||$!=="")&&Au(n,$):typeof $=="number"&&Au(n,""+$):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(Mu.hasOwnProperty(k)?$!=null&&k==="onScroll"&&ci("scroll",n):$!=null&&mg(n,k,$,S))}switch(c){case"input":ud(n),K_(n,p,!1);break;case"textarea":ud(n),Y_(n);break;case"option":p.value!=null&&n.setAttribute("value",""+Ms(p.value));break;case"select":n.multiple=!!p.multiple,k=p.value,k!=null?Fl(n,!!p.multiple,k,!1):p.defaultValue!=null&&Fl(n,!!p.multiple,p.defaultValue,!0);break;default:typeof v.onClick=="function"&&(n.onclick=Gd)}switch(c){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return In(o),null;case 6:if(n&&o.stateNode!=null)rx(n,o,n.memoizedProps,p);else{if(typeof p!="string"&&o.stateNode===null)throw Error(De(166));if(c=fa(Uu.current),fa(co.current),vd(o)){if(p=o.stateNode,c=o.memoizedProps,p[ao]=o,(k=p.nodeValue!==c)&&(n=ur,n!==null))switch(n.tag){case 3:_d(p.nodeValue,c,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&_d(p.nodeValue,c,(n.mode&1)!==0)}k&&(o.flags|=4)}else p=(c.nodeType===9?c:c.ownerDocument).createTextNode(p),p[ao]=o,o.stateNode=p}return In(o),null;case 13:if(ui(yi),p=o.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(mi&&cr!==null&&o.mode&1&&!(o.flags&128))b1(),ql(),o.flags|=98560,k=!1;else if(k=vd(o),p!==null&&p.dehydrated!==null){if(n===null){if(!k)throw Error(De(318));if(k=o.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(De(317));k[ao]=o}else ql(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;In(o),k=!1}else Ur!==null&&(lg(Ur),Ur=null),k=!0;if(!k)return o.flags&65536?o:null}return o.flags&128?(o.lanes=c,o):(p=p!==null,p!==(n!==null&&n.memoizedState!==null)&&p&&(o.child.flags|=8192,o.mode&1&&(n===null||yi.current&1?Vi===0&&(Vi=3):Yg())),o.updateQueue!==null&&(o.flags|=4),In(o),null);case 4:return Wl(),eg(n,o),n===null&&Ou(o.stateNode.containerInfo),In(o),null;case 10:return Lg(o.type._context),In(o),null;case 17:return Yn(o.type)&&Wd(),In(o),null;case 19:if(ui(yi),k=o.memoizedState,k===null)return In(o),null;if(p=(o.flags&128)!==0,S=k.rendering,S===null)if(p)fu(k,!1);else{if(Vi!==0||n!==null&&n.flags&128)for(n=o.child;n!==null;){if(S=ep(n),S!==null){for(o.flags|=128,fu(k,!1),p=S.updateQueue,p!==null&&(o.updateQueue=p,o.flags|=4),o.subtreeFlags=0,p=c,c=o.child;c!==null;)k=c,n=p,k.flags&=14680066,S=k.alternate,S===null?(k.childLanes=0,k.lanes=n,k.child=null,k.subtreeFlags=0,k.memoizedProps=null,k.memoizedState=null,k.updateQueue=null,k.dependencies=null,k.stateNode=null):(k.childLanes=S.childLanes,k.lanes=S.lanes,k.child=S.child,k.subtreeFlags=0,k.deletions=null,k.memoizedProps=S.memoizedProps,k.memoizedState=S.memoizedState,k.updateQueue=S.updateQueue,k.type=S.type,n=S.dependencies,k.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),c=c.sibling;return ri(yi,yi.current&1|2),o.child}n=n.sibling}k.tail!==null&&Pi()>Kl&&(o.flags|=128,p=!0,fu(k,!1),o.lanes=4194304)}else{if(!p)if(n=ep(S),n!==null){if(o.flags|=128,p=!0,c=n.updateQueue,c!==null&&(o.updateQueue=c,o.flags|=4),fu(k,!0),k.tail===null&&k.tailMode==="hidden"&&!S.alternate&&!mi)return In(o),null}else 2*Pi()-k.renderingStartTime>Kl&&c!==1073741824&&(o.flags|=128,p=!0,fu(k,!1),o.lanes=4194304);k.isBackwards?(S.sibling=o.child,o.child=S):(c=k.last,c!==null?c.sibling=S:o.child=S,k.last=S)}return k.tail!==null?(o=k.tail,k.rendering=o,k.tail=o.sibling,k.renderingStartTime=Pi(),o.sibling=null,c=yi.current,ri(yi,p?c&1|2:c&1),o):(In(o),null);case 22:case 23:return Xg(),p=o.memoizedState!==null,n!==null&&n.memoizedState!==null!==p&&(o.flags|=8192),p&&o.mode&1?lr&1073741824&&(In(o),o.subtreeFlags&6&&(o.flags|=8192)):In(o),null;case 24:return null;case 25:return null}throw Error(De(156,o.tag))}function M4(n,o){switch(Mg(o),o.tag){case 1:return Yn(o.type)&&Wd(),n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 3:return Wl(),ui(Xn),ui(En),Ng(),n=o.flags,n&65536&&!(n&128)?(o.flags=n&-65537|128,o):null;case 5:return Og(o),null;case 13:if(ui(yi),n=o.memoizedState,n!==null&&n.dehydrated!==null){if(o.alternate===null)throw Error(De(340));ql()}return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 19:return ui(yi),null;case 4:return Wl(),null;case 10:return Lg(o.type._context),null;case 22:case 23:return Xg(),null;case 24:return null;default:return null}}var bd=!1,Cn=!1,A4=typeof WeakSet=="function"?WeakSet:Set,it=null;function Ll(n,o){var c=n.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(p){Ti(n,o,p)}else c.current=null}function tg(n,o,c){try{c()}catch(p){Ti(n,o,p)}}var j0=!1;function z4(n,o){if(Om=$d,n=c1(),Eg(n)){if("selectionStart"in n)var c={start:n.selectionStart,end:n.selectionEnd};else e:{c=(c=n.ownerDocument)&&c.defaultView||window;var p=c.getSelection&&c.getSelection();if(p&&p.rangeCount!==0){c=p.anchorNode;var v=p.anchorOffset,k=p.focusNode;p=p.focusOffset;try{c.nodeType,k.nodeType}catch{c=null;break e}var S=0,d=-1,$=-1,ie=0,me=0,X=n,V=null;t:for(;;){for(var Te;X!==c||v!==0&&X.nodeType!==3||(d=S+v),X!==k||p!==0&&X.nodeType!==3||($=S+p),X.nodeType===3&&(S+=X.nodeValue.length),(Te=X.firstChild)!==null;)V=X,X=Te;for(;;){if(X===n)break t;if(V===c&&++ie===v&&(d=S),V===k&&++me===p&&($=S),(Te=X.nextSibling)!==null)break;X=V,V=X.parentNode}X=Te}c=d===-1||$===-1?null:{start:d,end:$}}else c=null}c=c||{start:0,end:0}}else c=null;for(Nm={focusedElem:n,selectionRange:c},$d=!1,it=o;it!==null;)if(o=it,n=o.child,(o.subtreeFlags&1028)!==0&&n!==null)n.return=o,it=n;else for(;it!==null;){o=it;try{var ke=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(ke!==null){var Me=ke.memoizedProps,yt=ke.memoizedState,oe=o.stateNode,ne=oe.getSnapshotBeforeUpdate(o.elementType===o.type?Me:jr(o.type,Me),yt);oe.__reactInternalSnapshotBeforeUpdate=ne}break;case 3:var he=o.stateNode.containerInfo;he.nodeType===1?he.textContent="":he.nodeType===9&&he.documentElement&&he.removeChild(he.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(De(163))}}catch(Ie){Ti(o,o.return,Ie)}if(n=o.sibling,n!==null){n.return=o.return,it=n;break}it=o.return}return ke=j0,j0=!1,ke}function Cu(n,o,c){var p=o.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var v=p=p.next;do{if((v.tag&n)===n){var k=v.destroy;v.destroy=void 0,k!==void 0&&tg(o,c,k)}v=v.next}while(v!==p)}}function yp(n,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var c=o=o.next;do{if((c.tag&n)===n){var p=c.create;c.destroy=p()}c=c.next}while(c!==o)}}function ig(n){var o=n.ref;if(o!==null){var c=n.stateNode;switch(n.tag){case 5:n=c;break;default:n=c}typeof o=="function"?o(n):o.current=n}}function ox(n){var o=n.alternate;o!==null&&(n.alternate=null,ox(o)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(o=n.stateNode,o!==null&&(delete o[ao],delete o[ju],delete o[Um],delete o[f4],delete o[m4])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function sx(n){return n.tag===5||n.tag===3||n.tag===4}function V0(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||sx(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function ng(n,o,c){var p=n.tag;if(p===5||p===6)n=n.stateNode,o?c.nodeType===8?c.parentNode.insertBefore(n,o):c.insertBefore(n,o):(c.nodeType===8?(o=c.parentNode,o.insertBefore(n,c)):(o=c,o.appendChild(n)),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=Gd));else if(p!==4&&(n=n.child,n!==null))for(ng(n,o,c),n=n.sibling;n!==null;)ng(n,o,c),n=n.sibling}function rg(n,o,c){var p=n.tag;if(p===5||p===6)n=n.stateNode,o?c.insertBefore(n,o):c.appendChild(n);else if(p!==4&&(n=n.child,n!==null))for(rg(n,o,c),n=n.sibling;n!==null;)rg(n,o,c),n=n.sibling}var cn=null,Vr=!1;function ms(n,o,c){for(c=c.child;c!==null;)ax(n,o,c),c=c.sibling}function ax(n,o,c){if(lo&&typeof lo.onCommitFiberUnmount=="function")try{lo.onCommitFiberUnmount(cp,c)}catch{}switch(c.tag){case 5:Cn||Ll(c,o);case 6:var p=cn,v=Vr;cn=null,ms(n,o,c),cn=p,Vr=v,cn!==null&&(Vr?(n=cn,c=c.stateNode,n.nodeType===8?n.parentNode.removeChild(c):n.removeChild(c)):cn.removeChild(c.stateNode));break;case 18:cn!==null&&(Vr?(n=cn,c=c.stateNode,n.nodeType===8?im(n.parentNode,c):n.nodeType===1&&im(n,c),Ru(n)):im(cn,c.stateNode));break;case 4:p=cn,v=Vr,cn=c.stateNode.containerInfo,Vr=!0,ms(n,o,c),cn=p,Vr=v;break;case 0:case 11:case 14:case 15:if(!Cn&&(p=c.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){v=p=p.next;do{var k=v,S=k.destroy;k=k.tag,S!==void 0&&(k&2||k&4)&&tg(c,o,S),v=v.next}while(v!==p)}ms(n,o,c);break;case 1:if(!Cn&&(Ll(c,o),p=c.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=c.memoizedProps,p.state=c.memoizedState,p.componentWillUnmount()}catch(d){Ti(c,o,d)}ms(n,o,c);break;case 21:ms(n,o,c);break;case 22:c.mode&1?(Cn=(p=Cn)||c.memoizedState!==null,ms(n,o,c),Cn=p):ms(n,o,c);break;default:ms(n,o,c)}}function U0(n){var o=n.updateQueue;if(o!==null){n.updateQueue=null;var c=n.stateNode;c===null&&(c=n.stateNode=new A4),o.forEach(function(p){var v=V4.bind(null,n,p);c.has(p)||(c.add(p),p.then(v,v))})}}function Nr(n,o){var c=o.deletions;if(c!==null)for(var p=0;p<c.length;p++){var v=c[p];try{var k=n,S=o,d=S;e:for(;d!==null;){switch(d.tag){case 5:cn=d.stateNode,Vr=!1;break e;case 3:cn=d.stateNode.containerInfo,Vr=!0;break e;case 4:cn=d.stateNode.containerInfo,Vr=!0;break e}d=d.return}if(cn===null)throw Error(De(160));ax(k,S,v),cn=null,Vr=!1;var $=v.alternate;$!==null&&($.return=null),v.return=null}catch(ie){Ti(v,o,ie)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)lx(o,n),o=o.sibling}function lx(n,o){var c=n.alternate,p=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Nr(o,n),oo(n),p&4){try{Cu(3,n,n.return),yp(3,n)}catch(Me){Ti(n,n.return,Me)}try{Cu(5,n,n.return)}catch(Me){Ti(n,n.return,Me)}}break;case 1:Nr(o,n),oo(n),p&512&&c!==null&&Ll(c,c.return);break;case 5:if(Nr(o,n),oo(n),p&512&&c!==null&&Ll(c,c.return),n.flags&32){var v=n.stateNode;try{Au(v,"")}catch(Me){Ti(n,n.return,Me)}}if(p&4&&(v=n.stateNode,v!=null)){var k=n.memoizedProps,S=c!==null?c.memoizedProps:k,d=n.type,$=n.updateQueue;if(n.updateQueue=null,$!==null)try{d==="input"&&k.type==="radio"&&k.name!=null&&Mv(v,k),Em(d,S);var ie=Em(d,k);for(S=0;S<$.length;S+=2){var me=$[S],X=$[S+1];me==="style"?Rv(v,X):me==="dangerouslySetInnerHTML"?Dv(v,X):me==="children"?Au(v,X):mg(v,me,X,ie)}switch(d){case"input":Sm(v,k);break;case"textarea":Av(v,k);break;case"select":var V=v._wrapperState.wasMultiple;v._wrapperState.wasMultiple=!!k.multiple;var Te=k.value;Te!=null?Fl(v,!!k.multiple,Te,!1):V!==!!k.multiple&&(k.defaultValue!=null?Fl(v,!!k.multiple,k.defaultValue,!0):Fl(v,!!k.multiple,k.multiple?[]:"",!1))}v[ju]=k}catch(Me){Ti(n,n.return,Me)}}break;case 6:if(Nr(o,n),oo(n),p&4){if(n.stateNode===null)throw Error(De(162));v=n.stateNode,k=n.memoizedProps;try{v.nodeValue=k}catch(Me){Ti(n,n.return,Me)}}break;case 3:if(Nr(o,n),oo(n),p&4&&c!==null&&c.memoizedState.isDehydrated)try{Ru(o.containerInfo)}catch(Me){Ti(n,n.return,Me)}break;case 4:Nr(o,n),oo(n);break;case 13:Nr(o,n),oo(n),v=n.child,v.flags&8192&&(k=v.memoizedState!==null,v.stateNode.isHidden=k,!k||v.alternate!==null&&v.alternate.memoizedState!==null||(Hg=Pi())),p&4&&U0(n);break;case 22:if(me=c!==null&&c.memoizedState!==null,n.mode&1?(Cn=(ie=Cn)||me,Nr(o,n),Cn=ie):Nr(o,n),oo(n),p&8192){if(ie=n.memoizedState!==null,(n.stateNode.isHidden=ie)&&!me&&n.mode&1)for(it=n,me=n.child;me!==null;){for(X=it=me;it!==null;){switch(V=it,Te=V.child,V.tag){case 0:case 11:case 14:case 15:Cu(4,V,V.return);break;case 1:Ll(V,V.return);var ke=V.stateNode;if(typeof ke.componentWillUnmount=="function"){p=V,c=V.return;try{o=p,ke.props=o.memoizedProps,ke.state=o.memoizedState,ke.componentWillUnmount()}catch(Me){Ti(p,c,Me)}}break;case 5:Ll(V,V.return);break;case 22:if(V.memoizedState!==null){Z0(X);continue}}Te!==null?(Te.return=V,it=Te):Z0(X)}me=me.sibling}e:for(me=null,X=n;;){if(X.tag===5){if(me===null){me=X;try{v=X.stateNode,ie?(k=v.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none"):(d=X.stateNode,$=X.memoizedProps.style,S=$!=null&&$.hasOwnProperty("display")?$.display:null,d.style.display=Lv("display",S))}catch(Me){Ti(n,n.return,Me)}}}else if(X.tag===6){if(me===null)try{X.stateNode.nodeValue=ie?"":X.memoizedProps}catch(Me){Ti(n,n.return,Me)}}else if((X.tag!==22&&X.tag!==23||X.memoizedState===null||X===n)&&X.child!==null){X.child.return=X,X=X.child;continue}if(X===n)break e;for(;X.sibling===null;){if(X.return===null||X.return===n)break e;me===X&&(me=null),X=X.return}me===X&&(me=null),X.sibling.return=X.return,X=X.sibling}}break;case 19:Nr(o,n),oo(n),p&4&&U0(n);break;case 21:break;default:Nr(o,n),oo(n)}}function oo(n){var o=n.flags;if(o&2){try{e:{for(var c=n.return;c!==null;){if(sx(c)){var p=c;break e}c=c.return}throw Error(De(160))}switch(p.tag){case 5:var v=p.stateNode;p.flags&32&&(Au(v,""),p.flags&=-33);var k=V0(n);rg(n,k,v);break;case 3:case 4:var S=p.stateNode.containerInfo,d=V0(n);ng(n,d,S);break;default:throw Error(De(161))}}catch($){Ti(n,n.return,$)}n.flags&=-3}o&4096&&(n.flags&=-4097)}function D4(n,o,c){it=n,cx(n)}function cx(n,o,c){for(var p=(n.mode&1)!==0;it!==null;){var v=it,k=v.child;if(v.tag===22&&p){var S=v.memoizedState!==null||bd;if(!S){var d=v.alternate,$=d!==null&&d.memoizedState!==null||Cn;d=bd;var ie=Cn;if(bd=S,(Cn=$)&&!ie)for(it=v;it!==null;)S=it,$=S.child,S.tag===22&&S.memoizedState!==null?q0(v):$!==null?($.return=S,it=$):q0(v);for(;k!==null;)it=k,cx(k),k=k.sibling;it=v,bd=d,Cn=ie}$0(n)}else v.subtreeFlags&8772&&k!==null?(k.return=v,it=k):$0(n)}}function $0(n){for(;it!==null;){var o=it;if(o.flags&8772){var c=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:Cn||yp(5,o);break;case 1:var p=o.stateNode;if(o.flags&4&&!Cn)if(c===null)p.componentDidMount();else{var v=o.elementType===o.type?c.memoizedProps:jr(o.type,c.memoizedProps);p.componentDidUpdate(v,c.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var k=o.updateQueue;k!==null&&C0(o,k,p);break;case 3:var S=o.updateQueue;if(S!==null){if(c=null,o.child!==null)switch(o.child.tag){case 5:c=o.child.stateNode;break;case 1:c=o.child.stateNode}C0(o,S,c)}break;case 5:var d=o.stateNode;if(c===null&&o.flags&4){c=d;var $=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":$.autoFocus&&c.focus();break;case"img":$.src&&(c.src=$.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var ie=o.alternate;if(ie!==null){var me=ie.memoizedState;if(me!==null){var X=me.dehydrated;X!==null&&Ru(X)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(De(163))}Cn||o.flags&512&&ig(o)}catch(V){Ti(o,o.return,V)}}if(o===n){it=null;break}if(c=o.sibling,c!==null){c.return=o.return,it=c;break}it=o.return}}function Z0(n){for(;it!==null;){var o=it;if(o===n){it=null;break}var c=o.sibling;if(c!==null){c.return=o.return,it=c;break}it=o.return}}function q0(n){for(;it!==null;){var o=it;try{switch(o.tag){case 0:case 11:case 15:var c=o.return;try{yp(4,o)}catch($){Ti(o,c,$)}break;case 1:var p=o.stateNode;if(typeof p.componentDidMount=="function"){var v=o.return;try{p.componentDidMount()}catch($){Ti(o,v,$)}}var k=o.return;try{ig(o)}catch($){Ti(o,k,$)}break;case 5:var S=o.return;try{ig(o)}catch($){Ti(o,S,$)}}}catch($){Ti(o,o.return,$)}if(o===n){it=null;break}var d=o.sibling;if(d!==null){d.return=o.return,it=d;break}it=o.return}}var L4=Math.ceil,np=Bo.ReactCurrentDispatcher,Gg=Bo.ReactCurrentOwner,Sr=Bo.ReactCurrentBatchConfig,Bt=0,tn=null,Li=null,un=0,lr=0,Rl=Ds(0),Vi=0,Gu=null,xa=0,_p=0,Wg=0,Eu=null,Hn=null,Hg=0,Kl=1/0,Eo=null,rp=!1,og=null,Cs=null,Sd=!1,ws=null,op=0,Pu=0,sg=null,Rd=-1,Fd=0;function Vn(){return Bt&6?Pi():Rd!==-1?Rd:Rd=Pi()}function Es(n){return n.mode&1?Bt&2&&un!==0?un&-un:y4.transition!==null?(Fd===0&&(Fd=Wv()),Fd):(n=Gt,n!==0||(n=window.event,n=n===void 0?16:e1(n.type)),n):1}function Zr(n,o,c,p){if(50<Pu)throw Pu=0,sg=null,Error(De(185));Hu(n,c,p),(!(Bt&2)||n!==tn)&&(n===tn&&(!(Bt&2)&&(_p|=c),Vi===4&&vs(n,un)),Jn(n,p),c===1&&Bt===0&&!(o.mode&1)&&(Kl=Pi()+500,fp&&Ls()))}function Jn(n,o){var c=n.callbackNode;yb(n,o);var p=Ud(n,n===tn?un:0);if(p===0)c!==null&&e0(c),n.callbackNode=null,n.callbackPriority=0;else if(o=p&-p,n.callbackPriority!==o){if(c!=null&&e0(c),o===1)n.tag===0?g4(G0.bind(null,n)):v1(G0.bind(null,n)),d4(function(){!(Bt&6)&&Ls()}),c=null;else{switch(Hv(p)){case 1:c=xg;break;case 4:c=qv;break;case 16:c=Vd;break;case 536870912:c=Gv;break;default:c=Vd}c=yx(c,ux.bind(null,n))}n.callbackPriority=o,n.callbackNode=c}}function ux(n,o){if(Rd=-1,Fd=0,Bt&6)throw Error(De(327));var c=n.callbackNode;if(Vl()&&n.callbackNode!==c)return null;var p=Ud(n,n===tn?un:0);if(p===0)return null;if(p&30||p&n.expiredLanes||o)o=sp(n,p);else{o=p;var v=Bt;Bt|=2;var k=dx();(tn!==n||un!==o)&&(Eo=null,Kl=Pi()+500,ma(n,o));do try{B4();break}catch(d){hx(n,d)}while(!0);Dg(),np.current=k,Bt=v,Li!==null?o=0:(tn=null,un=0,o=Vi)}if(o!==0){if(o===2&&(v=Dm(n),v!==0&&(p=v,o=ag(n,v))),o===1)throw c=Gu,ma(n,0),vs(n,p),Jn(n,Pi()),c;if(o===6)vs(n,p);else{if(v=n.current.alternate,!(p&30)&&!R4(v)&&(o=sp(n,p),o===2&&(k=Dm(n),k!==0&&(p=k,o=ag(n,k))),o===1))throw c=Gu,ma(n,0),vs(n,p),Jn(n,Pi()),c;switch(n.finishedWork=v,n.finishedLanes=p,o){case 0:case 1:throw Error(De(345));case 2:ha(n,Hn,Eo);break;case 3:if(vs(n,p),(p&130023424)===p&&(o=Hg+500-Pi(),10<o)){if(Ud(n,0)!==0)break;if(v=n.suspendedLanes,(v&p)!==p){Vn(),n.pingedLanes|=n.suspendedLanes&v;break}n.timeoutHandle=Vm(ha.bind(null,n,Hn,Eo),o);break}ha(n,Hn,Eo);break;case 4:if(vs(n,p),(p&4194240)===p)break;for(o=n.eventTimes,v=-1;0<p;){var S=31-$r(p);k=1<<S,S=o[S],S>v&&(v=S),p&=~k}if(p=v,p=Pi()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*L4(p/1960))-p,10<p){n.timeoutHandle=Vm(ha.bind(null,n,Hn,Eo),p);break}ha(n,Hn,Eo);break;case 5:ha(n,Hn,Eo);break;default:throw Error(De(329))}}}return Jn(n,Pi()),n.callbackNode===c?ux.bind(null,n):null}function ag(n,o){var c=Eu;return n.current.memoizedState.isDehydrated&&(ma(n,o).flags|=256),n=sp(n,o),n!==2&&(o=Hn,Hn=c,o!==null&&lg(o)),n}function lg(n){Hn===null?Hn=n:Hn.push.apply(Hn,n)}function R4(n){for(var o=n;;){if(o.flags&16384){var c=o.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var p=0;p<c.length;p++){var v=c[p],k=v.getSnapshot;v=v.value;try{if(!qr(k(),v))return!1}catch{return!1}}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function vs(n,o){for(o&=~Wg,o&=~_p,n.suspendedLanes|=o,n.pingedLanes&=~o,n=n.expirationTimes;0<o;){var c=31-$r(o),p=1<<c;n[c]=-1,o&=~p}}function G0(n){if(Bt&6)throw Error(De(327));Vl();var o=Ud(n,0);if(!(o&1))return Jn(n,Pi()),null;var c=sp(n,o);if(n.tag!==0&&c===2){var p=Dm(n);p!==0&&(o=p,c=ag(n,p))}if(c===1)throw c=Gu,ma(n,0),vs(n,o),Jn(n,Pi()),c;if(c===6)throw Error(De(345));return n.finishedWork=n.current.alternate,n.finishedLanes=o,ha(n,Hn,Eo),Jn(n,Pi()),null}function Kg(n,o){var c=Bt;Bt|=1;try{return n(o)}finally{Bt=c,Bt===0&&(Kl=Pi()+500,fp&&Ls())}}function wa(n){ws!==null&&ws.tag===0&&!(Bt&6)&&Vl();var o=Bt;Bt|=1;var c=Sr.transition,p=Gt;try{if(Sr.transition=null,Gt=1,n)return n()}finally{Gt=p,Sr.transition=c,Bt=o,!(Bt&6)&&Ls()}}function Xg(){lr=Rl.current,ui(Rl)}function ma(n,o){n.finishedWork=null,n.finishedLanes=0;var c=n.timeoutHandle;if(c!==-1&&(n.timeoutHandle=-1,h4(c)),Li!==null)for(c=Li.return;c!==null;){var p=c;switch(Mg(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&Wd();break;case 3:Wl(),ui(Xn),ui(En),Ng();break;case 5:Og(p);break;case 4:Wl();break;case 13:ui(yi);break;case 19:ui(yi);break;case 10:Lg(p.type._context);break;case 22:case 23:Xg()}c=c.return}if(tn=n,Li=n=Ps(n.current,null),un=lr=o,Vi=0,Gu=null,Wg=_p=xa=0,Hn=Eu=null,pa!==null){for(o=0;o<pa.length;o++)if(c=pa[o],p=c.interleaved,p!==null){c.interleaved=null;var v=p.next,k=c.pending;if(k!==null){var S=k.next;k.next=v,p.next=S}c.pending=p}pa=null}return n}function hx(n,o){do{var c=Li;try{if(Dg(),zd.current=ip,tp){for(var p=_i.memoizedState;p!==null;){var v=p.queue;v!==null&&(v.pending=null),p=p.next}tp=!1}if(va=0,en=ji=_i=null,Iu=!1,$u=0,Gg.current=null,c===null||c.return===null){Vi=1,Gu=o,Li=null;break}e:{var k=n,S=c.return,d=c,$=o;if(o=un,d.flags|=32768,$!==null&&typeof $=="object"&&typeof $.then=="function"){var ie=$,me=d,X=me.tag;if(!(me.mode&1)&&(X===0||X===11||X===15)){var V=me.alternate;V?(me.updateQueue=V.updateQueue,me.memoizedState=V.memoizedState,me.lanes=V.lanes):(me.updateQueue=null,me.memoizedState=null)}var Te=D0(S);if(Te!==null){Te.flags&=-257,L0(Te,S,d,k,o),Te.mode&1&&z0(k,ie,o),o=Te,$=ie;var ke=o.updateQueue;if(ke===null){var Me=new Set;Me.add($),o.updateQueue=Me}else ke.add($);break e}else{if(!(o&1)){z0(k,ie,o),Yg();break e}$=Error(De(426))}}else if(mi&&d.mode&1){var yt=D0(S);if(yt!==null){!(yt.flags&65536)&&(yt.flags|=256),L0(yt,S,d,k,o),Ag(Hl($,d));break e}}k=$=Hl($,d),Vi!==4&&(Vi=2),Eu===null?Eu=[k]:Eu.push(k),k=S;do{switch(k.tag){case 3:k.flags|=65536,o&=-o,k.lanes|=o;var oe=H1(k,$,o);I0(k,oe);break e;case 1:d=$;var ne=k.type,he=k.stateNode;if(!(k.flags&128)&&(typeof ne.getDerivedStateFromError=="function"||he!==null&&typeof he.componentDidCatch=="function"&&(Cs===null||!Cs.has(he)))){k.flags|=65536,o&=-o,k.lanes|=o;var Ie=K1(k,d,o);I0(k,Ie);break e}}k=k.return}while(k!==null)}fx(c)}catch(Be){o=Be,Li===c&&c!==null&&(Li=c=c.return);continue}break}while(!0)}function dx(){var n=np.current;return np.current=ip,n===null?ip:n}function Yg(){(Vi===0||Vi===3||Vi===2)&&(Vi=4),tn===null||!(xa&268435455)&&!(_p&268435455)||vs(tn,un)}function sp(n,o){var c=Bt;Bt|=2;var p=dx();(tn!==n||un!==o)&&(Eo=null,ma(n,o));do try{F4();break}catch(v){hx(n,v)}while(!0);if(Dg(),Bt=c,np.current=p,Li!==null)throw Error(De(261));return tn=null,un=0,Vi}function F4(){for(;Li!==null;)px(Li)}function B4(){for(;Li!==null&&!lb();)px(Li)}function px(n){var o=gx(n.alternate,n,lr);n.memoizedProps=n.pendingProps,o===null?fx(n):Li=o,Gg.current=null}function fx(n){var o=n;do{var c=o.alternate;if(n=o.return,o.flags&32768){if(c=M4(c,o),c!==null){c.flags&=32767,Li=c;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Vi=6,Li=null;return}}else if(c=P4(c,o,lr),c!==null){Li=c;return}if(o=o.sibling,o!==null){Li=o;return}Li=o=n}while(o!==null);Vi===0&&(Vi=5)}function ha(n,o,c){var p=Gt,v=Sr.transition;try{Sr.transition=null,Gt=1,O4(n,o,c,p)}finally{Sr.transition=v,Gt=p}return null}function O4(n,o,c,p){do Vl();while(ws!==null);if(Bt&6)throw Error(De(327));c=n.finishedWork;var v=n.finishedLanes;if(c===null)return null;if(n.finishedWork=null,n.finishedLanes=0,c===n.current)throw Error(De(177));n.callbackNode=null,n.callbackPriority=0;var k=c.lanes|c.childLanes;if(_b(n,k),n===tn&&(Li=tn=null,un=0),!(c.subtreeFlags&2064)&&!(c.flags&2064)||Sd||(Sd=!0,yx(Vd,function(){return Vl(),null})),k=(c.flags&15990)!==0,c.subtreeFlags&15990||k){k=Sr.transition,Sr.transition=null;var S=Gt;Gt=1;var d=Bt;Bt|=4,Gg.current=null,z4(n,c),lx(c,n),r4(Nm),$d=!!Om,Nm=Om=null,n.current=c,D4(c),cb(),Bt=d,Gt=S,Sr.transition=k}else n.current=c;if(Sd&&(Sd=!1,ws=n,op=v),k=n.pendingLanes,k===0&&(Cs=null),db(c.stateNode),Jn(n,Pi()),o!==null)for(p=n.onRecoverableError,c=0;c<o.length;c++)v=o[c],p(v.value,{componentStack:v.stack,digest:v.digest});if(rp)throw rp=!1,n=og,og=null,n;return op&1&&n.tag!==0&&Vl(),k=n.pendingLanes,k&1?n===sg?Pu++:(Pu=0,sg=n):Pu=0,Ls(),null}function Vl(){if(ws!==null){var n=Hv(op),o=Sr.transition,c=Gt;try{if(Sr.transition=null,Gt=16>n?16:n,ws===null)var p=!1;else{if(n=ws,ws=null,op=0,Bt&6)throw Error(De(331));var v=Bt;for(Bt|=4,it=n.current;it!==null;){var k=it,S=k.child;if(it.flags&16){var d=k.deletions;if(d!==null){for(var $=0;$<d.length;$++){var ie=d[$];for(it=ie;it!==null;){var me=it;switch(me.tag){case 0:case 11:case 15:Cu(8,me,k)}var X=me.child;if(X!==null)X.return=me,it=X;else for(;it!==null;){me=it;var V=me.sibling,Te=me.return;if(ox(me),me===ie){it=null;break}if(V!==null){V.return=Te,it=V;break}it=Te}}}var ke=k.alternate;if(ke!==null){var Me=ke.child;if(Me!==null){ke.child=null;do{var yt=Me.sibling;Me.sibling=null,Me=yt}while(Me!==null)}}it=k}}if(k.subtreeFlags&2064&&S!==null)S.return=k,it=S;else e:for(;it!==null;){if(k=it,k.flags&2048)switch(k.tag){case 0:case 11:case 15:Cu(9,k,k.return)}var oe=k.sibling;if(oe!==null){oe.return=k.return,it=oe;break e}it=k.return}}var ne=n.current;for(it=ne;it!==null;){S=it;var he=S.child;if(S.subtreeFlags&2064&&he!==null)he.return=S,it=he;else e:for(S=ne;it!==null;){if(d=it,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:yp(9,d)}}catch(Be){Ti(d,d.return,Be)}if(d===S){it=null;break e}var Ie=d.sibling;if(Ie!==null){Ie.return=d.return,it=Ie;break e}it=d.return}}if(Bt=v,Ls(),lo&&typeof lo.onPostCommitFiberRoot=="function")try{lo.onPostCommitFiberRoot(cp,n)}catch{}p=!0}return p}finally{Gt=c,Sr.transition=o}}return!1}function W0(n,o,c){o=Hl(c,o),o=H1(n,o,1),n=Is(n,o,1),o=Vn(),n!==null&&(Hu(n,1,o),Jn(n,o))}function Ti(n,o,c){if(n.tag===3)W0(n,n,c);else for(;o!==null;){if(o.tag===3){W0(o,n,c);break}else if(o.tag===1){var p=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Cs===null||!Cs.has(p))){n=Hl(c,n),n=K1(o,n,1),o=Is(o,n,1),n=Vn(),o!==null&&(Hu(o,1,n),Jn(o,n));break}}o=o.return}}function N4(n,o,c){var p=n.pingCache;p!==null&&p.delete(o),o=Vn(),n.pingedLanes|=n.suspendedLanes&c,tn===n&&(un&c)===c&&(Vi===4||Vi===3&&(un&130023424)===un&&500>Pi()-Hg?ma(n,0):Wg|=c),Jn(n,o)}function mx(n,o){o===0&&(n.mode&1?(o=pd,pd<<=1,!(pd&130023424)&&(pd=4194304)):o=1);var c=Vn();n=Ro(n,o),n!==null&&(Hu(n,o,c),Jn(n,c))}function j4(n){var o=n.memoizedState,c=0;o!==null&&(c=o.retryLane),mx(n,c)}function V4(n,o){var c=0;switch(n.tag){case 13:var p=n.stateNode,v=n.memoizedState;v!==null&&(c=v.retryLane);break;case 19:p=n.stateNode;break;default:throw Error(De(314))}p!==null&&p.delete(o),mx(n,c)}var gx;gx=function(n,o,c){if(n!==null)if(n.memoizedProps!==o.pendingProps||Xn.current)Kn=!0;else{if(!(n.lanes&c)&&!(o.flags&128))return Kn=!1,E4(n,o,c);Kn=!!(n.flags&131072)}else Kn=!1,mi&&o.flags&1048576&&x1(o,Xd,o.index);switch(o.lanes=0,o.tag){case 2:var p=o.type;Ld(n,o),n=o.pendingProps;var v=Zl(o,En.current);jl(o,c),v=Vg(null,o,p,n,v,c);var k=Ug();return o.flags|=1,typeof v=="object"&&v!==null&&typeof v.render=="function"&&v.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Yn(p)?(k=!0,Hd(o)):k=!1,o.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,Fg(o),v.updater=gp,o.stateNode=v,v._reactInternals=o,Hm(o,p,n,c),o=Ym(null,o,p,!0,k,c)):(o.tag=0,mi&&k&&Pg(o),Nn(null,o,v,c),o=o.child),o;case 16:p=o.elementType;e:{switch(Ld(n,o),n=o.pendingProps,v=p._init,p=v(p._payload),o.type=p,v=o.tag=$4(p),n=jr(p,n),v){case 0:o=Xm(null,o,p,n,c);break e;case 1:o=B0(null,o,p,n,c);break e;case 11:o=R0(null,o,p,n,c);break e;case 14:o=F0(null,o,p,jr(p.type,n),c);break e}throw Error(De(306,p,""))}return o;case 0:return p=o.type,v=o.pendingProps,v=o.elementType===p?v:jr(p,v),Xm(n,o,p,v,c);case 1:return p=o.type,v=o.pendingProps,v=o.elementType===p?v:jr(p,v),B0(n,o,p,v,c);case 3:e:{if(Q1(o),n===null)throw Error(De(387));p=o.pendingProps,k=o.memoizedState,v=k.element,I1(n,o),Qd(o,p,null,c);var S=o.memoizedState;if(p=S.element,k.isDehydrated)if(k={element:p,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},o.updateQueue.baseState=k,o.memoizedState=k,o.flags&256){v=Hl(Error(De(423)),o),o=O0(n,o,p,c,v);break e}else if(p!==v){v=Hl(Error(De(424)),o),o=O0(n,o,p,c,v);break e}else for(cr=ks(o.stateNode.containerInfo.firstChild),ur=o,mi=!0,Ur=null,c=T1(o,null,p,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(ql(),p===v){o=Fo(n,o,c);break e}Nn(n,o,p,c)}o=o.child}return o;case 5:return C1(o),n===null&&qm(o),p=o.type,v=o.pendingProps,k=n!==null?n.memoizedProps:null,S=v.children,jm(p,v)?S=null:k!==null&&jm(p,k)&&(o.flags|=32),J1(n,o),Nn(n,o,S,c),o.child;case 6:return n===null&&qm(o),null;case 13:return ex(n,o,c);case 4:return Bg(o,o.stateNode.containerInfo),p=o.pendingProps,n===null?o.child=Gl(o,null,p,c):Nn(n,o,p,c),o.child;case 11:return p=o.type,v=o.pendingProps,v=o.elementType===p?v:jr(p,v),R0(n,o,p,v,c);case 7:return Nn(n,o,o.pendingProps,c),o.child;case 8:return Nn(n,o,o.pendingProps.children,c),o.child;case 12:return Nn(n,o,o.pendingProps.children,c),o.child;case 10:e:{if(p=o.type._context,v=o.pendingProps,k=o.memoizedProps,S=v.value,ri(Yd,p._currentValue),p._currentValue=S,k!==null)if(qr(k.value,S)){if(k.children===v.children&&!Xn.current){o=Fo(n,o,c);break e}}else for(k=o.child,k!==null&&(k.return=o);k!==null;){var d=k.dependencies;if(d!==null){S=k.child;for(var $=d.firstContext;$!==null;){if($.context===p){if(k.tag===1){$=zo(-1,c&-c),$.tag=2;var ie=k.updateQueue;if(ie!==null){ie=ie.shared;var me=ie.pending;me===null?$.next=$:($.next=me.next,me.next=$),ie.pending=$}}k.lanes|=c,$=k.alternate,$!==null&&($.lanes|=c),Gm(k.return,c,o),d.lanes|=c;break}$=$.next}}else if(k.tag===10)S=k.type===o.type?null:k.child;else if(k.tag===18){if(S=k.return,S===null)throw Error(De(341));S.lanes|=c,d=S.alternate,d!==null&&(d.lanes|=c),Gm(S,c,o),S=k.sibling}else S=k.child;if(S!==null)S.return=k;else for(S=k;S!==null;){if(S===o){S=null;break}if(k=S.sibling,k!==null){k.return=S.return,S=k;break}S=S.return}k=S}Nn(n,o,v.children,c),o=o.child}return o;case 9:return v=o.type,p=o.pendingProps.children,jl(o,c),v=Tr(v),p=p(v),o.flags|=1,Nn(n,o,p,c),o.child;case 14:return p=o.type,v=jr(p,o.pendingProps),v=jr(p.type,v),F0(n,o,p,v,c);case 15:return X1(n,o,o.type,o.pendingProps,c);case 17:return p=o.type,v=o.pendingProps,v=o.elementType===p?v:jr(p,v),Ld(n,o),o.tag=1,Yn(p)?(n=!0,Hd(o)):n=!1,jl(o,c),W1(o,p,v),Hm(o,p,v,c),Ym(null,o,p,!0,n,c);case 19:return tx(n,o,c);case 22:return Y1(n,o,c)}throw Error(De(156,o.tag))};function yx(n,o){return Zv(n,o)}function U4(n,o,c,p){this.tag=n,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function br(n,o,c,p){return new U4(n,o,c,p)}function Jg(n){return n=n.prototype,!(!n||!n.isReactComponent)}function $4(n){if(typeof n=="function")return Jg(n)?1:0;if(n!=null){if(n=n.$$typeof,n===yg)return 11;if(n===_g)return 14}return 2}function Ps(n,o){var c=n.alternate;return c===null?(c=br(n.tag,o,n.key,n.mode),c.elementType=n.elementType,c.type=n.type,c.stateNode=n.stateNode,c.alternate=n,n.alternate=c):(c.pendingProps=o,c.type=n.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=n.flags&14680064,c.childLanes=n.childLanes,c.lanes=n.lanes,c.child=n.child,c.memoizedProps=n.memoizedProps,c.memoizedState=n.memoizedState,c.updateQueue=n.updateQueue,o=n.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=n.sibling,c.index=n.index,c.ref=n.ref,c}function Bd(n,o,c,p,v,k){var S=2;if(p=n,typeof n=="function")Jg(n)&&(S=1);else if(typeof n=="string")S=5;else e:switch(n){case kl:return ga(c.children,v,k,o);case gg:S=8,v|=8;break;case _m:return n=br(12,c,o,v|2),n.elementType=_m,n.lanes=k,n;case vm:return n=br(13,c,o,v),n.elementType=vm,n.lanes=k,n;case xm:return n=br(19,c,o,v),n.elementType=xm,n.lanes=k,n;case Cv:return vp(c,v,k,o);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case kv:S=10;break e;case Iv:S=9;break e;case yg:S=11;break e;case _g:S=14;break e;case gs:S=16,p=null;break e}throw Error(De(130,n==null?n:typeof n,""))}return o=br(S,c,o,v),o.elementType=n,o.type=p,o.lanes=k,o}function ga(n,o,c,p){return n=br(7,n,p,o),n.lanes=c,n}function vp(n,o,c,p){return n=br(22,n,p,o),n.elementType=Cv,n.lanes=c,n.stateNode={isHidden:!1},n}function um(n,o,c){return n=br(6,n,null,o),n.lanes=c,n}function hm(n,o,c){return o=br(4,n.children!==null?n.children:[],n.key,o),o.lanes=c,o.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},o}function Z4(n,o,c,p,v){this.tag=o,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=qf(0),this.expirationTimes=qf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qf(0),this.identifierPrefix=p,this.onRecoverableError=v,this.mutableSourceEagerHydrationData=null}function Qg(n,o,c,p,v,k,S,d,$){return n=new Z4(n,o,c,d,$),o===1?(o=1,k===!0&&(o|=8)):o=0,k=br(3,null,null,o),n.current=k,k.stateNode=n,k.memoizedState={element:p,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fg(k),n}function q4(n,o,c){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Tl,key:p==null?null:""+p,children:n,containerInfo:o,implementation:c}}function _x(n){if(!n)return As;n=n._reactInternals;e:{if(Sa(n)!==n||n.tag!==1)throw Error(De(170));var o=n;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Yn(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(De(171))}if(n.tag===1){var c=n.type;if(Yn(c))return _1(n,c,o)}return o}function vx(n,o,c,p,v,k,S,d,$){return n=Qg(c,p,!0,n,v,k,S,d,$),n.context=_x(null),c=n.current,p=Vn(),v=Es(c),k=zo(p,v),k.callback=o??null,Is(c,k,v),n.current.lanes=v,Hu(n,v,p),Jn(n,p),n}function xp(n,o,c,p){var v=o.current,k=Vn(),S=Es(v);return c=_x(c),o.context===null?o.context=c:o.pendingContext=c,o=zo(k,S),o.payload={element:n},p=p===void 0?null:p,p!==null&&(o.callback=p),n=Is(v,o,S),n!==null&&(Zr(n,v,S,k),Ad(n,v,S)),S}function ap(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function H0(n,o){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var c=n.retryLane;n.retryLane=c!==0&&c<o?c:o}}function ey(n,o){H0(n,o),(n=n.alternate)&&H0(n,o)}function G4(){return null}var xx=typeof reportError=="function"?reportError:function(n){console.error(n)};function ty(n){this._internalRoot=n}wp.prototype.render=ty.prototype.render=function(n){var o=this._internalRoot;if(o===null)throw Error(De(409));xp(n,o,null,null)};wp.prototype.unmount=ty.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var o=n.containerInfo;wa(function(){xp(null,n,null,null)}),o[Lo]=null}};function wp(n){this._internalRoot=n}wp.prototype.unstable_scheduleHydration=function(n){if(n){var o=Yv();n={blockedOn:null,target:n,priority:o};for(var c=0;c<_s.length&&o!==0&&o<_s[c].priority;c++);_s.splice(c,0,n),c===0&&Qv(n)}};function iy(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function bp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function K0(){}function W4(n,o,c,p,v){if(v){if(typeof p=="function"){var k=p;p=function(){var ie=ap(S);k.call(ie)}}var S=vx(o,p,n,0,null,!1,!1,"",K0);return n._reactRootContainer=S,n[Lo]=S.current,Ou(n.nodeType===8?n.parentNode:n),wa(),S}for(;v=n.lastChild;)n.removeChild(v);if(typeof p=="function"){var d=p;p=function(){var ie=ap($);d.call(ie)}}var $=Qg(n,0,!1,null,null,!1,!1,"",K0);return n._reactRootContainer=$,n[Lo]=$.current,Ou(n.nodeType===8?n.parentNode:n),wa(function(){xp(o,$,c,p)}),$}function Sp(n,o,c,p,v){var k=c._reactRootContainer;if(k){var S=k;if(typeof v=="function"){var d=v;v=function(){var $=ap(S);d.call($)}}xp(o,S,n,v)}else S=W4(c,o,n,v,p);return ap(S)}Kv=function(n){switch(n.tag){case 3:var o=n.stateNode;if(o.current.memoizedState.isDehydrated){var c=vu(o.pendingLanes);c!==0&&(wg(o,c|1),Jn(o,Pi()),!(Bt&6)&&(Kl=Pi()+500,Ls()))}break;case 13:wa(function(){var p=Ro(n,1);if(p!==null){var v=Vn();Zr(p,n,1,v)}}),ey(n,1)}};bg=function(n){if(n.tag===13){var o=Ro(n,134217728);if(o!==null){var c=Vn();Zr(o,n,134217728,c)}ey(n,134217728)}};Xv=function(n){if(n.tag===13){var o=Es(n),c=Ro(n,o);if(c!==null){var p=Vn();Zr(c,n,o,p)}ey(n,o)}};Yv=function(){return Gt};Jv=function(n,o){var c=Gt;try{return Gt=n,o()}finally{Gt=c}};Mm=function(n,o,c){switch(o){case"input":if(Sm(n,c),o=c.name,c.type==="radio"&&o!=null){for(c=n;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<c.length;o++){var p=c[o];if(p!==n&&p.form===n.form){var v=pp(p);if(!v)throw Error(De(90));Pv(p),Sm(p,v)}}}break;case"textarea":Av(n,c);break;case"select":o=c.value,o!=null&&Fl(n,!!c.multiple,o,!1)}};Ov=Kg;Nv=wa;var H4={usingClientEntryPoint:!1,Events:[Xu,Pl,pp,Fv,Bv,Kg]},mu={findFiberByHostInstance:da,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},K4={bundleType:mu.bundleType,version:mu.version,rendererPackageName:mu.rendererPackageName,rendererConfig:mu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Bo.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Uv(n),n===null?null:n.stateNode},findFiberByHostInstance:mu.findFiberByHostInstance||G4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Td=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Td.isDisabled&&Td.supportsFiber)try{cp=Td.inject(K4),lo=Td}catch{}}dr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=H4;dr.createPortal=function(n,o){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!iy(o))throw Error(De(200));return q4(n,o,null,c)};dr.createRoot=function(n,o){if(!iy(n))throw Error(De(299));var c=!1,p="",v=xx;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(p=o.identifierPrefix),o.onRecoverableError!==void 0&&(v=o.onRecoverableError)),o=Qg(n,1,!1,null,null,c,!1,p,v),n[Lo]=o.current,Ou(n.nodeType===8?n.parentNode:n),new ty(o)};dr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var o=n._reactInternals;if(o===void 0)throw typeof n.render=="function"?Error(De(188)):(n=Object.keys(n).join(","),Error(De(268,n)));return n=Uv(o),n=n===null?null:n.stateNode,n};dr.flushSync=function(n){return wa(n)};dr.hydrate=function(n,o,c){if(!bp(o))throw Error(De(200));return Sp(null,n,o,!0,c)};dr.hydrateRoot=function(n,o,c){if(!iy(n))throw Error(De(405));var p=c!=null&&c.hydratedSources||null,v=!1,k="",S=xx;if(c!=null&&(c.unstable_strictMode===!0&&(v=!0),c.identifierPrefix!==void 0&&(k=c.identifierPrefix),c.onRecoverableError!==void 0&&(S=c.onRecoverableError)),o=vx(o,null,n,1,c??null,v,!1,k,S),n[Lo]=o.current,Ou(n),p)for(n=0;n<p.length;n++)c=p[n],v=c._getVersion,v=v(c._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[c,v]:o.mutableSourceEagerHydrationData.push(c,v);return new wp(o)};dr.render=function(n,o,c){if(!bp(o))throw Error(De(200));return Sp(null,n,o,!1,c)};dr.unmountComponentAtNode=function(n){if(!bp(n))throw Error(De(40));return n._reactRootContainer?(wa(function(){Sp(null,null,n,!1,function(){n._reactRootContainer=null,n[Lo]=null})}),!0):!1};dr.unstable_batchedUpdates=Kg;dr.unstable_renderSubtreeIntoContainer=function(n,o,c,p){if(!bp(c))throw Error(De(200));if(n==null||n._reactInternals===void 0)throw Error(De(38));return Sp(n,o,c,!1,p)};dr.version="18.3.1-next-f1338f8080-20240426";function wx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(wx)}catch(n){console.error(n)}}wx(),wv.exports=dr;var Ju=wv.exports,X0=Ju;gm.createRoot=X0.createRoot,gm.hydrateRoot=X0.hydrateRoot;const X4="43f36e14-e3f5-43c1-84c0-50a9c80dc5c7",Y4="MapLibre",J4=.8619833357855968,Q4=0,e3=[17.65431710431244,32.954120326746775],t3="https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf",i3=[{id:"background",type:"background",paint:{"background-color":"#D8F2FF"},filter:["all"],layout:{visibility:"visible"},maxzoom:24},{id:"coastline",type:"line",paint:{"line-blur":.5,"line-color":"#198EC8","line-width":{stops:[[0,2],[6,6],[14,9],[22,18]]}},filter:["all"],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},source:"maplibre",maxzoom:24,minzoom:0,"source-layer":"countries"},{id:"countries-fill",type:"fill",paint:{"fill-color":["match",["get","ADM0_A3"],["ARM","ATG","AUS","BTN","CAN","COG","CZE","GHA","GIN","HTI","ISL","JOR","KHM","KOR","LVA","MLT","MNE","MOZ","PER","SAH","SGP","SLV","SOM","TJK","TUV","UKR","WSM"],"#D6C7FF",["AZE","BGD","CHL","CMR","CSI","DEU","DJI","GUY","HUN","IOA","JAM","LBN","LBY","LSO","MDG","MKD","MNG","MRT","NIU","NZL","PCN","PYF","SAU","SHN","STP","TTO","UGA","UZB","ZMB"],"#EBCA8A",["AGO","ASM","ATF","BDI","BFA","BGR","BLZ","BRA","CHN","CRI","ESP","HKG","HRV","IDN","IRN","ISR","KNA","LBR","LCA","MAC","MUS","NOR","PLW","POL","PRI","SDN","TUN","UMI","USA","USG","VIR","VUT"],"#C1E599",["ARE","ARG","BHS","CIV","CLP","DMA","ETH","GAB","GRD","HMD","IND","IOT","IRL","IRQ","ITA","KOS","LUX","MEX","NAM","NER","PHL","PRT","RUS","SEN","SUR","TZA","VAT"],"#E7E58F",["AUT","BEL","BHR","BMU","BRB","CYN","DZA","EST","FLK","GMB","GUM","HND","JEY","KGZ","LIE","MAF","MDA","NGA","NRU","SLB","SOL","SRB","SWZ","THA","TUR","VEN","VGB"],"#98DDA1",["AIA","BIH","BLM","BRN","CAF","CHE","COM","CPV","CUB","ECU","ESB","FSM","GAZ","GBR","GEO","KEN","LTU","MAR","MCO","MDV","NFK","NPL","PNG","PRY","QAT","SLE","SPM","SYC","TCA","TKM","TLS","VNM","WEB","WSB","YEM","ZWE"],"#83D5F4",["ABW","ALB","AND","ATC","BOL","COD","CUW","CYM","CYP","EGY","FJI","GGY","IMN","KAB","KAZ","KWT","LAO","MLI","MNP","MSR","MYS","NIC","NLD","PAK","PAN","PRK","ROU","SGS","SVN","SWE","TGO","TWN","VCT","ZAF"],"#B1BBF9",["ATA","GRL"],"#FFFFFF","#EAB38F"]},filter:["all"],layout:{visibility:"visible"},source:"maplibre",maxzoom:24,"source-layer":"countries"},{id:"countries-boundary",type:"line",paint:{"line-color":"rgba(255, 255, 255, 1)","line-width":{stops:[[1,1],[6,2],[14,6],[22,12]]},"line-opacity":{stops:[[3,.5],[6,1]]}},layout:{"line-cap":"round","line-join":"round",visibility:"visible"},source:"maplibre",maxzoom:24,"source-layer":"countries"},{id:"geolines",type:"line",paint:{"line-color":"#1077B0","line-opacity":1,"line-dasharray":[3,3]},filter:["all",["!=","name","International Date Line"]],layout:{visibility:"visible"},source:"maplibre",maxzoom:24,"source-layer":"geolines"},{id:"geolines-label",type:"symbol",paint:{"text-color":"#1077B0","text-halo-blur":1,"text-halo-color":"rgba(255, 255, 255, 1)","text-halo-width":1},filter:["all",["!=","name","International Date Line"]],layout:{"text-font":["Open Sans Semibold"],"text-size":{stops:[[2,12],[6,16]]},"text-field":"{name}",visibility:"visible","symbol-placement":"line"},source:"maplibre",maxzoom:24,minzoom:1,"source-layer":"geolines"},{id:"countries-label",type:"symbol",paint:{"text-color":"rgba(8, 37, 77, 1)","text-halo-blur":{stops:[[2,.2],[6,0]]},"text-halo-color":"rgba(255, 255, 255, 1)","text-halo-width":{stops:[[2,1],[6,1.6]]}},filter:["all"],layout:{"text-font":["Open Sans Semibold"],"text-size":{stops:[[2,10],[4,12],[6,16]]},"text-field":{stops:[[2,"{ABBREV}"],[4,"{NAME}"]]},visibility:"visible","text-max-width":10,"text-transform":{stops:[[0,"uppercase"],[2,"none"]]}},source:"maplibre",maxzoom:24,minzoom:2,"source-layer":"centroids"},{id:"crimea-fill",type:"fill",source:"crimea",paint:{"fill-color":"#D6C7FF"}}],n3=0,r3={maplibre:{url:"https://demotiles.maplibre.org/tiles/tiles.json",type:"vector",attribution:'© <a href="https://maplibre.org/">MapLibre</a>'},crimea:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[34.00905273547181,46.55925987559425],[33.64325260204026,46.34533545368038],[33.628682598560204,46.12569762665683],[33.64292861730951,46.10476396128129],[33.648473474905984,46.09033047763651],[33.63876482059936,46.077976784785335],[33.62782672238245,46.06747935719011],[33.62911357645072,46.05708111413949],[33.642686868727424,46.02192963417187],[33.6429723910654,46.01521185644708],[33.636224138774026,46.006705833212465],[33.63052626465907,45.99692992186792],[33.63193836679693,45.988472992911284],[33.64276684834442,45.984575360297384],[33.646928693041986,45.97981936210982],[33.638745893564305,45.96829769147004],[33.61958133326394,45.951176418494185],[33.63181380398527,45.9445404758078],[33.638921676216,45.94737012930554],[33.64561542516918,45.95403251372139],[33.65666403976448,45.95687114427736],[33.6825817382811,45.95878100879199],[33.738791807037614,45.94836945227263],[33.758180142697,45.94072970008301],[33.77735917288169,45.92923970233858],[33.75927796793485,45.92241179584471],[33.72529865009221,45.91587363154565],[33.70875012326826,45.91008760988058],[33.69378857293381,45.91480850795665],[33.69092650243843,45.89657370898402],[33.693592356906805,45.87271465766318],[33.69226765972388,45.86041392418218],[33.6704813511748,45.8584273836251],[33.65936345808916,45.85944682601249],[33.653870582376726,45.86425922279372],[33.65107345584843,45.87089907254003],[33.63067378180233,45.88040685247182],[33.61945300059696,45.88147266102649],[33.60987421595539,45.88048951126686],[33.59906957603934,45.877610457390375],[33.57828877687868,45.86810261756233],[33.55357394560386,45.84700625141778],[33.530220674480375,45.84221983655459],[33.5192297395441,45.84121682367507],[33.50832088442496,45.84313067048083],[33.48901101848409,45.85268298292175],[33.482152996405716,45.854578171799005],[33.46719955896293,45.849912739405056],[33.42447496599681,45.83075886348303],[33.40940172404095,45.82691953557702],[33.37918350072067,45.802867525073566],[33.37362145339398,45.79619281922518],[33.33805543634864,45.78577808972071],[33.26498872665803,45.75410774187094],[33.22887541283427,45.75131270772724],[33.19548267281132,45.7644887297206],[33.1789202379222,45.78010311364778],[33.1688456078636,45.78470227904205],[33.161012432811674,45.77921593899549],[33.15951585299757,45.76864464913777],[33.165962301438725,45.762685940125465],[33.1750888126426,45.759218220695715],[33.181464829753,45.75490447884948],[33.17613930782352,45.7437961960276],[33.16369168844906,45.735912015025065],[32.93692665480876,45.662114646778264],[32.86839112407645,45.63044340698664],[32.83803944575723,45.60834075026611],[32.82702772424804,45.59576101516498],[32.82433467080986,45.58705137380335],[32.82563941622885,45.579605763895614],[32.82993674258438,45.56978311819469],[32.82851940940563,45.56227808675749],[32.813310142795274,45.55930933158257],[32.80213583657516,45.560145780074464],[32.78258622159436,45.565158335073846],[32.77333922465823,45.56689313356526],[32.758306734735356,45.565030173463356],[32.750177256846115,45.55943726334968],[32.74340732630185,45.55261895849793],[32.73524549539499,45.54598788110354],[32.72031700779701,45.53735927760957],[32.70536040418847,45.53169142131733],[32.68589438933773,45.52663379187257],[32.66370583186284,45.52563107058867],[32.64312077736798,45.52188979044979],[32.525284074162556,45.45838108691365],[32.49490411219156,45.43524910229854],[32.48107654411925,45.408986638827514],[32.48514589713025,45.39458067125969],[32.51256939517424,45.34060655033625],[32.535915460470335,45.33777248012882],[32.57027153843481,45.32510892683359],[32.590830644991826,45.32038723212662],[32.66380378113439,45.320421746458976],[32.67760722618917,45.32609231279554],[32.71316246802607,45.353283572618125],[32.72817188836078,45.36074681043402],[32.750518060251466,45.36371725645313],[32.89973931692998,45.35412322462227],[32.941197846443885,45.34245505845169],[32.97701667405008,45.32596743563991],[33.04296090827762,45.2853982930032],[33.05274355585479,45.28154273654923],[33.06850284417635,45.27703461892352],[33.07825272648239,45.272210805127315],[33.089426322403455,45.25656353201492],[33.09897492343546,45.247820101667884],[33.12384611720435,45.238235755071685],[33.15767197859745,45.20755227709648],[33.172959979330074,45.19681657531794],[33.21837666514142,45.187878368659824],[33.24017433636709,45.180191106261134],[33.248571989896675,45.16588271012458],[33.259649216030766,45.155918961282026],[33.28309785485047,45.16064860772312],[33.31767999550894,45.17535522412791],[33.35458473323109,45.18598673360148],[33.39725661527919,45.18973663076909],[33.41344561756824,45.18490731877088],[33.468468576977216,45.149132412229676],[33.537128652906205,45.11719769268973],[33.56161328289443,45.094099022711475],[33.57837628774928,45.053145935448015],[33.58247744978442,45.027377243150454],[33.5851414316958,45.01816461606674],[33.6031021265521,44.993103583251695],[33.605922209331794,44.986905272229734],[33.60843524291815,44.97039962759274],[33.61943161357851,44.93184946652454],[33.619484500808824,44.90819321920554],[33.61549738593425,44.88894092276257],[33.608561183117274,44.871288478948514],[33.59889474705494,44.859790298912856],[33.55904244709464,44.850057575124595],[33.54667558363471,44.83724531175508],[33.53701832136994,44.81871953508235],[33.5303157846202,44.798338017069625],[33.5249116915937,44.78918633101301],[33.51669091675143,44.784809980590666],[33.524785531609865,44.77183212449111],[33.5302902535075,44.75724515985675],[33.53710734694323,44.73034290771247],[33.54650992495621,44.70989226909535],[33.5481286806762,44.699106546699085],[33.543995566510915,44.68230506537358],[33.53580273994743,44.6726082589706],[33.52337411931097,44.661863083605255],[33.515320778874354,44.6491266698327],[33.516377841582795,44.63464990118433],[33.52466971637648,44.62863961572572],[33.557474298027785,44.62473000923737],[33.5710648827386,44.620853511273225],[33.55105839203679,44.61506440493406],[33.499905706797676,44.61452599304897],[33.48451102966331,44.60992438254493],[33.47658499621011,44.60714391514574],[33.46705078205747,44.60616254193252],[33.44476599234898,44.607062134677875],[33.4353466482458,44.60509936890821],[33.413591053005575,44.593500212748125],[33.40543527945235,44.59055535193136],[33.37510958624222,44.58564691897425],[33.37074452434078,44.58851022190515],[33.372237834990756,44.576810695127364],[33.37913003799301,44.56412673079859],[33.48759131590526,44.51024086451031],[33.50011215135888,44.50041002882833],[33.517917009115365,44.49074142372788],[33.53836387802215,44.49164280212756],[33.56041892763031,44.4966411022441],[33.57822378538677,44.497542389459795],[33.59062975079095,44.48975808594983],[33.619577003408466,44.46229988129974],[33.62635433636015,44.45336293328907],[33.63175322871038,44.434828756313124],[33.645537634715026,44.42498521035591],[33.721007257593925,44.39946630464436],[33.74168386660085,44.39560878121904],[33.80727466517129,44.39454176175843],[33.81841706002561,44.39552670349164],[33.83909366903248,44.40143600575672],[33.85149963444792,44.40143600575945],[33.91467816197718,44.38387049706651],[33.938111652185,44.38083293528811],[33.957065210440874,44.38272116790142],[34.06614966692763,44.42019923628979],[34.088893936836286,44.42200415824283],[34.10279321289039,44.42487551014821],[34.135933345669,44.44163597968952],[34.14696087047267,44.44959070749778],[34.16058918507403,44.466287285335795],[34.170123399227776,44.48186111741296],[34.182759104731986,44.49267838558103],[34.22923417224524,44.49949719774551],[34.24301857824986,44.50744404277697],[34.263903954150294,44.53186886058606],[34.26631622520165,44.53555362837611],[34.26631622520165,44.54153064468656],[34.27033667695244,44.545378535987936],[34.2757355693048,44.54644280144541],[34.285384653508004,44.54562413743594],[34.299973149863405,44.54554227040174],[34.32260254971496,44.543577427039224],[34.3308731933177,44.54546040325087],[34.340292537420794,44.55798473830754],[34.38042135640006,44.631830317636684],[34.41495238900856,44.673669777529994],[34.424193090575585,44.68239452736094],[34.42959198292681,44.68884644523774],[34.469399167794535,44.730194532749294],[34.47376422969597,44.73011292571252],[34.47376422969597,44.72635887754967],[34.475142670296464,44.723502373339585],[34.499724861011515,44.74292382044041],[34.532800295801195,44.752620844929055],[34.61217550038418,44.76534519537847],[34.65065696715081,44.777088262503725],[34.72084256772871,44.811080759265764],[34.756796893391225,44.82094054159748],[34.82646979041766,44.81208604604609],[34.84289620758207,44.816893835303176],[34.856910353686715,44.82373813182468],[34.889648317948144,44.817871641692506],[34.90733830566026,44.820886440346584],[34.922960632465504,44.83050015059965],[34.92950822531711,44.83652826953224],[34.94179932067178,44.84019370922482],[34.95282684547897,44.841415470643284],[34.98567967978991,44.840275160795755],[35.0053224583441,44.83538786296728],[35.017958163849414,44.82219008824552],[35.02703289780189,44.80890779582285],[35.037933245998005,44.79869792240089],[35.08073333784134,44.793525442788905],[35.1080207326404,44.824553365795765],[35.130368105574235,44.86879838545747],[35.15485200090768,44.90071251697748],[35.17111229780758,44.90746386008772],[35.21522068940149,44.91421441031795],[35.233163085981715,44.925728224907715],[35.25636688416236,44.95896657181197],[35.27300098099195,44.96690119386028],[35.29748487632534,44.95605693543271],[35.30496087491386,44.96121482614441],[35.315240372954605,44.965711070514175],[35.31935217217088,44.96941359539801],[35.36757236298112,44.94362319076086],[35.36103086422793,44.97364475976596],[35.362152264014156,44.98593980935419],[35.374674561627444,44.997835734117416],[35.389439658813274,45.00180049366759],[35.42270785247763,45.00087540764923],[35.43504325012745,45.00470780964241],[35.43504325012745,45.011446929213974],[35.40631957913584,45.02015821022701],[35.40089948016896,45.025046135473445],[35.39790908073891,45.03482073400548],[35.40052568024015,45.042216617888045],[35.40631957913584,45.051328088783805],[35.40744097892215,45.06294640963205],[35.41734667704213,45.0708666385693],[35.469304867139925,45.10068964922732],[35.5070260597534,45.113341616151644],[35.54758335202416,45.12019982412133],[35.59019654390909,45.11993606213795],[35.63411803553862,45.11439677872579],[35.70669729572677,45.09480210570922],[35.771782422456766,45.06572995732262],[35.78430472007,45.057941041321754],[35.81250040352472,45.031852200991295],[35.81941570220667,45.021152336906454],[35.82763930064016,44.99895365027004],[35.848198296721705,44.99208088455586],[35.916977483614176,45.00172895661731],[35.99360646900681,44.997896355361604],[36.00893226608571,45.00926125333629],[36.02539976723364,45.03288661039673],[36.047827762958946,45.048074065419456],[36.078666257082034,45.03883000769565],[36.079137312377895,45.046610970582435],[36.135020401727616,45.02125162210126],[36.2241716847341,45.00751061631556],[36.24398308095806,45.011474706353084],[36.24828178013877,45.01649549321965],[36.25332807917695,45.03247980324494],[36.25743987839326,45.03842324279259],[36.267158676549116,45.043573724415154],[36.2783726744118,45.04555455542638],[36.36740852558336,45.04833265291825],[36.44029951169139,45.06787222615526],[36.45375630913995,45.07631970334319],[36.455251508854985,45.09202341204062],[36.44142091149291,45.10709638287736],[36.41432041665814,45.12872568311289],[36.40852651776157,45.149160473330085],[36.409997342308856,45.171615955386955],[36.418312796420764,45.23001671705953],[36.42672329481775,45.25186253492981],[36.43756477765089,45.27227491599612],[36.4497132753354,45.28542626329343],[36.45905827355429,45.28753019598713],[36.4814862692796,45.28845064200263],[36.4909554290368,45.29213135137758],[36.49637552800283,45.300940007322055],[36.49394582846682,45.305015191082816],[36.48871262946426,45.30935296803605],[36.48460083024801,45.315924724862185],[36.489647129296515,45.336413860372005],[36.502169426909745,45.34731734941451],[36.52104632331191,45.35033842661815],[36.544281237819945,45.34731734942025],[36.57455903204905,45.33601971904315],[36.585399229982954,45.333917585593355],[36.59810088537549,45.334837278577254],[36.630808379142394,45.34048649352954],[36.637536777859964,45.3511265071989],[36.63099527910589,45.3741073632589],[36.61359545390113,45.40895280985421],[36.59845655678569,45.421547717459106],[36.58331765967199,45.42731944465129],[36.566309762912795,45.42548305000767],[36.54836736633254,45.41210180010589],[36.53285466928139,45.4090840212946],[36.51565987255873,45.41957994832251],[36.49117597722616,45.44279525429408],[36.47043008117939,45.4458112314303],[36.411182792482634,45.43610707766504],[36.391371396258705,45.43991025572652],[36.35959840231365,45.45407156049933],[36.33960010612526,45.45695583486963],[36.33025510790637,45.454464879327446],[36.32053630976225,45.44856480887407],[36.31156511147125,45.4438443081136],[36.29885591389362,45.442795254299995],[36.3072664122906,45.46115087970253],[36.30016421364425,45.47320989503609],[36.283717016779036,45.476355300848866],[36.267082919949445,45.46704963343626],[36.25213092279836,45.46115087970253],[36.13681364478941,45.46219959214511],[36.11700224855986,45.45721803432335],[36.097003952371466,45.441483909606006],[36.06952965760803,45.43046741078453],[36.0655449627526,45.42553028973455],[36.05134056545904,45.39535242162091],[36.022557970944945,45.368441166003805],[35.986486277818386,45.362926059418186],[35.94723728529826,45.372380198658874],[35.87220216002379,45.404075760536614],[35.85388596351393,45.413916621802144],[35.84715756479628,45.426379251448395],[35.8524047739447,45.44386497541683],[35.85950697259193,45.45933624762881],[35.857824872912545,45.469953901705],[35.83278027768503,45.47087138287168],[35.8167068807486,45.46392436820739],[35.80362388324218,45.44963442058864],[35.79469305616038,45.42980210462429],[35.791889556694684,45.41209230278156],[35.772265060435046,45.39214572935421],[35.767405661361295,45.38873311015669],[35.75189296431793,45.386632934388984],[35.7481549650407,45.379938103368545],[35.746846665290036,45.369960021421576],[35.74423006578874,45.36076812520648],[35.71619507113218,45.34040932557082],[35.69451467527287,45.32989869277279],[35.51720627467216,45.29506847418358],[35.48038698168983,45.2979608697527],[35.33194061536096,45.371562726652314],[35.04491375777232,45.669545248704424],[35.00230056589345,45.7290693869553],[34.70631294999043,46.024929846739866],[34.35868883309806,46.106725558140795],[34.00905273547181,46.55925987559425]]]}}}},o3=8,s3={"maptiler:copyright":"This style was generated on MapTiler Cloud. Usage is governed by the license terms in https://github.com/maplibre/demotiles/blob/gh-pages/LICENSE","openmaptiles:version":"3.x"},a3={id:X4,name:Y4,zoom:J4,pitch:Q4,center:e3,glyphs:t3,layers:i3,bearing:n3,sources:r3,version:o3,metadata:s3};var l3=Object.create,bx=Object.defineProperty,c3=Object.getOwnPropertyDescriptor,ny=Object.getOwnPropertyNames,u3=Object.getPrototypeOf,h3=Object.prototype.hasOwnProperty,d3=(n,o)=>function(){return n&&(o=(0,n[ny(n)[0]])(n=0)),o},p3=(n,o)=>function(){return o||(0,n[ny(n)[0]])((o={exports:{}}).exports,o),o.exports},f3=(n,o,c,p)=>{if(o&&typeof o=="object"||typeof o=="function")for(let v of ny(o))!h3.call(n,v)&&v!==c&&bx(n,v,{get:()=>o[v],enumerable:!(p=c3(o,v))||p.enumerable});return n},m3=(n,o,c)=>(c=n!=null?l3(u3(n)):{},f3(bx(c,"default",{value:n,enumerable:!0}),n)),kt=d3({"../../node_modules/.pnpm/tsup@8.1.0_@swc+core@1.5.27_@swc+helpers@0.5.5__postcss@8.4.38_ts-node@10.9.2_@swc+core@1.5.2_3vwh66dsebnwbtwten5wl4t4ty/node_modules/tsup/assets/esm_shims.js"(){}}),g3=p3({"../../node_modules/.pnpm/@mapbox+point-geometry@0.1.0/node_modules/@mapbox/point-geometry/index.js"(n,o){kt(),o.exports=c;function c(p,v){this.x=p,this.y=v}c.prototype={clone:function(){return new c(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},multByPoint:function(p){return this.clone()._multByPoint(p)},divByPoint:function(p){return this.clone()._divByPoint(p)},mult:function(p){return this.clone()._mult(p)},div:function(p){return this.clone()._div(p)},rotate:function(p){return this.clone()._rotate(p)},rotateAround:function(p,v){return this.clone()._rotateAround(p,v)},matMult:function(p){return this.clone()._matMult(p)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(p){return this.x===p.x&&this.y===p.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var v=p.x-this.x,k=p.y-this.y;return v*v+k*k},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(p){return Math.atan2(this.y-p.y,this.x-p.x)},angleWith:function(p){return this.angleWithSep(p.x,p.y)},angleWithSep:function(p,v){return Math.atan2(this.x*v-this.y*p,this.x*p+this.y*v)},_matMult:function(p){var v=p[0]*this.x+p[1]*this.y,k=p[2]*this.x+p[3]*this.y;return this.x=v,this.y=k,this},_add:function(p){return this.x+=p.x,this.y+=p.y,this},_sub:function(p){return this.x-=p.x,this.y-=p.y,this},_mult:function(p){return this.x*=p,this.y*=p,this},_div:function(p){return this.x/=p,this.y/=p,this},_multByPoint:function(p){return this.x*=p.x,this.y*=p.y,this},_divByPoint:function(p){return this.x/=p.x,this.y/=p.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var p=this.y;return this.y=this.x,this.x=-p,this},_rotate:function(p){var v=Math.cos(p),k=Math.sin(p),S=v*this.x-k*this.y,d=k*this.x+v*this.y;return this.x=S,this.y=d,this},_rotateAround:function(p,v){var k=Math.cos(p),S=Math.sin(p),d=v.x+k*(this.x-v.x)-S*(this.y-v.y),$=v.y+S*(this.x-v.x)+k*(this.y-v.y);return this.x=d,this.y=$,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(p){return p instanceof c?p:Array.isArray(p)?new c(p[0],p[1]):p}}});kt();var y3=m3(g3()),Ft,Sl=(Ft=class{static testProp(o){if(!Ft.docStyle)return o[0];for(let c=0;c<o.length;c++)if(o[c]in Ft.docStyle)return o[c];return o[0]}static create(o,c,p){const v=window.document.createElement(o);return c!==void 0&&(v.className=c),p&&p.appendChild(v),v}static createNS(o,c){return window.document.createElementNS(o,c)}static disableDrag(){Ft.docStyle&&Ft.selectProp&&(Ft.userSelect=Ft.docStyle[Ft.selectProp],Ft.docStyle[Ft.selectProp]="none")}static enableDrag(){Ft.docStyle&&Ft.selectProp&&(Ft.docStyle[Ft.selectProp]=Ft.userSelect)}static setTransform(o,c){o.style[Ft.transformProp]=c}static addEventListener(o,c,p,v={}){"passive"in v?o.addEventListener(c,p,v):o.addEventListener(c,p,v.capture)}static removeEventListener(o,c,p,v={}){"passive"in v?o.removeEventListener(c,p,v):o.removeEventListener(c,p,v.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",Ft.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Ft.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Ft.suppressClickInternal,!0)},0)}static getScale(o){const c=o.getBoundingClientRect();return{x:c.width/o.offsetWidth||1,y:c.height/o.offsetHeight||1,boundingClientRect:c}}static getPoint(o,c,p){const v=c.boundingClientRect;return new y3.default((p.clientX-v.left)/c.x-o.clientLeft,(p.clientY-v.top)/c.y-o.clientTop)}static mousePos(o,c){const p=Ft.getScale(o);return Ft.getPoint(o,p,c)}static touchPos(o,c){const p=[],v=Ft.getScale(o);for(let k=0;k<c.length;k++)p.push(Ft.getPoint(o,v,c[k]));return p}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}},li(Ft,"docStyle",typeof window<"u"&&window.document&&window.document.documentElement.style),li(Ft,"userSelect"),li(Ft,"selectProp",Ft.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"])),li(Ft,"transformProp",Ft.testProp(["transform","WebkitTransform"])),Ft);kt();var Y0=8,Sx={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.4.1/LICENSE.txt
 */(function(n,o){(function(c,p){n.exports=p()})(T2,function(){var c={},p={};function v(S,d,$){if(p[S]=$,S==="index"){var ie="var sharedModule = {}; ("+p.shared+")(sharedModule); ("+p.worker+")(sharedModule);",me={};return p.shared(me),p.index(c,me),typeof window<"u"&&c.setWorkerUrl(window.URL.createObjectURL(new Blob([ie],{type:"text/javascript"}))),c}}v("shared",["exports"],function(S){function d(i,e,r,a){return new(r||(r=Promise))(function(u,f){function y(I){try{w(a.next(I))}catch(C){f(C)}}function _(I){try{w(a.throw(I))}catch(C){f(C)}}function w(I){var C;I.done?u(I.value):(C=I.value,C instanceof r?C:new r(function(P){P(C)})).then(y,_)}w((a=a.apply(i,e||[])).next())})}function $(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var ie=me;function me(i,e){this.x=i,this.y=e}me.prototype={clone:function(){return new me(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,e){var r=Math.cos(i),a=Math.sin(i),u=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},me.convert=function(i){return i instanceof me?i:Array.isArray(i)?new me(i[0],i[1]):i};var X=$(ie),V=Te;function Te(i,e,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=a}Te.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<e)return r;var f=this.sampleCurveDerivativeX(r);if(Math.abs(f)<1e-6)break;r-=u/f}var y=0,_=1;for(r=i,a=0;a<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<e));a++)i>u?y=r:_=r,r=.5*(_-y)+y;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var ke=$(V);let Me,yt;function oe(){return Me==null&&(Me=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Me}function ne(){if(yt==null&&(yt=!1,oe())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let a=0;a<5*5;a++){const u=4*a;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(a%5,Math.floor(a/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&r[a]!==a){yt=!0;break}}}return yt||!1}function he(i,e,r,a){const u=new ke(i,e,r,a);return f=>u.solve(f)}const Ie=he(.25,.1,.25,1);function Be(i,e,r){return Math.min(r,Math.max(e,i))}function Re(i,e,r){const a=r-e,u=((i-e)%a+a)%a+e;return u===e?r:u}function $e(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}let Xe=1;function xt(i,e,r){const a={};for(const u in i)a[u]=e.call(this,i[u],u,i);return a}function rt(i,e,r){const a={};for(const u in i)e.call(this,i[u],u,i)&&(a[u]=i[u]);return a}function pt(i){return Array.isArray(i)?i.map(pt):typeof i=="object"&&i?xt(i,pt):i}const oi={};function Ut(i){oi[i]||(typeof console<"u"&&console.warn(i),oi[i]=!0)}function ei(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Ri(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Pn=null;function Fi(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ft(i,e,r,a,u){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(i,{timestamp:0});try{const y=f==null?void 0:f.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const _=y.startsWith("BGR"),w=new Uint8ClampedArray(a*u*4);if(yield f.copyTo(w,function(I,C,P,z,L){const B=4*Math.max(-C,0),j=(Math.max(0,P)-P)*z*4+B,q=4*z,Y=Math.max(0,C),ue=Math.max(0,P);return{rect:{x:Y,y:ue,width:Math.min(I.width,C+z)-Y,height:Math.min(I.height,P+L)-ue},layout:[{offset:j,stride:q}]}}(i,e,r,a,u)),_)for(let I=0;I<w.length;I+=4){const C=w[I];w[I]=w[I+2],w[I+2]=C}return w}finally{f.close()}})}let mt,Et;const zt="AbortError";function Ui(){return new Error(zt)}const dn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Mn(i){return dn.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Bi="global-dispatcher";class $i extends Error{constructor(e,r,a,u){super(`AJAXError: ${r} (${e}): ${a}`),this.status=e,this.statusText=r,this.url=a,this.body=u}}const Ir=()=>Ri(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Oo=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const a=Mn(i.url);if(a)return a(i,e);if(Ri(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Bi},e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Ir())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,u){return d(this,void 0,void 0,function*(){const f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:Ir(),signal:u.signal});a.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");const y=yield fetch(f);if(!y.ok){const I=yield y.blob();throw new $i(y.status,y.statusText,a.url,I)}let _;_=a.type==="arrayBuffer"||a.type==="image"?y.arrayBuffer():a.type==="json"?y.json():y.text();const w=yield _;if(u.signal.aborted)throw Ui();return{data:w,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}})}(i,e);if(Ri(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Bi},e)}var r;return function(a,u){return new Promise((f,y)=>{var _;const w=new XMLHttpRequest;w.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(w.responseType="arraybuffer");for(const I in a.headers)w.setRequestHeader(I,a.headers[I]);a.type==="json"&&(w.responseType="text",!((_=a.headers)===null||_===void 0)&&_.Accept||w.setRequestHeader("Accept","application/json")),w.withCredentials=a.credentials==="include",w.onerror=()=>{y(new Error(w.statusText))},w.onload=()=>{if(!u.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let I=w.response;if(a.type==="json")try{I=JSON.parse(w.response)}catch(C){return void y(C)}f({data:I,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const I=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});y(new $i(w.status,w.statusText,a.url,I))}},u.signal.addEventListener("abort",()=>{w.abort(),y(Ui())}),w.send(a.body)})}(i,e)};function No(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function ka(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function fr(i,e,r){if(r&&r[i]){const a=r[i].indexOf(e);a!==-1&&r[i].splice(a,1)}}class Gr{constructor(e,r={}){$e(this,r),this.type=e}}class xi extends Gr{constructor(e,r={}){super("error",$e({error:e},r))}}class jo{on(e,r){return this._listeners=this._listeners||{},ka(e,r,this._listeners),this}off(e,r){return fr(e,r,this._listeners),fr(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},ka(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new Gr(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const _ of u)_.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const _ of f)fr(a,_,this._oneTimeListeners),_.call(this,e);const y=this._eventedParent;y&&($e(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof xi&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Wr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Rs(i,e){const r={};for(const a in i)a!=="ref"&&(r[a]=i[a]);return Wr.forEach(a=>{a in e&&(r[a]=e[a])}),r}function Dt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Dt(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!Dt(i[r],e[r]))return!1;return!0}return i===e}function Jt(i,e){i.push(e)}function Cr(i,e,r){Jt(r,{command:"addSource",args:[i,e[i]]})}function Vo(i,e,r){Jt(e,{command:"removeSource",args:[i]}),r[i]=!0}function Fs(i,e,r,a){Vo(i,r,a),Cr(i,e,r)}function Uo(i,e,r){let a;for(a in i[r])if(Object.prototype.hasOwnProperty.call(i[r],a)&&a!=="data"&&!Dt(i[r][a],e[r][a]))return!1;for(a in e[r])if(Object.prototype.hasOwnProperty.call(e[r],a)&&a!=="data"&&!Dt(i[r][a],e[r][a]))return!1;return!0}function Er(i,e,r,a,u,f){i=i||{},e=e||{};for(const y in i)Object.prototype.hasOwnProperty.call(i,y)&&(Dt(i[y],e[y])||r.push({command:f,args:[a,y,e[y],u]}));for(const y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(i,y)&&(Dt(i[y],e[y])||r.push({command:f,args:[a,y,e[y],u]}))}function $o(i){return i.id}function Ia(i,e){return i[e.id]=e,i}class ze{constructor(e,r,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function pn(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}class fn extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Zo{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,u]of r)this.bindings[a]=u}concat(e){return new Zo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const uo={kind:"null"},Pe={kind:"number"},wt={kind:"string"},gt={kind:"boolean"},nn={kind:"color"},rn={kind:"object"},_t={kind:"value"},Pr={kind:"collator"},Mr={kind:"formatted"},Mi={kind:"padding"},G={kind:"resolvedImage"},D={kind:"variableAnchorOffsetCollection"};function R(i,e){return{kind:"array",itemType:i,N:e}}function O(i){if(i.kind==="array"){const e=O(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const H=[uo,Pe,wt,gt,nn,Mr,rn,R(_t),Mi,G,D];function te(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!te(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of H)if(!te(r,e))return null}}return`Expected ${O(i)} but found ${O(e)} instead.`}function se(i,e){return e.some(r=>r.kind===i.kind)}function ce(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function Q(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const pe=.96422,be=.82521,ve=4/29,_e=6/29,ot=3*_e*_e,nt=_e*_e*_e,Tt=Math.PI/180,ht=180/Math.PI;function Ct(i){return(i%=360)<0&&(i+=360),i}function Nt([i,e,r,a]){let u,f;const y=wi((.2225045*(i=Wt(i))+.7168786*(e=Wt(e))+.0606169*(r=Wt(r)))/1);i===e&&e===r?u=f=y:(u=wi((.4360747*i+.3850649*e+.1430804*r)/pe),f=wi((.0139322*i+.0971045*e+.7141733*r)/be));const _=116*y-16;return[_<0?0:_,500*(u-y),200*(y-f),a]}function Wt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function wi(i){return i>nt?Math.pow(i,1/3):i/ot+ve}function vt([i,e,r,a]){let u=(i+16)/116,f=isNaN(e)?u:u+e/500,y=isNaN(r)?u:u-r/200;return u=1*ki(u),f=pe*ki(f),y=be*ki(y),[ti(3.1338561*f-1.6168667*u-.4906146*y),ti(-.9787684*f+1.9161415*u+.033454*y),ti(.0719453*f-.2289914*u+1.4052427*y),a]}function ti(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function ki(i){return i>_e?i*i*i:ot*(i-ve)}function mn(i){return parseInt(i.padEnd(2,i),16)/255}function An(i,e){return Ii(e?i/100:i,0,1)}function Ii(i,e,r){return Math.min(Math.max(e,i),r)}function qo(i){return!i.some(Number.isNaN)}const Ep={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ot{constructor(e,r,a,u=1,f=!0){this.r=e,this.g=r,this.b=a,this.a=u,f||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,r,a,u]))}static parse(e){if(e instanceof Ot)return e;if(typeof e!="string")return;const r=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=Ep[a];if(u){const[y,_,w]=u;return[y/255,_/255,w/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const y=a.length<6?1:2;let _=1;return[mn(a.slice(_,_+=y)),mn(a.slice(_,_+=y)),mn(a.slice(_,_+=y)),mn(a.slice(_,_+y)||"ff")]}if(a.startsWith("rgb")){const y=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[_,w,I,C,P,z,L,B,j,q,Y,ue]=y,ee=[C||" ",L||" ",q].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const le=[I,z,j].join(""),ge=le==="%%%"?100:le===""?255:0;if(ge){const Se=[Ii(+w/ge,0,1),Ii(+P/ge,0,1),Ii(+B/ge,0,1),Y?An(+Y,ue):1];if(qo(Se))return Se}}return}}const f=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[y,_,w,I,C,P,z,L,B]=f,j=[w||" ",C||" ",z].join("");if(j==="  "||j==="  /"||j===",,"||j===",,,"){const q=[+_,Ii(+I,0,100),Ii(+P,0,100),L?An(+L,B):1];if(qo(q))return function([Y,ue,ee,le]){function ge(Se){const Oe=(Se+Y/30)%12,st=ue*Math.min(ee,1-ee);return ee-st*Math.max(-1,Math.min(Oe-3,9-Oe,1))}return Y=Ct(Y),ue/=100,ee/=100,[ge(0),ge(8),ge(4),le]}(q)}}}(e);return r?new Ot(...r,!1):void 0}get rgb(){const{r:e,g:r,b:a,a:u}=this,f=u||1/0;return this.overwriteGetter("rgb",[e/f,r/f,a/f,u])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,a,u,f]=Nt(e),y=Math.sqrt(a*a+u*u);return[Math.round(1e4*y)?Ct(Math.atan2(u,a)*ht):NaN,y,r,f]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Nt(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,a,u]=this.rgb;return`rgba(${[e,r,a].map(f=>Math.round(255*f)).join(",")},${u})`}}Ot.black=new Ot(0,0,0,1),Ot.white=new Ot(1,1,1,1),Ot.transparent=new Ot(0,0,0,0),Ot.red=new Ot(1,0,0,1);class Ql{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ec{constructor(e,r,a,u,f){this.text=e,this.image=r,this.scale=a,this.fontStack=u,this.textColor=f}}class zn{constructor(e){this.sections=e}static fromString(e){return new zn([new ec(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof zn?e:zn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class gn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof gn)return e;if(typeof e=="number")return new gn([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new gn(e)}}toString(){return JSON.stringify(this.values)}}const Bs=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class yn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof yn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const a=e[r],u=e[r+1];if(typeof a!="string"||!Bs.has(a)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new yn(e)}}toString(){return JSON.stringify(this.values)}}class Zn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Zn({name:e,available:!1}):null}}function eh(i,e,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,e,r,a]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ar(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ot||i instanceof Ql||i instanceof zn||i instanceof gn||i instanceof yn||i instanceof Zn)return!0;if(Array.isArray(i)){for(const e of i)if(!Ar(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Ar(i[e]))return!1;return!0}return!1}function bi(i){if(i===null)return uo;if(typeof i=="string")return wt;if(typeof i=="boolean")return gt;if(typeof i=="number")return Pe;if(i instanceof Ot)return nn;if(i instanceof Ql)return Pr;if(i instanceof zn)return Mr;if(i instanceof gn)return Mi;if(i instanceof yn)return D;if(i instanceof Zn)return G;if(Array.isArray(i)){const e=i.length;let r;for(const a of i){const u=bi(a);if(r){if(r===u)continue;r=_t;break}r=u}return R(r||_t,e)}return rn}function Os(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Ot||i instanceof zn||i instanceof gn||i instanceof yn||i instanceof Zn?i.toString():JSON.stringify(i)}class ho{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ar(e[1]))return r.error("invalid value");const a=e[1];let u=bi(a);const f=r.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new ho(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class hi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const po={string:wt,number:Pe,boolean:gt,object:rn};class Qn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,u=1;const f=e[0];if(f==="array"){let _,w;if(e.length>2){const I=e[1];if(typeof I!="string"||!(I in po)||I==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=po[I],u++}else _=_t;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);w=e[2],u++}a=R(_,w)}else{if(!po[f])throw new Error(`Types doesn't contain name = ${f}`);a=po[f]}const y=[];for(;u<e.length;u++){const _=r.parse(e[u],u,_t);if(!_)return null;y.push(_)}return new Qn(a,y)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!te(this.type,bi(a)))return a;if(r===this.args.length-1)throw new hi(`Expected value to be of type ${O(this.type)}, but found ${O(bi(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ca={"to-boolean":gt,"to-color":nn,"to-number":Pe,"to-string":wt};class mr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if(!Ca[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const u=Ca[a],f=[];for(let y=1;y<e.length;y++){const _=r.parse(e[y],y,_t);if(!_)return null;f.push(_)}return new mr(u,f)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,a;for(const u of this.args){if(r=u.evaluate(e),a=null,r instanceof Ot)return r;if(typeof r=="string"){const f=e.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:eh(r[0],r[1],r[2],r[3]),!a))return new Ot(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new hi(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const a of this.args){r=a.evaluate(e);const u=gn.parse(r);if(u)return u}throw new hi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const a of this.args){r=a.evaluate(e);const u=yn.parse(r);if(u)return u}throw new hi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new hi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return zn.fromString(Os(this.args[0].evaluate(e)));case"resolvedImage":return Zn.fromString(Os(this.args[0].evaluate(e)));default:return Os(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const tc=["Unknown","Point","LineString","Polygon"];class Go{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?tc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Ot.parse(e)),r}}class Lt{constructor(e,r,a=[],u,f=new Zo,y=[]){this.registry=e,this.path=a,this.key=a.map(_=>`[${_}]`).join(""),this.scope=f,this.errors=y,this.expectedType=u,this._isConstant=r}parse(e,r,a,u,f={}){return r?this.concat(r,a,u)._parse(e,f):this._parse(e,f)}_parse(e,r){function a(u,f,y){return y==="assert"?new Qn(f,[u]):y==="coerce"?new mr(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let y=f.parse(e,this);if(!y)return null;if(this.expectedType){const _=this.expectedType,w=y.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||w.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string")if(_.kind!=="padding"||w.kind!=="value"&&w.kind!=="number"&&w.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||w.kind!=="value"&&w.kind!=="array"){if(this.checkSubtype(_,w))return null}else y=a(y,_,r.typeAnnotation||"coerce");else y=a(y,_,r.typeAnnotation||"coerce");else y=a(y,_,r.typeAnnotation||"coerce");else y=a(y,_,r.typeAnnotation||"assert")}if(!(y instanceof ho)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const _=new Go;try{y=new ho(y.type,y.evaluate(_))}catch(w){return this.error(w.message),null}}return y}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const u=typeof e=="number"?this.path.concat(e):this.path,f=a?this.scope.concat(a):this.scope;return new Lt(this.registry,this._isConstant,u,r||null,f,this.errors)}error(e,...r){const a=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new fn(a,e))}checkSubtype(e,r){const a=te(e,r);return a&&this.error(a),a}}class Ea{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let f=1;f<e.length-1;f+=2){const y=e[f];if(typeof y!="string")return r.error(`Expected string, but found ${typeof y} instead.`,f);if(/[^a-zA-Z0-9_]/.test(y))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const _=r.parse(e[f+1],f+1);if(!_)return null;a.push([y,_])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return u?new Ea(a,u):null}outputDefined(){return this.result.outputDefined()}}class Wo{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new Wo(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class ic{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Pe),u=r.parse(e[2],2,R(r.expectedType||_t));return a&&u?new ic(u.type.itemType,a,u):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new hi(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new hi(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new hi(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Pa{constructor(e,r){this.type=gt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,_t),u=r.parse(e[2],2,_t);return a&&u?se(a.type,[gt,wt,Pe,uo,_t])?new Pa(a,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${O(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!ce(r,["boolean","string","number","null"]))throw new hi(`Expected first argument to be of type boolean, string, number or null, but found ${O(bi(r))} instead.`);if(!ce(a,["string","array"]))throw new hi(`Expected second argument to be of type array or string, but found ${O(bi(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ns{constructor(e,r,a){this.type=Pe,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,_t),u=r.parse(e[2],2,_t);if(!a||!u)return null;if(!se(a.type,[gt,wt,Pe,uo,_t]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${O(a.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,Pe);return f?new Ns(a,u,f):null}return new Ns(a,u)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!ce(r,["boolean","string","number","null"]))throw new hi(`Expected first argument to be of type boolean, string, number or null, but found ${O(bi(r))} instead.`);if(!ce(a,["string","array"]))throw new hi(`Expected second argument to be of type array or string, but found ${O(bi(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(r,u)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class nc{constructor(e,r,a,u,f,y){this.inputType=e,this.type=r,this.input=a,this.cases=u,this.outputs=f,this.otherwise=y}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const f={},y=[];for(let I=2;I<e.length-1;I+=2){let C=e[I];const P=e[I+1];Array.isArray(C)||(C=[C]);const z=r.concat(I);if(C.length===0)return z.error("Expected at least one branch label.");for(const B of C){if(typeof B!="number"&&typeof B!="string")return z.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return z.error("Numeric branch labels must be integer values.");if(a){if(z.checkSubtype(a,bi(B)))return null}else a=bi(B);if(f[String(B)]!==void 0)return z.error("Branch labels must be unique.");f[String(B)]=y.length}const L=r.parse(P,I,u);if(!L)return null;u=u||L.type,y.push(L)}const _=r.parse(e[1],1,_t);if(!_)return null;const w=r.parse(e[e.length-1],e.length-1,u);return w?_.type.kind!=="value"&&r.concat(1).checkSubtype(a,_.type)?null:new nc(a,u,_,f,y,w):null}evaluate(e){const r=this.input.evaluate(e);return(bi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Ma{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const u=[];for(let y=1;y<e.length-1;y+=2){const _=r.parse(e[y],y,gt);if(!_)return null;const w=r.parse(e[y+1],y+1,a);if(!w)return null;u.push([_,w]),a=a||w.type}const f=r.parse(e[e.length-1],e.length-1,a);if(!f)return null;if(!a)throw new Error("Can't infer output type");return new Ma(a,u,f)}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class js{constructor(e,r,a,u){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,_t),u=r.parse(e[2],2,Pe);if(!a||!u)return null;if(!se(a.type,[R(_t),wt,_t]))return r.error(`Expected first argument to be of type array or string, but found ${O(a.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,Pe);return f?new js(a.type,a,u,f):null}return new js(a.type,a,u)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!ce(r,["string","array"]))throw new hi(`Expected first argument to be of type array or string, but found ${O(bi(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(a,u)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Aa(i,e){const r=i.length-1;let a,u,f=0,y=r,_=0;for(;f<=y;)if(_=Math.floor((f+y)/2),a=i[_],u=i[_+1],a<=e){if(_===r||e<u)return _;f=_+1}else{if(!(a>e))throw new hi("Input is not a number.");y=_-1}return 0}class Vs{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,f]of a)this.labels.push(u),this.outputs.push(f)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,Pe);if(!a)return null;const u=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let y=1;y<e.length;y+=2){const _=y===1?-1/0:e[y],w=e[y+1],I=y,C=y+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(u.length&&u[u.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const P=r.parse(w,C,f);if(!P)return null;f=f||P.type,u.push([_,P])}return new Vs(f,a,u)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const f=r.length;return u>=r[f-1]?a[f-1].evaluate(e):a[Aa(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Pp(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Mp=rc;function rc(i,e,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=a}rc.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<e)return r;var f=this.sampleCurveDerivativeX(r);if(Math.abs(f)<1e-6)break;r-=u/f}var y=0,_=1;for(r=i,a=0;a<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<e));a++)i>u?y=r:_=r,r=.5*(_-y)+y;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var th=Pp(Mp);function fo(i,e,r){return i+r*(e-i)}function za(i,e,r){return i.map((a,u)=>fo(a,e[u],r))}const on={number:fo,color:function(i,e,r,a="rgb"){switch(a){case"rgb":{const[u,f,y,_]=za(i.rgb,e.rgb,r);return new Ot(u,f,y,_,!1)}case"hcl":{const[u,f,y,_]=i.hcl,[w,I,C,P]=e.hcl;let z,L;if(isNaN(u)||isNaN(w))isNaN(u)?isNaN(w)?z=NaN:(z=w,y!==1&&y!==0||(L=I)):(z=u,C!==1&&C!==0||(L=f));else{let ue=w-u;w>u&&ue>180?ue-=360:w<u&&u-w>180&&(ue+=360),z=u+r*ue}const[B,j,q,Y]=function([ue,ee,le,ge]){return ue=isNaN(ue)?0:ue*Tt,vt([le,Math.cos(ue)*ee,Math.sin(ue)*ee,ge])}([z,L??fo(f,I,r),fo(y,C,r),fo(_,P,r)]);return new Ot(B,j,q,Y,!1)}case"lab":{const[u,f,y,_]=vt(za(i.lab,e.lab,r));return new Ot(u,f,y,_,!1)}}},array:za,padding:function(i,e,r){return new gn(za(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const a=i.values,u=e.values;if(a.length!==u.length)throw new hi(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const f=[];for(let y=0;y<a.length;y+=2){if(a[y]!==u[y])throw new hi(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${a[y]}, to[${y}]: ${u[y]}`);f.push(a[y]);const[_,w]=a[y+1],[I,C]=u[y+1];f.push([fo(_,I,r),fo(w,C,r)])}return new yn(f)}};class Dn{constructor(e,r,a,u,f){this.type=e,this.operator=r,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[y,_]of f)this.labels.push(y),this.outputs.push(_)}static interpolationFactor(e,r,a,u){let f=0;if(e.name==="exponential")f=oc(r,e.base,a,u);else if(e.name==="linear")f=oc(r,1,a,u);else if(e.name==="cubic-bezier"){const y=e.controlPoints;f=new th(y[0],y[1],y[2],y[3]).solve(oc(r,1,a,u))}return f}static parse(e,r){let[a,u,f,...y]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const I=u[1];if(typeof I!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:I}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const I=u.slice(1);if(I.length!==4||I.some(C=>typeof C!="number"||C<0||C>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:I}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,Pe),!f)return null;const _=[];let w=null;a==="interpolate-hcl"||a==="interpolate-lab"?w=nn:r.expectedType&&r.expectedType.kind!=="value"&&(w=r.expectedType);for(let I=0;I<y.length;I+=2){const C=y[I],P=y[I+1],z=I+3,L=I+4;if(typeof C!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(_.length&&_[_.length-1][0]>=C)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const B=r.parse(P,L,w);if(!B)return null;w=w||B.type,_.push([C,B])}return Q(w,Pe)||Q(w,nn)||Q(w,Mi)||Q(w,D)||Q(w,R(Pe))?new Dn(w,a,u,f,_):r.error(`Type ${O(w)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const f=r.length;if(u>=r[f-1])return a[f-1].evaluate(e);const y=Aa(r,u),_=Dn.interpolationFactor(this.interpolation,u,r[y],r[y+1]),w=a[y].evaluate(e),I=a[y+1].evaluate(e);switch(this.operator){case"interpolate":return on[this.type.kind](w,I,_);case"interpolate-hcl":return on.color(w,I,_,"hcl");case"interpolate-lab":return on.color(w,I,_,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function oc(i,e,r,a){const u=a-r,f=i-r;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}class Da{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const u=r.expectedType;u&&u.kind!=="value"&&(a=u);const f=[];for(const _ of e.slice(1)){const w=r.parse(_,1+f.length,a,void 0,{typeAnnotation:"omit"});if(!w)return null;a=a||w.type,f.push(w)}if(!a)throw new Error("No output type");const y=u&&f.some(_=>te(u,_.type));return new Da(y?_t:a,f)}evaluate(e){let r,a=null,u=0;for(const f of this.args)if(u++,a=f.evaluate(e),a&&a instanceof Zn&&!a.available&&(r||(r=a.name),a=null,u===this.args.length&&(a=r)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function sc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ac(i,e,r,a){return a.compare(e,r)===0}function Ho(i,e,r){const a=i!=="=="&&i!=="!=";return class Tx{constructor(f,y,_){this.type=gt,this.lhs=f,this.rhs=y,this.collator=_,this.hasUntypedArgument=f.type.kind==="value"||y.type.kind==="value"}static parse(f,y){if(f.length!==3&&f.length!==4)return y.error("Expected two or three arguments.");const _=f[0];let w=y.parse(f[1],1,_t);if(!w)return null;if(!sc(_,w.type))return y.concat(1).error(`"${_}" comparisons are not supported for type '${O(w.type)}'.`);let I=y.parse(f[2],2,_t);if(!I)return null;if(!sc(_,I.type))return y.concat(2).error(`"${_}" comparisons are not supported for type '${O(I.type)}'.`);if(w.type.kind!==I.type.kind&&w.type.kind!=="value"&&I.type.kind!=="value")return y.error(`Cannot compare types '${O(w.type)}' and '${O(I.type)}'.`);a&&(w.type.kind==="value"&&I.type.kind!=="value"?w=new Qn(I.type,[w]):w.type.kind!=="value"&&I.type.kind==="value"&&(I=new Qn(w.type,[I])));let C=null;if(f.length===4){if(w.type.kind!=="string"&&I.type.kind!=="string"&&w.type.kind!=="value"&&I.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(C=y.parse(f[3],3,Pr),!C)return null}return new Tx(w,I,C)}evaluate(f){const y=this.lhs.evaluate(f),_=this.rhs.evaluate(f);if(a&&this.hasUntypedArgument){const w=bi(y),I=bi(_);if(w.kind!==I.kind||w.kind!=="string"&&w.kind!=="number")throw new hi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${I.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const w=bi(y),I=bi(_);if(w.kind!=="string"||I.kind!=="string")return e(f,y,_)}return this.collator?r(f,y,_,this.collator.evaluate(f)):e(f,y,_)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const Ap=Ho("==",function(i,e,r){return e===r},ac),ih=Ho("!=",function(i,e,r){return e!==r},function(i,e,r,a){return!ac(0,e,r,a)}),nh=Ho("<",function(i,e,r){return e<r},function(i,e,r,a){return a.compare(e,r)<0}),zp=Ho(">",function(i,e,r){return e>r},function(i,e,r,a){return a.compare(e,r)>0}),Dp=Ho("<=",function(i,e,r){return e<=r},function(i,e,r,a){return a.compare(e,r)<=0}),Lp=Ho(">=",function(i,e,r){return e>=r},function(i,e,r,a){return a.compare(e,r)>=0});class La{constructor(e,r,a){this.type=Pr,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const u=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,gt);if(!u)return null;const f=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,gt);if(!f)return null;let y=null;return a.locale&&(y=r.parse(a.locale,1,wt),!y)?null:new La(u,f,y)}evaluate(e){return new Ql(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class lc{constructor(e,r,a,u,f){this.type=wt,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Pe);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=r.parse(u.locale,1,wt),!f))return null;let y=null;if(u.currency&&(y=r.parse(u.currency,1,wt),!y))return null;let _=null;if(u["min-fraction-digits"]&&(_=r.parse(u["min-fraction-digits"],1,Pe),!_))return null;let w=null;return u["max-fraction-digits"]&&(w=r.parse(u["max-fraction-digits"],1,Pe),!w)?null:new lc(a,f,y,_,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ra{constructor(e){this.type=Mr,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const u=[];let f=!1;for(let y=1;y<=e.length-1;++y){const _=e[y];if(f&&typeof _=="object"&&!Array.isArray(_)){f=!1;let w=null;if(_["font-scale"]&&(w=r.parse(_["font-scale"],1,Pe),!w))return null;let I=null;if(_["text-font"]&&(I=r.parse(_["text-font"],1,R(wt)),!I))return null;let C=null;if(_["text-color"]&&(C=r.parse(_["text-color"],1,nn),!C))return null;const P=u[u.length-1];P.scale=w,P.font=I,P.textColor=C}else{const w=r.parse(e[y],1,_t);if(!w)return null;const I=w.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:w,scale:null,font:null,textColor:null})}}return new Ra(u)}evaluate(e){return new zn(this.sections.map(r=>{const a=r.content.evaluate(e);return bi(a)===G?new ec("",a,null,null,null):new ec(Os(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class cc{constructor(e){this.type=G,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,wt);return a?new cc(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=Zn.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class Us{constructor(e){this.type=Pe,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${O(a.type)} instead.`):new Us(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new hi(`Expected value to be of type string or array, but found ${O(bi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ln=8192;function Rt(i,e){const r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*Ln),Math.round(a*u*Ln)]}function uc(i,e){const r=Math.pow(2,e.z);return[(u=(i[0]/Ln+e.x)/r,360*u-180),(a=(i[1]/Ln+e.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,u}function $s(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Zs(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Rp(i,e,r){const a=i[0]-e[0],u=i[1]-e[1],f=i[0]-r[0],y=i[1]-r[1];return a*y-f*u==0&&a*f<=0&&u*y<=0}function Fa(i,e,r,a){return(u=[a[0]-r[0],a[1]-r[1]])[0]*(f=[e[0]-i[0],e[1]-i[1]])[1]-u[1]*f[0]!=0&&!(!oh(i,e,r,a)||!oh(r,a,i,e));var u,f}function Fp(i,e,r){for(const a of r)for(let u=0;u<a.length-1;++u)if(Fa(i,e,a[u],a[u+1]))return!0;return!1}function Ko(i,e,r=!1){let a=!1;for(const _ of e)for(let w=0;w<_.length-1;w++){if(Rp(i,_[w],_[w+1]))return r;(f=_[w])[1]>(u=i)[1]!=(y=_[w+1])[1]>u[1]&&u[0]<(y[0]-f[0])*(u[1]-f[1])/(y[1]-f[1])+f[0]&&(a=!a)}var u,f,y;return a}function Bp(i,e){for(const r of e)if(Ko(i,r))return!0;return!1}function rh(i,e){for(const r of i)if(!Ko(r,e))return!1;for(let r=0;r<i.length-1;++r)if(Fp(i[r],i[r+1],e))return!1;return!0}function Op(i,e){for(const r of e)if(rh(i,r))return!0;return!1}function oh(i,e,r,a){const u=a[0]-r[0],f=a[1]-r[1],y=(i[0]-r[0])*f-u*(i[1]-r[1]),_=(e[0]-r[0])*f-u*(e[1]-r[1]);return y>0&&_<0||y<0&&_>0}function hc(i,e,r){const a=[];for(let u=0;u<i.length;u++){const f=[];for(let y=0;y<i[u].length;y++){const _=Rt(i[u][y],r);$s(e,_),f.push(_)}a.push(f)}return a}function sh(i,e,r){const a=[];for(let u=0;u<i.length;u++){const f=hc(i[u],e,r);a.push(f)}return a}function ah(i,e,r,a){if(i[0]<r[0]||i[0]>r[2]){const u=.5*a;let f=i[0]-r[0]>u?-a:r[0]-i[0]>u?a:0;f===0&&(f=i[0]-r[2]>u?-a:r[2]-i[0]>u?a:0),i[0]+=f}$s(e,i)}function lh(i,e,r,a){const u=Math.pow(2,a.z)*Ln,f=[a.x*Ln,a.y*Ln],y=[];for(const _ of i)for(const w of _){const I=[w.x+f[0],w.y+f[1]];ah(I,e,r,u),y.push(I)}return y}function ch(i,e,r,a){const u=Math.pow(2,a.z)*Ln,f=[a.x*Ln,a.y*Ln],y=[];for(const w of i){const I=[];for(const C of w){const P=[C.x+f[0],C.y+f[1]];$s(e,P),I.push(P)}y.push(I)}if(e[2]-e[0]<=u/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const w of y)for(const I of w)ah(I,e,r,u)}var _;return y}class mo{constructor(e,r){this.type=gt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ar(e[1])){const a=e[1];if(a.type==="FeatureCollection"){const u=[];for(const f of a.features){const{type:y,coordinates:_}=f.geometry;y==="Polygon"&&u.push(_),y==="MultiPolygon"&&u.push(..._)}if(u.length)return new mo(a,{type:"MultiPolygon",coordinates:u})}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new mo(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new mo(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(a.type==="Polygon"){const _=hc(a.coordinates,f,y),w=lh(r.geometry(),u,f,y);if(!Zs(u,f))return!1;for(const I of w)if(!Ko(I,_))return!1}if(a.type==="MultiPolygon"){const _=sh(a.coordinates,f,y),w=lh(r.geometry(),u,f,y);if(!Zs(u,f))return!1;for(const I of w)if(!Bp(I,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(a.type==="Polygon"){const _=hc(a.coordinates,f,y),w=ch(r.geometry(),u,f,y);if(!Zs(u,f))return!1;for(const I of w)if(!rh(I,_))return!1}if(a.type==="MultiPolygon"){const _=sh(a.coordinates,f,y),w=ch(r.geometry(),u,f,y);if(!Zs(u,f))return!1;for(const I of w)if(!Op(I,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let uh=class{constructor(i=[],e=Np){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:r}=this,a=e[i];for(;i>0;){const u=i-1>>1,f=e[u];if(r(a,f)>=0)break;e[i]=f,i=u}e[i]=a}_down(i){const{data:e,compare:r}=this,a=this.length>>1,u=e[i];for(;i<a;){let f=1+(i<<1),y=e[f];const _=f+1;if(_<this.length&&r(e[_],y)<0&&(f=_,y=e[_]),r(y,u)>=0)break;e[i]=y,i=f}e[i]=u}};function Np(i,e){return i<e?-1:i>e?1:0}function jp(i,e,r,a,u){hh(i,e,r,a||i.length-1,u||Vp)}function hh(i,e,r,a,u){for(;a>r;){if(a-r>600){var f=a-r+1,y=e-r+1,_=Math.log(f),w=.5*Math.exp(2*_/3),I=.5*Math.sqrt(_*w*(f-w)/f)*(y-f/2<0?-1:1);hh(i,e,Math.max(r,Math.floor(e-y*w/f+I)),Math.min(a,Math.floor(e+(f-y)*w/f+I)),u)}var C=i[e],P=r,z=a;for(qs(i,r,e),u(i[a],C)>0&&qs(i,r,a);P<z;){for(qs(i,P,z),P++,z--;u(i[P],C)<0;)P++;for(;u(i[z],C)>0;)z--}u(i[r],C)===0?qs(i,r,z):qs(i,++z,a),z<=e&&(r=z+1),e<=z&&(a=z-1)}}function qs(i,e,r){var a=i[e];i[e]=i[r],i[r]=a}function Vp(i,e){return i<e?-1:i>e?1:0}function Ba(i,e){if(i.length<=1)return[i];const r=[];let a,u;for(const f of i){const y=$p(f);y!==0&&(f.area=Math.abs(y),u===void 0&&(u=y<0),u===y<0?(a&&r.push(a),a=[f]):a.push(f))}if(a&&r.push(a),e>1)for(let f=0;f<r.length;f++)r[f].length<=e||(jp(r[f],e,1,r[f].length-1,Up),r[f]=r[f].slice(0,e));return r}function Up(i,e){return e.area-i.area}function $p(i){let e=0;for(let r,a,u=0,f=i.length,y=f-1;u<f;y=u++)r=i[u],a=i[y],e+=(a.x-r.x)*(r.y+a.y);return e}const dh=1/298.257223563,ph=dh*(2-dh),fh=Math.PI/180;class dc{constructor(e){const r=6378.137*fh*1e3,a=Math.cos(e*fh),u=1/(1-ph*(1-a*a)),f=Math.sqrt(u);this.kx=r*f*a,this.ky=r*f*u*(1-ph)}distance(e,r){const a=this.wrap(e[0]-r[0])*this.kx,u=(e[1]-r[1])*this.ky;return Math.sqrt(a*a+u*u)}pointOnLine(e,r){let a,u,f,y,_=1/0;for(let w=0;w<e.length-1;w++){let I=e[w][0],C=e[w][1],P=this.wrap(e[w+1][0]-I)*this.kx,z=(e[w+1][1]-C)*this.ky,L=0;P===0&&z===0||(L=(this.wrap(r[0]-I)*this.kx*P+(r[1]-C)*this.ky*z)/(P*P+z*z),L>1?(I=e[w+1][0],C=e[w+1][1]):L>0&&(I+=P/this.kx*L,C+=z/this.ky*L)),P=this.wrap(r[0]-I)*this.kx,z=(r[1]-C)*this.ky;const B=P*P+z*z;B<_&&(_=B,a=I,u=C,f=w,y=L)}return{point:[a,u],index:f,t:Math.max(0,Math.min(1,y))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function mh(i,e){return e[0]-i[0]}function Xo(i){return i[1]-i[0]+1}function zr(i,e){return i[1]>=i[0]&&i[1]<e}function pc(i,e){if(i[0]>i[1])return[null,null];const r=Xo(i);if(e){if(r===2)return[i,null];const u=Math.floor(r/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}if(r===1)return[i,null];const a=Math.floor(r/2)-1;return[[i[0],i[0]+a],[i[0]+a+1,i[1]]]}function fc(i,e){if(!zr(e,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let a=e[0];a<=e[1];++a)$s(r,i[a]);return r}function mc(i){const e=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const a of r)$s(e,a);return e}function di(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function gc(i,e,r){if(!di(i)||!di(e))return NaN;let a=0,u=0;return i[2]<e[0]&&(a=e[0]-i[2]),i[0]>e[2]&&(a=i[0]-e[2]),i[1]>e[3]&&(u=i[1]-e[3]),i[3]<e[1]&&(u=e[1]-i[3]),r.distance([0,0],[a,u])}function St(i,e,r){const a=r.pointOnLine(e,i);return r.distance(i,a.point)}function Gs(i,e,r,a,u){const f=Math.min(St(i,[r,a],u),St(e,[r,a],u)),y=Math.min(St(r,[i,e],u),St(a,[i,e],u));return Math.min(f,y)}function ii(i,e,r,a,u){if(!zr(e,i.length)||!zr(a,r.length))return 1/0;let f=1/0;for(let y=e[0];y<e[1];++y){const _=i[y],w=i[y+1];for(let I=a[0];I<a[1];++I){const C=r[I],P=r[I+1];if(Fa(_,w,C,P))return 0;f=Math.min(f,Gs(_,w,C,P,u))}}return f}function Qt(i,e,r,a,u){if(!zr(e,i.length)||!zr(a,r.length))return NaN;let f=1/0;for(let y=e[0];y<=e[1];++y)for(let _=a[0];_<=a[1];++_)if(f=Math.min(f,u.distance(i[y],r[_])),f===0)return f;return f}function Oa(i,e,r){if(Ko(i,e,!0))return 0;let a=1/0;for(const u of e){const f=u[0],y=u[u.length-1];if(f!==y&&(a=Math.min(a,St(i,[y,f],r)),a===0))return a;const _=r.pointOnLine(u,i);if(a=Math.min(a,r.distance(i,_.point)),a===0)return a}return a}function gh(i,e,r,a){if(!zr(e,i.length))return NaN;for(let f=e[0];f<=e[1];++f)if(Ko(i[f],r,!0))return 0;let u=1/0;for(let f=e[0];f<e[1];++f){const y=i[f],_=i[f+1];for(const w of r)for(let I=0,C=w.length,P=C-1;I<C;P=I++){const z=w[P],L=w[I];if(Fa(y,_,z,L))return 0;u=Math.min(u,Gs(y,_,z,L,a))}}return u}function yc(i,e){for(const r of i)for(const a of r)if(Ko(a,e,!0))return!0;return!1}function Zp(i,e,r,a=1/0){const u=mc(i),f=mc(e);if(a!==1/0&&gc(u,f,r)>=a)return a;if(Zs(u,f)){if(yc(i,e))return 0}else if(yc(e,i))return 0;let y=1/0;for(const _ of i)for(let w=0,I=_.length,C=I-1;w<I;C=w++){const P=_[C],z=_[w];for(const L of e)for(let B=0,j=L.length,q=j-1;B<j;q=B++){const Y=L[q],ue=L[B];if(Fa(P,z,Y,ue))return 0;y=Math.min(y,Gs(P,z,Y,ue,r))}}return y}function yh(i,e,r,a,u,f){if(!f)return;const y=gc(fc(a,f),u,r);y<e&&i.push([y,f,[0,0]])}function Na(i,e,r,a,u,f,y){if(!f||!y)return;const _=gc(fc(a,f),fc(u,y),r);_<e&&i.push([_,f,y])}function ja(i,e,r,a,u=1/0){let f=Math.min(a.distance(i[0],r[0][0]),u);if(f===0)return f;const y=new uh([[0,[0,i.length-1],[0,0]]],mh),_=mc(r);for(;y.length>0;){const w=y.pop();if(w[0]>=f)continue;const I=w[1],C=e?50:100;if(Xo(I)<=C){if(!zr(I,i.length))return NaN;if(e){const P=gh(i,I,r,a);if(isNaN(P)||P===0)return P;f=Math.min(f,P)}else for(let P=I[0];P<=I[1];++P){const z=Oa(i[P],r,a);if(f=Math.min(f,z),f===0)return 0}}else{const P=pc(I,e);yh(y,f,a,i,_,P[0]),yh(y,f,a,i,_,P[1])}}return f}function Ws(i,e,r,a,u,f=1/0){let y=Math.min(f,u.distance(i[0],r[0]));if(y===0)return y;const _=new uh([[0,[0,i.length-1],[0,r.length-1]]],mh);for(;_.length>0;){const w=_.pop();if(w[0]>=y)continue;const I=w[1],C=w[2],P=e?50:100,z=a?50:100;if(Xo(I)<=P&&Xo(C)<=z){if(!zr(I,i.length)&&zr(C,r.length))return NaN;let L;if(e&&a)L=ii(i,I,r,C,u),y=Math.min(y,L);else if(e&&!a){const B=i.slice(I[0],I[1]+1);for(let j=C[0];j<=C[1];++j)if(L=St(r[j],B,u),y=Math.min(y,L),y===0)return y}else if(!e&&a){const B=r.slice(C[0],C[1]+1);for(let j=I[0];j<=I[1];++j)if(L=St(i[j],B,u),y=Math.min(y,L),y===0)return y}else L=Qt(i,I,r,C,u),y=Math.min(y,L)}else{const L=pc(I,e),B=pc(C,a);Na(_,y,u,i,r,L[0],B[0]),Na(_,y,u,i,r,L[0],B[1]),Na(_,y,u,i,r,L[1],B[0]),Na(_,y,u,i,r,L[1],B[1])}}return y}function Va(i){return i.type==="MultiPolygon"?i.coordinates.map(e=>({type:"Polygon",coordinates:e})):i.type==="MultiLineString"?i.coordinates.map(e=>({type:"LineString",coordinates:e})):i.type==="MultiPoint"?i.coordinates.map(e=>({type:"Point",coordinates:e})):[i]}class Hr{constructor(e,r){this.type=Pe,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ar(e[1])){const a=e[1];if(a.type==="FeatureCollection")return new Hr(a,a.features.map(u=>Va(u.geometry)).flat());if(a.type==="Feature")return new Hr(a,Va(a.geometry));if("type"in a&&"coordinates"in a)return new Hr(a,Va(a))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const u=r.geometry(),f=u.flat().map(w=>uc([w.x,w.y],r.canonical));if(u.length===0)return NaN;const y=new dc(f[0][1]);let _=1/0;for(const w of a){switch(w.type){case"Point":_=Math.min(_,Ws(f,!1,[w.coordinates],!1,y,_));break;case"LineString":_=Math.min(_,Ws(f,!1,w.coordinates,!0,y,_));break;case"Polygon":_=Math.min(_,ja(f,!1,w.coordinates,y,_))}if(_===0)return _}return _}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const u=r.geometry(),f=u.flat().map(w=>uc([w.x,w.y],r.canonical));if(u.length===0)return NaN;const y=new dc(f[0][1]);let _=1/0;for(const w of a){switch(w.type){case"Point":_=Math.min(_,Ws(f,!0,[w.coordinates],!1,y,_));break;case"LineString":_=Math.min(_,Ws(f,!0,w.coordinates,!0,y,_));break;case"Polygon":_=Math.min(_,ja(f,!0,w.coordinates,y,_))}if(_===0)return _}return _}(e,this.geometries);if(e.geometryType()==="Polygon")return function(r,a){const u=r.geometry();if(u.length===0||u[0].length===0)return NaN;const f=Ba(u,0).map(w=>w.map(I=>I.map(C=>uc([C.x,C.y],r.canonical)))),y=new dc(f[0][0][0][1]);let _=1/0;for(const w of a)for(const I of f){switch(w.type){case"Point":_=Math.min(_,ja([w.coordinates],!1,I,y,_));break;case"LineString":_=Math.min(_,ja(w.coordinates,!0,I,y,_));break;case"Polygon":_=Math.min(_,Zp(I,w.coordinates,y,_))}if(_===0)return _}return _}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const go={"==":Ap,"!=":ih,">":zp,"<":nh,">=":Lp,"<=":Dp,array:Qn,at:ic,boolean:Qn,case:Ma,coalesce:Da,collator:La,format:Ra,image:cc,in:Pa,"index-of":Ns,interpolate:Dn,"interpolate-hcl":Dn,"interpolate-lab":Dn,length:Us,let:Ea,literal:ho,match:nc,number:Qn,"number-format":lc,object:Qn,slice:js,step:Vs,string:Qn,"to-boolean":mr,"to-color":mr,"to-number":mr,"to-string":mr,var:Wo,within:mo,distance:Hr};class _n{constructor(e,r,a,u){this.name=e,this.type=r,this._evaluate=a,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const a=e[0],u=_n.definitions[a];if(!u)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,y=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=y.filter(([I])=>!Array.isArray(I)||I.length===e.length-1);let w=null;for(const[I,C]of _){w=new Lt(r.registry,Ua,r.path,null,r.scope);const P=[];let z=!1;for(let L=1;L<e.length;L++){const B=e[L],j=Array.isArray(I)?I[L-1]:I.type,q=w.parse(B,1+P.length,j);if(!q){z=!0;break}P.push(q)}if(!z)if(Array.isArray(I)&&I.length!==P.length)w.error(`Expected ${I.length} arguments, but found ${P.length} instead.`);else{for(let L=0;L<P.length;L++){const B=Array.isArray(I)?I[L]:I.type,j=P[L];w.concat(L+1).checkSubtype(B,j.type)}if(w.errors.length===0)return new _n(a,f,C,P)}}if(_.length===1)r.errors.push(...w.errors);else{const I=(_.length?_:y).map(([P])=>{return z=P,Array.isArray(z)?`(${z.map(O).join(", ")})`:`(${O(z.type)}...)`;var z}).join(" | "),C=[];for(let P=1;P<e.length;P++){const z=r.parse(e[P],1+C.length);if(!z)return null;C.push(O(z.type))}r.error(`Expected arguments of type ${I}, but found (${C.join(", ")}) instead.`)}return null}static register(e,r){_n.definitions=r;for(const a in r)e[a]=_n}}function _h(i,[e,r,a,u]){e=e.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);const f=u?u.evaluate(i):1,y=eh(e,r,a,f);if(y)throw new hi(y);return new Ot(e/255,r/255,a/255,f,!1)}function vh(i,e){return i in e}function _c(i,e){const r=e[i];return r===void 0?null:r}function yo(i){return{type:i}}function Ua(i){if(i instanceof Wo)return Ua(i.boundExpression);if(i instanceof _n&&i.name==="error"||i instanceof La||i instanceof mo||i instanceof Hr)return!1;const e=i instanceof mr||i instanceof Qn;let r=!0;return i.eachChild(a=>{r=e?r&&Ua(a):r&&a instanceof ho}),!!r&&$a(i)&&Za(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function $a(i){if(i instanceof _n&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof mo||i instanceof Hr)return!1;let e=!0;return i.eachChild(r=>{e&&!$a(r)&&(e=!1)}),e}function Hs(i){if(i instanceof _n&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Hs(r)&&(e=!1)}),e}function Za(i,e){if(i instanceof _n&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!Za(a,e)&&(r=!1)}),r}function vc(i){return{result:"success",value:i}}function _o(i){return{result:"error",value:i}}function Dr(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function xh(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function qa(i){return!!i.expression&&i.expression.interpolated}function Mt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Yo(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Ga(i){return i}function Ks(i,e){const r=e.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",u=a||!(a||i.property!==void 0),f=i.type||(qa(e)?"exponential":"interval");if(r||e.type==="padding"){const C=r?Ot.parse:gn.parse;(i=pn({},i)).stops&&(i.stops=i.stops.map(P=>[P[0],C(P[1])])),i.default=C(i.default?i.default:e.default)}if(i.colorSpace&&(y=i.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var y;let _,w,I;if(f==="exponential")_=wc;else if(f==="interval")_=wh;else if(f==="categorical"){_=xc,w=Object.create(null);for(const C of i.stops)w[C[0]]=C[1];I=typeof i.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);_=Wa}if(a){const C={},P=[];for(let B=0;B<i.stops.length;B++){const j=i.stops[B],q=j[0].zoom;C[q]===void 0&&(C[q]={zoom:q,type:i.type,property:i.property,default:i.default,stops:[]},P.push(q)),C[q].stops.push([j[0].value,j[1]])}const z=[];for(const B of P)z.push([C[B].zoom,Ks(C[B],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Dn.interpolationFactor.bind(void 0,L),zoomStops:z.map(B=>B[0]),evaluate:({zoom:B},j)=>wc({stops:z,base:i.base},e,B).evaluate(B,j)}}if(u){const C=f==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Dn.interpolationFactor.bind(void 0,C),zoomStops:i.stops.map(P=>P[0]),evaluate:({zoom:P})=>_(i,e,P,w,I)}}return{kind:"source",evaluate(C,P){const z=P&&P.properties?P.properties[i.property]:void 0;return z===void 0?Jo(i.default,e.default):_(i,e,z,w,I)}}}function Jo(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function xc(i,e,r,a,u){return Jo(typeof r===u?a[r]:void 0,i.default,e.default)}function wh(i,e,r){if(Mt(r)!=="number")return Jo(i.default,e.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const u=Aa(i.stops.map(f=>f[0]),r);return i.stops[u][1]}function wc(i,e,r){const a=i.base!==void 0?i.base:1;if(Mt(r)!=="number")return Jo(i.default,e.default);const u=i.stops.length;if(u===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[u-1][0])return i.stops[u-1][1];const f=Aa(i.stops.map(C=>C[0]),r),y=function(C,P,z,L){const B=L-z,j=C-z;return B===0?0:P===1?j/B:(Math.pow(P,j)-1)/(Math.pow(P,B)-1)}(r,a,i.stops[f][0],i.stops[f+1][0]),_=i.stops[f][1],w=i.stops[f+1][1],I=on[e.type]||Ga;return typeof _.evaluate=="function"?{evaluate(...C){const P=_.evaluate.apply(void 0,C),z=w.evaluate.apply(void 0,C);if(P!==void 0&&z!==void 0)return I(P,z,y,i.colorSpace)}}:I(_,w,y,i.colorSpace)}function Wa(i,e,r){switch(e.type){case"color":r=Ot.parse(r);break;case"formatted":r=zn.fromString(r.toString());break;case"resolvedImage":r=Zn.fromString(r.toString());break;case"padding":r=gn.parse(r);break;default:Mt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Jo(r,i.default,e.default)}_n.register(go,{error:[{kind:"error"},[wt],(i,[e])=>{throw new hi(e.evaluate(i))}],typeof:[wt,[_t],(i,[e])=>O(bi(e.evaluate(i)))],"to-rgba":[R(Pe,4),[nn],(i,[e])=>{const[r,a,u,f]=e.evaluate(i).rgb;return[255*r,255*a,255*u,f]}],rgb:[nn,[Pe,Pe,Pe],_h],rgba:[nn,[Pe,Pe,Pe,Pe],_h],has:{type:gt,overloads:[[[wt],(i,[e])=>vh(e.evaluate(i),i.properties())],[[wt,rn],(i,[e,r])=>vh(e.evaluate(i),r.evaluate(i))]]},get:{type:_t,overloads:[[[wt],(i,[e])=>_c(e.evaluate(i),i.properties())],[[wt,rn],(i,[e,r])=>_c(e.evaluate(i),r.evaluate(i))]]},"feature-state":[_t,[wt],(i,[e])=>_c(e.evaluate(i),i.featureState||{})],properties:[rn,[],i=>i.properties()],"geometry-type":[wt,[],i=>i.geometryType()],id:[_t,[],i=>i.id()],zoom:[Pe,[],i=>i.globals.zoom],"heatmap-density":[Pe,[],i=>i.globals.heatmapDensity||0],"line-progress":[Pe,[],i=>i.globals.lineProgress||0],accumulated:[_t,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Pe,yo(Pe),(i,e)=>{let r=0;for(const a of e)r+=a.evaluate(i);return r}],"*":[Pe,yo(Pe),(i,e)=>{let r=1;for(const a of e)r*=a.evaluate(i);return r}],"-":{type:Pe,overloads:[[[Pe,Pe],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Pe],(i,[e])=>-e.evaluate(i)]]},"/":[Pe,[Pe,Pe],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Pe,[Pe,Pe],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Pe,[],()=>Math.LN2],pi:[Pe,[],()=>Math.PI],e:[Pe,[],()=>Math.E],"^":[Pe,[Pe,Pe],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Pe,[Pe],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Pe,[Pe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Pe,[Pe],(i,[e])=>Math.log(e.evaluate(i))],log2:[Pe,[Pe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Pe,[Pe],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Pe,[Pe],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Pe,[Pe],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Pe,[Pe],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Pe,[Pe],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Pe,[Pe],(i,[e])=>Math.atan(e.evaluate(i))],min:[Pe,yo(Pe),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Pe,yo(Pe),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Pe,[Pe],(i,[e])=>Math.abs(e.evaluate(i))],round:[Pe,[Pe],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Pe,[Pe],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Pe,[Pe],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[gt,[wt,_t],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[gt,[_t],(i,[e])=>i.id()===e.value],"filter-type-==":[gt,[wt],(i,[e])=>i.geometryType()===e.value],"filter-<":[gt,[wt,_t],(i,[e,r])=>{const a=i.properties()[e.value],u=r.value;return typeof a==typeof u&&a<u}],"filter-id-<":[gt,[_t],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[gt,[wt,_t],(i,[e,r])=>{const a=i.properties()[e.value],u=r.value;return typeof a==typeof u&&a>u}],"filter-id->":[gt,[_t],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[gt,[wt,_t],(i,[e,r])=>{const a=i.properties()[e.value],u=r.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[gt,[_t],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[gt,[wt,_t],(i,[e,r])=>{const a=i.properties()[e.value],u=r.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[gt,[_t],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[gt,[_t],(i,[e])=>e.value in i.properties()],"filter-has-id":[gt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[gt,[R(wt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[gt,[R(_t)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[gt,[wt,R(_t)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[gt,[wt,R(_t)],(i,[e,r])=>function(a,u,f,y){for(;f<=y;){const _=f+y>>1;if(u[_]===a)return!0;u[_]>a?y=_-1:f=_+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:gt,overloads:[[[gt,gt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[yo(gt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:gt,overloads:[[[gt,gt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[yo(gt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[gt,[gt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[gt,[wt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[wt,[wt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[wt,[wt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[wt,yo(_t),(i,e)=>e.map(r=>Os(r.evaluate(i))).join("")],"resolved-locale":[wt,[Pr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class bc{constructor(e,r){var a;this.expression=e,this._warningHistory={},this._evaluator=new Go,this._defaultValue=r?(a=r).type==="color"&&Yo(a.default)?new Ot(0,0,0,0):a.type==="color"?Ot.parse(a.default)||null:a.type==="padding"?gn.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?yn.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,u,f,y){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,u,f,y){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new hi(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Ha(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in go}function Ka(i,e){const r=new Lt(go,Ua,[],e?function(u){const f={color:nn,string:wt,number:Pe,enum:wt,boolean:gt,formatted:Mr,padding:Mi,resolvedImage:G,variableAnchorOffsetCollection:D};return u.type==="array"?R(f[u.value]||_t,u.length):f[u.type]}(e):void 0),a=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?vc(new bc(a,e)):_o(r.errors)}class Sc{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Hs(r.expression)}evaluateWithoutErrorHandling(e,r,a,u,f,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,f,y)}evaluate(e,r,a,u,f,y){return this._styleExpression.evaluate(e,r,a,u,f,y)}}class Tc{constructor(e,r,a,u){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Hs(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,a,u,f,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,f,y)}evaluate(e,r,a,u,f,y){return this._styleExpression.evaluate(e,r,a,u,f,y)}interpolationFactor(e,r,a){return this.interpolationType?Dn.interpolationFactor(this.interpolationType,e,r,a):0}}function Xs(i,e){const r=Ka(i,e);if(r.result==="error")return r;const a=r.value.expression,u=$a(a);if(!u&&!Dr(e))return _o([new fn("","data expressions not supported")]);const f=Za(a,["zoom"]);if(!f&&!xh(e))return _o([new fn("","zoom expressions not supported")]);const y=Zi(a);return y||f?y instanceof fn?_o([y]):y instanceof Dn&&!qa(e)?_o([new fn("",'"interpolate" expressions cannot be used with this property')]):vc(y?new Tc(u?"camera":"composite",r.value,y.labels,y instanceof Dn?y.interpolation:void 0):new Sc(u?"constant":"source",r.value)):_o([new fn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class vo{constructor(e,r){this._parameters=e,this._specification=r,pn(this,Ks(this._parameters,this._specification))}static deserialize(e){return new vo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Zi(i){let e=null;if(i instanceof Ea)e=Zi(i.result);else if(i instanceof Da){for(const r of i.args)if(e=Zi(r),e)break}else(i instanceof Vs||i instanceof Dn)&&i.input instanceof _n&&i.input.name==="zoom"&&(e=i);return e instanceof fn||i.eachChild(r=>{const a=Zi(r);a instanceof fn?e=a:!e&&a?e=new fn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new fn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function xo(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!xo(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const bh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function kc(i){if(i==null)return{filter:()=>!0,needGeometry:!1};xo(i)||(i=Ys(i));const e=Ka(i,bh);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,u)=>e.value.evaluate(r,a,{},u),needGeometry:Qo(i)}}function qp(i,e){return i<e?-1:i>e?1:0}function Qo(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(Qo(i[e]))return!0;return!1}function Ys(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Js(i[1],i[2],"=="):e==="!="?Ya(Js(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Js(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Ys))):e==="all"?["all"].concat(i.slice(1).map(Ys)):e==="none"?["all"].concat(i.slice(1).map(Ys).map(Ya)):e==="in"?Sh(i[1],i.slice(2)):e==="!in"?Ya(Sh(i[1],i.slice(2))):e==="has"?Xa(i[1]):e!=="!has"||Ya(Xa(i[1]));var r}function Js(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Sh(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(qp)]]:["filter-in-small",i,["literal",e]]}}function Xa(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ya(i){return["!",i]}function wo(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const f of i)u+=`${wo(f)},`;return`${u}]`}const r=Object.keys(i).sort();let a="{";for(let u=0;u<r.length;u++)a+=`${JSON.stringify(r[u])}:${wo(i[r[u]])},`;return`${a}}`}function Gp(i){let e="";for(const r of Wr)e+=`/${wo(i[r])}`;return e}function Ja(i){const e=i.value;return e?[new ze(i.key,e,"constants have been deprecated as of v8")]:[]}function si(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Lr(i){if(Array.isArray(i))return i.map(Lr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Lr(i[r]);return e}return si(i)}function Rn(i){const e=i.key,r=i.value,a=i.valueSpec||{},u=i.objectElementValidators||{},f=i.style,y=i.styleSpec,_=i.validateSpec;let w=[];const I=Mt(r);if(I!=="object")return[new ze(e,r,`object expected, ${I} found`)];for(const C in r){const P=C.split(".")[0],z=a[P]||a["*"];let L;if(u[P])L=u[P];else if(a[P])L=_;else if(u["*"])L=u["*"];else{if(!a["*"]){w.push(new ze(e,r[C],`unknown property "${C}"`));continue}L=_}w=w.concat(L({key:(e&&`${e}.`)+C,value:r[C],valueSpec:z,style:f,styleSpec:y,object:r,objectKey:C,validateSpec:_},r))}for(const C in a)u[C]||a[C].required&&a[C].default===void 0&&r[C]===void 0&&w.push(new ze(e,r,`missing required property "${C}"`));return w}function Qa(i){const e=i.value,r=i.valueSpec,a=i.style,u=i.styleSpec,f=i.key,y=i.arrayElementValidator||i.validateSpec;if(Mt(e)!=="array")return[new ze(f,e,`array expected, ${Mt(e)} found`)];if(r.length&&e.length!==r.length)return[new ze(f,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new ze(f,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let _={type:r.value,values:r.values};u.$version<7&&(_.function=r.function),Mt(r.value)==="object"&&(_=r.value);let w=[];for(let I=0;I<e.length;I++)w=w.concat(y({array:e,arrayIndex:I,value:e[I],valueSpec:_,validateSpec:i.validateSpec,style:a,styleSpec:u,key:`${f}[${I}]`}));return w}function Ic(i){const e=i.key,r=i.value,a=i.valueSpec;let u=Mt(r);return u==="number"&&r!=r&&(u="NaN"),u!=="number"?[new ze(e,r,`number expected, ${u} found`)]:"minimum"in a&&r<a.minimum?[new ze(e,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new ze(e,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function el(i){const e=i.valueSpec,r=si(i.value.type);let a,u,f,y={};const _=r!=="categorical"&&i.value.property===void 0,w=!_,I=Mt(i.value.stops)==="array"&&Mt(i.value.stops[0])==="array"&&Mt(i.value.stops[0][0])==="object",C=Rn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(L){if(r==="identity")return[new ze(L.key,L.value,'identity function may not have a "stops" property')];let B=[];const j=L.value;return B=B.concat(Qa({key:L.key,value:j,valueSpec:L.valueSpec,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:P})),Mt(j)==="array"&&j.length===0&&B.push(new ze(L.key,j,"array must have at least one stop")),B},default:function(L){return L.validateSpec({key:L.key,value:L.value,valueSpec:e,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec})}}});return r==="identity"&&_&&C.push(new ze(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||C.push(new ze(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!qa(i.valueSpec)&&C.push(new ze(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(w&&!Dr(i.valueSpec)?C.push(new ze(i.key,i.value,"property functions not supported")):_&&!xh(i.valueSpec)&&C.push(new ze(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!I||i.value.property!==void 0||C.push(new ze(i.key,i.value,'"property" property is required')),C;function P(L){let B=[];const j=L.value,q=L.key;if(Mt(j)!=="array")return[new ze(q,j,`array expected, ${Mt(j)} found`)];if(j.length!==2)return[new ze(q,j,`array length 2 expected, length ${j.length} found`)];if(I){if(Mt(j[0])!=="object")return[new ze(q,j,`object expected, ${Mt(j[0])} found`)];if(j[0].zoom===void 0)return[new ze(q,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new ze(q,j,"object stop key must have value")];if(f&&f>si(j[0].zoom))return[new ze(q,j[0].zoom,"stop zoom values must appear in ascending order")];si(j[0].zoom)!==f&&(f=si(j[0].zoom),u=void 0,y={}),B=B.concat(Rn({key:`${q}[0]`,value:j[0],valueSpec:{zoom:{}},validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:Ic,value:z}}))}else B=B.concat(z({key:`${q}[0]`,value:j[0],valueSpec:{},validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec},j));return Ha(Lr(j[1]))?B.concat([new ze(`${q}[1]`,j[1],"expressions are not allowed in function stops.")]):B.concat(L.validateSpec({key:`${q}[1]`,value:j[1],valueSpec:e,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec}))}function z(L,B){const j=Mt(L.value),q=si(L.value),Y=L.value!==null?L.value:B;if(a){if(j!==a)return[new ze(L.key,Y,`${j} stop domain type must match previous stop domain type ${a}`)]}else a=j;if(j!=="number"&&j!=="string"&&j!=="boolean")return[new ze(L.key,Y,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&r!=="categorical"){let ue=`number expected, ${j} found`;return Dr(e)&&r===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ze(L.key,Y,ue)]}return r!=="categorical"||j!=="number"||isFinite(q)&&Math.floor(q)===q?r!=="categorical"&&j==="number"&&u!==void 0&&q<u?[new ze(L.key,Y,"stop domain values must appear in ascending order")]:(u=q,r==="categorical"&&q in y?[new ze(L.key,Y,"stop domain values must be unique")]:(y[q]=!0,[])):[new ze(L.key,Y,`integer expected, found ${q}`)]}}function Rr(i){const e=(i.expressionContext==="property"?Xs:Ka)(Lr(i.value),i.valueSpec);if(e.result==="error")return e.value.map(a=>new ze(`${i.key}${a.key}`,i.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new ze(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Hs(r))return[new ze(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Hs(r))return[new ze(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Za(r,["zoom","feature-state"]))return[new ze(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!$a(r))return[new ze(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function es(i){const e=i.key,r=i.value,a=i.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(si(r))===-1&&u.push(new ze(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(si(r))===-1&&u.push(new ze(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function tl(i){return xo(Lr(i.value))?Rr(pn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Cc(i)}function Cc(i){const e=i.value,r=i.key;if(Mt(e)!=="array")return[new ze(r,e,`array expected, ${Mt(e)} found`)];const a=i.styleSpec;let u,f=[];if(e.length<1)return[new ze(r,e,"filter array must have at least 1 element")];switch(f=f.concat(es({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),si(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&si(e[1])==="$type"&&f.push(new ze(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new ze(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Mt(e[1]),u!=="string"&&f.push(new ze(`${r}[1]`,e[1],`string expected, ${u} found`)));for(let y=2;y<e.length;y++)u=Mt(e[y]),si(e[1])==="$type"?f=f.concat(es({key:`${r}[${y}]`,value:e[y],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new ze(`${r}[${y}]`,e[y],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)f=f.concat(Cc({key:`${r}[${y}]`,value:e[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=Mt(e[1]),e.length!==2?f.push(new ze(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new ze(`${r}[1]`,e[1],`string expected, ${u} found`))}return f}function Ec(i,e){const r=i.key,a=i.validateSpec,u=i.style,f=i.styleSpec,y=i.value,_=i.objectKey,w=f[`${e}_${i.layerType}`];if(!w)return[];const I=_.match(/^(.*)-transition$/);if(e==="paint"&&I&&w[I[1]]&&w[I[1]].transition)return a({key:r,value:y,valueSpec:f.transition,style:u,styleSpec:f});const C=i.valueSpec||w[_];if(!C)return[new ze(r,y,`unknown property "${_}"`)];let P;if(Mt(y)==="string"&&Dr(C)&&!C.tokens&&(P=/^{([^}]+)}$/.exec(y)))return[new ze(r,y,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const z=[];return i.layerType==="symbol"&&(_==="text-field"&&u&&!u.glyphs&&z.push(new ze(r,y,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Yo(Lr(y))&&si(y.type)==="identity"&&z.push(new ze(r,y,'"text-font" does not support identity functions'))),z.concat(a({key:i.key,value:y,valueSpec:C,style:u,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:_}))}function il(i){return Ec(i,"paint")}function Pc(i){return Ec(i,"layout")}function Th(i){let e=[];const r=i.value,a=i.key,u=i.style,f=i.styleSpec;r.type||r.ref||e.push(new ze(a,r,'either "type" or "ref" is required'));let y=si(r.type);const _=si(r.ref);if(r.id){const w=si(r.id);for(let I=0;I<i.arrayIndex;I++){const C=u.layers[I];si(C.id)===w&&e.push(new ze(a,r.id,`duplicate layer id "${r.id}", previously used at line ${C.id.__line__}`))}}if("ref"in r){let w;["type","source","source-layer","filter","layout"].forEach(I=>{I in r&&e.push(new ze(a,r[I],`"${I}" is prohibited for ref layers`))}),u.layers.forEach(I=>{si(I.id)===_&&(w=I)}),w?w.ref?e.push(new ze(a,r.ref,"ref cannot reference another ref layer")):y=si(w.type):e.push(new ze(a,r.ref,`ref layer "${_}" not found`))}else if(y!=="background")if(r.source){const w=u.sources&&u.sources[r.source],I=w&&si(w.type);w?I==="vector"&&y==="raster"?e.push(new ze(a,r.source,`layer "${r.id}" requires a raster source`)):I!=="raster-dem"&&y==="hillshade"?e.push(new ze(a,r.source,`layer "${r.id}" requires a raster-dem source`)):I==="raster"&&y!=="raster"?e.push(new ze(a,r.source,`layer "${r.id}" requires a vector source`)):I!=="vector"||r["source-layer"]?I==="raster-dem"&&y!=="hillshade"?e.push(new ze(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!r.paint||!r.paint["line-gradient"]||I==="geojson"&&w.lineMetrics||e.push(new ze(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ze(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new ze(a,r.source,`source "${r.source}" not found`))}else e.push(new ze(a,r,'missing required property "source"'));return e=e.concat(Rn({key:a,value:r,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${a}.type`,value:r.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:tl,layout:w=>Rn({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":I=>Pc(pn({layerType:y},I))}}),paint:w=>Rn({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":I=>il(pn({layerType:y},I))}})}})),e}function Kr(i){const e=i.value,r=i.key,a=Mt(e);return a!=="string"?[new ze(r,e,`string expected, ${a} found`)]:[]}const kh={promoteId:function({key:i,value:e}){if(Mt(e)==="string")return Kr({key:i,value:e});{const r=[];for(const a in e)r.push(...Kr({key:`${i}.${a}`,value:e[a]}));return r}}};function Mc(i){const e=i.value,r=i.key,a=i.styleSpec,u=i.style,f=i.validateSpec;if(!e.type)return[new ze(r,e,'"type" is required')];const y=si(e.type);let _;switch(y){case"vector":case"raster":return _=Rn({key:r,value:e,valueSpec:a[`source_${y.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:kh,validateSpec:f}),_;case"raster-dem":return _=function(w){var I;const C=(I=w.sourceName)!==null&&I!==void 0?I:"",P=w.value,z=w.styleSpec,L=z.source_raster_dem,B=w.style;let j=[];const q=Mt(P);if(P===void 0)return j;if(q!=="object")return j.push(new ze("source_raster_dem",P,`object expected, ${q} found`)),j;const Y=si(P.encoding)==="custom",ue=["redFactor","greenFactor","blueFactor","baseShift"],ee=w.value.encoding?`"${w.value.encoding}"`:"Default";for(const le in P)!Y&&ue.includes(le)?j.push(new ze(le,P[le],`In "${C}": "${le}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):L[le]?j=j.concat(w.validateSpec({key:le,value:P[le],valueSpec:L[le],validateSpec:w.validateSpec,style:B,styleSpec:z})):j.push(new ze(le,P[le],`unknown property "${le}"`));return j}({sourceName:r,value:e,style:i.style,styleSpec:a,validateSpec:f}),_;case"geojson":if(_=Rn({key:r,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,validateSpec:f,objectElementValidators:kh}),e.cluster)for(const w in e.clusterProperties){const[I,C]=e.clusterProperties[w],P=typeof I=="string"?[I,["accumulated"],["get",w]]:I;_.push(...Rr({key:`${r}.${w}.map`,value:C,validateSpec:f,expressionContext:"cluster-map"})),_.push(...Rr({key:`${r}.${w}.reduce`,value:P,validateSpec:f,expressionContext:"cluster-reduce"}))}return _;case"video":return Rn({key:r,value:e,valueSpec:a.source_video,style:u,validateSpec:f,styleSpec:a});case"image":return Rn({key:r,value:e,valueSpec:a.source_image,style:u,validateSpec:f,styleSpec:a});case"canvas":return[new ze(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return es({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,validateSpec:f,styleSpec:a})}}function Ac(i){const e=i.value,r=i.styleSpec,a=r.light,u=i.style;let f=[];const y=Mt(e);if(e===void 0)return f;if(y!=="object")return f=f.concat([new ze("light",e,`object expected, ${y} found`)]),f;for(const _ in e){const w=_.match(/^(.*)-transition$/);f=f.concat(w&&a[w[1]]&&a[w[1]].transition?i.validateSpec({key:_,value:e[_],valueSpec:r.transition,validateSpec:i.validateSpec,style:u,styleSpec:r}):a[_]?i.validateSpec({key:_,value:e[_],valueSpec:a[_],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new ze(_,e[_],`unknown property "${_}"`)])}return f}function zc(i){const e=i.value,r=i.styleSpec,a=r.sky,u=i.style,f=Mt(e);if(e===void 0)return[];if(f!=="object")return[new ze("sky",e,`object expected, ${f} found`)];let y=[];for(const _ in e)y=y.concat(a[_]?i.validateSpec({key:_,value:e[_],valueSpec:a[_],style:u,styleSpec:r}):[new ze(_,e[_],`unknown property "${_}"`)]);return y}function Ih(i){const e=i.value,r=i.styleSpec,a=r.terrain,u=i.style;let f=[];const y=Mt(e);if(e===void 0)return f;if(y!=="object")return f=f.concat([new ze("terrain",e,`object expected, ${y} found`)]),f;for(const _ in e)f=f.concat(a[_]?i.validateSpec({key:_,value:e[_],valueSpec:a[_],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new ze(_,e[_],`unknown property "${_}"`)]);return f}function Ch(i){let e=[];const r=i.value,a=i.key;if(Array.isArray(r)){const u=[],f=[];for(const y in r)r[y].id&&u.includes(r[y].id)&&e.push(new ze(a,r,`all the sprites' ids must be unique, but ${r[y].id} is duplicated`)),u.push(r[y].id),r[y].url&&f.includes(r[y].url)&&e.push(new ze(a,r,`all the sprites' URLs must be unique, but ${r[y].url} is duplicated`)),f.push(r[y].url),e=e.concat(Rn({key:`${a}[${y}]`,value:r[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Kr({key:a,value:r})}const Dc={"*":()=>[],array:Qa,boolean:function(i){const e=i.value,r=i.key,a=Mt(e);return a!=="boolean"?[new ze(r,e,`boolean expected, ${a} found`)]:[]},number:Ic,color:function(i){const e=i.key,r=i.value,a=Mt(r);return a!=="string"?[new ze(e,r,`color expected, ${a} found`)]:Ot.parse(String(r))?[]:[new ze(e,r,`color expected, "${r}" found`)]},constants:Ja,enum:es,filter:tl,function:el,layer:Th,object:Rn,source:Mc,light:Ac,sky:zc,terrain:Ih,projection:function(i){const e=i.value,r=i.styleSpec,a=r.projection,u=i.style,f=Mt(e);if(e===void 0)return[];if(f!=="object")return[new ze("projection",e,`object expected, ${f} found`)];let y=[];for(const _ in e)y=y.concat(a[_]?i.validateSpec({key:_,value:e[_],valueSpec:a[_],style:u,styleSpec:r}):[new ze(_,e[_],`unknown property "${_}"`)]);return y},string:Kr,formatted:function(i){return Kr(i).length===0?[]:Rr(i)},resolvedImage:function(i){return Kr(i).length===0?[]:Rr(i)},padding:function(i){const e=i.key,r=i.value;if(Mt(r)==="array"){if(r.length<1||r.length>4)return[new ze(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let u=[];for(let f=0;f<r.length;f++)u=u.concat(i.validateSpec({key:`${e}[${f}]`,value:r[f],validateSpec:i.validateSpec,valueSpec:a}));return u}return Ic({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,a=Mt(r),u=i.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new ze(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let y=0;y<r.length;y+=2)f=f.concat(es({key:`${e}[${y}]`,value:r[y],valueSpec:u.layout_symbol["text-anchor"]})),f=f.concat(Qa({key:`${e}[${y+1}]`,value:r[y+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return f},sprite:Ch};function ts(i){const e=i.value,r=i.valueSpec,a=i.styleSpec;return i.validateSpec=ts,r.expression&&Yo(si(e))?el(i):r.expression&&Ha(Lr(e))?Rr(i):r.type&&Dc[r.type]?Dc[r.type](i):Rn(pn({},i,{valueSpec:r.type?a[r.type]:r}))}function Lc(i){const e=i.value,r=i.key,a=Kr(i);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new ze(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new ze(r,e,'"glyphs" url must include a "{range}" token'))),a}function qn(i,e=ye){let r=[];return r=r.concat(ts({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:ts,objectElementValidators:{glyphs:Lc,"*":()=>[]}})),i.constants&&(r=r.concat(Ja({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:ts}))),Eh(r)}function Fn(i){return function(e){return i({...e,validateSpec:ts})}}function Eh(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function Gn(i){return function(...e){return Eh(i.apply(this,e))}}qn.source=Gn(Fn(Mc)),qn.sprite=Gn(Fn(Ch)),qn.glyphs=Gn(Fn(Lc)),qn.light=Gn(Fn(Ac)),qn.sky=Gn(Fn(zc)),qn.terrain=Gn(Fn(Ih)),qn.layer=Gn(Fn(Th)),qn.filter=Gn(Fn(tl)),qn.paintProperty=Gn(Fn(il)),qn.layoutProperty=Gn(Fn(Pc));const Qs=qn,Wp=Qs.light,Ph=Qs.paintProperty,Mh=Qs.layoutProperty;function Rc(i,e){let r=!1;if(e&&e.length)for(const a of e)i.fire(new xi(new Error(a.message))),r=!0;return r}class ea{constructor(e,r,a){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(r=y[1])+2*(a=y[2]);for(let w=0;w<this.d*this.d;w++){const I=y[3+w],C=y[3+w+1];u.push(I===C?null:y.subarray(I,C))}const _=y[3+u.length+1];this.keys=y.subarray(y[3+u.length],_),this.bboxes=y.subarray(_),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let y=0;y<this.d*this.d;y++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;const f=a/r*e;this.min=-f,this.max=e+f}insert(e,r,a,u,f){this._forEachCell(r,a,u,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,a,u,f,y){this.cells[f].push(y)}query(e,r,a,u,f){const y=this.min,_=this.max;if(e<=y&&r<=y&&_<=a&&_<=u&&!f)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(e,r,a,u,this._queryCell,w,{},f),w}}_queryCell(e,r,a,u,f,y,_,w){const I=this.cells[f];if(I!==null){const C=this.keys,P=this.bboxes;for(let z=0;z<I.length;z++){const L=I[z];if(_[L]===void 0){const B=4*L;(w?w(P[B+0],P[B+1],P[B+2],P[B+3]):e<=P[B+2]&&r<=P[B+3]&&a>=P[B+0]&&u>=P[B+1])?(_[L]=!0,y.push(C[L])):_[L]=!1}}}}_forEachCell(e,r,a,u,f,y,_,w){const I=this._convertToCellCoord(e),C=this._convertToCellCoord(r),P=this._convertToCellCoord(a),z=this._convertToCellCoord(u);for(let L=I;L<=P;L++)for(let B=C;B<=z;B++){const j=this.d*B+L;if((!w||w(this._convertFromCellCoord(L),this._convertFromCellCoord(B),this._convertFromCellCoord(L+1),this._convertFromCellCoord(B+1)))&&f.call(this,e,r,a,u,j,y,_,w))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const u=new Int32Array(r+a+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let f=r;for(let y=0;y<e.length;y++){const _=e[y];u[3+y]=f,u.set(_,f),f+=_.length}return u[3+e.length]=f,u.set(this.keys,f),f+=this.keys.length,u[3+e.length+1]=f,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer}static serialize(e,r){const a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(e){return new ea(e.buffer)}}const Xr={};function We(i,e,r={}){if(Xr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Xr[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}We("Object",Object),We("TransferableGridIndex",ea),We("Color",Ot),We("Error",Error),We("AJAXError",$i),We("ResolvedImage",Zn),We("StylePropertyFunction",vo),We("StyleExpression",bc,{omit:["_evaluator"]}),We("ZoomDependentExpression",Tc),We("ZoomConstantExpression",Sc),We("CompoundExpression",_n,{omit:["_evaluate"]});for(const i in go)go[i]._classRegistryKey||We(`Expression_${i}`,go[i]);function Ah(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function ta(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error)return i;if(Ah(i)||Fi(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const a of i)r.push(ta(a,e));return r}if(typeof i=="object"){const r=i.constructor,a=r._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${r.name}`);if(!Xr[a])throw new Error(`${a} is not registered.`);const u=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in i){if(!i.hasOwnProperty(f)||Xr[a].omit.indexOf(f)>=0)continue;const y=i[f];u[f]=Xr[a].shallow.indexOf(f)>=0?y:ta(y,e)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof i)}function gr(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Ah(i)||Fi(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(gr);if(typeof i=="object"){const e=i.$name||"Object";if(!Xr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Xr[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const a=Object.create(r.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const f=i[u];a[u]=Xr[e].shallow.indexOf(u)>=0?f:gr(f)}return a}throw new Error("can't deserialize object of type "+typeof i)}class zh{constructor(){this.first=!0}update(e,r){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const Ue={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Fc(i){for(const e of i)if(Bc(e.charCodeAt(0)))return!0;return!1}function Hp(i){for(const e of i)if(!Dh(e.charCodeAt(0)))return!1;return!0}function Dh(i){return!(Ue.Arabic(i)||Ue["Arabic Supplement"](i)||Ue["Arabic Extended-A"](i)||Ue["Arabic Presentation Forms-A"](i)||Ue["Arabic Presentation Forms-B"](i))}function Bc(i){return!(i!==746&&i!==747&&(i<4352||!(Ue["Bopomofo Extended"](i)||Ue.Bopomofo(i)||Ue["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ue["CJK Compatibility Ideographs"](i)||Ue["CJK Compatibility"](i)||Ue["CJK Radicals Supplement"](i)||Ue["CJK Strokes"](i)||!(!Ue["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ue["CJK Unified Ideographs Extension A"](i)||Ue["CJK Unified Ideographs"](i)||Ue["Enclosed CJK Letters and Months"](i)||Ue["Hangul Compatibility Jamo"](i)||Ue["Hangul Jamo Extended-A"](i)||Ue["Hangul Jamo Extended-B"](i)||Ue["Hangul Jamo"](i)||Ue["Hangul Syllables"](i)||Ue.Hiragana(i)||Ue["Ideographic Description Characters"](i)||Ue.Kanbun(i)||Ue["Kangxi Radicals"](i)||Ue["Katakana Phonetic Extensions"](i)||Ue.Katakana(i)&&i!==12540||!(!Ue["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ue["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ue["Unified Canadian Aboriginal Syllabics"](i)||Ue["Unified Canadian Aboriginal Syllabics Extended"](i)||Ue["Vertical Forms"](i)||Ue["Yijing Hexagram Symbols"](i)||Ue["Yi Syllables"](i)||Ue["Yi Radicals"](i))))}function Lh(i){return!(Bc(i)||function(e){return!!(Ue["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ue["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ue["Letterlike Symbols"](e)||Ue["Number Forms"](e)||Ue["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ue["Control Pictures"](e)&&e!==9251||Ue["Optical Character Recognition"](e)||Ue["Enclosed Alphanumerics"](e)||Ue["Geometric Shapes"](e)||Ue["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ue["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ue["CJK Symbols and Punctuation"](e)||Ue.Katakana(e)||Ue["Private Use Area"](e)||Ue["CJK Compatibility Forms"](e)||Ue["Small Form Variants"](e)||Ue["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Yr(i){return i>=1424&&i<=2303||Ue["Arabic Presentation Forms-A"](i)||Ue["Arabic Presentation Forms-B"](i)}function Rh(i,e){return!(!e&&Yr(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ue.Khmer(i))}function Oc(i){for(const e of i)if(Yr(e.charCodeAt(0)))return!0;return!1}const Jr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Zt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new zh,this.transition={})}isSupportedScript(e){return function(r,a){for(const u of r)if(!Rh(u.charCodeAt(0),a))return!1;return!0}(e,Jr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class nl{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,u){if(Yo(a))return new vo(a,u);if(Ha(a)){const f=Xs(a,u);if(f.result==="error")throw new Error(f.value.map(y=>`${y.key}: ${y.message}`).join(", "));return f.value}{let f=a;return u.type==="color"&&typeof a=="string"?f=Ot.parse(a):u.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?u.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(f=yn.parse(a)):f=gn.parse(a),{kind:"constant",evaluate:()=>f}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class is{constructor(e){this.property=e,this.value=new nl(e,void 0)}transitioned(e,r){return new Fh(this.property,this.value,r,$e({},e.transition,this.transition),e.now)}untransitioned(){return new Fh(this.property,this.value,null,{},0)}}class ns{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return pt(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new is(this._values[e].property)),this._values[e].value=new nl(this._values[e].property,r===null?void 0:pt(r))}getTransition(e){return pt(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new is(this._values[e].property)),this._values[e].transition=pt(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const a=new Nc(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,r._values[u]);return a}untransitioned(){const e=new Nc(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Fh{constructor(e,r,a,u,f){this.property=e,this.value=r,this.begin=f+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const u=e.now||0,f=this.value.possiblyEvaluate(e,r,a),y=this.prior;if(y){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return y.possiblyEvaluate(e,r,a);{const _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,r,a),f,function(w){if(w<=0)return 0;if(w>=1)return 1;const I=w*w,C=I*w;return 4*(w<.5?C:3*(w-I)+C-.75)}(_))}}return f}}class Nc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const u=new rl(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,r,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ia{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return pt(this._values[e].value)}setValue(e,r){this._values[e]=new nl(this._values[e].property,r===null?void 0:pt(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const u=new rl(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,r,a);return u}}class yr{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,u){return this.property.evaluate(this.value,this.parameters,e,r,a,u)}}class rl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class et{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,a){const u=on[this.specification.type];return u?u(e,r,a):e}}class lt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,u){return new yr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,u)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new yr(this,{kind:"constant",value:void 0},e.parameters);const u=on[this.specification.type];if(u){const f=u(e.value.value,r.value.value,a);return new yr(this,{kind:"constant",value:f},e.parameters)}return e}evaluate(e,r,a,u,f,y){return e.kind==="constant"?e.value:e.evaluate(r,a,u,f,y)}}class m extends lt{possiblyEvaluate(e,r,a,u){if(e.value===void 0)return new yr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},a,u),y=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,_=this._calculate(y,y,y,r);return new yr(this,{kind:"constant",value:_},r)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new yr(this,{kind:"constant",value:f},r)}return new yr(this,e.expression,r)}evaluate(e,r,a,u,f,y){if(e.kind==="source"){const _=e.evaluate(r,a,u,f,y);return this._calculate(_,_,_,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},a,u),e.evaluate({zoom:Math.floor(r.zoom)},a,u),e.evaluate({zoom:Math.floor(r.zoom)+1},a,u),r):e.value}_calculate(e,r,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class t{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},a,u);return this._calculate(f,f,f,r)}return this._calculate(e.expression.evaluate(new Zt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Zt(Math.floor(r.zoom),r)),e.expression.evaluate(new Zt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class s{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,u){return!!e.expression.evaluate(r,null,{},a,u)}interpolate(){return!1}}class l{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new nl(a,void 0),f=this.defaultTransitionablePropertyValues[r]=new is(a);this.defaultTransitioningPropertyValues[r]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate({})}}}We("DataDrivenProperty",lt),We("DataConstantProperty",et),We("CrossFadedDataDrivenProperty",m),We("CrossFadedProperty",t),We("ColorRampProperty",s);const h="-transition";class g extends jo{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new ia(r.layout)),r.paint)){this._transitionablePaint=new ns(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new rl(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(Mh,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(h)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(Ph,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(e.endsWith(h))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const u=this._transitionablePaint._values[e],f=u.property.specification["property-type"]==="cross-faded-data-driven",y=u.value.isDataDriven(),_=u.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value;return w.isDataDriven()||y||f||this._handleOverridablePaintPropertyUpdate(e,_,w)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),rt(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,u,f={}){return(!f||f.validate!==!1)&&Rc(this,e.call(Qs,{key:r,layerType:this.type,objectKey:a,value:u,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof yr&&Dr(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const x={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class b{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class T{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function E(i,e=1){let r=0,a=0;return{members:i.map(u=>{const f=x[u.type].BYTES_PER_ELEMENT,y=r=A(r,Math.max(e,f)),_=u.components||1;return a=Math.max(a,f),r+=f*_,{name:u.name,type:u.type,components:_,offset:y}}),size:A(r,Math.max(a,e)),alignment:e}}function A(i,e){return Math.ceil(i/e)*e}class M extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=a,e}}M.prototype.bytesPerElement=4,We("StructArrayLayout2i4",M);class F extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const f=3*e;return this.int16[f+0]=r,this.int16[f+1]=a,this.int16[f+2]=u,e}}F.prototype.bytesPerElement=6,We("StructArrayLayout3i6",F);class N extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u)}emplace(e,r,a,u,f){const y=4*e;return this.int16[y+0]=r,this.int16[y+1]=a,this.int16[y+2]=u,this.int16[y+3]=f,e}}N.prototype.bytesPerElement=8,We("StructArrayLayout4i8",N);class U extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,y){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u,f,y)}emplace(e,r,a,u,f,y,_){const w=6*e;return this.int16[w+0]=r,this.int16[w+1]=a,this.int16[w+2]=u,this.int16[w+3]=f,this.int16[w+4]=y,this.int16[w+5]=_,e}}U.prototype.bytesPerElement=12,We("StructArrayLayout2i4i12",U);class K extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,y){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u,f,y)}emplace(e,r,a,u,f,y,_){const w=4*e,I=8*e;return this.int16[w+0]=r,this.int16[w+1]=a,this.uint8[I+4]=u,this.uint8[I+5]=f,this.uint8[I+6]=y,this.uint8[I+7]=_,e}}K.prototype.bytesPerElement=8,We("StructArrayLayout2i4ub8",K);class Z extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=a,e}}Z.prototype.bytesPerElement=8,We("StructArrayLayout2f8",Z);class J extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,y,_,w,I,C){const P=this.length;return this.resize(P+1),this.emplace(P,e,r,a,u,f,y,_,w,I,C)}emplace(e,r,a,u,f,y,_,w,I,C,P){const z=10*e;return this.uint16[z+0]=r,this.uint16[z+1]=a,this.uint16[z+2]=u,this.uint16[z+3]=f,this.uint16[z+4]=y,this.uint16[z+5]=_,this.uint16[z+6]=w,this.uint16[z+7]=I,this.uint16[z+8]=C,this.uint16[z+9]=P,e}}J.prototype.bytesPerElement=20,We("StructArrayLayout10ui20",J);class re extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,y,_,w,I,C,P,z){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,a,u,f,y,_,w,I,C,P,z)}emplace(e,r,a,u,f,y,_,w,I,C,P,z,L){const B=12*e;return this.int16[B+0]=r,this.int16[B+1]=a,this.int16[B+2]=u,this.int16[B+3]=f,this.uint16[B+4]=y,this.uint16[B+5]=_,this.uint16[B+6]=w,this.uint16[B+7]=I,this.int16[B+8]=C,this.int16[B+9]=P,this.int16[B+10]=z,this.int16[B+11]=L,e}}re.prototype.bytesPerElement=24,We("StructArrayLayout4i4ui4i24",re);class W extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const f=3*e;return this.float32[f+0]=r,this.float32[f+1]=a,this.float32[f+2]=u,e}}W.prototype.bytesPerElement=12,We("StructArrayLayout3f12",W);class ae extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}ae.prototype.bytesPerElement=4,We("StructArrayLayout1ul4",ae);class de extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,y,_,w,I){const C=this.length;return this.resize(C+1),this.emplace(C,e,r,a,u,f,y,_,w,I)}emplace(e,r,a,u,f,y,_,w,I,C){const P=10*e,z=5*e;return this.int16[P+0]=r,this.int16[P+1]=a,this.int16[P+2]=u,this.int16[P+3]=f,this.int16[P+4]=y,this.int16[P+5]=_,this.uint32[z+3]=w,this.uint16[P+8]=I,this.uint16[P+9]=C,e}}de.prototype.bytesPerElement=20,We("StructArrayLayout6i1ul2ui20",de);class fe extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,y){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u,f,y)}emplace(e,r,a,u,f,y,_){const w=6*e;return this.int16[w+0]=r,this.int16[w+1]=a,this.int16[w+2]=u,this.int16[w+3]=f,this.int16[w+4]=y,this.int16[w+5]=_,e}}fe.prototype.bytesPerElement=12,We("StructArrayLayout2i2i2i12",fe);class we extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,f)}emplace(e,r,a,u,f,y){const _=4*e,w=8*e;return this.float32[_+0]=r,this.float32[_+1]=a,this.float32[_+2]=u,this.int16[w+6]=f,this.int16[w+7]=y,e}}we.prototype.bytesPerElement=16,We("StructArrayLayout2f1f2i16",we);class Ce extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,y){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u,f,y)}emplace(e,r,a,u,f,y,_){const w=16*e,I=4*e,C=8*e;return this.uint8[w+0]=r,this.uint8[w+1]=a,this.float32[I+1]=u,this.float32[I+2]=f,this.int16[C+6]=y,this.int16[C+7]=_,e}}Ce.prototype.bytesPerElement=16,We("StructArrayLayout2ub2f2i16",Ce);class Ze extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const f=3*e;return this.uint16[f+0]=r,this.uint16[f+1]=a,this.uint16[f+2]=u,e}}Ze.prototype.bytesPerElement=6,We("StructArrayLayout3ui6",Ze);class qe extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,y,_,w,I,C,P,z,L,B,j,q,Y){const ue=this.length;return this.resize(ue+1),this.emplace(ue,e,r,a,u,f,y,_,w,I,C,P,z,L,B,j,q,Y)}emplace(e,r,a,u,f,y,_,w,I,C,P,z,L,B,j,q,Y,ue){const ee=24*e,le=12*e,ge=48*e;return this.int16[ee+0]=r,this.int16[ee+1]=a,this.uint16[ee+2]=u,this.uint16[ee+3]=f,this.uint32[le+2]=y,this.uint32[le+3]=_,this.uint32[le+4]=w,this.uint16[ee+10]=I,this.uint16[ee+11]=C,this.uint16[ee+12]=P,this.float32[le+7]=z,this.float32[le+8]=L,this.uint8[ge+36]=B,this.uint8[ge+37]=j,this.uint8[ge+38]=q,this.uint32[le+10]=Y,this.int16[ee+22]=ue,e}}qe.prototype.bytesPerElement=48,We("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",qe);class Ee extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,y,_,w,I,C,P,z,L,B,j,q,Y,ue,ee,le,ge,Se,Oe,st,je,Fe,Qe,He){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,e,r,a,u,f,y,_,w,I,C,P,z,L,B,j,q,Y,ue,ee,le,ge,Se,Oe,st,je,Fe,Qe,He)}emplace(e,r,a,u,f,y,_,w,I,C,P,z,L,B,j,q,Y,ue,ee,le,ge,Se,Oe,st,je,Fe,Qe,He,Ge){const xe=32*e,tt=16*e;return this.int16[xe+0]=r,this.int16[xe+1]=a,this.int16[xe+2]=u,this.int16[xe+3]=f,this.int16[xe+4]=y,this.int16[xe+5]=_,this.int16[xe+6]=w,this.int16[xe+7]=I,this.uint16[xe+8]=C,this.uint16[xe+9]=P,this.uint16[xe+10]=z,this.uint16[xe+11]=L,this.uint16[xe+12]=B,this.uint16[xe+13]=j,this.uint16[xe+14]=q,this.uint16[xe+15]=Y,this.uint16[xe+16]=ue,this.uint16[xe+17]=ee,this.uint16[xe+18]=le,this.uint16[xe+19]=ge,this.uint16[xe+20]=Se,this.uint16[xe+21]=Oe,this.uint16[xe+22]=st,this.uint32[tt+12]=je,this.float32[tt+13]=Fe,this.float32[tt+14]=Qe,this.uint16[xe+30]=He,this.uint16[xe+31]=Ge,e}}Ee.prototype.bytesPerElement=64,We("StructArrayLayout8i15ui1ul2f2ui64",Ee);class Ae extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Ae.prototype.bytesPerElement=4,We("StructArrayLayout1f4",Ae);class Ke extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const f=3*e;return this.uint16[6*e+0]=r,this.float32[f+1]=a,this.float32[f+2]=u,e}}Ke.prototype.bytesPerElement=12,We("StructArrayLayout1ui2f12",Ke);class dt extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const f=4*e;return this.uint32[2*e+0]=r,this.uint16[f+2]=a,this.uint16[f+3]=u,e}}dt.prototype.bytesPerElement=8,We("StructArrayLayout1ul2ui8",dt);class Le extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=a,e}}Le.prototype.bytesPerElement=4,We("StructArrayLayout2ui4",Le);class Ne extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Ne.prototype.bytesPerElement=2,We("StructArrayLayout1ui2",Ne);class ct extends T{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u)}emplace(e,r,a,u,f){const y=4*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=u,this.float32[y+3]=f,e}}ct.prototype.bytesPerElement=16,We("StructArrayLayout4f16",ct);class Ht extends b{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new X(this.anchorPointX,this.anchorPointY)}}Ht.prototype.size=20;class bt extends de{get(e){return new Ht(this,e)}}We("CollisionBoxArray",bt);class It extends b{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}It.prototype.size=48;class Kt extends qe{get(e){return new It(this,e)}}We("PlacedSymbolArray",Kt);class qi extends b{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}qi.prototype.size=64;class er extends Ee{get(e){return new qi(this,e)}}We("SymbolInstanceArray",er);class Xt extends Ae{getoffsetX(e){return this.float32[1*e+0]}}We("GlyphOffsetArray",Xt);class vn extends F{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}We("SymbolLineVertexArray",vn);class sn extends b{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}sn.prototype.size=12;class Gi extends Ke{get(e){return new sn(this,e)}}We("TextAnchorOffsetArray",Gi);class Wi extends b{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Wi.prototype.size=8;class tr extends dt{get(e){return new Wi(this,e)}}We("FeatureIndexArray",tr);class bo extends M{}class ol extends M{}class rs extends M{}class So extends U{}class sl extends K{}class jc extends Z{}class Oi extends J{}class ir extends re{}class Qr extends W{}class os extends ae{}class Hi extends fe{}class Ki extends Ce{}class Ai extends Ze{}class ni extends Le{}const ss=E([{name:"a_pos",components:2,type:"Int16"}],4),{members:Vc}=ss;class Ci{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,u){let f=this.segments[this.segments.length-1];return e>Ci.MAX_VERTEX_ARRAY_LENGTH&&Ut(`Max vertices per segment is ${Ci.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>Ci.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,u){return new Ci([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function Bh(i,e){return 256*(i=Be(Math.floor(i),0,255))+Be(Math.floor(e),0,255)}Ci.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,We("SegmentVector",Ci);const al=E([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ll={exports:{}},eo={exports:{}};eo.exports=function(i,e){var r,a,u,f,y,_,w,I;for(a=i.length-(r=3&i.length),u=e,y=3432918353,_=461845907,I=0;I<a;)w=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,u=27492+(65535&(f=5*(65535&(u=(u^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*_+(((w>>>16)*_&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(w=0,r){case 3:w^=(255&i.charCodeAt(I+2))<<16;case 2:w^=(255&i.charCodeAt(I+1))<<8;case 1:u^=w=(65535&(w=(w=(65535&(w^=255&i.charCodeAt(I)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*_+(((w>>>16)*_&65535)<<16)&4294967295}return u^=i.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var Oh=eo.exports,Uc={exports:{}};Uc.exports=function(i,e){for(var r,a=i.length,u=e^a,f=0;a>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(f)|(255&i.charCodeAt(++f))<<8|(255&i.charCodeAt(++f))<<16|(255&i.charCodeAt(++f))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++f;switch(a){case 3:u^=(255&i.charCodeAt(f+2))<<16;case 2:u^=(255&i.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&i.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var $c=Oh,Zc=Uc.exports;ll.exports=$c,ll.exports.murmur3=$c,ll.exports.murmur2=Zc;var cl=$(ll.exports);class as{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,u){this.ids.push(ry(e)),this.positions.push(r,a,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=ry(e);let a=0,u=this.ids.length-1;for(;a<u;){const y=a+u>>1;this.ids[y]>=r?u=y:a=y+1}const f=[];for(;this.ids[a]===r;)f.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return f}static serialize(e,r){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Kp(a,u,0,a.length-1),r&&r.push(a.buffer,u.buffer),{ids:a,positions:u}}static deserialize(e){const r=new as;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function ry(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:cl(String(i))}function Kp(i,e,r,a){for(;r<a;){const u=i[r+a>>1];let f=r-1,y=a+1;for(;;){do f++;while(i[f]<u);do y--;while(i[y]>u);if(f>=y)break;Nh(i,f,y),Nh(e,3*f,3*y),Nh(e,3*f+1,3*y+1),Nh(e,3*f+2,3*y+2)}y-r<a-y?(Kp(i,e,r,y),r=y+1):(Kp(i,e,y+1,a),a=y)}}function Nh(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}We("FeaturePositionMap",as);class na{constructor(e,r){this.gl=e.gl,this.location=r}}class jh extends na{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class oy extends na{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class sy extends na{constructor(e,r){super(e,r),this.current=Ot.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Px=new Float32Array(16);function Xp(i){return[Bh(255*i.r,255*i.g),Bh(255*i.b,255*i.a)]}class qc{constructor(e,r,a){this.value=e,this.uniformNames=r.map(u=>`u_${u}`),this.type=a}setUniform(e,r,a){e.set(a.constantOr(this.value))}getBinding(e,r,a){return this.type==="color"?new sy(e,r):new jh(e,r)}}class ul{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,a,u){const f=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&e.set(f)}getBinding(e,r,a){return a.substr(0,9)==="u_pattern"?new oy(e,r):new jh(e,r)}}class To{constructor(e,r,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,a,u,f){const y=this.paintVertexArray.length,_=this.expression.evaluate(new Zt(0),r,{},u,[],f);this.paintVertexArray.resize(e),this._setPaintValue(y,e,_)}updatePaintArray(e,r,a,u){const f=this.expression.evaluate({zoom:0},a,u);this._setPaintValue(e,r,f)}_setPaintValue(e,r,a){if(this.type==="color"){const u=Xp(a);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fr{constructor(e,r,a,u,f,y){this.expression=e,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,r,a,u,f){const y=this.expression.evaluate(new Zt(this.zoom),r,{},u,[],f),_=this.expression.evaluate(new Zt(this.zoom+1),r,{},u,[],f),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,y,_)}updatePaintArray(e,r,a,u){const f=this.expression.evaluate({zoom:this.zoom},a,u),y=this.expression.evaluate({zoom:this.zoom+1},a,u);this._setPaintValue(e,r,f,y)}_setPaintValue(e,r,a,u){if(this.type==="color"){const f=Xp(a),y=Xp(u);for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,f[0],f[1],y[0],y[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,u=Be(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,r,a){return new jh(e,r)}}class ls{constructor(e,r,a,u,f,y){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=u,this.layerId=y,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,r,a){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,u,f){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],f)}_setPaintValues(e,r,a,u){if(!u||!a)return;const{min:f,mid:y,max:_}=a,w=u[f],I=u[y],C=u[_];if(w&&I&&C)for(let P=e;P<r;P++)this.zoomInPaintVertexArray.emplace(P,I.tl[0],I.tl[1],I.br[0],I.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],I.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,I.tl[0],I.tl[1],I.br[0],I.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],I.pixelRatio,C.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,al.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,al.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ay{constructor(e,r,a){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!a(f))continue;const y=e.paint.get(f);if(!(y instanceof yr&&Dr(y.property.specification)))continue;const _=Mx(f,e.type),w=y.value,I=y.property.specification.type,C=y.property.useIntegerZoom,P=y.property.specification["property-type"],z=P==="cross-faded"||P==="cross-faded-data-driven";if(w.kind==="constant")this.binders[f]=z?new ul(w.value,_):new qc(w.value,_,I),u.push(`/u_${f}`);else if(w.kind==="source"||z){const L=ly(f,I,"source");this.binders[f]=z?new ls(w,I,C,r,L,e.id):new To(w,_,I,L),u.push(`/a_${f}`)}else{const L=ly(f,I,"composite");this.binders[f]=new Fr(w,_,I,C,r,L),u.push(`/z_${f}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof To||r instanceof Fr?r.maxValue:0}populatePaintArrays(e,r,a,u,f){for(const y in this.binders){const _=this.binders[y];(_ instanceof To||_ instanceof Fr||_ instanceof ls)&&_.populatePaintArray(e,r,a,u,f)}}setConstantPatternPositions(e,r){for(const a in this.binders){const u=this.binders[a];u instanceof ul&&u.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,a,u,f){let y=!1;for(const _ in e){const w=r.getPositions(_);for(const I of w){const C=a.feature(I.index);for(const P in this.binders){const z=this.binders[P];if((z instanceof To||z instanceof Fr||z instanceof ls)&&z.expression.isStateDependent===!0){const L=u.paint.get(P);z.expression=L.value,z.updatePaintArray(I.start,I.end,C,e[_],f),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof qc||a instanceof ul)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof To||a instanceof Fr)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name);else if(a instanceof ls)for(let u=0;u<al.members.length;u++)e.push(al.members[u].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof qc||a instanceof ul||a instanceof Fr)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const a=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof qc||f instanceof ul||f instanceof Fr){for(const y of f.uniformNames)if(r[y]){const _=f.getBinding(e,r[y],y);a.push({name:y,property:u,binding:_})}}}return a}setUniforms(e,r,a,u){for(const{name:f,property:y,binding:_}of r)this.binders[y].setUniform(_,u,a.get(y),f)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(e&&a instanceof ls){const u=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(a instanceof To||a instanceof Fr)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof To||a instanceof Fr||a instanceof ls)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof To||r instanceof Fr||r instanceof ls)&&r.destroy()}}}class ra{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new ay(u,r,a);this.needsUpload=!1,this._featureMap=new as,this._bufferOffset=0}populatePaintArrays(e,r,a,u,f,y){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,r,u,f,y);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,u){for(const f of a)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,r,f,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Mx(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function ly(i,e,r){const a={color:{source:Z,composite:ct},number:{source:Ae,composite:Z}},u=function(f){return{"line-pattern":{source:Oi,composite:Oi},"fill-pattern":{source:Oi,composite:Oi},"fill-extrusion-pattern":{source:Oi,composite:Oi}}[f]}(i);return u&&u[r]||a[e][r]}We("ConstantBinder",qc),We("CrossFadedConstantBinder",ul),We("SourceExpressionBinder",To),We("CrossFadedCompositeBinder",ls),We("CompositeExpressionBinder",Fr),We("ProgramConfiguration",ay,{omit:["_buffers"]}),We("ProgramConfigurationSet",ra);const Si=8192,Yp=Math.pow(2,14)-1,cy=-Yp-1;function oa(i){const e=Si/i.extent,r=i.loadGeometry();for(let a=0;a<r.length;a++){const u=r[a];for(let f=0;f<u.length;f++){const y=u[f],_=Math.round(y.x*e),w=Math.round(y.y*e);y.x=Be(_,cy,Yp),y.y=Be(w,cy,Yp),(_<y.x||_>y.x+1||w<y.y||w>y.y+1)&&Ut("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function sa(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?oa(i):[]}}function Vh(i,e,r,a,u){i.emplaceBack(2*e+(a+1)/2,2*r+(u+1)/2)}class Jp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ol,this.indexArray=new Ai,this.segments=new Ci,this.programConfigurations=new ra(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){const u=this.layers[0],f=[];let y=null,_=!1;u.type==="circle"&&(y=u.layout.get("circle-sort-key"),_=!y.isConstant());for(const{feature:w,id:I,index:C,sourceLayerIndex:P}of e){const z=this.layers[0]._featureFilter.needGeometry,L=sa(w,z);if(!this.layers[0]._featureFilter.filter(new Zt(this.zoom),L,a))continue;const B=_?y.evaluate(L,{},a):void 0,j={id:I,properties:w.properties,type:w.type,sourceLayerIndex:P,index:C,geometry:z?L.geometry:oa(w),patterns:{},sortKey:B};f.push(j)}_&&f.sort((w,I)=>w.sortKey-I.sortKey);for(const w of f){const{geometry:I,index:C,sourceLayerIndex:P}=w,z=e[C].feature;this.addFeature(w,I,C,a),r.featureIndex.insert(z,I,C,P,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,u){for(const f of r)for(const y of f){const _=y.x,w=y.y;if(_<0||_>=Si||w<0||w>=Si)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),C=I.vertexLength;Vh(this.layoutVertexArray,_,w,-1,-1),Vh(this.layoutVertexArray,_,w,1,-1),Vh(this.layoutVertexArray,_,w,1,1),Vh(this.layoutVertexArray,_,w,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+3,C+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u)}}function uy(i,e){for(let r=0;r<i.length;r++)if(hl(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(hl(i,e[r]))return!0;return!!Qp(i,e)}function Ax(i,e,r){return!!hl(i,e)||!!ef(e,i,r)}function hy(i,e){if(i.length===1)return py(e,i[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let u=0;u<a.length;u++)if(hl(i,a[u]))return!0}for(let r=0;r<i.length;r++)if(py(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Qp(i,e[r]))return!0;return!1}function zx(i,e,r){if(i.length>1){if(Qp(i,e))return!0;for(let a=0;a<e.length;a++)if(ef(e[a],i,r))return!0}for(let a=0;a<i.length;a++)if(ef(i[a],e,r))return!0;return!1}function Qp(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const a=i[r],u=i[r+1];for(let f=0;f<e.length-1;f++)if(Dx(a,u,e[f],e[f+1]))return!0}return!1}function Dx(i,e,r,a){return ei(i,r,a)!==ei(e,r,a)&&ei(i,e,r)!==ei(i,e,a)}function ef(i,e,r){const a=r*r;if(e.length===1)return i.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(dy(i,e[u-1],e[u])<a)return!0;return!1}function dy(i,e,r){const a=e.distSqr(r);if(a===0)return i.distSqr(e);const u=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/a;return i.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function py(i,e){let r,a,u,f=!1;for(let y=0;y<i.length;y++){r=i[y];for(let _=0,w=r.length-1;_<r.length;w=_++)a=r[_],u=r[w],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(f=!f)}return f}function hl(i,e){let r=!1;for(let a=0,u=i.length-1;a<i.length;u=a++){const f=i[a],y=i[u];f.y>e.y!=y.y>e.y&&e.x<(y.x-f.x)*(e.y-f.y)/(y.y-f.y)+f.x&&(r=!r)}return r}function Lx(i,e,r){const a=r[0],u=r[2];if(i.x<a.x&&e.x<a.x||i.x>u.x&&e.x>u.x||i.y<a.y&&e.y<a.y||i.y>u.y&&e.y>u.y)return!1;const f=ei(i,e,r[0]);return f!==ei(i,e,r[1])||f!==ei(i,e,r[2])||f!==ei(i,e,r[3])}function Gc(i,e,r){const a=e.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Uh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function $h(i,e,r,a,u){if(!e[0]&&!e[1])return i;const f=X.convert(e)._mult(u);r==="viewport"&&f._rotate(-a);const y=[];for(let _=0;_<i.length;_++)y.push(i[_].sub(f));return y}let fy,my;We("CircleBucket",Jp,{omit:["layers"]});var Rx={get paint(){return my=my||new l({"circle-radius":new lt(ye.paint_circle["circle-radius"]),"circle-color":new lt(ye.paint_circle["circle-color"]),"circle-blur":new lt(ye.paint_circle["circle-blur"]),"circle-opacity":new lt(ye.paint_circle["circle-opacity"]),"circle-translate":new et(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new et(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new et(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new et(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new lt(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new lt(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new lt(ye.paint_circle["circle-stroke-opacity"])})},get layout(){return fy=fy||new l({"circle-sort-key":new lt(ye.layout_circle["circle-sort-key"])})}},xn=1e-6,dl=typeof Float32Array<"u"?Float32Array:Array;function tf(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function gy(i,e,r){var a=e[0],u=e[1],f=e[2],y=e[3],_=e[4],w=e[5],I=e[6],C=e[7],P=e[8],z=e[9],L=e[10],B=e[11],j=e[12],q=e[13],Y=e[14],ue=e[15],ee=r[0],le=r[1],ge=r[2],Se=r[3];return i[0]=ee*a+le*_+ge*P+Se*j,i[1]=ee*u+le*w+ge*z+Se*q,i[2]=ee*f+le*I+ge*L+Se*Y,i[3]=ee*y+le*C+ge*B+Se*ue,i[4]=(ee=r[4])*a+(le=r[5])*_+(ge=r[6])*P+(Se=r[7])*j,i[5]=ee*u+le*w+ge*z+Se*q,i[6]=ee*f+le*I+ge*L+Se*Y,i[7]=ee*y+le*C+ge*B+Se*ue,i[8]=(ee=r[8])*a+(le=r[9])*_+(ge=r[10])*P+(Se=r[11])*j,i[9]=ee*u+le*w+ge*z+Se*q,i[10]=ee*f+le*I+ge*L+Se*Y,i[11]=ee*y+le*C+ge*B+Se*ue,i[12]=(ee=r[12])*a+(le=r[13])*_+(ge=r[14])*P+(Se=r[15])*j,i[13]=ee*u+le*w+ge*z+Se*q,i[14]=ee*f+le*I+ge*L+Se*Y,i[15]=ee*y+le*C+ge*B+Se*ue,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Wc,Fx=gy;function Zh(i,e,r){var a=e[0],u=e[1],f=e[2],y=e[3];return i[0]=r[0]*a+r[4]*u+r[8]*f+r[12]*y,i[1]=r[1]*a+r[5]*u+r[9]*f+r[13]*y,i[2]=r[2]*a+r[6]*u+r[10]*f+r[14]*y,i[3]=r[3]*a+r[7]*u+r[11]*f+r[15]*y,i}Wc=new dl(4),dl!=Float32Array&&(Wc[0]=0,Wc[1]=0,Wc[2]=0,Wc[3]=0);class Bx extends g{constructor(e){super(e,Rx)}createBucket(e){return new Jp(e)}queryRadius(e){const r=e;return Gc("circle-radius",this,r)+Gc("circle-stroke-width",this,r)+Uh(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,a,u,f,y,_,w){const I=$h(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,_),C=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),P=this.paint.get("circle-pitch-alignment")==="map",z=P?I:function(B,j){return B.map(q=>yy(q,j))}(I,w),L=P?C*_:C;for(const B of u)for(const j of B){const q=P?j:yy(j,w);let Y=L;const ue=Zh([],[j.x,j.y,0,1],w);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Y*=ue[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Y*=y.cameraToCenterDistance/ue[3]),Ax(z,q,Y))return!0}return!1}}function yy(i,e){const r=Zh([],[i.x,i.y,0,1],e);return new X(r[0]/r[3],r[1]/r[3])}class _y extends Jp{}let vy;We("HeatmapBucket",_y,{omit:["layers"]});var Ox={get paint(){return vy=vy||new l({"heatmap-radius":new lt(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new lt(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new et(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new s(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new et(ye.paint_heatmap["heatmap-opacity"])})}};function nf(i,{width:e,height:r},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*a)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*r*a}`)}else u=new Uint8Array(e*r*a);return i.width=e,i.height=r,i.data=u,i}function xy(i,{width:e,height:r},a){if(e===i.width&&r===i.height)return;const u=nf({},{width:e,height:r},a);rf(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},a),i.width=e,i.height=r,i.data=u.data}function rf(i,e,r,a,u,f){if(u.width===0||u.height===0)return e;if(u.width>i.width||u.height>i.height||r.x>i.width-u.width||r.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,_=e.data;if(y===_)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<u.height;w++){const I=((r.y+w)*i.width+r.x)*f,C=((a.y+w)*e.width+a.x)*f;for(let P=0;P<u.width*f;P++)_[C+P]=y[I+P]}return e}class Hc{constructor(e,r){nf(this,e,1,r)}resize(e){xy(this,e,1)}clone(){return new Hc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,f){rf(e,r,a,u,f,1)}}class nr{constructor(e,r){nf(this,e,4,r)}resize(e){xy(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new nr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,f){rf(e,r,a,u,f,4)}}function wy(i){const e={},r=i.resolution||256,a=i.clips?i.clips.length:1,u=i.image||new nr({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const f=(y,_,w)=>{e[i.evaluationKey]=w;const I=i.expression.evaluate(e);u.data[y+_+0]=Math.floor(255*I.r/I.a),u.data[y+_+1]=Math.floor(255*I.g/I.a),u.data[y+_+2]=Math.floor(255*I.b/I.a),u.data[y+_+3]=Math.floor(255*I.a)};if(i.clips)for(let y=0,_=0;y<a;++y,_+=4*r)for(let w=0,I=0;w<r;w++,I+=4){const C=w/(r-1),{start:P,end:z}=i.clips[y];f(_,I,P*(1-C)+z*C)}else for(let y=0,_=0;y<r;y++,_+=4)f(0,_,y/(r-1));return u}We("AlphaImage",Hc),We("RGBAImage",nr);class Nx extends g{createBucket(e){return new _y(e)}constructor(e){super(e,Ox),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let by;var jx={get paint(){return by=by||new l({"hillshade-illumination-direction":new et(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new et(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new et(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new et(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new et(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new et(ye.paint_hillshade["hillshade-accent-color"])})}};class Vx extends g{constructor(e){super(e,jx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Ux=E([{name:"a_pos",components:2,type:"Int16"}],4),{members:$x}=Ux;var of={exports:{}};function qh(i,e,r){r=r||2;var a,u,f,y,_,w,I,C=e&&e.length,P=C?e[0]*r:i.length,z=Sy(i,0,P,r,!0),L=[];if(!z||z.next===z.prev)return L;if(C&&(z=function(j,q,Y,ue){var ee,le,ge,Se=[];for(ee=0,le=q.length;ee<le;ee++)(ge=Sy(j,q[ee]*ue,ee<le-1?q[ee+1]*ue:j.length,ue,!1))===ge.next&&(ge.steiner=!0),Se.push(Yx(ge));for(Se.sort(Hx),ee=0;ee<Se.length;ee++)Y=Kx(Se[ee],Y);return Y}(i,e,z,r)),i.length>80*r){a=f=i[0],u=y=i[1];for(var B=r;B<P;B+=r)(_=i[B])<a&&(a=_),(w=i[B+1])<u&&(u=w),_>f&&(f=_),w>y&&(y=w);I=(I=Math.max(f-a,y-u))!==0?32767/I:0}return Kc(z,L,r,a,u,I,0),L}function Sy(i,e,r,a,u){var f,y;if(u===lf(i,e,r,a)>0)for(f=e;f<r;f+=a)y=Iy(f,i[f],i[f+1],y);else for(f=r-a;f>=e;f-=a)y=Iy(f,i[f],i[f+1],y);return y&&Gh(y,y.next)&&(Yc(y),y=y.next),y}function aa(i,e){if(!i)return i;e||(e=i);var r,a=i;do if(r=!1,a.steiner||!Gh(a,a.next)&&gi(a.prev,a,a.next)!==0)a=a.next;else{if(Yc(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function Kc(i,e,r,a,u,f,y){if(i){!y&&f&&function(C,P,z,L){var B=C;do B.z===0&&(B.z=sf(B.x,B.y,P,z,L)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==C);B.prevZ.nextZ=null,B.prevZ=null,function(j){var q,Y,ue,ee,le,ge,Se,Oe,st=1;do{for(Y=j,j=null,le=null,ge=0;Y;){for(ge++,ue=Y,Se=0,q=0;q<st&&(Se++,ue=ue.nextZ);q++);for(Oe=st;Se>0||Oe>0&&ue;)Se!==0&&(Oe===0||!ue||Y.z<=ue.z)?(ee=Y,Y=Y.nextZ,Se--):(ee=ue,ue=ue.nextZ,Oe--),le?le.nextZ=ee:j=ee,ee.prevZ=le,le=ee;Y=ue}le.nextZ=null,st*=2}while(ge>1)}(B)}(i,a,u,f);for(var _,w,I=i;i.prev!==i.next;)if(_=i.prev,w=i.next,f?qx(i,a,u,f):Zx(i))e.push(_.i/r|0),e.push(i.i/r|0),e.push(w.i/r|0),Yc(i),i=w.next,I=w.next;else if((i=w)===I){y?y===1?Kc(i=Gx(aa(i),e,r),e,r,a,u,f,2):y===2&&Wx(i,e,r,a,u,f):Kc(aa(i),e,r,a,u,f,1);break}}}function Zx(i){var e=i.prev,r=i,a=i.next;if(gi(e,r,a)>=0)return!1;for(var u=e.x,f=r.x,y=a.x,_=e.y,w=r.y,I=a.y,C=u<f?u<y?u:y:f<y?f:y,P=_<w?_<I?_:I:w<I?w:I,z=u>f?u>y?u:y:f>y?f:y,L=_>w?_>I?_:I:w>I?w:I,B=a.next;B!==e;){if(B.x>=C&&B.x<=z&&B.y>=P&&B.y<=L&&pl(u,_,f,w,y,I,B.x,B.y)&&gi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function qx(i,e,r,a){var u=i.prev,f=i,y=i.next;if(gi(u,f,y)>=0)return!1;for(var _=u.x,w=f.x,I=y.x,C=u.y,P=f.y,z=y.y,L=_<w?_<I?_:I:w<I?w:I,B=C<P?C<z?C:z:P<z?P:z,j=_>w?_>I?_:I:w>I?w:I,q=C>P?C>z?C:z:P>z?P:z,Y=sf(L,B,e,r,a),ue=sf(j,q,e,r,a),ee=i.prevZ,le=i.nextZ;ee&&ee.z>=Y&&le&&le.z<=ue;){if(ee.x>=L&&ee.x<=j&&ee.y>=B&&ee.y<=q&&ee!==u&&ee!==y&&pl(_,C,w,P,I,z,ee.x,ee.y)&&gi(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,le.x>=L&&le.x<=j&&le.y>=B&&le.y<=q&&le!==u&&le!==y&&pl(_,C,w,P,I,z,le.x,le.y)&&gi(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;ee&&ee.z>=Y;){if(ee.x>=L&&ee.x<=j&&ee.y>=B&&ee.y<=q&&ee!==u&&ee!==y&&pl(_,C,w,P,I,z,ee.x,ee.y)&&gi(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;le&&le.z<=ue;){if(le.x>=L&&le.x<=j&&le.y>=B&&le.y<=q&&le!==u&&le!==y&&pl(_,C,w,P,I,z,le.x,le.y)&&gi(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function Gx(i,e,r){var a=i;do{var u=a.prev,f=a.next.next;!Gh(u,f)&&Ty(u,a,a.next,f)&&Xc(u,f)&&Xc(f,u)&&(e.push(u.i/r|0),e.push(a.i/r|0),e.push(f.i/r|0),Yc(a),Yc(a.next),a=i=f),a=a.next}while(a!==i);return aa(a)}function Wx(i,e,r,a,u,f){var y=i;do{for(var _=y.next.next;_!==y.prev;){if(y.i!==_.i&&Jx(y,_)){var w=ky(y,_);return y=aa(y,y.next),w=aa(w,w.next),Kc(y,e,r,a,u,f,0),void Kc(w,e,r,a,u,f,0)}_=_.next}y=y.next}while(y!==i)}function Hx(i,e){return i.x-e.x}function Kx(i,e){var r=function(u,f){var y,_=f,w=u.x,I=u.y,C=-1/0;do{if(I<=_.y&&I>=_.next.y&&_.next.y!==_.y){var P=_.x+(I-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(P<=w&&P>C&&(C=P,y=_.x<_.next.x?_:_.next,P===w))return y}_=_.next}while(_!==f);if(!y)return null;var z,L=y,B=y.x,j=y.y,q=1/0;_=y;do w>=_.x&&_.x>=B&&w!==_.x&&pl(I<j?w:C,I,B,j,I<j?C:w,I,_.x,_.y)&&(z=Math.abs(I-_.y)/(w-_.x),Xc(_,u)&&(z<q||z===q&&(_.x>y.x||_.x===y.x&&Xx(y,_)))&&(y=_,q=z)),_=_.next;while(_!==L);return y}(i,e);if(!r)return e;var a=ky(r,i);return aa(a,a.next),aa(r,r.next)}function Xx(i,e){return gi(i.prev,i,e.prev)<0&&gi(e.next,i,i.next)<0}function sf(i,e,r,a,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Yx(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function pl(i,e,r,a,u,f,y,_){return(u-y)*(e-_)>=(i-y)*(f-_)&&(i-y)*(a-_)>=(r-y)*(e-_)&&(r-y)*(f-_)>=(u-y)*(a-_)}function Jx(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,a){var u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==a.i&&u.next.i!==a.i&&Ty(u,u.next,r,a))return!0;u=u.next}while(u!==r);return!1}(i,e)&&(Xc(i,e)&&Xc(e,i)&&function(r,a){var u=r,f=!1,y=(r.x+a.x)/2,_=(r.y+a.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&y<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==r);return f}(i,e)&&(gi(i.prev,i,e.prev)||gi(i,e.prev,e))||Gh(i,e)&&gi(i.prev,i,i.next)>0&&gi(e.prev,e,e.next)>0)}function gi(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Gh(i,e){return i.x===e.x&&i.y===e.y}function Ty(i,e,r,a){var u=Hh(gi(i,e,r)),f=Hh(gi(i,e,a)),y=Hh(gi(r,a,i)),_=Hh(gi(r,a,e));return u!==f&&y!==_||!(u!==0||!Wh(i,r,e))||!(f!==0||!Wh(i,a,e))||!(y!==0||!Wh(r,i,a))||!(_!==0||!Wh(r,e,a))}function Wh(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Hh(i){return i>0?1:i<0?-1:0}function Xc(i,e){return gi(i.prev,i,i.next)<0?gi(i,e,i.next)>=0&&gi(i,i.prev,e)>=0:gi(i,e,i.prev)<0||gi(i,i.next,e)<0}function ky(i,e){var r=new af(i.i,i.x,i.y),a=new af(e.i,e.x,e.y),u=i.next,f=e.prev;return i.next=e,e.prev=i,r.next=u,u.prev=r,a.next=r,r.prev=a,f.next=a,a.prev=f,a}function Iy(i,e,r,a){var u=new af(i,e,r);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Yc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function af(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function lf(i,e,r,a){for(var u=0,f=e,y=r-a;f<r;f+=a)u+=(i[y]-i[f])*(i[f+1]+i[y+1]),y=f;return u}of.exports=qh,of.exports.default=qh,qh.deviation=function(i,e,r,a){var u=e&&e.length,f=Math.abs(lf(i,0,u?e[0]*r:i.length,r));if(u)for(var y=0,_=e.length;y<_;y++)f-=Math.abs(lf(i,e[y]*r,y<_-1?e[y+1]*r:i.length,r));var w=0;for(y=0;y<a.length;y+=3){var I=a[y]*r,C=a[y+1]*r,P=a[y+2]*r;w+=Math.abs((i[I]-i[P])*(i[C+1]-i[I+1])-(i[I]-i[C])*(i[P+1]-i[I+1]))}return f===0&&w===0?0:Math.abs((w-f)/f)},qh.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,u=0;u<i.length;u++){for(var f=0;f<i[u].length;f++)for(var y=0;y<e;y++)r.vertices.push(i[u][f][y]);u>0&&r.holes.push(a+=i[u-1].length)}return r};var Cy=$(of.exports);function cf(i,e,r){const a=r.patternDependencies;let u=!1;for(const f of e){const y=f.paint.get(`${i}-pattern`);y.isConstant()||(u=!0);const _=y.constantOr(null);_&&(u=!0,a[_.to]=!0,a[_.from]=!0)}return u}function uf(i,e,r,a,u){const f=u.patternDependencies;for(const y of e){const _=y.paint.get(`${i}-pattern`).value;if(_.kind!=="constant"){let w=_.evaluate({zoom:a-1},r,{},u.availableImages),I=_.evaluate({zoom:a},r,{},u.availableImages),C=_.evaluate({zoom:a+1},r,{},u.availableImages);w=w&&w.name?w.name:w,I=I&&I.name?I.name:I,C=C&&C.name?C.name:C,f[w]=!0,f[I]=!0,f[C]=!0,r.patterns[y.id]={min:w,mid:I,max:C}}}return r}class hf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rs,this.indexArray=new Ai,this.indexArray2=new ni,this.programConfigurations=new ra(e.layers,e.zoom),this.segments=new Ci,this.segments2=new Ci,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=cf("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),f=!u.isConstant(),y=[];for(const{feature:_,id:w,index:I,sourceLayerIndex:C}of e){const P=this.layers[0]._featureFilter.needGeometry,z=sa(_,P);if(!this.layers[0]._featureFilter.filter(new Zt(this.zoom),z,a))continue;const L=f?u.evaluate(z,{},a,r.availableImages):void 0,B={id:w,properties:_.properties,type:_.type,sourceLayerIndex:C,index:I,geometry:P?z.geometry:oa(_),patterns:{},sortKey:L};y.push(B)}f&&y.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of y){const{geometry:w,index:I,sourceLayerIndex:C}=_;if(this.hasPattern){const P=uf("fill",this.layers,_,this.zoom,r);this.patternFeatures.push(P)}else this.addFeature(_,w,I,a,{});r.featureIndex.insert(e[I].feature,w,I,C,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$x),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,u,f){for(const y of Ba(r,500)){let _=0;for(const L of y)_+=L.length;const w=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),I=w.vertexLength,C=[],P=[];for(const L of y){if(L.length===0)continue;L!==y[0]&&P.push(C.length/2);const B=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),j=B.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(j+L.length-1,j),C.push(L[0].x),C.push(L[0].y);for(let q=1;q<L.length;q++)this.layoutVertexArray.emplaceBack(L[q].x,L[q].y),this.indexArray2.emplaceBack(j+q-1,j+q),C.push(L[q].x),C.push(L[q].y);B.vertexLength+=L.length,B.primitiveLength+=L.length}const z=Cy(C,P);for(let L=0;L<z.length;L+=3)this.indexArray.emplaceBack(I+z[L],I+z[L+1],I+z[L+2]);w.vertexLength+=_,w.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,u)}}let Ey,Py;We("FillBucket",hf,{omit:["layers","patternFeatures"]});var Qx={get paint(){return Py=Py||new l({"fill-antialias":new et(ye.paint_fill["fill-antialias"]),"fill-opacity":new lt(ye.paint_fill["fill-opacity"]),"fill-color":new lt(ye.paint_fill["fill-color"]),"fill-outline-color":new lt(ye.paint_fill["fill-outline-color"]),"fill-translate":new et(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new et(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new m(ye.paint_fill["fill-pattern"])})},get layout(){return Ey=Ey||new l({"fill-sort-key":new lt(ye.layout_fill["fill-sort-key"])})}};class ew extends g{constructor(e){super(e,Qx)}recalculate(e,r){super.recalculate(e,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new hf(e)}queryRadius(){return Uh(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,a,u,f,y,_){return hy($h(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,_),u)}isTileClipped(){return!0}}const tw=E([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),iw=E([{name:"a_centroid",components:2,type:"Int16"}],4),{members:nw}=tw;var cs={},rw=ie,My=fl;function fl(i,e,r,a,u){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=u,i.readFields(ow,this,e)}function ow(i,e,r){i==1?e.id=r.readVarint():i==2?function(a,u){for(var f=a.readVarint()+a.pos;a.pos<f;){var y=u._keys[a.readVarint()],_=u._values[a.readVarint()];u.properties[y]=_}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function sw(i){for(var e,r,a=0,u=0,f=i.length,y=f-1;u<f;y=u++)a+=((r=i[y]).x-(e=i[u]).x)*(e.y+r.y);return a}fl.types=["Unknown","Point","LineString","Polygon"],fl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,a=1,u=0,f=0,y=0,_=[];i.pos<r;){if(u<=0){var w=i.readVarint();a=7&w,u=w>>3}if(u--,a===1||a===2)f+=i.readSVarint(),y+=i.readSVarint(),a===1&&(e&&_.push(e),e=[]),e.push(new rw(f,y));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&_.push(e),_},fl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,a=0,u=0,f=0,y=1/0,_=-1/0,w=1/0,I=-1/0;i.pos<e;){if(a<=0){var C=i.readVarint();r=7&C,a=C>>3}if(a--,r===1||r===2)(u+=i.readSVarint())<y&&(y=u),u>_&&(_=u),(f+=i.readSVarint())<w&&(w=f),f>I&&(I=f);else if(r!==7)throw new Error("unknown command "+r)}return[y,w,_,I]},fl.prototype.toGeoJSON=function(i,e,r){var a,u,f=this.extent*Math.pow(2,r),y=this.extent*i,_=this.extent*e,w=this.loadGeometry(),I=fl.types[this.type];function C(L){for(var B=0;B<L.length;B++){var j=L[B];L[B]=[360*(j.x+y)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+_)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<w.length;a++)P[a]=w[a][0];C(w=P);break;case 2:for(a=0;a<w.length;a++)C(w[a]);break;case 3:for(w=function(L){var B=L.length;if(B<=1)return[L];for(var j,q,Y=[],ue=0;ue<B;ue++){var ee=sw(L[ue]);ee!==0&&(q===void 0&&(q=ee<0),q===ee<0?(j&&Y.push(j),j=[L[ue]]):j.push(L[ue]))}return j&&Y.push(j),Y}(w),a=0;a<w.length;a++)for(u=0;u<w[a].length;u++)C(w[a][u])}w.length===1?w=w[0]:I="Multi"+I;var z={type:"Feature",geometry:{type:I,coordinates:w},properties:this.properties};return"id"in this&&(z.id=this.id),z};var aw=My,Ay=zy;function zy(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(lw,this,e),this.length=this._features.length}function lw(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(a){for(var u=null,f=a.readVarint()+a.pos;a.pos<f;){var y=a.readVarint()>>3;u=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return u}(r))}zy.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new aw(this._pbf,e,this.extent,this._keys,this._values)};var cw=Ay;function uw(i,e,r){if(i===3){var a=new cw(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}cs.VectorTile=function(i,e){this.layers=i.readFields(uw,{},e)},cs.VectorTileFeature=My,cs.VectorTileLayer=Ay;const hw=cs.VectorTileFeature.types,df=Math.pow(2,13);function Jc(i,e,r,a,u,f,y,_){i.emplaceBack(e,r,2*Math.floor(a*df)+y,u*df*2,f*df*2,Math.round(_))}class pf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new So,this.centroidVertexArray=new bo,this.indexArray=new Ai,this.programConfigurations=new ra(e.layers,e.zoom),this.segments=new Ci,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.features=[],this.hasPattern=cf("fill-extrusion",this.layers,r);for(const{feature:u,id:f,index:y,sourceLayerIndex:_}of e){const w=this.layers[0]._featureFilter.needGeometry,I=sa(u,w);if(!this.layers[0]._featureFilter.filter(new Zt(this.zoom),I,a))continue;const C={id:f,sourceLayerIndex:_,index:y,geometry:w?I.geometry:oa(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(uf("fill-extrusion",this.layers,C,this.zoom,r)):this.addFeature(C,C.geometry,y,a,{}),r.featureIndex.insert(u,C.geometry,y,_,this.index,!0)}}addFeatures(e,r,a){for(const u of this.features){const{geometry:f}=u;this.addFeature(u,f,u.index,r,a)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nw),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,iw.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,a,u,f){for(const y of Ba(r,500)){const _={x:0,y:0,vertexCount:0};let w=0;for(const B of y)w+=B.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of y){if(B.length===0||pw(B))continue;let j=0;for(let q=0;q<B.length;q++){const Y=B[q];if(q>=1){const ue=B[q-1];if(!dw(Y,ue)){I.vertexLength+4>Ci.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ee=Y.sub(ue)._perp()._unit(),le=ue.dist(Y);j+le>32768&&(j=0),Jc(this.layoutVertexArray,Y.x,Y.y,ee.x,ee.y,0,0,j),Jc(this.layoutVertexArray,Y.x,Y.y,ee.x,ee.y,0,1,j),_.x+=2*Y.x,_.y+=2*Y.y,_.vertexCount+=2,j+=le,Jc(this.layoutVertexArray,ue.x,ue.y,ee.x,ee.y,0,0,j),Jc(this.layoutVertexArray,ue.x,ue.y,ee.x,ee.y,0,1,j),_.x+=2*ue.x,_.y+=2*ue.y,_.vertexCount+=2;const ge=I.vertexLength;this.indexArray.emplaceBack(ge,ge+2,ge+1),this.indexArray.emplaceBack(ge+1,ge+2,ge+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+w>Ci.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray)),hw[e.type]!=="Polygon")continue;const C=[],P=[],z=I.vertexLength;for(const B of y)if(B.length!==0){B!==y[0]&&P.push(C.length/2);for(let j=0;j<B.length;j++){const q=B[j];Jc(this.layoutVertexArray,q.x,q.y,0,0,1,1,0),_.x+=q.x,_.y+=q.y,_.vertexCount+=1,C.push(q.x),C.push(q.y)}}const L=Cy(C,P);for(let B=0;B<L.length;B+=3)this.indexArray.emplaceBack(z+L[B],z+L[B+2],z+L[B+1]);I.primitiveLength+=L.length/3,I.vertexLength+=w;for(let B=0;B<_.vertexCount;B++){const j=Math.floor(_.x/_.vertexCount),q=Math.floor(_.y/_.vertexCount);this.centroidVertexArray.emplaceBack(j,q)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,u)}}function dw(i,e){return i.x===e.x&&(i.x<0||i.x>Si)||i.y===e.y&&(i.y<0||i.y>Si)}function pw(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Si)||i.every(e=>e.y<0)||i.every(e=>e.y>Si)}let Dy;We("FillExtrusionBucket",pf,{omit:["layers","features"]});var fw={get paint(){return Dy=Dy||new l({"fill-extrusion-opacity":new et(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new lt(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new et(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new et(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new m(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new lt(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new lt(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new et(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class mw extends g{constructor(e){super(e,fw)}createBucket(e){return new pf(e)}queryRadius(){return Uh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,a,u,f,y,_,w){const I=$h(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,_),C=this.paint.get("fill-extrusion-height").evaluate(r,a),P=this.paint.get("fill-extrusion-base").evaluate(r,a),z=function(B,j,q,Y){const ue=[];for(const ee of B){const le=[ee.x,ee.y,0,1];Zh(le,le,j),ue.push(new X(le[0]/le[3],le[1]/le[3]))}return ue}(I,w),L=function(B,j,q,Y){const ue=[],ee=[],le=Y[8]*j,ge=Y[9]*j,Se=Y[10]*j,Oe=Y[11]*j,st=Y[8]*q,je=Y[9]*q,Fe=Y[10]*q,Qe=Y[11]*q;for(const He of B){const Ge=[],xe=[];for(const tt of He){const Je=tt.x,ut=tt.y,$t=Y[0]*Je+Y[4]*ut+Y[12],Vt=Y[1]*Je+Y[5]*ut+Y[13],zi=Y[2]*Je+Y[6]*ut+Y[14],_r=Y[3]*Je+Y[7]*ut+Y[15],Yi=zi+Se,pi=_r+Oe,wn=$t+st,bn=Vt+je,Sn=zi+Fe,fi=_r+Qe,Di=new X(($t+le)/pi,(Vt+ge)/pi);Di.z=Yi/pi,Ge.push(Di);const an=new X(wn/fi,bn/fi);an.z=Sn/fi,xe.push(an)}ue.push(Ge),ee.push(xe)}return[ue,ee]}(u,P,C,w);return function(B,j,q){let Y=1/0;hy(q,j)&&(Y=Ly(q,j[0]));for(let ue=0;ue<j.length;ue++){const ee=j[ue],le=B[ue];for(let ge=0;ge<ee.length-1;ge++){const Se=ee[ge],Oe=[Se,ee[ge+1],le[ge+1],le[ge],Se];uy(q,Oe)&&(Y=Math.min(Y,Ly(q,Oe)))}}return Y!==1/0&&Y}(L[0],L[1],z)}}function Qc(i,e){return i.x*e.x+i.y*e.y}function Ly(i,e){if(i.length===1){let r=0;const a=e[r++];let u;for(;!u||a.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const f=e[r],y=i[0],_=u.sub(a),w=f.sub(a),I=y.sub(a),C=Qc(_,_),P=Qc(_,w),z=Qc(w,w),L=Qc(I,_),B=Qc(I,w),j=C*z-P*P,q=(z*L-P*B)/j,Y=(C*B-P*L)/j,ue=a.z*(1-q-Y)+u.z*q+f.z*Y;if(isFinite(ue))return ue}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}const gw=E([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:yw}=gw,_w=E([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:vw}=_w,xw=cs.VectorTileFeature.types,ww=Math.cos(Math.PI/180*37.5),Ry=Math.pow(2,14)/.5;class ff{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new sl,this.layoutVertexArray2=new jc,this.indexArray=new Ai,this.programConfigurations=new ra(e.layers,e.zoom),this.segments=new Ci,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=cf("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),f=!u.isConstant(),y=[];for(const{feature:_,id:w,index:I,sourceLayerIndex:C}of e){const P=this.layers[0]._featureFilter.needGeometry,z=sa(_,P);if(!this.layers[0]._featureFilter.filter(new Zt(this.zoom),z,a))continue;const L=f?u.evaluate(z,{},a):void 0,B={id:w,properties:_.properties,type:_.type,sourceLayerIndex:C,index:I,geometry:P?z.geometry:oa(_),patterns:{},sortKey:L};y.push(B)}f&&y.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of y){const{geometry:w,index:I,sourceLayerIndex:C}=_;if(this.hasPattern){const P=uf("line",this.layers,_,this.zoom,r);this.patternFeatures.push(P)}else this.addFeature(_,w,I,a,{});r.featureIndex.insert(e[I].feature,w,I,C,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,vw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yw),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,u,f){const y=this.layers[0].layout,_=y.get("line-join").evaluate(e,{}),w=y.get("line-cap"),I=y.get("line-miter-limit"),C=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of r)this.addLine(P,e,_,w,I,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,u)}addLine(e,r,a,u,f,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=xw[r.type]==="Polygon";let w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let I=0;for(;I<w-1&&e[I].equals(e[I+1]);)I++;if(w<(_?3:2))return;a==="bevel"&&(f=1.05);const C=this.overscaling<=16?15*Si/(512*this.overscaling):0,P=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let z,L,B,j,q;this.e1=this.e2=-1,_&&(z=e[w-2],q=e[I].sub(z)._unit()._perp());for(let Y=I;Y<w;Y++){if(B=Y===w-1?_?e[I+1]:void 0:e[Y+1],B&&e[Y].equals(B))continue;q&&(j=q),z&&(L=z),z=e[Y],q=B?B.sub(z)._unit()._perp():j,j=j||q;let ue=j.add(q);ue.x===0&&ue.y===0||ue._unit();const ee=j.x*q.x+j.y*q.y,le=ue.x*q.x+ue.y*q.y,ge=le!==0?1/le:1/0,Se=2*Math.sqrt(2-2*le),Oe=le<ww&&L&&B,st=j.x*q.y-j.y*q.x>0;if(Oe&&Y>I){const Qe=z.dist(L);if(Qe>2*C){const He=z.sub(z.sub(L)._mult(C/Qe)._round());this.updateDistance(L,He),this.addCurrentVertex(He,j,0,0,P),L=He}}const je=L&&B;let Fe=je?a:_?"butt":u;if(je&&Fe==="round"&&(ge<y?Fe="miter":ge<=2&&(Fe="fakeround")),Fe==="miter"&&ge>f&&(Fe="bevel"),Fe==="bevel"&&(ge>2&&(Fe="flipbevel"),ge<f&&(Fe="miter")),L&&this.updateDistance(L,z),Fe==="miter")ue._mult(ge),this.addCurrentVertex(z,ue,0,0,P);else if(Fe==="flipbevel"){if(ge>100)ue=q.mult(-1);else{const Qe=ge*j.add(q).mag()/j.sub(q).mag();ue._perp()._mult(Qe*(st?-1:1))}this.addCurrentVertex(z,ue,0,0,P),this.addCurrentVertex(z,ue.mult(-1),0,0,P)}else if(Fe==="bevel"||Fe==="fakeround"){const Qe=-Math.sqrt(ge*ge-1),He=st?Qe:0,Ge=st?0:Qe;if(L&&this.addCurrentVertex(z,j,He,Ge,P),Fe==="fakeround"){const xe=Math.round(180*Se/Math.PI/20);for(let tt=1;tt<xe;tt++){let Je=tt/xe;if(Je!==.5){const $t=Je-.5;Je+=Je*$t*(Je-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*$t*$t+(.848013+ee*(.215638*ee-1.06021)))}const ut=q.sub(j)._mult(Je)._add(j)._unit()._mult(st?-1:1);this.addHalfVertex(z,ut.x,ut.y,!1,st,0,P)}}B&&this.addCurrentVertex(z,q,-He,-Ge,P)}else if(Fe==="butt")this.addCurrentVertex(z,ue,0,0,P);else if(Fe==="square"){const Qe=L?1:-1;this.addCurrentVertex(z,ue,Qe,Qe,P)}else Fe==="round"&&(L&&(this.addCurrentVertex(z,j,0,0,P),this.addCurrentVertex(z,j,1,1,P,!0)),B&&(this.addCurrentVertex(z,q,-1,-1,P,!0),this.addCurrentVertex(z,q,0,0,P)));if(Oe&&Y<w-1){const Qe=z.dist(B);if(Qe>2*C){const He=z.add(B.sub(z)._mult(C/Qe)._round());this.updateDistance(z,He),this.addCurrentVertex(He,q,0,0,P),z=He}}}}addCurrentVertex(e,r,a,u,f,y=!1){const _=r.y*u-r.x,w=-r.y-r.x*u;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,y,!1,a,f),this.addHalfVertex(e,_,w,y,!0,-u,f),this.distance>Ry/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,a,u,f,y))}addHalfVertex({x:e,y:r},a,u,f,y,_,w){const I=.5*(this.lineClips?this.scaledDistance*(Ry-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(r<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),w.primitiveLength++),y?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let Fy,By;We("LineBucket",ff,{omit:["layers","patternFeatures"]});var Oy={get paint(){return By=By||new l({"line-opacity":new lt(ye.paint_line["line-opacity"]),"line-color":new lt(ye.paint_line["line-color"]),"line-translate":new et(ye.paint_line["line-translate"]),"line-translate-anchor":new et(ye.paint_line["line-translate-anchor"]),"line-width":new lt(ye.paint_line["line-width"]),"line-gap-width":new lt(ye.paint_line["line-gap-width"]),"line-offset":new lt(ye.paint_line["line-offset"]),"line-blur":new lt(ye.paint_line["line-blur"]),"line-dasharray":new t(ye.paint_line["line-dasharray"]),"line-pattern":new m(ye.paint_line["line-pattern"]),"line-gradient":new s(ye.paint_line["line-gradient"])})},get layout(){return Fy=Fy||new l({"line-cap":new et(ye.layout_line["line-cap"]),"line-join":new lt(ye.layout_line["line-join"]),"line-miter-limit":new et(ye.layout_line["line-miter-limit"]),"line-round-limit":new et(ye.layout_line["line-round-limit"]),"line-sort-key":new lt(ye.layout_line["line-sort-key"])})}};class bw extends lt{possiblyEvaluate(e,r){return r=new Zt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,a,u){return r=$e({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,a,u)}}let Kh;class Sw extends g{constructor(e){super(e,Oy),this.gradientVersion=0,Kh||(Kh=new bw(Oy.paint.properties["line-width"].specification),Kh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Vs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Kh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new ff(e)}queryRadius(e){const r=e,a=Ny(Gc("line-width",this,r),Gc("line-gap-width",this,r)),u=Gc("line-offset",this,r);return a/2+Math.abs(u)+Uh(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,a,u,f,y,_){const w=$h(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,_),I=_/2*Ny(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),C=this.paint.get("line-offset").evaluate(r,a);return C&&(u=function(P,z){const L=[];for(let B=0;B<P.length;B++){const j=P[B],q=[];for(let Y=0;Y<j.length;Y++){const ue=j[Y-1],ee=j[Y],le=j[Y+1],ge=Y===0?new X(0,0):ee.sub(ue)._unit()._perp(),Se=Y===j.length-1?new X(0,0):le.sub(ee)._unit()._perp(),Oe=ge._add(Se)._unit(),st=Oe.x*Se.x+Oe.y*Se.y;st!==0&&Oe._mult(1/st),q.push(Oe._mult(z)._add(ee))}L.push(q)}return L}(u,C*_)),function(P,z,L){for(let B=0;B<z.length;B++){const j=z[B];if(P.length>=3){for(let q=0;q<j.length;q++)if(hl(P,j[q]))return!0}if(zx(P,j,L))return!0}return!1}(w,u,I)}isTileClipped(){return!0}}function Ny(i,e){return e>0?e+2*i:i}const Tw=E([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kw=E([{name:"a_projected_pos",components:3,type:"Float32"}],4);E([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Iw=E([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);E([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jy=E([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Cw=E([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ew(i,e,r){return i.sections.forEach(a=>{a.text=function(u,f,y){const _=f.layout.get("text-transform").evaluate(y,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),Jr.applyArabicShaping&&(u=Jr.applyArabicShaping(u)),u}(a.text,e,r)}),i}E([{name:"triangle",components:3,type:"Uint16"}]),E([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),E([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),E([{type:"Float32",name:"offsetX"}]),E([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),E([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const eu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Ei=24,Vy=jt,Uy=function(i,e,r,a,u){var f,y,_=8*u-a-1,w=(1<<_)-1,I=w>>1,C=-7,P=u-1,z=-1,L=i[e+P];for(P+=z,f=L&(1<<-C)-1,L>>=-C,C+=_;C>0;f=256*f+i[e+P],P+=z,C-=8);for(y=f&(1<<-C)-1,f>>=-C,C+=a;C>0;y=256*y+i[e+P],P+=z,C-=8);if(f===0)f=1-I;else{if(f===w)return y?NaN:1/0*(L?-1:1);y+=Math.pow(2,a),f-=I}return(L?-1:1)*y*Math.pow(2,f-a)},$y=function(i,e,r,a,u,f){var y,_,w,I=8*f-u-1,C=(1<<I)-1,P=C>>1,z=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=0,B=1,j=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,y=C):(y=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-y))<1&&(y--,w*=2),(e+=y+P>=1?z/w:z*Math.pow(2,1-P))*w>=2&&(y++,w/=2),y+P>=C?(_=0,y=C):y+P>=1?(_=(e*w-1)*Math.pow(2,u),y+=P):(_=e*Math.pow(2,P-1)*Math.pow(2,u),y=0));u>=8;i[r+L]=255&_,L+=B,_/=256,u-=8);for(y=y<<u|_,I+=u;I>0;i[r+L]=255&y,L+=B,y/=256,I-=8);i[r+L-B]|=128*j};function jt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}jt.Varint=0,jt.Fixed64=1,jt.Bytes=2,jt.Fixed32=5;var mf=4294967296,Zy=1/mf,qy=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ko(i){return i.type===jt.Bytes?i.readVarint()+i.pos:i.pos+1}function ml(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Gy(i,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var u=r.pos-1;u>=i;u--)r.buf[u+a]=r.buf[u]}function Pw(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Mw(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Aw(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function zw(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Dw(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Lw(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Rw(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Fw(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Bw(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Xh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function gl(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Wy(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}jt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),u=a>>3,f=this.pos;this.type=7&a,i(u,e,this),this.pos===f&&this.skip(a)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Xh(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Wy(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Xh(this.buf,this.pos)+Xh(this.buf,this.pos+4)*mf;return this.pos+=8,i},readSFixed64:function(){var i=Xh(this.buf,this.pos)+Wy(this.buf,this.pos+4)*mf;return this.pos+=8,i},readFloat:function(){var i=Uy(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Uy(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(u,f,y){var _,w,I=y.buf;if(_=(112&(w=I[y.pos++]))>>4,w<128||(_|=(127&(w=I[y.pos++]))<<3,w<128)||(_|=(127&(w=I[y.pos++]))<<10,w<128)||(_|=(127&(w=I[y.pos++]))<<17,w<128)||(_|=(127&(w=I[y.pos++]))<<24,w<128)||(_|=(1&(w=I[y.pos++]))<<31,w<128))return ml(u,_,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&qy?function(r,a,u){return qy.decode(r.subarray(a,u))}(this.buf,e,i):function(r,a,u){for(var f="",y=a;y<u;){var _,w,I,C=r[y],P=null,z=C>239?4:C>223?3:C>191?2:1;if(y+z>u)break;z===1?C<128&&(P=C):z===2?(192&(_=r[y+1]))==128&&(P=(31&C)<<6|63&_)<=127&&(P=null):z===3?(w=r[y+2],(192&(_=r[y+1]))==128&&(192&w)==128&&((P=(15&C)<<12|(63&_)<<6|63&w)<=2047||P>=55296&&P<=57343)&&(P=null)):z===4&&(w=r[y+2],I=r[y+3],(192&(_=r[y+1]))==128&&(192&w)==128&&(192&I)==128&&((P=(15&C)<<18|(63&_)<<12|(63&w)<<6|63&I)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,z=1):P>65535&&(P-=65536,f+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),f+=String.fromCharCode(P),y+=z}return f}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==jt.Bytes)return i.push(this.readVarint(e));var r=ko(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==jt.Bytes)return i.push(this.readSVarint());var e=ko(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==jt.Bytes)return i.push(this.readBoolean());var e=ko(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==jt.Bytes)return i.push(this.readFloat());var e=ko(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==jt.Bytes)return i.push(this.readDouble());var e=ko(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==jt.Bytes)return i.push(this.readFixed32());var e=ko(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==jt.Bytes)return i.push(this.readSFixed32());var e=ko(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==jt.Bytes)return i.push(this.readFixed64());var e=ko(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==jt.Bytes)return i.push(this.readSFixed64());var e=ko(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===jt.Varint)for(;this.buf[this.pos++]>127;);else if(e===jt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===jt.Fixed32)this.pos+=4;else{if(e!==jt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),gl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),gl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),gl(this.buf,-1&i,this.pos),gl(this.buf,Math.floor(i*Zy),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),gl(this.buf,-1&i,this.pos),gl(this.buf,Math.floor(i*Zy),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(f,y,_){_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,_.buf[_.pos]=127&(f>>>=7)}(a,0,r),function(f,y){var _=(7&f)<<4;y.buf[y.pos++]|=_|((f>>>=3)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f)))))}(u,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(a,u,f){for(var y,_,w=0;w<u.length;w++){if((y=u.charCodeAt(w))>55295&&y<57344){if(!_){y>56319||w+1===u.length?(a[f++]=239,a[f++]=191,a[f++]=189):_=y;continue}if(y<56320){a[f++]=239,a[f++]=191,a[f++]=189,_=y;continue}y=_-55296<<10|y-56320|65536,_=null}else _&&(a[f++]=239,a[f++]=191,a[f++]=189,_=null);y<128?a[f++]=y:(y<2048?a[f++]=y>>6|192:(y<65536?a[f++]=y>>12|224:(a[f++]=y>>18|240,a[f++]=y>>12&63|128),a[f++]=y>>6&63|128),a[f++]=63&y|128)}return f}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Gy(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),$y(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),$y(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var a=this.pos-r;a>=128&&Gy(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,e,r){this.writeTag(i,jt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Pw,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Mw,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Dw,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Aw,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,zw,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Lw,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Rw,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Fw,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Bw,e)},writeBytesField:function(i,e){this.writeTag(i,jt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,jt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,jt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,jt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,jt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,jt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,jt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,jt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,jt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,jt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var gf=$(Vy);const yf=3;function Ow(i,e,r){i===1&&r.readMessage(Nw,e)}function Nw(i,e,r){if(i===3){const{id:a,bitmap:u,width:f,height:y,left:_,top:w,advance:I}=r.readMessage(jw,{});e.push({id:a,bitmap:new Hc({width:f+2*yf,height:y+2*yf},u),metrics:{width:f,height:y,left:_,top:w,advance:I}})}}function jw(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const Hy=yf;function Ky(i){let e=0,r=0;for(const y of i)e+=y.w*y.h,r=Math.max(r,y.w);i.sort((y,_)=>_.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,f=0;for(const y of i)for(let _=a.length-1;_>=0;_--){const w=a[_];if(!(y.w>w.w||y.h>w.h)){if(y.x=w.x,y.y=w.y,f=Math.max(f,y.y+y.h),u=Math.max(u,y.x+y.w),y.w===w.w&&y.h===w.h){const I=a.pop();_<a.length&&(a[_]=I)}else y.h===w.h?(w.x+=y.w,w.w-=y.w):y.w===w.w?(w.y+=y.h,w.h-=y.h):(a.push({x:w.x+y.w,y:w.y,w:w.w-y.w,h:y.h}),w.y+=y.h,w.h-=y.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}const Bn=1;class _f{constructor(e,{pixelRatio:r,version:a,stretchX:u,stretchY:f,content:y,textFitWidth:_,textFitHeight:w}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=f,this.content=y,this.version=a,this.textFitWidth=_,this.textFitHeight=w}get tl(){return[this.paddedRect.x+Bn,this.paddedRect.y+Bn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Bn,this.paddedRect.y+this.paddedRect.h-Bn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Bn)/this.pixelRatio,(this.paddedRect.h-2*Bn)/this.pixelRatio]}}class Xy{constructor(e,r){const a={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,a,f),this.addImages(r,u,f);const{w:y,h:_}=Ky(f),w=new nr({width:y||1,height:_||1});for(const I in e){const C=e[I],P=a[I].paddedRect;nr.copy(C.data,w,{x:0,y:0},{x:P.x+Bn,y:P.y+Bn},C.data)}for(const I in r){const C=r[I],P=u[I].paddedRect,z=P.x+Bn,L=P.y+Bn,B=C.data.width,j=C.data.height;nr.copy(C.data,w,{x:0,y:0},{x:z,y:L},C.data),nr.copy(C.data,w,{x:0,y:j-1},{x:z,y:L-1},{width:B,height:1}),nr.copy(C.data,w,{x:0,y:0},{x:z,y:L+j},{width:B,height:1}),nr.copy(C.data,w,{x:B-1,y:0},{x:z-1,y:L},{width:1,height:j}),nr.copy(C.data,w,{x:0,y:0},{x:z+B,y:L},{width:1,height:j})}this.image=w,this.iconPositions=a,this.patternPositions=u}addImages(e,r,a){for(const u in e){const f=e[u],y={x:0,y:0,w:f.data.width+2*Bn,h:f.data.height+2*Bn};a.push(y),r[u]=new _f(y,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,f]=e.tl;a.update(r.data,void 0,{x:u,y:f})}}var us;We("ImagePosition",_f),We("ImageAtlas",Xy),S.ah=void 0,(us=S.ah||(S.ah={}))[us.none=0]="none",us[us.horizontal=1]="horizontal",us[us.vertical=2]="vertical",us[us.horizontalOnly=3]="horizontalOnly";const tu=-17;class iu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new iu;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new iu;return r.imageName=e,r}}class yl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new yl;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?a.addImageSection(f):a.addTextSection(f,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let a=0;a<e.length;a++){const u=e.charCodeAt(a+1)||null,f=e.charCodeAt(a-1)||null;r+=u&&Lh(u)&&!eu[e[a+1]]||f&&Lh(f)&&!eu[e[a-1]]||!eu[e[a]]?e[a]:eu[e[a]]}return r}(this.text)}trim(){let e=0;for(let a=0;a<this.text.length&&Jh[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Jh[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new yl;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(iu.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Ut("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(iu.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Ut("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Yh(i,e,r,a,u,f,y,_,w,I,C,P,z,L,B){const j=yl.fromFeature(i,u);let q;P===S.ah.vertical&&j.verticalizePunctuation();const{processBidirectionalText:Y,processStyledBidirectionalText:ue}=Jr;if(Y&&j.sections.length===1){q=[];const ge=Y(j.toString(),vf(j,I,f,e,a,L));for(const Se of ge){const Oe=new yl;Oe.text=Se,Oe.sections=j.sections;for(let st=0;st<Se.length;st++)Oe.sectionIndex.push(0);q.push(Oe)}}else if(ue){q=[];const ge=ue(j.text,j.sectionIndex,vf(j,I,f,e,a,L));for(const Se of ge){const Oe=new yl;Oe.text=Se[0],Oe.sectionIndex=Se[1],Oe.sections=j.sections,q.push(Oe)}}else q=function(ge,Se){const Oe=[],st=ge.text;let je=0;for(const Fe of Se)Oe.push(ge.substring(je,Fe)),je=Fe;return je<st.length&&Oe.push(ge.substring(je,st.length)),Oe}(j,vf(j,I,f,e,a,L));const ee=[],le={positionedLines:ee,text:j.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(ge,Se,Oe,st,je,Fe,Qe,He,Ge,xe,tt,Je){let ut=0,$t=tu,Vt=0,zi=0;const _r=He==="right"?1:He==="left"?0:.5;let Yi=0;for(const fi of je){fi.trim();const Di=fi.getMaxScale(),an=(Di-1)*Ei,Ji={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Yi]=Ji;const Tn=Ji.positionedGlyphs;let Qi=0;if(!fi.length()){$t+=Fe,++Yi;continue}for(let On=0;On<fi.length();On++){const At=fi.getSection(On),qt=fi.getSectionIndex(On),Yt=fi.getCharCode(On);let Wn=0,ai=null,wl=null,io=null,no=Ei;const vr=!(Ge===S.ah.horizontal||!tt&&!Bc(Yt)||tt&&(Jh[Yt]||(pi=Yt,Ue.Arabic(pi)||Ue["Arabic Supplement"](pi)||Ue["Arabic Extended-A"](pi)||Ue["Arabic Presentation Forms-A"](pi)||Ue["Arabic Presentation Forms-B"](pi))));if(At.imageName){const sr=st[At.imageName];if(!sr)continue;io=At.imageName,ge.iconsInText=ge.iconsInText||!0,wl=sr.paddedRect;const Ni=sr.displaySize;At.scale=At.scale*Ei/Je,ai={width:Ni[0],height:Ni[1],left:Bn,top:-Hy,advance:vr?Ni[1]:Ni[0]},Wn=an+(Ei-Ni[1]*At.scale),no=ai.advance;const Io=vr?Ni[0]*At.scale-Ei*Di:Ni[1]*At.scale-Ei*Di;Io>0&&Io>Qi&&(Qi=Io)}else{const sr=Oe[At.fontStack],Ni=sr&&sr[Yt];if(Ni&&Ni.rect)wl=Ni.rect,ai=Ni.metrics;else{const Io=Se[At.fontStack],au=Io&&Io[Yt];if(!au)continue;ai=au.metrics}Wn=(Di-At.scale)*Ei}vr?(ge.verticalizable=!0,Tn.push({glyph:Yt,imageName:io,x:ut,y:$t+Wn,vertical:vr,scale:At.scale,fontStack:At.fontStack,sectionIndex:qt,metrics:ai,rect:wl}),ut+=no*At.scale+xe):(Tn.push({glyph:Yt,imageName:io,x:ut,y:$t+Wn,vertical:vr,scale:At.scale,fontStack:At.fontStack,sectionIndex:qt,metrics:ai,rect:wl}),ut+=ai.advance*At.scale+xe)}Tn.length!==0&&(Vt=Math.max(ut-xe,Vt),Zw(Tn,0,Tn.length-1,_r,Qi)),ut=0;const or=Fe*Di+Qi;Ji.lineOffset=Math.max(Qi,an),$t+=or,zi=Math.max(or,zi),++Yi}var pi;const wn=$t-tu,{horizontalAlign:bn,verticalAlign:Sn}=xf(Qe);(function(fi,Di,an,Ji,Tn,Qi,or,On,At){const qt=(Di-an)*Tn;let Yt=0;Yt=Qi!==or?-On*Ji-tu:(-Ji*At+.5)*or;for(const Wn of fi)for(const ai of Wn.positionedGlyphs)ai.x+=qt,ai.y+=Yt})(ge.positionedLines,_r,bn,Sn,Vt,zi,Fe,wn,je.length),ge.top+=-Sn*wn,ge.bottom=ge.top+wn,ge.left+=-bn*Vt,ge.right=ge.left+Vt}(le,e,r,a,q,y,_,w,P,I,z,B),!function(ge){for(const Se of ge)if(Se.positionedGlyphs.length!==0)return!1;return!0}(ee)&&le}const Jh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Vw={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Uw={40:!0};function Yy(i,e,r,a,u,f){if(e.imageName){const y=a[e.imageName];return y?y.displaySize[0]*e.scale*Ei/f+u:0}{const y=r[e.fontStack],_=y&&y[i];return _?_.metrics.advance*e.scale+u:0}}function Jy(i,e,r,a){const u=Math.pow(i-e,2);return a?i<e?u/2:2*u:u+Math.abs(r)*r}function $w(i,e,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Qy(i,e,r,a,u,f){let y=null,_=Jy(e,r,u,f);for(const w of a){const I=Jy(e-w.x,r,u,f)+w.badness;I<=_&&(y=w,_=I)}return{index:i,x:e,priorBreak:y,badness:_}}function e_(i){return i?e_(i.priorBreak).concat(i.index):[]}function vf(i,e,r,a,u,f){if(!i)return[];const y=[],_=function(P,z,L,B,j,q){let Y=0;for(let ue=0;ue<P.length();ue++){const ee=P.getSection(ue);Y+=Yy(P.getCharCode(ue),ee,B,j,z,q)}return Y/Math.max(1,Math.ceil(Y/L))}(i,e,r,a,u,f),w=i.text.indexOf("​")>=0;let I=0;for(let P=0;P<i.length();P++){const z=i.getSection(P),L=i.getCharCode(P);if(Jh[L]||(I+=Yy(L,z,a,u,e,f)),P<i.length()-1){const B=!((C=L)<11904||!(Ue["Bopomofo Extended"](C)||Ue.Bopomofo(C)||Ue["CJK Compatibility Forms"](C)||Ue["CJK Compatibility Ideographs"](C)||Ue["CJK Compatibility"](C)||Ue["CJK Radicals Supplement"](C)||Ue["CJK Strokes"](C)||Ue["CJK Symbols and Punctuation"](C)||Ue["CJK Unified Ideographs Extension A"](C)||Ue["CJK Unified Ideographs"](C)||Ue["Enclosed CJK Letters and Months"](C)||Ue["Halfwidth and Fullwidth Forms"](C)||Ue.Hiragana(C)||Ue["Ideographic Description Characters"](C)||Ue["Kangxi Radicals"](C)||Ue["Katakana Phonetic Extensions"](C)||Ue.Katakana(C)||Ue["Vertical Forms"](C)||Ue["Yi Radicals"](C)||Ue["Yi Syllables"](C)));(Vw[L]||B||z.imageName||P!==i.length()-2&&Uw[i.getCharCode(P+1)])&&y.push(Qy(P+1,I,_,y,$w(L,i.getCharCode(P+1),B&&w),!1))}}var C;return e_(Qy(i.length(),I,_,y,0,!0))}function xf(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Zw(i,e,r,a,u){if(!a&&!u)return;const f=i[r],y=(i[r].x+f.metrics.advance*f.scale)*a;for(let _=e;_<=r;_++)i[_].x-=y,i[_].y+=u}function qw(i,e,r){const{horizontalAlign:a,verticalAlign:u}=xf(r),f=e[0]-i.displaySize[0]*a,y=e[1]-i.displaySize[1]*u;return{image:i,top:y,bottom:y+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function t_(i){var e,r;let a=i.left,u=i.top,f=i.right-a,y=i.bottom-u;const _=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",w=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",I=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(w==="proportional"){if(_==="stretchOnly"&&f/y<I||_==="proportional"){const C=Math.ceil(y*I);a*=C/f,f=C}}else if(_==="proportional"&&w==="stretchOnly"&&I!==0&&f/y>I){const C=Math.ceil(f/I);u*=C/y,y=C}return{x1:a,y1:u,x2:a+f,y2:u+y}}function i_(i,e,r,a,u,f){const y=i.image;let _;if(y.content){const q=y.content,Y=y.pixelRatio||1;_=[q[0]/Y,q[1]/Y,y.displaySize[0]-q[2]/Y,y.displaySize[1]-q[3]/Y]}const w=e.left*f,I=e.right*f;let C,P,z,L;r==="width"||r==="both"?(L=u[0]+w-a[3],P=u[0]+I+a[1]):(L=u[0]+(w+I-y.displaySize[0])/2,P=L+y.displaySize[0]);const B=e.top*f,j=e.bottom*f;return r==="height"||r==="both"?(C=u[1]+B-a[0],z=u[1]+j+a[2]):(C=u[1]+(B+j-y.displaySize[1])/2,z=C+y.displaySize[1]),{image:y,top:C,right:P,bottom:z,left:L,collisionPadding:_}}const nu=255,to=128,hs=nu*to;function n_(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Zt(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=r;let f=0;for(;f<a.length&&a[f]<=i;)f++;f=Math.max(0,f-1);let y=f;for(;y<a.length&&a[y]<i+1;)y++;y=Math.min(a.length-1,y);const _=a[f],w=a[y];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:_,maxZoom:w,minSize:r.evaluate(new Zt(_)),maxSize:r.evaluate(new Zt(w)),interpolationType:u}}}function wf(i,e,r){let a="never";const u=i.get(e);return u?a=u:i.get(r)&&(a="always"),a}const Gw=cs.VectorTileFeature.types,Ww=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Qh(i,e,r,a,u,f,y,_,w,I,C,P,z){const L=_?Math.min(hs,Math.round(_[0])):0,B=_?Math.min(hs,Math.round(_[1])):0;i.emplaceBack(e,r,Math.round(32*a),Math.round(32*u),f,y,(L<<1)+(w?1:0),B,16*I,16*C,256*P,256*z)}function bf(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Hw(i){for(const e of i.sections)if(Oc(e.text))return!0;return!1}class Sf{constructor(e){this.layoutVertexArray=new ir,this.indexArray=new Ai,this.programConfigurations=e,this.segments=new Ci,this.dynamicLayoutVertexArray=new Qr,this.opacityVertexArray=new os,this.hasVisibleVertices=!1,this.placedSymbolArray=new Kt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Tw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,kw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Ww,!0),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}We("SymbolBuffers",Sf);class Tf{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new Ci,this.collisionVertexArray=new Ki}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Iw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}We("CollisionBuffers",Tf);class _l{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=tf([]),this.placementViewportMatrix=tf([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=n_(this.zoom,r["text-size"]),this.iconSizeData=n_(this.zoom,r["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),f=a.get("symbol-z-order");this.canOverlap=wf(a,"text-overlap","text-allow-overlap")!=="never"||wf(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>S.ah[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new Sf(new ra(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Sf(new ra(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Xt,this.lineVertexArray=new vn,this.symbolInstances=new er,this.textAnchorOffsets=new Gi}calculateGlyphDependencies(e,r,a,u,f){for(let y=0;y<e.length;y++)if(r[e.charCodeAt(y)]=!0,(a||u)&&f){const _=eu[e.charAt(y)];_&&(r[_.charCodeAt(0)]=!0)}}populate(e,r,a){const u=this.layers[0],f=u.layout,y=f.get("text-font"),_=f.get("text-field"),w=f.get("icon-image"),I=(_.value.kind!=="constant"||_.value.value instanceof zn&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),C=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,P=f.get("symbol-sort-key");if(this.features=[],!I&&!C)return;const z=r.iconDependencies,L=r.glyphDependencies,B=r.availableImages,j=new Zt(this.zoom);for(const{feature:q,id:Y,index:ue,sourceLayerIndex:ee}of e){const le=u._featureFilter.needGeometry,ge=sa(q,le);if(!u._featureFilter.filter(j,ge,a))continue;let Se,Oe;if(le||(ge.geometry=oa(q)),I){const je=u.getValueAndResolveTokens("text-field",ge,a,B),Fe=zn.factory(je),Qe=this.hasRTLText=this.hasRTLText||Hw(Fe);(!Qe||Jr.getRTLTextPluginStatus()==="unavailable"||Qe&&Jr.isParsed())&&(Se=Ew(Fe,u,ge))}if(C){const je=u.getValueAndResolveTokens("icon-image",ge,a,B);Oe=je instanceof Zn?je:Zn.fromString(je)}if(!Se&&!Oe)continue;const st=this.sortFeaturesByKey?P.evaluate(ge,{},a):void 0;if(this.features.push({id:Y,text:Se,icon:Oe,index:ue,sourceLayerIndex:ee,geometry:ge.geometry,properties:q.properties,type:Gw[q.type],sortKey:st}),Oe&&(z[Oe.name]=!0),Se){const je=y.evaluate(ge,{},a).join(","),Fe=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.ah.vertical)>=0;for(const Qe of Se.sections)if(Qe.image)z[Qe.image.name]=!0;else{const He=Fc(Se.toString()),Ge=Qe.fontStack||je,xe=L[Ge]=L[Ge]||{};this.calculateGlyphDependencies(Qe.text,xe,Fe,this.allowVerticalPlacement,He)}}}f.get("symbol-placement")==="line"&&(this.features=function(q){const Y={},ue={},ee=[];let le=0;function ge(je){ee.push(q[je]),le++}function Se(je,Fe,Qe){const He=ue[je];return delete ue[je],ue[Fe]=He,ee[He].geometry[0].pop(),ee[He].geometry[0]=ee[He].geometry[0].concat(Qe[0]),He}function Oe(je,Fe,Qe){const He=Y[Fe];return delete Y[Fe],Y[je]=He,ee[He].geometry[0].shift(),ee[He].geometry[0]=Qe[0].concat(ee[He].geometry[0]),He}function st(je,Fe,Qe){const He=Qe?Fe[0][Fe[0].length-1]:Fe[0][0];return`${je}:${He.x}:${He.y}`}for(let je=0;je<q.length;je++){const Fe=q[je],Qe=Fe.geometry,He=Fe.text?Fe.text.toString():null;if(!He){ge(je);continue}const Ge=st(He,Qe),xe=st(He,Qe,!0);if(Ge in ue&&xe in Y&&ue[Ge]!==Y[xe]){const tt=Oe(Ge,xe,Qe),Je=Se(Ge,xe,ee[tt].geometry);delete Y[Ge],delete ue[xe],ue[st(He,ee[Je].geometry,!0)]=Je,ee[tt].geometry=null}else Ge in ue?Se(Ge,xe,Qe):xe in Y?Oe(Ge,xe,Qe):(ge(je),Y[Ge]=le-1,ue[xe]=le-1)}return ee.filter(je=>je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((q,Y)=>q.sortKey-Y.sortKey)}update(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(r[e.segment+1]),f=e.dist(r[e.segment]);const y={};for(let _=e.segment+1;_<r.length;_++)y[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:u},_<r.length-1&&(u+=r[_+1].dist(r[_]));for(let _=e.segment||0;_>=0;_--)y[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:f},_>0&&(f+=r[_-1].dist(r[_]));for(let _=0;_<r.length;_++){const w=y[_];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,u,f,y,_,w,I,C,P,z){const L=e.indexArray,B=e.layoutVertexArray,j=e.segments.prepareSegment(4*r.length,B,L,this.canOverlap?y.sortKey:void 0),q=this.glyphOffsetArray.length,Y=j.vertexLength,ue=this.allowVerticalPlacement&&_===S.ah.vertical?Math.PI/2:0,ee=y.text&&y.text.sections;for(let le=0;le<r.length;le++){const{tl:ge,tr:Se,bl:Oe,br:st,tex:je,pixelOffsetTL:Fe,pixelOffsetBR:Qe,minFontScaleX:He,minFontScaleY:Ge,glyphOffset:xe,isSDF:tt,sectionIndex:Je}=r[le],ut=j.vertexLength,$t=xe[1];Qh(B,w.x,w.y,ge.x,$t+ge.y,je.x,je.y,a,tt,Fe.x,Fe.y,He,Ge),Qh(B,w.x,w.y,Se.x,$t+Se.y,je.x+je.w,je.y,a,tt,Qe.x,Fe.y,He,Ge),Qh(B,w.x,w.y,Oe.x,$t+Oe.y,je.x,je.y+je.h,a,tt,Fe.x,Qe.y,He,Ge),Qh(B,w.x,w.y,st.x,$t+st.y,je.x+je.w,je.y+je.h,a,tt,Qe.x,Qe.y,He,Ge),bf(e.dynamicLayoutVertexArray,w,ue),L.emplaceBack(ut,ut+1,ut+2),L.emplaceBack(ut+1,ut+2,ut+3),j.vertexLength+=4,j.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xe[0]),le!==r.length-1&&Je===r[le+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,y,y.index,{},z,ee&&ee[Je])}e.placedSymbolArray.emplaceBack(w.x,w.y,q,this.glyphOffsetArray.length-q,Y,I,C,w.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],_,0,!1,0,P)}_addCollisionDebugVertex(e,r,a,u,f,y){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,u,f,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,r,a,u,f,y,_){const w=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),I=w.vertexLength,C=f.layoutVertexArray,P=f.collisionVertexArray,z=_.anchorX,L=_.anchorY;this._addCollisionDebugVertex(C,P,y,z,L,new X(e,r)),this._addCollisionDebugVertex(C,P,y,z,L,new X(a,r)),this._addCollisionDebugVertex(C,P,y,z,L,new X(a,u)),this._addCollisionDebugVertex(C,P,y,z,L,new X(e,u)),w.vertexLength+=4;const B=f.indexArray;B.emplaceBack(I,I+1),B.emplaceBack(I+1,I+2),B.emplaceBack(I+2,I+3),B.emplaceBack(I+3,I),w.primitiveLength+=4}addDebugCollisionBoxes(e,r,a,u){for(let f=e;f<r;f++){const y=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,u?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Tf(Hi,jy.members,ni),this.iconCollisionBox=new Tf(Hi,jy.members,ni);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,a,u,f,y,_,w,I){const C={};for(let P=r;P<a;P++){const z=e.get(P);C.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},C.textFeatureIndex=z.featureIndex;break}for(let P=u;P<f;P++){const z=e.get(P);C.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},C.verticalTextFeatureIndex=z.featureIndex;break}for(let P=y;P<_;P++){const z=e.get(P);C.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},C.iconFeatureIndex=z.featureIndex;break}for(let P=w;P<I;P++){const z=e.get(P);C.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},C.verticalIconFeatureIndex=z.featureIndex;break}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),u=a.vertexStartIndex+4*a.numGlyphs;for(let f=a.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),u=[],f=[],y=[];for(let _=0;_<this.symbolInstances.length;++_){y.push(_);const w=this.symbolInstances.get(_);u.push(0|Math.round(r*w.anchorX+a*w.anchorY)),f.push(w.featureIndex)}return y.sort((_,w)=>u[_]-u[w]||f[w]-f[_]),y}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((u,f,y)=>{u>=0&&y.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let r_,o_;We("SymbolBucket",_l,{omit:["layers","collisionBoxArray","features","compareText"]}),_l.MAX_GLYPHS=65535,_l.addDynamicAttributes=bf;var kf={get paint(){return o_=o_||new l({"icon-opacity":new lt(ye.paint_symbol["icon-opacity"]),"icon-color":new lt(ye.paint_symbol["icon-color"]),"icon-halo-color":new lt(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new lt(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new lt(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new et(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new et(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new lt(ye.paint_symbol["text-opacity"]),"text-color":new lt(ye.paint_symbol["text-color"],{runtimeType:nn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new lt(ye.paint_symbol["text-halo-color"]),"text-halo-width":new lt(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new lt(ye.paint_symbol["text-halo-blur"]),"text-translate":new et(ye.paint_symbol["text-translate"]),"text-translate-anchor":new et(ye.paint_symbol["text-translate-anchor"])})},get layout(){return r_=r_||new l({"symbol-placement":new et(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new et(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new et(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new lt(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new et(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new et(ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new et(ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new et(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new et(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new et(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new lt(ye.layout_symbol["icon-size"]),"icon-text-fit":new et(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new et(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new lt(ye.layout_symbol["icon-image"]),"icon-rotate":new lt(ye.layout_symbol["icon-rotate"]),"icon-padding":new lt(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new et(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new lt(ye.layout_symbol["icon-offset"]),"icon-anchor":new lt(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new et(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new et(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new et(ye.layout_symbol["text-rotation-alignment"]),"text-field":new lt(ye.layout_symbol["text-field"]),"text-font":new lt(ye.layout_symbol["text-font"]),"text-size":new lt(ye.layout_symbol["text-size"]),"text-max-width":new lt(ye.layout_symbol["text-max-width"]),"text-line-height":new et(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new lt(ye.layout_symbol["text-letter-spacing"]),"text-justify":new lt(ye.layout_symbol["text-justify"]),"text-radial-offset":new lt(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new et(ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new lt(ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new lt(ye.layout_symbol["text-anchor"]),"text-max-angle":new et(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new et(ye.layout_symbol["text-writing-mode"]),"text-rotate":new lt(ye.layout_symbol["text-rotate"]),"text-padding":new et(ye.layout_symbol["text-padding"]),"text-keep-upright":new et(ye.layout_symbol["text-keep-upright"]),"text-transform":new lt(ye.layout_symbol["text-transform"]),"text-offset":new lt(ye.layout_symbol["text-offset"]),"text-allow-overlap":new et(ye.layout_symbol["text-allow-overlap"]),"text-overlap":new et(ye.layout_symbol["text-overlap"]),"text-ignore-placement":new et(ye.layout_symbol["text-ignore-placement"]),"text-optional":new et(ye.layout_symbol["text-optional"])})}};class s_{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:uo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}We("FormatSectionOverride",s_,{omit:["defaultValue"]});class ed extends g{constructor(e){super(e,kf)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const f of a)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,u){const f=this.layout.get(e).evaluate(r,{},a,u),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||Ha(y.value)||!f?f:function(_,w){return w.replace(/{([^{}]+)}/g,(I,C)=>_&&C in _?String(_[C]):"")}(r.properties,f)}createBucket(e){return new _l(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of kf.paint.overridableProperties){if(!ed.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new s_(r),u=new bc(a,r.property.specification);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new Sc("source",u):new Tc("composite",u,r.value.zoomStops),this.paint._values[e]=new yr(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&ed.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),u=kf.paint.properties[r];let f=!1;const y=_=>{for(const w of _)if(u.overrides&&u.overrides.hasOverride(w))return void(f=!0)};if(a.value.kind==="constant"&&a.value.value instanceof zn)y(a.value.value.sections);else if(a.value.kind==="source"){const _=I=>{f||(I instanceof ho&&bi(I.value)===Mr?y(I.value.sections):I instanceof Ra?y(I.sections):I.eachChild(_))},w=a.value;w._styleExpression&&_(w._styleExpression.expression)}return f}}let a_;var Kw={get paint(){return a_=a_||new l({"background-color":new et(ye.paint_background["background-color"]),"background-pattern":new t(ye.paint_background["background-pattern"]),"background-opacity":new et(ye.paint_background["background-opacity"])})}};class Xw extends g{constructor(e){super(e,Kw)}}let l_;var Yw={get paint(){return l_=l_||new l({"raster-opacity":new et(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new et(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new et(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new et(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new et(ye.paint_raster["raster-saturation"]),"raster-contrast":new et(ye.paint_raster["raster-contrast"]),"raster-resampling":new et(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new et(ye.paint_raster["raster-fade-duration"])})}};class Jw extends g{constructor(e){super(e,Yw)}}class Qw extends g{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class e2{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const If=63710088e-1;class ds{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ds(Re(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,u=e.lat*r,f=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return If*Math.acos(Math.min(f,1))}static convert(e){if(e instanceof ds)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ds(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ds(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const c_=2*Math.PI*If;function u_(i){return c_*Math.cos(i*Math.PI/180)}function h_(i){return(180+i)/360}function d_(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function p_(i,e){return i/u_(e)}function Cf(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class td{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=ds.convert(e);return new td(h_(a.lng),d_(a.lat),p_(r,a.lat))}toLngLat(){return new ds(360*this.x-180,Cf(this.y))}toAltitude(){return this.z*u_(Cf(this.y))}meterInMercatorCoordinateUnits(){return 1/c_*(e=Cf(this.y),1/Math.cos(e*Math.PI/180));var e}}function f_(i,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class Ef{constructor(e,r,a){if(e<0||e>25||a<0||a>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=a,this.key=ru(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,a){const u=(y=this.y,_=this.z,w=f_(256*(f=this.x),256*(y=Math.pow(2,_)-y-1),_),I=f_(256*(f+1),256*(y+1),_),w[0]+","+w[1]+","+I[0]+","+I[1]);var f,y,_,w,I;const C=function(P,z,L){let B,j="";for(let q=P;q>0;q--)B=1<<q-1,j+=(z&B?1:0)+(L&B?2:0);return j}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new X((e.x*r-this.x)*Si,(e.y*r-this.y)*Si)}toString(){return`${this.z}/${this.x}/${this.y}`}}class m_{constructor(e,r){this.wrap=e,this.canonical=r,this.key=ru(e,r.z,r.z,r.x,r.y)}}class rr{constructor(e,r,a,u,f){if(e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Ef(a,+u,+f),this.key=ru(r,e,a,u,f)}clone(){return new rr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new rr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new rr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?ru(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):ru(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new rr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new rr(r,this.wrap,r,a,u),new rr(r,this.wrap,r,a+1,u),new rr(r,this.wrap,r,a,u+1),new rr(r,this.wrap,r,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new rr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new rr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new m_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new td(e.x-this.wrap,e.y))}}function ru(i,e,r,a,u){(i*=2)<0&&(i=-1*i-1);const f=1<<r;return(f*f*i+f*u+a).toString(36)+r.toString(36)+e.toString(36)}We("CanonicalTileID",Ef),We("OverscaledTileID",rr,{omit:["posMatrix"]});class g_{constructor(e,r,a,u=1,f=1,y=1,_=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void Ut(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const w=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=f,this.blueFactor=y,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<w;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(w,I)]=this.data[this._idx(w-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,w)]=this.data[this._idx(I,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<w;I++)for(let C=0;C<w;C++){const P=this.get(I,C);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(e,r){const a=new Uint8Array(this.data.buffer),u=4*this._idx(e,r);return this.unpack(a[u],a[u+1],a[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,a){return e*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new nr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,f=r*this.dim+this.dim,y=a*this.dim,_=a*this.dim+this.dim;switch(r){case-1:u=f-1;break;case 1:f=u+1}switch(a){case-1:y=_-1;break;case 1:_=y+1}const w=-r*this.dim,I=-a*this.dim;for(let C=y;C<_;C++)for(let P=u;P<f;P++)this.data[this._idx(P,C)]=e.data[this._idx(P+w,C+I)]}}We("DEMData",g_);class y_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class __{constructor(e,r,a,u,f){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=a,e._y=u,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class v_{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ea(Si,16,0),this.grid3D=new ea(Si,16,0),this.featureIndexArray=new tr,this.promoteId=r}insert(e,r,a,u,f,y){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,f);const w=y?this.grid3D:this.grid;for(let I=0;I<r.length;I++){const C=r[I],P=[1/0,1/0,-1/0,-1/0];for(let z=0;z<C.length;z++){const L=C[z];P[0]=Math.min(P[0],L.x),P[1]=Math.min(P[1],L.y),P[2]=Math.max(P[2],L.x),P[3]=Math.max(P[3],L.y)}P[0]<Si&&P[1]<Si&&P[2]>=0&&P[3]>=0&&w.insert(_,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new cs.VectorTile(new gf(this.rawTileData)).layers,this.sourceLayerCoder=new y_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,a,u){this.loadVTLayers();const f=e.params||{},y=Si/e.tileSize/e.scale,_=kc(f.filter),w=e.queryGeometry,I=e.queryPadding*y,C=w_(w),P=this.grid.query(C.minX-I,C.minY-I,C.maxX+I,C.maxY+I),z=w_(e.cameraQueryGeometry),L=this.grid3D.query(z.minX-I,z.minY-I,z.maxX+I,z.maxY+I,(q,Y,ue,ee)=>function(le,ge,Se,Oe,st){for(const Fe of le)if(ge<=Fe.x&&Se<=Fe.y&&Oe>=Fe.x&&st>=Fe.y)return!0;const je=[new X(ge,Se),new X(ge,st),new X(Oe,st),new X(Oe,Se)];if(le.length>2){for(const Fe of je)if(hl(le,Fe))return!0}for(let Fe=0;Fe<le.length-1;Fe++)if(Lx(le[Fe],le[Fe+1],je))return!0;return!1}(e.cameraQueryGeometry,q-I,Y-I,ue+I,ee+I));for(const q of L)P.push(q);P.sort(t2);const B={};let j;for(let q=0;q<P.length;q++){const Y=P[q];if(Y===j)continue;j=Y;const ue=this.featureIndexArray.get(Y);let ee=null;this.loadMatchingFeature(B,ue.bucketIndex,ue.sourceLayerIndex,ue.featureIndex,_,f.layers,f.availableImages,r,a,u,(le,ge,Se)=>(ee||(ee=oa(le)),ge.queryIntersectsFeature(w,le,Se,ee,this.z,e.transform,y,e.pixelPosMatrix)))}return B}loadMatchingFeature(e,r,a,u,f,y,_,w,I,C,P){const z=this.bucketLayerIDs[r];if(y&&!function(q,Y){for(let ue=0;ue<q.length;ue++)if(Y.indexOf(q[ue])>=0)return!0;return!1}(y,z))return;const L=this.sourceLayerCoder.decode(a),B=this.vtLayers[L].feature(u);if(f.needGeometry){const q=sa(B,!0);if(!f.filter(new Zt(this.tileID.overscaledZ),q,this.tileID.canonical))return}else if(!f.filter(new Zt(this.tileID.overscaledZ),B))return;const j=this.getId(B,L);for(let q=0;q<z.length;q++){const Y=z[q];if(y&&y.indexOf(Y)<0)continue;const ue=w[Y];if(!ue)continue;let ee={};j&&C&&(ee=C.getState(ue.sourceLayer||"_geojsonTileLayer",j));const le=$e({},I[Y]);le.paint=x_(le.paint,ue.paint,B,ee,_),le.layout=x_(le.layout,ue.layout,B,ee,_);const ge=!P||P(B,ue,ee);if(!ge)continue;const Se=new __(B,this.z,this.x,this.y,j);Se.layer=le;let Oe=e[Y];Oe===void 0&&(Oe=e[Y]=[]),Oe.push({featureIndex:u,feature:Se,intersectionZ:ge})}}lookupSymbolFeatures(e,r,a,u,f,y,_,w){const I={};this.loadVTLayers();const C=kc(f);for(const P of e)this.loadMatchingFeature(I,a,u,P,C,y,_,w,r);return I}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function x_(i,e,r,a,u){return xt(i,(f,y)=>{const _=e instanceof rl?e.get(y):null;return _&&_.evaluate?_.evaluate(r,a,u):_})}function w_(i){let e=1/0,r=1/0,a=-1/0,u=-1/0;for(const f of i)e=Math.min(e,f.x),r=Math.min(r,f.y),a=Math.max(a,f.x),u=Math.max(u,f.y);return{minX:e,minY:r,maxX:a,maxY:u}}function t2(i,e){return e-i}function b_(i,e,r,a,u){const f=[];for(let y=0;y<i.length;y++){const _=i[y];let w;for(let I=0;I<_.length-1;I++){let C=_[I],P=_[I+1];C.x<e&&P.x<e||(C.x<e?C=new X(e,C.y+(e-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x<e&&(P=new X(e,C.y+(e-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y<r&&P.y<r||(C.y<r?C=new X(C.x+(r-C.y)/(P.y-C.y)*(P.x-C.x),r)._round():P.y<r&&(P=new X(C.x+(r-C.y)/(P.y-C.y)*(P.x-C.x),r)._round()),C.x>=a&&P.x>=a||(C.x>=a?C=new X(a,C.y+(a-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x>=a&&(P=new X(a,C.y+(a-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y>=u&&P.y>=u||(C.y>=u?C=new X(C.x+(u-C.y)/(P.y-C.y)*(P.x-C.x),u)._round():P.y>=u&&(P=new X(C.x+(u-C.y)/(P.y-C.y)*(P.x-C.x),u)._round()),w&&C.equals(w[w.length-1])||(w=[C],f.push(w)),w.push(P)))))}}return f}We("FeatureIndex",v_,{omit:["rawTileData","sourceLayerCoder"]});class ps extends X{constructor(e,r,a,u){super(e,r),this.angle=a,u!==void 0&&(this.segment=u)}clone(){return new ps(this.x,this.y,this.angle,this.segment)}}function S_(i,e,r,a,u){if(e.segment===void 0||r===0)return!0;let f=e,y=e.segment+1,_=0;for(;_>-r/2;){if(y--,y<0)return!1;_-=i[y].dist(f),f=i[y]}_+=i[y].dist(i[y+1]),y++;const w=[];let I=0;for(;_<r/2;){const C=i[y],P=i[y+1];if(!P)return!1;let z=i[y-1].angleTo(C)-C.angleTo(P);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:_,angleDelta:z}),I+=z;_-w[0].distance>a;)I-=w.shift().angleDelta;if(I>u)return!1;y++,_+=C.dist(P)}return!0}function T_(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function k_(i,e,r){return i?.6*e*r:0}function I_(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function i2(i,e,r,a,u,f){const y=k_(r,u,f),_=I_(r,a)*f;let w=0;const I=T_(i)/2;for(let C=0;C<i.length-1;C++){const P=i[C],z=i[C+1],L=P.dist(z);if(w+L>I){const B=(I-w)/L,j=on.number(P.x,z.x,B),q=on.number(P.y,z.y,B),Y=new ps(j,q,z.angleTo(P),C);return Y._round(),!y||S_(i,Y,_,y,e)?Y:void 0}w+=L}}function n2(i,e,r,a,u,f,y,_,w){const I=k_(a,f,y),C=I_(a,u),P=C*y,z=i[0].x===0||i[0].x===w||i[0].y===0||i[0].y===w;return e-P<e/4&&(e=P+e/4),C_(i,z?e/2*_%e:(C/2+2*f)*y*_%e,e,I,r,P,z,!1,w)}function C_(i,e,r,a,u,f,y,_,w){const I=f/2,C=T_(i);let P=0,z=e-r,L=[];for(let B=0;B<i.length-1;B++){const j=i[B],q=i[B+1],Y=j.dist(q),ue=q.angleTo(j);for(;z+r<P+Y;){z+=r;const ee=(z-P)/Y,le=on.number(j.x,q.x,ee),ge=on.number(j.y,q.y,ee);if(le>=0&&le<w&&ge>=0&&ge<w&&z-I>=0&&z+I<=C){const Se=new ps(le,ge,ue,B);Se._round(),a&&!S_(i,Se,f,a,u)||L.push(Se)}}P+=Y}return _||L.length||y||(L=C_(i,P/2,r,a,u,f,y,!0,w)),L}We("Anchor",ps);const vl=Bn;function E_(i,e,r,a){const u=[],f=i.image,y=f.pixelRatio,_=f.paddedRect.w-2*vl,w=f.paddedRect.h-2*vl;let I={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const C=f.stretchX||[[0,_]],P=f.stretchY||[[0,w]],z=(xe,tt)=>xe+tt[1]-tt[0],L=C.reduce(z,0),B=P.reduce(z,0),j=_-L,q=w-B;let Y=0,ue=L,ee=0,le=B,ge=0,Se=j,Oe=0,st=q;if(f.content&&a){const xe=f.content,tt=xe[2]-xe[0],Je=xe[3]-xe[1];(f.textFitWidth||f.textFitHeight)&&(I=t_(i)),Y=id(C,0,xe[0]),ee=id(P,0,xe[1]),ue=id(C,xe[0],xe[2]),le=id(P,xe[1],xe[3]),ge=xe[0]-Y,Oe=xe[1]-ee,Se=tt-ue,st=Je-le}const je=I.x1,Fe=I.y1,Qe=I.x2-je,He=I.y2-Fe,Ge=(xe,tt,Je,ut)=>{const $t=nd(xe.stretch-Y,ue,Qe,je),Vt=rd(xe.fixed-ge,Se,xe.stretch,L),zi=nd(tt.stretch-ee,le,He,Fe),_r=rd(tt.fixed-Oe,st,tt.stretch,B),Yi=nd(Je.stretch-Y,ue,Qe,je),pi=rd(Je.fixed-ge,Se,Je.stretch,L),wn=nd(ut.stretch-ee,le,He,Fe),bn=rd(ut.fixed-Oe,st,ut.stretch,B),Sn=new X($t,zi),fi=new X(Yi,zi),Di=new X(Yi,wn),an=new X($t,wn),Ji=new X(Vt/y,_r/y),Tn=new X(pi/y,bn/y),Qi=e*Math.PI/180;if(Qi){const At=Math.sin(Qi),qt=Math.cos(Qi),Yt=[qt,-At,At,qt];Sn._matMult(Yt),fi._matMult(Yt),an._matMult(Yt),Di._matMult(Yt)}const or=xe.stretch+xe.fixed,On=tt.stretch+tt.fixed;return{tl:Sn,tr:fi,bl:an,br:Di,tex:{x:f.paddedRect.x+vl+or,y:f.paddedRect.y+vl+On,w:Je.stretch+Je.fixed-or,h:ut.stretch+ut.fixed-On},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ji,pixelOffsetBR:Tn,minFontScaleX:Se/y/Qe,minFontScaleY:st/y/He,isSDF:r}};if(a&&(f.stretchX||f.stretchY)){const xe=P_(C,j,L),tt=P_(P,q,B);for(let Je=0;Je<xe.length-1;Je++){const ut=xe[Je],$t=xe[Je+1];for(let Vt=0;Vt<tt.length-1;Vt++)u.push(Ge(ut,tt[Vt],$t,tt[Vt+1]))}}else u.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:w+1}));return u}function id(i,e,r){let a=0;for(const u of i)a+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return a}function P_(i,e,r){const a=[{fixed:-vl,stretch:0}];for(const[u,f]of i){const y=a[a.length-1];a.push({fixed:u-y.stretch,stretch:y.stretch}),a.push({fixed:u-y.stretch,stretch:y.stretch+(f-u)})}return a.push({fixed:e+vl,stretch:r}),a}function nd(i,e,r,a){return i/e*r+a}function rd(i,e,r,a){return i-e*r/a}class od{constructor(e,r,a,u,f,y,_,w,I,C){var P;if(this.boxStartIndex=e.length,I){let z=y.top,L=y.bottom;const B=y.collisionPadding;B&&(z-=B[1],L+=B[3]);let j=L-z;j>0&&(j=Math.max(10,j),this.circleDiameter=j)}else{const z=!((P=y.image)===null||P===void 0)&&P.content&&(y.image.textFitWidth||y.image.textFitHeight)?t_(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};z.y1=z.y1*_-w[0],z.y2=z.y2*_+w[2],z.x1=z.x1*_-w[3],z.x2=z.x2*_+w[1];const L=y.collisionPadding;if(L&&(z.x1-=L[0]*_,z.y1-=L[1]*_,z.x2+=L[2]*_,z.y2+=L[3]*_),C){const B=new X(z.x1,z.y1),j=new X(z.x2,z.y1),q=new X(z.x1,z.y2),Y=new X(z.x2,z.y2),ue=C*Math.PI/180;B._rotate(ue),j._rotate(ue),q._rotate(ue),Y._rotate(ue),z.x1=Math.min(B.x,j.x,q.x,Y.x),z.x2=Math.max(B.x,j.x,q.x,Y.x),z.y1=Math.min(B.y,j.y,q.y,Y.y),z.y2=Math.max(B.y,j.y,q.y,Y.y)}e.emplaceBack(r.x,r.y,z.x1,z.y1,z.x2,z.y2,a,u,f)}this.boxEndIndex=e.length}}class r2{constructor(e=[],r=o2){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,u=r[e];for(;e>0;){const f=e-1>>1,y=r[f];if(a(u,y)>=0)break;r[e]=y,e=f}r[e]=u}_down(e){const{data:r,compare:a}=this,u=this.length>>1,f=r[e];for(;e<u;){let y=1+(e<<1),_=r[y];const w=y+1;if(w<this.length&&a(r[w],_)<0&&(y=w,_=r[w]),a(_,f)>=0)break;r[e]=_,e=y}r[e]=f}}function o2(i,e){return i<e?-1:i>e?1:0}function s2(i,e=1,r=!1){let a=1/0,u=1/0,f=-1/0,y=-1/0;const _=i[0];for(let L=0;L<_.length;L++){const B=_[L];(!L||B.x<a)&&(a=B.x),(!L||B.y<u)&&(u=B.y),(!L||B.x>f)&&(f=B.x),(!L||B.y>y)&&(y=B.y)}const w=Math.min(f-a,y-u);let I=w/2;const C=new r2([],a2);if(w===0)return new X(a,u);for(let L=a;L<f;L+=w)for(let B=u;B<y;B+=w)C.push(new xl(L+I,B+I,I,i));let P=function(L){let B=0,j=0,q=0;const Y=L[0];for(let ue=0,ee=Y.length,le=ee-1;ue<ee;le=ue++){const ge=Y[ue],Se=Y[le],Oe=ge.x*Se.y-Se.x*ge.y;j+=(ge.x+Se.x)*Oe,q+=(ge.y+Se.y)*Oe,B+=3*Oe}return new xl(j/B,q/B,0,L)}(i),z=C.length;for(;C.length;){const L=C.pop();(L.d>P.d||!P.d)&&(P=L,r&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,z)),L.max-P.d<=e||(I=L.h/2,C.push(new xl(L.p.x-I,L.p.y-I,I,i)),C.push(new xl(L.p.x+I,L.p.y-I,I,i)),C.push(new xl(L.p.x-I,L.p.y+I,I,i)),C.push(new xl(L.p.x+I,L.p.y+I,I,i)),z+=4)}return r&&(console.log(`num probes: ${z}`),console.log(`best distance: ${P.d}`)),P.p}function a2(i,e){return e.max-i.max}function xl(i,e,r,a){this.p=new X(i,e),this.h=r,this.d=function(u,f){let y=!1,_=1/0;for(let w=0;w<f.length;w++){const I=f[w];for(let C=0,P=I.length,z=P-1;C<P;z=C++){const L=I[C],B=I[z];L.y>u.y!=B.y>u.y&&u.x<(B.x-L.x)*(u.y-L.y)/(B.y-L.y)+L.x&&(y=!y),_=Math.min(_,dy(u,L,B))}}return(y?1:-1)*Math.sqrt(_)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Xi;S.aq=void 0,(Xi=S.aq||(S.aq={}))[Xi.center=1]="center",Xi[Xi.left=2]="left",Xi[Xi.right=3]="right",Xi[Xi.top=4]="top",Xi[Xi.bottom=5]="bottom",Xi[Xi["top-left"]=6]="top-left",Xi[Xi["top-right"]=7]="top-right",Xi[Xi["bottom-left"]=8]="bottom-left",Xi[Xi["bottom-right"]=9]="bottom-right";const fs=7,Pf=Number.POSITIVE_INFINITY;function M_(i,e){return e[1]!==Pf?function(r,a,u){let f=0,y=0;switch(a=Math.abs(a),u=Math.abs(u),r){case"top-right":case"top-left":case"top":y=u-fs;break;case"bottom-right":case"bottom-left":case"bottom":y=-u+fs}switch(r){case"top-right":case"bottom-right":case"right":f=-a;break;case"top-left":case"bottom-left":case"left":f=a}return[f,y]}(i,e[0],e[1]):function(r,a){let u=0,f=0;a<0&&(a=0);const y=a/Math.SQRT2;switch(r){case"top-right":case"top-left":f=y-fs;break;case"bottom-right":case"bottom-left":f=-y+fs;break;case"bottom":f=-a+fs;break;case"top":f=a-fs}switch(r){case"top-right":case"bottom-right":u=-y;break;case"top-left":case"bottom-left":u=y;break;case"left":u=a;break;case"right":u=-a}return[u,f]}(i,e[0])}function A_(i,e,r){var a;const u=i.layout,f=(a=u.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(e,{},r);if(f){const _=f.values,w=[];for(let I=0;I<_.length;I+=2){const C=w[I]=_[I],P=_[I+1].map(z=>z*Ei);C.startsWith("top")?P[1]-=fs:C.startsWith("bottom")&&(P[1]+=fs),w[I+1]=P}return new yn(w)}const y=u.get("text-variable-anchor");if(y){let _;_=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},r)*Ei,Pf]:u.get("text-offset").evaluate(e,{},r).map(I=>I*Ei);const w=[];for(const I of y)w.push(I,M_(I,_));return new yn(w)}return null}function Mf(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function l2(i,e,r,a,u,f,y,_,w,I,C){let P=f.textMaxSize.evaluate(e,{});P===void 0&&(P=y);const z=i.layers[0].layout,L=z.get("icon-offset").evaluate(e,{},C),B=D_(r.horizontal),j=y/24,q=i.tilePixelRatio*j,Y=i.tilePixelRatio*P/24,ue=i.tilePixelRatio*_,ee=i.tilePixelRatio*z.get("symbol-spacing"),le=z.get("text-padding")*i.tilePixelRatio,ge=function(xe,tt,Je,ut=1){const $t=xe.get("icon-padding").evaluate(tt,{},Je),Vt=$t&&$t.values;return[Vt[0]*ut,Vt[1]*ut,Vt[2]*ut,Vt[3]*ut]}(z,e,C,i.tilePixelRatio),Se=z.get("text-max-angle")/180*Math.PI,Oe=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",st=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",je=z.get("symbol-placement"),Fe=ee/2,Qe=z.get("icon-text-fit");let He;a&&Qe!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(He=i_(a,r.vertical,Qe,z.get("icon-text-fit-padding"),L,j)),B&&(a=i_(a,B,Qe,z.get("icon-text-fit-padding"),L,j)));const Ge=(xe,tt)=>{tt.x<0||tt.x>=Si||tt.y<0||tt.y>=Si||function(Je,ut,$t,Vt,zi,_r,Yi,pi,wn,bn,Sn,fi,Di,an,Ji,Tn,Qi,or,On,At,qt,Yt,Wn,ai,wl){const io=Je.addToLineVertexArray(ut,$t);let no,vr,sr,Ni,Io=0,au=0,B_=0,O_=0,Of=-1,Nf=-1;const Co={};let N_=cl("");if(Je.allowVerticalPlacement&&Vt.vertical){const ln=pi.layout.get("text-rotate").evaluate(qt,{},ai)+90;sr=new od(wn,ut,bn,Sn,fi,Vt.vertical,Di,an,Ji,ln),Yi&&(Ni=new od(wn,ut,bn,Sn,fi,Yi,Qi,or,Ji,ln))}if(zi){const ln=pi.layout.get("icon-rotate").evaluate(qt,{}),ar=pi.layout.get("icon-text-fit")!=="none",la=E_(zi,ln,Wn,ar),Or=Yi?E_(Yi,ln,Wn,ar):void 0;vr=new od(wn,ut,bn,Sn,fi,zi,Qi,or,!1,ln),Io=4*la.length;const ca=Je.iconSizeData;let ro=null;ca.kind==="source"?(ro=[to*pi.layout.get("icon-size").evaluate(qt,{})],ro[0]>hs&&Ut(`${Je.layerIds[0]}: Value for "icon-size" is >= ${nu}. Reduce your "icon-size".`)):ca.kind==="composite"&&(ro=[to*Yt.compositeIconSizes[0].evaluate(qt,{},ai),to*Yt.compositeIconSizes[1].evaluate(qt,{},ai)],(ro[0]>hs||ro[1]>hs)&&Ut(`${Je.layerIds[0]}: Value for "icon-size" is >= ${nu}. Reduce your "icon-size".`)),Je.addSymbols(Je.icon,la,ro,At,On,qt,S.ah.none,ut,io.lineStartIndex,io.lineLength,-1,ai),Of=Je.icon.placedSymbolArray.length-1,Or&&(au=4*Or.length,Je.addSymbols(Je.icon,Or,ro,At,On,qt,S.ah.vertical,ut,io.lineStartIndex,io.lineLength,-1,ai),Nf=Je.icon.placedSymbolArray.length-1)}const j_=Object.keys(Vt.horizontal);for(const ln of j_){const ar=Vt.horizontal[ln];if(!no){N_=cl(ar.text);const Or=pi.layout.get("text-rotate").evaluate(qt,{},ai);no=new od(wn,ut,bn,Sn,fi,ar,Di,an,Ji,Or)}const la=ar.positionedLines.length===1;if(B_+=z_(Je,ut,ar,_r,pi,Ji,qt,Tn,io,Vt.vertical?S.ah.horizontal:S.ah.horizontalOnly,la?j_:[ln],Co,Of,Yt,ai),la)break}Vt.vertical&&(O_+=z_(Je,ut,Vt.vertical,_r,pi,Ji,qt,Tn,io,S.ah.vertical,["vertical"],Co,Nf,Yt,ai));const h2=no?no.boxStartIndex:Je.collisionBoxArray.length,d2=no?no.boxEndIndex:Je.collisionBoxArray.length,p2=sr?sr.boxStartIndex:Je.collisionBoxArray.length,f2=sr?sr.boxEndIndex:Je.collisionBoxArray.length,m2=vr?vr.boxStartIndex:Je.collisionBoxArray.length,g2=vr?vr.boxEndIndex:Je.collisionBoxArray.length,y2=Ni?Ni.boxStartIndex:Je.collisionBoxArray.length,_2=Ni?Ni.boxEndIndex:Je.collisionBoxArray.length;let Br=-1;const ad=(ln,ar)=>ln&&ln.circleDiameter?Math.max(ln.circleDiameter,ar):ar;Br=ad(no,Br),Br=ad(sr,Br),Br=ad(vr,Br),Br=ad(Ni,Br);const V_=Br>-1?1:0;V_&&(Br*=wl/Ei),Je.glyphOffsetArray.length>=_l.MAX_GLYPHS&&Ut("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),qt.sortKey!==void 0&&Je.addToSortKeyRanges(Je.symbolInstances.length,qt.sortKey);const v2=A_(pi,qt,ai),[x2,w2]=function(ln,ar){const la=ln.length,Or=ar==null?void 0:ar.values;if((Or==null?void 0:Or.length)>0)for(let ca=0;ca<Or.length;ca+=2){const ro=Or[ca+1];ln.emplaceBack(S.aq[Or[ca]],ro[0],ro[1])}return[la,ln.length]}(Je.textAnchorOffsets,v2);Je.symbolInstances.emplaceBack(ut.x,ut.y,Co.right>=0?Co.right:-1,Co.center>=0?Co.center:-1,Co.left>=0?Co.left:-1,Co.vertical||-1,Of,Nf,N_,h2,d2,p2,f2,m2,g2,y2,_2,bn,B_,O_,Io,au,V_,0,Di,Br,x2,w2)}(i,tt,xe,r,a,u,He,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,q,[le,le,le,le],Oe,w,ue,ge,st,L,e,f,I,C,y)};if(je==="line")for(const xe of b_(e.geometry,0,0,Si,Si)){const tt=n2(xe,ee,Se,r.vertical||B,a,24,Y,i.overscaling,Si);for(const Je of tt)B&&c2(i,B.text,Fe,Je)||Ge(xe,Je)}else if(je==="line-center"){for(const xe of e.geometry)if(xe.length>1){const tt=i2(xe,Se,r.vertical||B,a,24,Y);tt&&Ge(xe,tt)}}else if(e.type==="Polygon")for(const xe of Ba(e.geometry,0)){const tt=s2(xe,16);Ge(xe[0],new ps(tt.x,tt.y,0))}else if(e.type==="LineString")for(const xe of e.geometry)Ge(xe,new ps(xe[0].x,xe[0].y,0));else if(e.type==="Point")for(const xe of e.geometry)for(const tt of xe)Ge([tt],new ps(tt.x,tt.y,0))}function z_(i,e,r,a,u,f,y,_,w,I,C,P,z,L,B){const j=function(ue,ee,le,ge,Se,Oe,st,je){const Fe=ge.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,Qe=[];for(const He of ee.positionedLines)for(const Ge of He.positionedGlyphs){if(!Ge.rect)continue;const xe=Ge.rect||{};let tt=Hy+1,Je=!0,ut=1,$t=0;const Vt=(Se||je)&&Ge.vertical,zi=Ge.metrics.advance*Ge.scale/2;if(je&&ee.verticalizable&&($t=He.lineOffset/2-(Ge.imageName?-(Ei-Ge.metrics.width*Ge.scale)/2:(Ge.scale-1)*Ei)),Ge.imageName){const At=st[Ge.imageName];Je=At.sdf,ut=At.pixelRatio,tt=Bn/ut}const _r=Se?[Ge.x+zi,Ge.y]:[0,0];let Yi=Se?[0,0]:[Ge.x+zi+le[0],Ge.y+le[1]-$t],pi=[0,0];Vt&&(pi=Yi,Yi=[0,0]);const wn=Ge.metrics.isDoubleResolution?2:1,bn=(Ge.metrics.left-tt)*Ge.scale-zi+Yi[0],Sn=(-Ge.metrics.top-tt)*Ge.scale+Yi[1],fi=bn+xe.w/wn*Ge.scale/ut,Di=Sn+xe.h/wn*Ge.scale/ut,an=new X(bn,Sn),Ji=new X(fi,Sn),Tn=new X(bn,Di),Qi=new X(fi,Di);if(Vt){const At=new X(-zi,zi-tu),qt=-Math.PI/2,Yt=Ei/2-zi,Wn=new X(5-tu-Yt,-(Ge.imageName?Yt:0)),ai=new X(...pi);an._rotateAround(qt,At)._add(Wn)._add(ai),Ji._rotateAround(qt,At)._add(Wn)._add(ai),Tn._rotateAround(qt,At)._add(Wn)._add(ai),Qi._rotateAround(qt,At)._add(Wn)._add(ai)}if(Fe){const At=Math.sin(Fe),qt=Math.cos(Fe),Yt=[qt,-At,At,qt];an._matMult(Yt),Ji._matMult(Yt),Tn._matMult(Yt),Qi._matMult(Yt)}const or=new X(0,0),On=new X(0,0);Qe.push({tl:an,tr:Ji,bl:Tn,br:Qi,tex:xe,writingMode:ee.writingMode,glyphOffset:_r,sectionIndex:Ge.sectionIndex,isSDF:Je,pixelOffsetTL:or,pixelOffsetBR:On,minFontScaleX:0,minFontScaleY:0})}return Qe}(0,r,_,u,f,y,a,i.allowVerticalPlacement),q=i.textSizeData;let Y=null;q.kind==="source"?(Y=[to*u.layout.get("text-size").evaluate(y,{})],Y[0]>hs&&Ut(`${i.layerIds[0]}: Value for "text-size" is >= ${nu}. Reduce your "text-size".`)):q.kind==="composite"&&(Y=[to*L.compositeTextSizes[0].evaluate(y,{},B),to*L.compositeTextSizes[1].evaluate(y,{},B)],(Y[0]>hs||Y[1]>hs)&&Ut(`${i.layerIds[0]}: Value for "text-size" is >= ${nu}. Reduce your "text-size".`)),i.addSymbols(i.text,j,Y,_,f,y,I,e,w.lineStartIndex,w.lineLength,z,B);for(const ue of C)P[ue]=i.text.placedSymbolArray.length-1;return 4*j.length}function D_(i){for(const e in i)return i[e];return null}function c2(i,e,r,a){const u=i.compareText;if(e in u){const f=u[e];for(let y=f.length-1;y>=0;y--)if(a.dist(f[y])<r)return!0}else u[e]=[];return u[e].push(a),!1}const L_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Af{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=L_[15&a];if(!f)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new Af(_,y,f,e)}constructor(e,r=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=L_.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-_%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+_+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return zf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:y,nodeSize:_}=this,w=[0,f.length-1,0],I=[];for(;w.length;){const C=w.pop()||0,P=w.pop()||0,z=w.pop()||0;if(P-z<=_){for(let q=z;q<=P;q++){const Y=y[2*q],ue=y[2*q+1];Y>=e&&Y<=a&&ue>=r&&ue<=u&&I.push(f[q])}continue}const L=z+P>>1,B=y[2*L],j=y[2*L+1];B>=e&&B<=a&&j>=r&&j<=u&&I.push(f[L]),(C===0?e<=B:r<=j)&&(w.push(z),w.push(L-1),w.push(1-C)),(C===0?a>=B:u>=j)&&(w.push(L+1),w.push(P),w.push(1-C))}return I}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:y}=this,_=[0,u.length-1,0],w=[],I=a*a;for(;_.length;){const C=_.pop()||0,P=_.pop()||0,z=_.pop()||0;if(P-z<=y){for(let q=z;q<=P;q++)F_(f[2*q],f[2*q+1],e,r)<=I&&w.push(u[q]);continue}const L=z+P>>1,B=f[2*L],j=f[2*L+1];F_(B,j,e,r)<=I&&w.push(u[L]),(C===0?e-a<=B:r-a<=j)&&(_.push(z),_.push(L-1),_.push(1-C)),(C===0?e+a>=B:r+a>=j)&&(_.push(L+1),_.push(P),_.push(1-C))}return w}}function zf(i,e,r,a,u,f){if(u-a<=r)return;const y=a+u>>1;R_(i,e,y,a,u,f),zf(i,e,r,a,y-1,1-f),zf(i,e,r,y+1,u,1-f)}function R_(i,e,r,a,u,f){for(;u>a;){if(u-a>600){const I=u-a+1,C=r-a+1,P=Math.log(I),z=.5*Math.exp(2*P/3),L=.5*Math.sqrt(P*z*(I-z)/I)*(C-I/2<0?-1:1);R_(i,e,r,Math.max(a,Math.floor(r-C*z/I+L)),Math.min(u,Math.floor(r+(I-C)*z/I+L)),f)}const y=e[2*r+f];let _=a,w=u;for(ou(i,e,a,r),e[2*u+f]>y&&ou(i,e,a,u);_<w;){for(ou(i,e,_,w),_++,w--;e[2*_+f]<y;)_++;for(;e[2*w+f]>y;)w--}e[2*a+f]===y?ou(i,e,a,w):(w++,ou(i,e,w,u)),w<=r&&(a=w+1),r<=w&&(u=w-1)}}function ou(i,e,r,a){Df(i,r,a),Df(e,2*r,2*a),Df(e,2*r+1,2*a+1)}function Df(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}function F_(i,e,r,a){const u=i-r,f=e-a;return u*u+f*f}var Lf;S.be=void 0,(Lf=S.be||(S.be={})).create="create",Lf.load="load",Lf.fullLoad="fullLoad";let sd=null,su=[];const Rf=1e3/60,Ff="loadTime",Bf="fullLoadTime",u2={mark(i){performance.mark(i)},frame(i){const e=i;sd!=null&&su.push(e-sd),sd=e},clearMetrics(){sd=null,su=[],performance.clearMeasures(Ff),performance.clearMeasures(Bf);for(const i in S.be)performance.clearMarks(S.be[i])},getPerformanceMetrics(){performance.measure(Ff,S.be.create,S.be.load),performance.measure(Bf,S.be.create,S.be.fullLoad);const i=performance.getEntriesByName(Ff)[0].duration,e=performance.getEntriesByName(Bf)[0].duration,r=su.length,a=1/(su.reduce((f,y)=>f+y,0)/r/1e3),u=su.filter(f=>f>Rf).reduce((f,y)=>f+(y-Rf)/Rf,0);return{loadTime:i,fullLoadTime:e,fps:a,percentDroppedFrames:u/(r+u)*100,totalFrames:r}}};S.$=Ci,S.A=dl,S.B=function(i){if(Pn==null){const e=i.navigator?i.navigator.userAgent:null;Pn=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Pn},S.C=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new e2(()=>this.process()),this.subscription=function(r,a,u,f){return r.addEventListener(a,u,!1),{unsubscribe:()=>{r.removeEventListener(a,u,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Ri(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}sendAsync(i,e){return new Promise((r,a)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[u]={resolve:r,reject:a},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[u];const _={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const f=[],y=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:ta(i.data,f)});this.target.postMessage(y,{transfer:f})})}receive(i){const e=i.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const a=this.abortControllers[r];return delete this.abortControllers[r],void(a&&a.abort())}if(Ri(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return d(this,void 0,void 0,function*(){if(e.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(e.error?u.reject(gr(e.error)):u.resolve(gr(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=gr(e.data),a=new AbortController;this.abortControllers[i]=a;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,r,a);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}})}completeTask(i,e,r){const a=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?ta(e):null,data:ta(r,a)};this.target.postMessage(u,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.D=et,S.E=jo,S.F=function(){var i=new dl(16);return dl!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},S.G=Bi,S.H=function(i,e,r){var a,u,f,y,_,w,I,C,P,z,L,B,j=r[0],q=r[1],Y=r[2];return e===i?(i[12]=e[0]*j+e[4]*q+e[8]*Y+e[12],i[13]=e[1]*j+e[5]*q+e[9]*Y+e[13],i[14]=e[2]*j+e[6]*q+e[10]*Y+e[14],i[15]=e[3]*j+e[7]*q+e[11]*Y+e[15]):(u=e[1],f=e[2],y=e[3],_=e[4],w=e[5],I=e[6],C=e[7],P=e[8],z=e[9],L=e[10],B=e[11],i[0]=a=e[0],i[1]=u,i[2]=f,i[3]=y,i[4]=_,i[5]=w,i[6]=I,i[7]=C,i[8]=P,i[9]=z,i[10]=L,i[11]=B,i[12]=a*j+_*q+P*Y+e[12],i[13]=u*j+w*q+z*Y+e[13],i[14]=f*j+I*q+L*Y+e[14],i[15]=y*j+C*q+B*Y+e[15]),i},S.I=_f,S.J=function(i,e,r){var a=r[0],u=r[1],f=r[2];return i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a,i[3]=e[3]*a,i[4]=e[4]*u,i[5]=e[5]*u,i[6]=e[6]*u,i[7]=e[7]*u,i[8]=e[8]*f,i[9]=e[9]*f,i[10]=e[10]*f,i[11]=e[11]*f,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},S.K=gy,S.L=function(i,e){const r={};for(let a=0;a<e.length;a++){const u=e[a];u in i&&(r[u]=i[u])}return r},S.M=ds,S.N=h_,S.O=d_,S.P=X,S.Q=rr,S.R=nr,S.S=oe,S.T=ns,S.U=ne,S.V=ft,S.W=Si,S.X=E,S.Y=td,S.Z=class extends N{},S._=d,S.a=dn,S.a$=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},S.a0=Ef,S.a1=ze,S.a2=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(r=>{e.onloadstart=()=>{r(e)};for(const a of i){const u=window.document.createElement("source");No(a)||(e.crossOrigin="Anonymous"),u.src=a,e.appendChild(u)}})},S.a3=function(){return Xe++},S.a4=bt,S.a5=_l,S.a6=kc,S.a7=sa,S.a8=Zt,S.a9=__,S.aA=function(i){if(i.type==="custom")return new Qw(i);switch(i.type){case"background":return new Xw(i);case"circle":return new Bx(i);case"fill":return new ew(i);case"fill-extrusion":return new mw(i);case"heatmap":return new Nx(i);case"hillshade":return new Vx(i);case"line":return new Sw(i);case"raster":return new Jw(i);case"symbol":return new ed(i)}},S.aB=pt,S.aC=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let r=[];try{if(!Dt(i.version,e.version))return[{command:"setStyle",args:[e]}];Dt(i.center,e.center)||r.push({command:"setCenter",args:[e.center]}),Dt(i.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),Dt(i.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),Dt(i.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),Dt(i.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),Dt(i.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),Dt(i.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),Dt(i.light,e.light)||r.push({command:"setLight",args:[e.light]}),Dt(i.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),Dt(i.sky,e.sky)||r.push({command:"setSky",args:[e.sky]}),Dt(i.projection,e.projection)||r.push({command:"setProjection",args:[e.projection]});const a={},u=[];(function(y,_,w,I){let C;for(C in _=_||{},y=y||{})Object.prototype.hasOwnProperty.call(y,C)&&(Object.prototype.hasOwnProperty.call(_,C)||Vo(C,w,I));for(C in _)Object.prototype.hasOwnProperty.call(_,C)&&(Object.prototype.hasOwnProperty.call(y,C)?Dt(y[C],_[C])||(y[C].type==="geojson"&&_[C].type==="geojson"&&Uo(y,_,C)?Jt(w,{command:"setGeoJSONSourceData",args:[C,_[C].data]}):Fs(C,_,w,I)):Cr(C,_,w))})(i.sources,e.sources,u,a);const f=[];i.layers&&i.layers.forEach(y=>{"source"in y&&a[y.source]?r.push({command:"removeLayer",args:[y.id]}):f.push(y)}),r=r.concat(u),function(y,_,w){_=_||[];const I=(y=y||[]).map($o),C=_.map($o),P=y.reduce(Ia,{}),z=_.reduce(Ia,{}),L=I.slice(),B=Object.create(null);let j,q,Y,ue,ee;for(let le=0,ge=0;le<I.length;le++)j=I[le],Object.prototype.hasOwnProperty.call(z,j)?ge++:(Jt(w,{command:"removeLayer",args:[j]}),L.splice(L.indexOf(j,ge),1));for(let le=0,ge=0;le<C.length;le++)j=C[C.length-1-le],L[L.length-1-le]!==j&&(Object.prototype.hasOwnProperty.call(P,j)?(Jt(w,{command:"removeLayer",args:[j]}),L.splice(L.lastIndexOf(j,L.length-ge),1)):ge++,ue=L[L.length-le],Jt(w,{command:"addLayer",args:[z[j],ue]}),L.splice(L.length-le,0,j),B[j]=!0);for(let le=0;le<C.length;le++)if(j=C[le],q=P[j],Y=z[j],!B[j]&&!Dt(q,Y))if(Dt(q.source,Y.source)&&Dt(q["source-layer"],Y["source-layer"])&&Dt(q.type,Y.type)){for(ee in Er(q.layout,Y.layout,w,j,null,"setLayoutProperty"),Er(q.paint,Y.paint,w,j,null,"setPaintProperty"),Dt(q.filter,Y.filter)||Jt(w,{command:"setFilter",args:[j,Y.filter]}),Dt(q.minzoom,Y.minzoom)&&Dt(q.maxzoom,Y.maxzoom)||Jt(w,{command:"setLayerZoomRange",args:[j,Y.minzoom,Y.maxzoom]}),q)Object.prototype.hasOwnProperty.call(q,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Er(q[ee],Y[ee],w,j,ee.slice(6),"setPaintProperty"):Dt(q[ee],Y[ee])||Jt(w,{command:"setLayerProperty",args:[j,ee,Y[ee]]}));for(ee in Y)Object.prototype.hasOwnProperty.call(Y,ee)&&!Object.prototype.hasOwnProperty.call(q,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Er(q[ee],Y[ee],w,j,ee.slice(6),"setPaintProperty"):Dt(q[ee],Y[ee])||Jt(w,{command:"setLayerProperty",args:[j,ee,Y[ee]]}))}else Jt(w,{command:"removeLayer",args:[j]}),ue=L[L.lastIndexOf(j)+1],Jt(w,{command:"addLayer",args:[Y,ue]})}(f,e.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:"setStyle",args:[e]}]}return r},S.aD=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},S.aE=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let a=0;a<e.length;a++)if(!i(e[a],r[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(!i(e[a],r[a]))return!1;return!0}return e===r},S.aF=xt,S.aG=rt,S.aH=class extends na{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},S.aI=jh,S.aJ=class extends na{constructor(i,e){super(i,e),this.current=Px}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},S.aK=oy,S.aL=class extends na{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},S.aM=class extends na{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},S.aN=sy,S.aO=function(i,e,r,a,u,f,y){var _=1/(e-r),w=1/(a-u),I=1/(f-y);return i[0]=-2*_,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*I,i[11]=0,i[12]=(e+r)*_,i[13]=(u+a)*w,i[14]=(y+f)*I,i[15]=1,i},S.aP=Ot,S.aQ=Fx,S.aR=class extends we{},S.aS=Cw,S.aT=class extends Ze{},S.aU=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},S.aV=wy,S.aW=bo,S.aX=class extends Ne{},S.aY=Ai,S.aZ=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},S.a_=function(i,e){var r=i[0],a=i[1],u=i[2],f=i[3],y=i[4],_=i[5],w=i[6],I=i[7],C=i[8],P=i[9],z=i[10],L=i[11],B=i[12],j=i[13],q=i[14],Y=i[15],ue=e[0],ee=e[1],le=e[2],ge=e[3],Se=e[4],Oe=e[5],st=e[6],je=e[7],Fe=e[8],Qe=e[9],He=e[10],Ge=e[11],xe=e[12],tt=e[13],Je=e[14],ut=e[15];return Math.abs(r-ue)<=xn*Math.max(1,Math.abs(r),Math.abs(ue))&&Math.abs(a-ee)<=xn*Math.max(1,Math.abs(a),Math.abs(ee))&&Math.abs(u-le)<=xn*Math.max(1,Math.abs(u),Math.abs(le))&&Math.abs(f-ge)<=xn*Math.max(1,Math.abs(f),Math.abs(ge))&&Math.abs(y-Se)<=xn*Math.max(1,Math.abs(y),Math.abs(Se))&&Math.abs(_-Oe)<=xn*Math.max(1,Math.abs(_),Math.abs(Oe))&&Math.abs(w-st)<=xn*Math.max(1,Math.abs(w),Math.abs(st))&&Math.abs(I-je)<=xn*Math.max(1,Math.abs(I),Math.abs(je))&&Math.abs(C-Fe)<=xn*Math.max(1,Math.abs(C),Math.abs(Fe))&&Math.abs(P-Qe)<=xn*Math.max(1,Math.abs(P),Math.abs(Qe))&&Math.abs(z-He)<=xn*Math.max(1,Math.abs(z),Math.abs(He))&&Math.abs(L-Ge)<=xn*Math.max(1,Math.abs(L),Math.abs(Ge))&&Math.abs(B-xe)<=xn*Math.max(1,Math.abs(B),Math.abs(xe))&&Math.abs(j-tt)<=xn*Math.max(1,Math.abs(j),Math.abs(tt))&&Math.abs(q-Je)<=xn*Math.max(1,Math.abs(q),Math.abs(Je))&&Math.abs(Y-ut)<=xn*Math.max(1,Math.abs(Y),Math.abs(ut))},S.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,u,f)=>{const y=u||f;return e[a]=!y||y.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},S.ab=function(i,e){const r=[];for(const a in i)a in e||r.push(a);return r},S.ac=Be,S.ad=function(i,e,r){var a=Math.sin(r),u=Math.cos(r),f=e[0],y=e[1],_=e[2],w=e[3],I=e[4],C=e[5],P=e[6],z=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=f*u+I*a,i[1]=y*u+C*a,i[2]=_*u+P*a,i[3]=w*u+z*a,i[4]=I*u-f*a,i[5]=C*u-y*a,i[6]=P*u-_*a,i[7]=z*u-w*a,i},S.ae=function(i){var e=new dl(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},S.af=Zh,S.ag=function(i,e){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:y}=i,_=u?Be(Dn.interpolationFactor(u,e,f,y),0,1):0;i.kind==="camera"?a=on.number(i.minSize,i.maxSize,_):r=_}return{uSizeT:r,uSize:a}},S.ai=function(i,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:u}){return i.kind==="source"?a/to:i.kind==="composite"?on.number(a/to,u/to,r):e},S.aj=bf,S.ak=function(i,e,r,a){const u=e.y-i.y,f=e.x-i.x,y=a.y-r.y,_=a.x-r.x,w=y*f-_*u;if(w===0)return null;const I=(_*(i.y-r.y)-y*(i.x-r.x))/w;return new X(i.x+I*f,i.y+I*u)},S.al=b_,S.am=uy,S.an=tf,S.ao=function(i){let e=1/0,r=1/0,a=-1/0,u=-1/0;for(const f of i)e=Math.min(e,f.x),r=Math.min(r,f.y),a=Math.max(a,f.x),u=Math.max(u,f.y);return[e,r,a,u]},S.ap=Ei,S.ar=wf,S.as=function(i,e){var r=e[0],a=e[1],u=e[2],f=e[3],y=e[4],_=e[5],w=e[6],I=e[7],C=e[8],P=e[9],z=e[10],L=e[11],B=e[12],j=e[13],q=e[14],Y=e[15],ue=r*_-a*y,ee=r*w-u*y,le=r*I-f*y,ge=a*w-u*_,Se=a*I-f*_,Oe=u*I-f*w,st=C*j-P*B,je=C*q-z*B,Fe=C*Y-L*B,Qe=P*q-z*j,He=P*Y-L*j,Ge=z*Y-L*q,xe=ue*Ge-ee*He+le*Qe+ge*Fe-Se*je+Oe*st;return xe?(i[0]=(_*Ge-w*He+I*Qe)*(xe=1/xe),i[1]=(u*He-a*Ge-f*Qe)*xe,i[2]=(j*Oe-q*Se+Y*ge)*xe,i[3]=(z*Se-P*Oe-L*ge)*xe,i[4]=(w*Fe-y*Ge-I*je)*xe,i[5]=(r*Ge-u*Fe+f*je)*xe,i[6]=(q*le-B*Oe-Y*ee)*xe,i[7]=(C*Oe-z*le+L*ee)*xe,i[8]=(y*He-_*Fe+I*st)*xe,i[9]=(a*Fe-r*He-f*st)*xe,i[10]=(B*Se-j*le+Y*ue)*xe,i[11]=(P*le-C*Se-L*ue)*xe,i[12]=(_*je-y*Qe-w*st)*xe,i[13]=(r*Qe-a*je+u*st)*xe,i[14]=(j*ee-B*ge-q*ue)*xe,i[15]=(C*ge-P*ee+z*ue)*xe,i):null},S.at=Mf,S.au=xf,S.av=Af,S.aw=function(){const i={},e=ye.$version;for(const r in ye.$root){const a=ye.$root[r];if(a.required){let u=null;u=r==="version"?e:a.type==="array"?[]:{},u!=null&&(i[r]=u)}}return i},S.ax=zh,S.ay=Ir,S.az=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Rs(i[r],e[i[r].ref]));return i},S.b=Fi,S.b0=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},S.b1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},S.b2=Re,S.b3=m_,S.b4=p_,S.b5=function(i,e,r,a,u){var f,y=1/Math.tan(e/2);return i[0]=y/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=(u+a)*(f=1/(a-u)),i[14]=2*u*a*f):(i[10]=-1,i[14]=-2*a),i},S.b6=function(i,e,r){var a=Math.sin(r),u=Math.cos(r),f=e[4],y=e[5],_=e[6],w=e[7],I=e[8],C=e[9],P=e[10],z=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=f*u+I*a,i[5]=y*u+C*a,i[6]=_*u+P*a,i[7]=w*u+z*a,i[8]=I*u-f*a,i[9]=C*u-y*a,i[10]=P*u-_*a,i[11]=z*u-w*a,i},S.b7=he,S.b8=Ie,S.b9=function(i){return i*Math.PI/180},S.bA=Ka,S.bB=Jr,S.ba=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},S.bb=class extends F{},S.bc=If,S.bd=u2,S.bf=$i,S.bg=function(i,e){dn.REGISTERED_PROTOCOLS[i]=e},S.bh=function(i){delete dn.REGISTERED_PROTOCOLS[i]},S.bi=function(i,e){const r={};for(let u=0;u<i.length;u++){const f=e&&e[i[u].id]||Gp(i[u]);e&&(e[i[u].id]=f);let y=r[f];y||(y=r[f]=[]),y.push(i[u])}const a=[];for(const u in r)a.push(r[u]);return a},S.bj=We,S.bk=y_,S.bl=v_,S.bm=Xy,S.bn=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Si/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,a=e._unevaluatedLayout._values,u={layoutIconSize:a["icon-size"].possiblyEvaluate(new Zt(i.bucket.zoom+1),i.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Zt(i.bucket.zoom+1),i.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Zt(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:C}=i.bucket.textSizeData;u.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Zt(I),i.canonical),a["text-size"].possiblyEvaluate(new Zt(C),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:C}=i.bucket.iconSizeData;u.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Zt(I),i.canonical),a["icon-size"].possiblyEvaluate(new Zt(C),i.canonical)]}const f=r.get("text-line-height")*Ei,y=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",_=r.get("text-keep-upright"),w=r.get("text-size");for(const I of i.bucket.features){const C=r.get("text-font").evaluate(I,{},i.canonical).join(","),P=w.evaluate(I,{},i.canonical),z=u.layoutTextSize.evaluate(I,{},i.canonical),L=u.layoutIconSize.evaluate(I,{},i.canonical),B={horizontal:{},vertical:void 0},j=I.text;let q,Y=[0,0];if(j){const le=j.toString(),ge=r.get("text-letter-spacing").evaluate(I,{},i.canonical)*Ei,Se=Hp(le)?ge:0,Oe=r.get("text-anchor").evaluate(I,{},i.canonical),st=A_(e,I,i.canonical);if(!st){const He=r.get("text-radial-offset").evaluate(I,{},i.canonical);Y=He?M_(Oe,[He*Ei,Pf]):r.get("text-offset").evaluate(I,{},i.canonical).map(Ge=>Ge*Ei)}let je=y?"center":r.get("text-justify").evaluate(I,{},i.canonical);const Fe=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(I,{},i.canonical)*Ei:1/0,Qe=()=>{i.bucket.allowVerticalPlacement&&Fc(le)&&(B.vertical=Yh(j,i.glyphMap,i.glyphPositions,i.imagePositions,C,Fe,f,Oe,"left",Se,Y,S.ah.vertical,!0,z,P))};if(!y&&st){const He=new Set;if(je==="auto")for(let xe=0;xe<st.values.length;xe+=2)He.add(Mf(st.values[xe]));else He.add(je);let Ge=!1;for(const xe of He)if(!B.horizontal[xe])if(Ge)B.horizontal[xe]=B.horizontal[0];else{const tt=Yh(j,i.glyphMap,i.glyphPositions,i.imagePositions,C,Fe,f,"center",xe,Se,Y,S.ah.horizontal,!1,z,P);tt&&(B.horizontal[xe]=tt,Ge=tt.positionedLines.length===1)}Qe()}else{je==="auto"&&(je=Mf(Oe));const He=Yh(j,i.glyphMap,i.glyphPositions,i.imagePositions,C,Fe,f,Oe,je,Se,Y,S.ah.horizontal,!1,z,P);He&&(B.horizontal[je]=He),Qe(),Fc(le)&&y&&_&&(B.vertical=Yh(j,i.glyphMap,i.glyphPositions,i.imagePositions,C,Fe,f,Oe,je,Se,Y,S.ah.vertical,!1,z,P))}}let ue=!1;if(I.icon&&I.icon.name){const le=i.imageMap[I.icon.name];le&&(q=qw(i.imagePositions[I.icon.name],r.get("icon-offset").evaluate(I,{},i.canonical),r.get("icon-anchor").evaluate(I,{},i.canonical)),ue=!!le.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ue:i.bucket.sdfIcons!==ue&&Ut("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(le.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ee=D_(B.horizontal)||B.vertical;i.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||q)&&l2(i.bucket,I,B,q,i.imageMap,u,z,L,Y,ue,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},S.bo=ff,S.bp=hf,S.bq=pf,S.br=cs,S.bs=gf,S.bt=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},S.bu=function(i,e,r,a,u){return d(this,void 0,void 0,function*(){if(ne())try{return yield ft(i,e,r,a,u)}catch{}return function(f,y,_,w,I){const C=f.width,P=f.height;mt&&Et||(mt=new OffscreenCanvas(C,P),Et=mt.getContext("2d",{willReadFrequently:!0})),mt.width=C,mt.height=P,Et.drawImage(f,0,0,C,P);const z=Et.getImageData(y,_,w,I);return Et.clearRect(0,0,C,P),z.data}(i,e,r,a,u)})},S.bv=g_,S.bw=$,S.bx=ie,S.by=Vy,S.bz=function(i){return i.message===zt},S.c=Ui,S.d=i=>d(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.e=$e,S.f=i=>new Promise((e,r)=>{const a=new Image;a.onload=()=>{e(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=Ye})},a.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});a.src=i.byteLength?URL.createObjectURL(u):Ye}),S.g=Mn,S.h=(i,e)=>Oo($e(i,{type:"json"}),e),S.i=Ri,S.j=xi,S.k=Gr,S.l=(i,e)=>Oo($e(i,{type:"arrayBuffer"}),e),S.m=Oo,S.n=function(i){return new gf(i).readFields(Ow,[])},S.o=Hc,S.p=Ky,S.q=l,S.r=Wp,S.s=No,S.t=Rc,S.u=Ue,S.v=ye,S.w=Ut,S.x=Qs,S.y=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},S.z=on}),v("worker",["./shared"],function(S){class d{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,R){for(const H of D){this._layerConfigs[H.id]=H;const te=this._layers[H.id]=S.aA(H);te._featureFilter=S.a6(te.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of R)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const O=S.bi(Object.values(this._layerConfigs),this.keyCache);for(const H of O){const te=H.map(ve=>this._layers[ve.id]),se=te[0];if(se.visibility==="none")continue;const ce=se.source||"";let Q=this.familiesBySource[ce];Q||(Q=this.familiesBySource[ce]={});const pe=se.sourceLayer||"_geojsonTileLayer";let be=Q[pe];be||(be=Q[pe]=[]),be.push(te)}}}class ${constructor(D){const R={},O=[];for(const ce in D){const Q=D[ce],pe=R[ce]={};for(const be in Q){const ve=Q[+be];if(!ve||ve.bitmap.width===0||ve.bitmap.height===0)continue;const _e={x:0,y:0,w:ve.bitmap.width+2,h:ve.bitmap.height+2};O.push(_e),pe[be]={rect:_e,metrics:ve.metrics}}}const{w:H,h:te}=S.p(O),se=new S.o({width:H||1,height:te||1});for(const ce in D){const Q=D[ce];for(const pe in Q){const be=Q[+pe];if(!be||be.bitmap.width===0||be.bitmap.height===0)continue;const ve=R[ce][pe].rect;S.o.copy(be.bitmap,se,{x:0,y:0},{x:ve.x+1,y:ve.y+1},be.bitmap)}}this.image=se,this.positions=R}}S.bj("GlyphAtlas",$);class ie{constructor(D){this.tileID=new S.Q(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId,this.inFlightDependencies=[]}parse(D,R,O,H){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=D,this.collisionBoxArray=new S.a4;const te=new S.bk(Object.keys(D.layers).sort()),se=new S.bl(this.tileID,this.promoteId);se.bucketLayerIDs=[];const ce={},Q={featureIndex:se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:O},pe=R.familiesBySource[this.source];for(const vt in pe){const ti=D.layers[vt];if(!ti)continue;ti.version===1&&S.w(`Vector tile source "${this.source}" layer "${vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ki=te.encode(vt),mn=[];for(let An=0;An<ti.length;An++){const Ii=ti.feature(An),qo=se.getId(Ii,vt);mn.push({feature:Ii,id:qo,index:An,sourceLayerIndex:ki})}for(const An of pe[vt]){const Ii=An[0];Ii.source!==this.source&&S.w(`layer.source = ${Ii.source} does not equal this.source = ${this.source}`),Ii.minzoom&&this.zoom<Math.floor(Ii.minzoom)||Ii.maxzoom&&this.zoom>=Ii.maxzoom||Ii.visibility!=="none"&&(me(An,this.zoom,O),(ce[Ii.id]=Ii.createBucket({index:se.bucketLayerIDs.length,layers:An,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ki,sourceID:this.source})).populate(mn,Q,this.tileID.canonical),se.bucketLayerIDs.push(An.map(qo=>qo.id)))}}const be=S.aF(Q.glyphDependencies,vt=>Object.keys(vt).map(Number));this.inFlightDependencies.forEach(vt=>vt==null?void 0:vt.abort()),this.inFlightDependencies=[];let ve=Promise.resolve({});if(Object.keys(be).length){const vt=new AbortController;this.inFlightDependencies.push(vt),ve=H.sendAsync({type:"GG",data:{stacks:be,source:this.source,tileID:this.tileID,type:"glyphs"}},vt)}const _e=Object.keys(Q.iconDependencies);let ot=Promise.resolve({});if(_e.length){const vt=new AbortController;this.inFlightDependencies.push(vt),ot=H.sendAsync({type:"GI",data:{icons:_e,source:this.source,tileID:this.tileID,type:"icons"}},vt)}const nt=Object.keys(Q.patternDependencies);let Tt=Promise.resolve({});if(nt.length){const vt=new AbortController;this.inFlightDependencies.push(vt),Tt=H.sendAsync({type:"GI",data:{icons:nt,source:this.source,tileID:this.tileID,type:"patterns"}},vt)}const[ht,Ct,Nt]=yield Promise.all([ve,ot,Tt]),Wt=new $(ht),wi=new S.bm(Ct,Nt);for(const vt in ce){const ti=ce[vt];ti instanceof S.a5?(me(ti.layers,this.zoom,O),S.bn({bucket:ti,glyphMap:ht,glyphPositions:Wt.positions,imageMap:Ct,imagePositions:wi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ti.hasPattern&&(ti instanceof S.bo||ti instanceof S.bp||ti instanceof S.bq)&&(me(ti.layers,this.zoom,O),ti.addFeatures(Q,this.tileID.canonical,wi.patternPositions))}return this.status="done",{buckets:Object.values(ce).filter(vt=>!vt.isEmpty()),featureIndex:se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Wt.image,imageAtlas:wi,glyphMap:this.returnDependencies?ht:null,iconMap:this.returnDependencies?Ct:null,glyphPositions:this.returnDependencies?Wt.positions:null}})}}function me(G,D,R){const O=new S.a8(D);for(const H of G)H.recalculate(O,R)}class X{constructor(D,R,O){this.actor=D,this.layerIndex=R,this.availableImages=O,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(D,R){return S._(this,void 0,void 0,function*(){const O=yield S.l(D.request,R);try{return{vectorTile:new S.br.VectorTile(new S.bs(O.data)),rawData:O.data,cacheControl:O.cacheControl,expires:O.expires}}catch(H){const te=new Uint8Array(O.data);let se=`Unable to parse the tile at ${D.request.url}, `;throw se+=te[0]===31&&te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${H.message}`,new Error(se)}})}loadTile(D){return S._(this,void 0,void 0,function*(){const R=D.uid,O=!!(D&&D.request&&D.request.collectResourceTiming)&&new S.bt(D.request),H=new ie(D);this.loading[R]=H;const te=new AbortController;H.abort=te;try{const se=yield this.loadVectorTile(D,te);if(delete this.loading[R],!se)return null;const ce=se.rawData,Q={};se.expires&&(Q.expires=se.expires),se.cacheControl&&(Q.cacheControl=se.cacheControl);const pe={};if(O){const ve=O.finish();ve&&(pe.resourceTiming=JSON.parse(JSON.stringify(ve)))}H.vectorTile=se.vectorTile;const be=H.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[R]=H,this.fetching[R]={rawTileData:ce,cacheControl:Q,resourceTiming:pe};try{const ve=yield be;return S.e({rawTileData:ce.slice(0)},ve,Q,pe)}finally{delete this.fetching[R]}}catch(se){throw delete this.loading[R],H.status="done",this.loaded[R]=H,se}})}reloadTile(D){return S._(this,void 0,void 0,function*(){const R=D.uid;if(!this.loaded||!this.loaded[R])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const O=this.loaded[R];if(O.showCollisionBoxes=D.showCollisionBoxes,O.status==="parsing"){const H=yield O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor);let te;if(this.fetching[R]){const{rawTileData:se,cacheControl:ce,resourceTiming:Q}=this.fetching[R];delete this.fetching[R],te=S.e({rawTileData:se.slice(0)},H,ce,Q)}else te=H;return te}if(O.status==="done"&&O.vectorTile)return O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(D){return S._(this,void 0,void 0,function*(){const R=this.loading,O=D.uid;R&&R[O]&&R[O].abort&&(R[O].abort.abort(),delete R[O])})}removeTile(D){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[D.uid]&&delete this.loaded[D.uid]})}}class V{constructor(){this.loaded={}}loadTile(D){return S._(this,void 0,void 0,function*(){const{uid:R,encoding:O,rawImageData:H,redFactor:te,greenFactor:se,blueFactor:ce,baseShift:Q}=D,pe=H.width+2,be=H.height+2,ve=S.b(H)?new S.R({width:pe,height:be},yield S.bu(H,-1,-1,pe,be)):H,_e=new S.bv(R,ve,O,te,se,ce,Q);return this.loaded=this.loaded||{},this.loaded[R]=_e,_e})}removeTile(D){const R=this.loaded,O=D.uid;R&&R[O]&&delete R[O]}}function Te(G,D){if(G.length!==0){ke(G[0],D);for(var R=1;R<G.length;R++)ke(G[R],!D)}}function ke(G,D){for(var R=0,O=0,H=0,te=G.length,se=te-1;H<te;se=H++){var ce=(G[H][0]-G[se][0])*(G[se][1]+G[H][1]),Q=R+ce;O+=Math.abs(R)>=Math.abs(ce)?R-Q+ce:ce-Q+R,R=Q}R+O>=0!=!!D&&G.reverse()}var Me=S.bw(function G(D,R){var O,H=D&&D.type;if(H==="FeatureCollection")for(O=0;O<D.features.length;O++)G(D.features[O],R);else if(H==="GeometryCollection")for(O=0;O<D.geometries.length;O++)G(D.geometries[O],R);else if(H==="Feature")G(D.geometry,R);else if(H==="Polygon")Te(D.coordinates,R);else if(H==="MultiPolygon")for(O=0;O<D.coordinates.length;O++)Te(D.coordinates[O],R);return D});const yt=S.br.VectorTileFeature.prototype.toGeoJSON;var oe={exports:{}},ne=S.bx,he=S.br.VectorTileFeature,Ie=Be;function Be(G,D){this.options=D||{},this.features=G,this.length=G.length}function Re(G,D){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=D||4096}Be.prototype.feature=function(G){return new Re(this.features[G],this.options.extent)},Re.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var D=0;D<G.length;D++){for(var R=G[D],O=[],H=0;H<R.length;H++)O.push(new ne(R[H][0],R[H][1]));this.geometry.push(O)}return this.geometry},Re.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,D=1/0,R=-1/0,O=1/0,H=-1/0,te=0;te<G.length;te++)for(var se=G[te],ce=0;ce<se.length;ce++){var Q=se[ce];D=Math.min(D,Q.x),R=Math.max(R,Q.x),O=Math.min(O,Q.y),H=Math.max(H,Q.y)}return[D,O,R,H]},Re.prototype.toGeoJSON=he.prototype.toGeoJSON;var $e=S.by,Xe=Ie;function xt(G){var D=new $e;return function(R,O){for(var H in R.layers)O.writeMessage(3,rt,R.layers[H])}(G,D),D.finish()}function rt(G,D){var R;D.writeVarintField(15,G.version||1),D.writeStringField(1,G.name||""),D.writeVarintField(5,G.extent||4096);var O={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<G.length;R++)O.feature=G.feature(R),D.writeMessage(2,pt,O);var H=O.keys;for(R=0;R<H.length;R++)D.writeStringField(3,H[R]);var te=O.values;for(R=0;R<te.length;R++)D.writeMessage(4,Pn,te[R])}function pt(G,D){var R=G.feature;R.id!==void 0&&D.writeVarintField(1,R.id),D.writeMessage(2,oi,G),D.writeVarintField(3,R.type),D.writeMessage(4,Ri,R)}function oi(G,D){var R=G.feature,O=G.keys,H=G.values,te=G.keycache,se=G.valuecache;for(var ce in R.properties){var Q=R.properties[ce],pe=te[ce];if(Q!==null){pe===void 0&&(O.push(ce),te[ce]=pe=O.length-1),D.writeVarint(pe);var be=typeof Q;be!=="string"&&be!=="boolean"&&be!=="number"&&(Q=JSON.stringify(Q));var ve=be+":"+Q,_e=se[ve];_e===void 0&&(H.push(Q),se[ve]=_e=H.length-1),D.writeVarint(_e)}}}function Ut(G,D){return(D<<3)+(7&G)}function ei(G){return G<<1^G>>31}function Ri(G,D){for(var R=G.loadGeometry(),O=G.type,H=0,te=0,se=R.length,ce=0;ce<se;ce++){var Q=R[ce],pe=1;O===1&&(pe=Q.length),D.writeVarint(Ut(1,pe));for(var be=O===3?Q.length-1:Q.length,ve=0;ve<be;ve++){ve===1&&O!==1&&D.writeVarint(Ut(2,be-1));var _e=Q[ve].x-H,ot=Q[ve].y-te;D.writeVarint(ei(_e)),D.writeVarint(ei(ot)),H+=_e,te+=ot}O===3&&D.writeVarint(Ut(7,1))}}function Pn(G,D){var R=typeof G;R==="string"?D.writeStringField(1,G):R==="boolean"?D.writeBooleanField(7,G):R==="number"&&(G%1!=0?D.writeDoubleField(3,G):G<0?D.writeSVarintField(6,G):D.writeVarintField(5,G))}oe.exports=xt,oe.exports.fromVectorTileJs=xt,oe.exports.fromGeojsonVt=function(G,D){D=D||{};var R={};for(var O in G)R[O]=new Xe(G[O].features,D),R[O].name=O,R[O].version=D.version,R[O].extent=D.extent;return xt({layers:R})},oe.exports.GeoJSONWrapper=Xe;var Fi=S.bw(oe.exports);const Ye={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:G=>G},ft=Math.fround||(mt=new Float32Array(1),G=>(mt[0]=+G,mt[0]));var mt;const Et=3,zt=5,Ui=6;class dn{constructor(D){this.options=Object.assign(Object.create(Ye),D),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(D){const{log:R,minZoom:O,maxZoom:H}=this.options;R&&console.time("total time");const te=`prepare ${D.length} points`;R&&console.time(te),this.points=D;const se=[];for(let Q=0;Q<D.length;Q++){const pe=D[Q];if(!pe.geometry)continue;const[be,ve]=pe.geometry.coordinates,_e=ft($i(be)),ot=ft(Ir(ve));se.push(_e,ot,1/0,Q,-1,1),this.options.reduce&&se.push(0)}let ce=this.trees[H+1]=this._createTree(se);R&&console.timeEnd(te);for(let Q=H;Q>=O;Q--){const pe=+Date.now();ce=this.trees[Q]=this._createTree(this._cluster(ce,Q)),R&&console.log("z%d: %d clusters in %dms",Q,ce.numItems,+Date.now()-pe)}return R&&console.timeEnd("total time"),this}getClusters(D,R){let O=((D[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,D[1]));let te=D[2]===180?180:((D[2]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)O=-180,te=180;else if(O>te){const ve=this.getClusters([O,H,180,se],R),_e=this.getClusters([-180,H,te,se],R);return ve.concat(_e)}const ce=this.trees[this._limitZoom(R)],Q=ce.range($i(O),Ir(se),$i(te),Ir(H)),pe=ce.data,be=[];for(const ve of Q){const _e=this.stride*ve;be.push(pe[_e+zt]>1?Mn(pe,_e,this.clusterProps):this.points[pe[_e+Et]])}return be}getChildren(D){const R=this._getOriginId(D),O=this._getOriginZoom(D),H="No cluster with the specified id.",te=this.trees[O];if(!te)throw new Error(H);const se=te.data;if(R*this.stride>=se.length)throw new Error(H);const ce=this.options.radius/(this.options.extent*Math.pow(2,O-1)),Q=te.within(se[R*this.stride],se[R*this.stride+1],ce),pe=[];for(const be of Q){const ve=be*this.stride;se[ve+4]===D&&pe.push(se[ve+zt]>1?Mn(se,ve,this.clusterProps):this.points[se[ve+Et]])}if(pe.length===0)throw new Error(H);return pe}getLeaves(D,R,O){const H=[];return this._appendLeaves(H,D,R=R||10,O=O||0,0),H}getTile(D,R,O){const H=this.trees[this._limitZoom(D)],te=Math.pow(2,D),{extent:se,radius:ce}=this.options,Q=ce/se,pe=(O-Q)/te,be=(O+1+Q)/te,ve={features:[]};return this._addTileFeatures(H.range((R-Q)/te,pe,(R+1+Q)/te,be),H.data,R,O,te,ve),R===0&&this._addTileFeatures(H.range(1-Q/te,pe,1,be),H.data,te,O,te,ve),R===te-1&&this._addTileFeatures(H.range(0,pe,Q/te,be),H.data,-1,O,te,ve),ve.features.length?ve:null}getClusterExpansionZoom(D){let R=this._getOriginZoom(D)-1;for(;R<=this.options.maxZoom;){const O=this.getChildren(D);if(R++,O.length!==1)break;D=O[0].properties.cluster_id}return R}_appendLeaves(D,R,O,H,te){const se=this.getChildren(R);for(const ce of se){const Q=ce.properties;if(Q&&Q.cluster?te+Q.point_count<=H?te+=Q.point_count:te=this._appendLeaves(D,Q.cluster_id,O,H,te):te<H?te++:D.push(ce),D.length===O)break}return te}_createTree(D){const R=new S.av(D.length/this.stride|0,this.options.nodeSize,Float32Array);for(let O=0;O<D.length;O+=this.stride)R.add(D[O],D[O+1]);return R.finish(),R.data=D,R}_addTileFeatures(D,R,O,H,te,se){for(const ce of D){const Q=ce*this.stride,pe=R[Q+zt]>1;let be,ve,_e;if(pe)be=Bi(R,Q,this.clusterProps),ve=R[Q],_e=R[Q+1];else{const Tt=this.points[R[Q+Et]];be=Tt.properties;const[ht,Ct]=Tt.geometry.coordinates;ve=$i(ht),_e=Ir(Ct)}const ot={type:1,geometry:[[Math.round(this.options.extent*(ve*te-O)),Math.round(this.options.extent*(_e*te-H))]],tags:be};let nt;nt=pe||this.options.generateId?R[Q+Et]:this.points[R[Q+Et]].id,nt!==void 0&&(ot.id=nt),se.features.push(ot)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,R){const{radius:O,extent:H,reduce:te,minPoints:se}=this.options,ce=O/(H*Math.pow(2,R)),Q=D.data,pe=[],be=this.stride;for(let ve=0;ve<Q.length;ve+=be){if(Q[ve+2]<=R)continue;Q[ve+2]=R;const _e=Q[ve],ot=Q[ve+1],nt=D.within(Q[ve],Q[ve+1],ce),Tt=Q[ve+zt];let ht=Tt;for(const Ct of nt){const Nt=Ct*be;Q[Nt+2]>R&&(ht+=Q[Nt+zt])}if(ht>Tt&&ht>=se){let Ct,Nt=_e*Tt,Wt=ot*Tt,wi=-1;const vt=((ve/be|0)<<5)+(R+1)+this.points.length;for(const ti of nt){const ki=ti*be;if(Q[ki+2]<=R)continue;Q[ki+2]=R;const mn=Q[ki+zt];Nt+=Q[ki]*mn,Wt+=Q[ki+1]*mn,Q[ki+4]=vt,te&&(Ct||(Ct=this._map(Q,ve,!0),wi=this.clusterProps.length,this.clusterProps.push(Ct)),te(Ct,this._map(Q,ki)))}Q[ve+4]=vt,pe.push(Nt/ht,Wt/ht,1/0,vt,-1,ht),te&&pe.push(wi)}else{for(let Ct=0;Ct<be;Ct++)pe.push(Q[ve+Ct]);if(ht>1)for(const Ct of nt){const Nt=Ct*be;if(!(Q[Nt+2]<=R)){Q[Nt+2]=R;for(let Wt=0;Wt<be;Wt++)pe.push(Q[Nt+Wt])}}}}return pe}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,R,O){if(D[R+zt]>1){const se=this.clusterProps[D[R+Ui]];return O?Object.assign({},se):se}const H=this.points[D[R+Et]].properties,te=this.options.map(H);return O&&te===H?Object.assign({},te):te}}function Mn(G,D,R){return{type:"Feature",id:G[D+Et],properties:Bi(G,D,R),geometry:{type:"Point",coordinates:[(O=G[D],360*(O-.5)),Oo(G[D+1])]}};var O}function Bi(G,D,R){const O=G[D+zt],H=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O,te=G[D+Ui],se=te===-1?{}:Object.assign({},R[te]);return Object.assign(se,{cluster:!0,cluster_id:G[D+Et],point_count:O,point_count_abbreviated:H})}function $i(G){return G/360+.5}function Ir(G){const D=Math.sin(G*Math.PI/180),R=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return R<0?0:R>1?1:R}function Oo(G){const D=(180-360*G)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function No(G,D,R,O){for(var H,te=O,se=R-D>>1,ce=R-D,Q=G[D],pe=G[D+1],be=G[R],ve=G[R+1],_e=D+3;_e<R;_e+=3){var ot=ka(G[_e],G[_e+1],Q,pe,be,ve);if(ot>te)H=_e,te=ot;else if(ot===te){var nt=Math.abs(_e-se);nt<ce&&(H=_e,ce=nt)}}te>O&&(H-D>3&&No(G,D,H,O),G[H+2]=te,R-H>3&&No(G,H,R,O))}function ka(G,D,R,O,H,te){var se=H-R,ce=te-O;if(se!==0||ce!==0){var Q=((G-R)*se+(D-O)*ce)/(se*se+ce*ce);Q>1?(R=H,O=te):Q>0&&(R+=se*Q,O+=ce*Q)}return(se=G-R)*se+(ce=D-O)*ce}function fr(G,D,R,O){var H={id:G===void 0?null:G,type:D,geometry:R,tags:O,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(te){var se=te.geometry,ce=te.type;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")Gr(te,se);else if(ce==="Polygon"||ce==="MultiLineString")for(var Q=0;Q<se.length;Q++)Gr(te,se[Q]);else if(ce==="MultiPolygon")for(Q=0;Q<se.length;Q++)for(var pe=0;pe<se[Q].length;pe++)Gr(te,se[Q][pe])}(H),H}function Gr(G,D){for(var R=0;R<D.length;R+=3)G.minX=Math.min(G.minX,D[R]),G.minY=Math.min(G.minY,D[R+1]),G.maxX=Math.max(G.maxX,D[R]),G.maxY=Math.max(G.maxY,D[R+1])}function xi(G,D,R,O){if(D.geometry){var H=D.geometry.coordinates,te=D.geometry.type,se=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),ce=[],Q=D.id;if(R.promoteId?Q=D.properties[R.promoteId]:R.generateId&&(Q=O||0),te==="Point")jo(H,ce);else if(te==="MultiPoint")for(var pe=0;pe<H.length;pe++)jo(H[pe],ce);else if(te==="LineString")ye(H,ce,se,!1);else if(te==="MultiLineString"){if(R.lineMetrics){for(pe=0;pe<H.length;pe++)ye(H[pe],ce=[],se,!1),G.push(fr(Q,"LineString",ce,D.properties));return}Wr(H,ce,se,!1)}else if(te==="Polygon")Wr(H,ce,se,!0);else{if(te!=="MultiPolygon"){if(te==="GeometryCollection"){for(pe=0;pe<D.geometry.geometries.length;pe++)xi(G,{id:Q,geometry:D.geometry.geometries[pe],properties:D.properties},R,O);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pe=0;pe<H.length;pe++){var be=[];Wr(H[pe],be,se,!0),ce.push(be)}}G.push(fr(Q,te,ce,D.properties))}}function jo(G,D){D.push(Rs(G[0])),D.push(Dt(G[1])),D.push(0)}function ye(G,D,R,O){for(var H,te,se=0,ce=0;ce<G.length;ce++){var Q=Rs(G[ce][0]),pe=Dt(G[ce][1]);D.push(Q),D.push(pe),D.push(0),ce>0&&(se+=O?(H*pe-Q*te)/2:Math.sqrt(Math.pow(Q-H,2)+Math.pow(pe-te,2))),H=Q,te=pe}var be=D.length-3;D[2]=1,No(D,0,be,R),D[be+2]=1,D.size=Math.abs(se),D.start=0,D.end=D.size}function Wr(G,D,R,O){for(var H=0;H<G.length;H++){var te=[];ye(G[H],te,R,O),D.push(te)}}function Rs(G){return G/360+.5}function Dt(G){var D=Math.sin(G*Math.PI/180),R=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return R<0?0:R>1?1:R}function Jt(G,D,R,O,H,te,se,ce){if(O/=D,te>=(R/=D)&&se<O)return G;if(se<R||te>=O)return null;for(var Q=[],pe=0;pe<G.length;pe++){var be=G[pe],ve=be.geometry,_e=be.type,ot=H===0?be.minX:be.minY,nt=H===0?be.maxX:be.maxY;if(ot>=R&&nt<O)Q.push(be);else if(!(nt<R||ot>=O)){var Tt=[];if(_e==="Point"||_e==="MultiPoint")Cr(ve,Tt,R,O,H);else if(_e==="LineString")Vo(ve,Tt,R,O,H,!1,ce.lineMetrics);else if(_e==="MultiLineString")Uo(ve,Tt,R,O,H,!1);else if(_e==="Polygon")Uo(ve,Tt,R,O,H,!0);else if(_e==="MultiPolygon")for(var ht=0;ht<ve.length;ht++){var Ct=[];Uo(ve[ht],Ct,R,O,H,!0),Ct.length&&Tt.push(Ct)}if(Tt.length){if(ce.lineMetrics&&_e==="LineString"){for(ht=0;ht<Tt.length;ht++)Q.push(fr(be.id,_e,Tt[ht],be.tags));continue}_e!=="LineString"&&_e!=="MultiLineString"||(Tt.length===1?(_e="LineString",Tt=Tt[0]):_e="MultiLineString"),_e!=="Point"&&_e!=="MultiPoint"||(_e=Tt.length===3?"Point":"MultiPoint"),Q.push(fr(be.id,_e,Tt,be.tags))}}}return Q.length?Q:null}function Cr(G,D,R,O,H){for(var te=0;te<G.length;te+=3){var se=G[te+H];se>=R&&se<=O&&(D.push(G[te]),D.push(G[te+1]),D.push(G[te+2]))}}function Vo(G,D,R,O,H,te,se){for(var ce,Q,pe=Fs(G),be=H===0?$o:Ia,ve=G.start,_e=0;_e<G.length-3;_e+=3){var ot=G[_e],nt=G[_e+1],Tt=G[_e+2],ht=G[_e+3],Ct=G[_e+4],Nt=H===0?ot:nt,Wt=H===0?ht:Ct,wi=!1;se&&(ce=Math.sqrt(Math.pow(ot-ht,2)+Math.pow(nt-Ct,2))),Nt<R?Wt>R&&(Q=be(pe,ot,nt,ht,Ct,R),se&&(pe.start=ve+ce*Q)):Nt>O?Wt<O&&(Q=be(pe,ot,nt,ht,Ct,O),se&&(pe.start=ve+ce*Q)):Er(pe,ot,nt,Tt),Wt<R&&Nt>=R&&(Q=be(pe,ot,nt,ht,Ct,R),wi=!0),Wt>O&&Nt<=O&&(Q=be(pe,ot,nt,ht,Ct,O),wi=!0),!te&&wi&&(se&&(pe.end=ve+ce*Q),D.push(pe),pe=Fs(G)),se&&(ve+=ce)}var vt=G.length-3;ot=G[vt],nt=G[vt+1],Tt=G[vt+2],(Nt=H===0?ot:nt)>=R&&Nt<=O&&Er(pe,ot,nt,Tt),vt=pe.length-3,te&&vt>=3&&(pe[vt]!==pe[0]||pe[vt+1]!==pe[1])&&Er(pe,pe[0],pe[1],pe[2]),pe.length&&D.push(pe)}function Fs(G){var D=[];return D.size=G.size,D.start=G.start,D.end=G.end,D}function Uo(G,D,R,O,H,te){for(var se=0;se<G.length;se++)Vo(G[se],D,R,O,H,te,!1)}function Er(G,D,R,O){G.push(D),G.push(R),G.push(O)}function $o(G,D,R,O,H,te){var se=(te-D)/(O-D);return G.push(te),G.push(R+(H-R)*se),G.push(1),se}function Ia(G,D,R,O,H,te){var se=(te-R)/(H-R);return G.push(D+(O-D)*se),G.push(te),G.push(1),se}function ze(G,D){for(var R=[],O=0;O<G.length;O++){var H,te=G[O],se=te.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")H=pn(te.geometry,D);else if(se==="MultiLineString"||se==="Polygon"){H=[];for(var ce=0;ce<te.geometry.length;ce++)H.push(pn(te.geometry[ce],D))}else if(se==="MultiPolygon")for(H=[],ce=0;ce<te.geometry.length;ce++){for(var Q=[],pe=0;pe<te.geometry[ce].length;pe++)Q.push(pn(te.geometry[ce][pe],D));H.push(Q)}R.push(fr(te.id,se,H,te.tags))}return R}function pn(G,D){var R=[];R.size=G.size,G.start!==void 0&&(R.start=G.start,R.end=G.end);for(var O=0;O<G.length;O+=3)R.push(G[O]+D,G[O+1],G[O+2]);return R}function fn(G,D){if(G.transformed)return G;var R,O,H,te=1<<G.z,se=G.x,ce=G.y;for(R=0;R<G.features.length;R++){var Q=G.features[R],pe=Q.geometry,be=Q.type;if(Q.geometry=[],be===1)for(O=0;O<pe.length;O+=2)Q.geometry.push(Zo(pe[O],pe[O+1],D,te,se,ce));else for(O=0;O<pe.length;O++){var ve=[];for(H=0;H<pe[O].length;H+=2)ve.push(Zo(pe[O][H],pe[O][H+1],D,te,se,ce));Q.geometry.push(ve)}}return G.transformed=!0,G}function Zo(G,D,R,O,H,te){return[Math.round(R*(G*O-H)),Math.round(R*(D*O-te))]}function uo(G,D,R,O,H){for(var te=D===H.maxZoom?0:H.tolerance/((1<<D)*H.extent),se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:O,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ce=0;ce<G.length;ce++){se.numFeatures++,Pe(se,G[ce],te,H);var Q=G[ce].minX,pe=G[ce].minY,be=G[ce].maxX,ve=G[ce].maxY;Q<se.minX&&(se.minX=Q),pe<se.minY&&(se.minY=pe),be>se.maxX&&(se.maxX=be),ve>se.maxY&&(se.maxY=ve)}return se}function Pe(G,D,R,O){var H=D.geometry,te=D.type,se=[];if(te==="Point"||te==="MultiPoint")for(var ce=0;ce<H.length;ce+=3)se.push(H[ce]),se.push(H[ce+1]),G.numPoints++,G.numSimplified++;else if(te==="LineString")wt(se,H,G,R,!1,!1);else if(te==="MultiLineString"||te==="Polygon")for(ce=0;ce<H.length;ce++)wt(se,H[ce],G,R,te==="Polygon",ce===0);else if(te==="MultiPolygon")for(var Q=0;Q<H.length;Q++){var pe=H[Q];for(ce=0;ce<pe.length;ce++)wt(se,pe[ce],G,R,!0,ce===0)}if(se.length){var be=D.tags||null;if(te==="LineString"&&O.lineMetrics){for(var ve in be={},D.tags)be[ve]=D.tags[ve];be.mapbox_clip_start=H.start/H.size,be.mapbox_clip_end=H.end/H.size}var _e={geometry:se,type:te==="Polygon"||te==="MultiPolygon"?3:te==="LineString"||te==="MultiLineString"?2:1,tags:be};D.id!==null&&(_e.id=D.id),G.features.push(_e)}}function wt(G,D,R,O,H,te){var se=O*O;if(O>0&&D.size<(H?se:O))R.numPoints+=D.length/3;else{for(var ce=[],Q=0;Q<D.length;Q+=3)(O===0||D[Q+2]>se)&&(R.numSimplified++,ce.push(D[Q]),ce.push(D[Q+1])),R.numPoints++;H&&function(pe,be){for(var ve=0,_e=0,ot=pe.length,nt=ot-2;_e<ot;nt=_e,_e+=2)ve+=(pe[_e]-pe[nt])*(pe[_e+1]+pe[nt+1]);if(ve>0===be)for(_e=0,ot=pe.length;_e<ot/2;_e+=2){var Tt=pe[_e],ht=pe[_e+1];pe[_e]=pe[ot-2-_e],pe[_e+1]=pe[ot-1-_e],pe[ot-2-_e]=Tt,pe[ot-1-_e]=ht}}(ce,te),G.push(ce)}}function gt(G,D){var R=(D=this.options=function(H,te){for(var se in te)H[se]=te[se];return H}(Object.create(this.options),D)).debug;if(R&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var O=function(H,te){var se=[];if(H.type==="FeatureCollection")for(var ce=0;ce<H.features.length;ce++)xi(se,H.features[ce],te,ce);else xi(se,H.type==="Feature"?H:{geometry:H},te);return se}(G,D);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),O=function(H,te){var se=te.buffer/te.extent,ce=H,Q=Jt(H,1,-1-se,se,0,-1,2,te),pe=Jt(H,1,1-se,2+se,0,-1,2,te);return(Q||pe)&&(ce=Jt(H,1,-se,1+se,0,-1,2,te)||[],Q&&(ce=ze(Q,1).concat(ce)),pe&&(ce=ce.concat(ze(pe,-1)))),ce}(O,D),O.length&&this.splitTile(O,0,0,0),R&&(O.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function nn(G,D,R){return 32*((1<<G)*R+D)+G}function rn(G,D){return D?G.properties[D]:G.id}function _t(G,D){if(G==null)return!0;if(G.type==="Feature")return rn(G,D)!=null;if(G.type==="FeatureCollection"){const R=new Set;for(const O of G.features){const H=rn(O,D);if(H==null||R.has(H))return!1;R.add(H)}return!0}return!1}function Pr(G,D){const R=new Map;if(G!=null)if(G.type==="Feature")R.set(rn(G,D),G);else for(const O of G.features)R.set(rn(O,D),O);return R}gt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gt.prototype.splitTile=function(G,D,R,O,H,te,se){for(var ce=[G,D,R,O],Q=this.options,pe=Q.debug;ce.length;){O=ce.pop(),R=ce.pop(),D=ce.pop(),G=ce.pop();var be=1<<D,ve=nn(D,R,O),_e=this.tiles[ve];if(!_e&&(pe>1&&console.time("creation"),_e=this.tiles[ve]=uo(G,D,R,O,Q),this.tileCoords.push({z:D,x:R,y:O}),pe)){pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,R,O,_e.numFeatures,_e.numPoints,_e.numSimplified),console.timeEnd("creation"));var ot="z"+D;this.stats[ot]=(this.stats[ot]||0)+1,this.total++}if(_e.source=G,H){if(D===Q.maxZoom||D===H)continue;var nt=1<<H-D;if(R!==Math.floor(te/nt)||O!==Math.floor(se/nt))continue}else if(D===Q.indexMaxZoom||_e.numPoints<=Q.indexMaxPoints)continue;if(_e.source=null,G.length!==0){pe>1&&console.time("clipping");var Tt,ht,Ct,Nt,Wt,wi,vt=.5*Q.buffer/Q.extent,ti=.5-vt,ki=.5+vt,mn=1+vt;Tt=ht=Ct=Nt=null,Wt=Jt(G,be,R-vt,R+ki,0,_e.minX,_e.maxX,Q),wi=Jt(G,be,R+ti,R+mn,0,_e.minX,_e.maxX,Q),G=null,Wt&&(Tt=Jt(Wt,be,O-vt,O+ki,1,_e.minY,_e.maxY,Q),ht=Jt(Wt,be,O+ti,O+mn,1,_e.minY,_e.maxY,Q),Wt=null),wi&&(Ct=Jt(wi,be,O-vt,O+ki,1,_e.minY,_e.maxY,Q),Nt=Jt(wi,be,O+ti,O+mn,1,_e.minY,_e.maxY,Q),wi=null),pe>1&&console.timeEnd("clipping"),ce.push(Tt||[],D+1,2*R,2*O),ce.push(ht||[],D+1,2*R,2*O+1),ce.push(Ct||[],D+1,2*R+1,2*O),ce.push(Nt||[],D+1,2*R+1,2*O+1)}}},gt.prototype.getTile=function(G,D,R){var O=this.options,H=O.extent,te=O.debug;if(G<0||G>24)return null;var se=1<<G,ce=nn(G,D=(D%se+se)%se,R);if(this.tiles[ce])return fn(this.tiles[ce],H);te>1&&console.log("drilling down to z%d-%d-%d",G,D,R);for(var Q,pe=G,be=D,ve=R;!Q&&pe>0;)pe--,be=Math.floor(be/2),ve=Math.floor(ve/2),Q=this.tiles[nn(pe,be,ve)];return Q&&Q.source?(te>1&&console.log("found parent tile z%d-%d-%d",pe,be,ve),te>1&&console.time("drilling down"),this.splitTile(Q.source,pe,be,ve,G,D,R),te>1&&console.timeEnd("drilling down"),this.tiles[ce]?fn(this.tiles[ce],H):null):null};class Mr extends X{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(D,R){return S._(this,void 0,void 0,function*(){const O=D.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const H=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!H)return null;const te=new class{constructor(ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.W,this.length=ce.length,this._features=ce}feature(ce){return new class{constructor(Q){this._feature=Q,this.extent=S.W,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))}loadGeometry(){if(this._feature.type===1){const Q=[];for(const pe of this._feature.geometry)Q.push([new S.P(pe[0],pe[1])]);return Q}{const Q=[];for(const pe of this._feature.geometry){const be=[];for(const ve of pe)be.push(new S.P(ve[0],ve[1]));Q.push(be)}return Q}}toGeoJSON(Q,pe,be){return yt.call(this,Q,pe,be)}}(this._features[ce])}}(H.features);let se=Fi(te);return se.byteOffset===0&&se.byteLength===se.buffer.byteLength||(se=new Uint8Array(se)),{vectorTile:te,rawData:se.buffer}})}loadData(D){return S._(this,void 0,void 0,function*(){var R;(R=this._pendingRequest)===null||R===void 0||R.abort();const O=!!(D&&D.request&&D.request.collectResourceTiming)&&new S.bt(D.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(D,this._pendingRequest),this._geoJSONIndex=D.cluster?new dn(function({superclusterOptions:te,clusterProperties:se}){if(!se||!te)return te;const ce={},Q={},pe={accumulated:null,zoom:0},be={properties:null},ve=Object.keys(se);for(const _e of ve){const[ot,nt]=se[_e],Tt=S.bA(nt),ht=S.bA(typeof ot=="string"?[ot,["accumulated"],["get",_e]]:ot);ce[_e]=Tt.value,Q[_e]=ht.value}return te.map=_e=>{be.properties=_e;const ot={};for(const nt of ve)ot[nt]=ce[nt].evaluate(pe,be);return ot},te.reduce=(_e,ot)=>{be.properties=ot;for(const nt of ve)pe.accumulated=_e[nt],_e[nt]=Q[nt].evaluate(pe,be)},te}(D)).load((yield this._pendingData).features):new gt(yield this._pendingData,D.geojsonVtOptions),this.loaded={};const H={};if(O){const te=O.finish();te&&(H.resourceTiming={},H.resourceTiming[D.source]=JSON.parse(JSON.stringify(te)))}return H}catch(H){if(delete this._pendingRequest,S.bz(H))return{abandoned:!0};throw H}})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(D){const R=this.loaded;return R&&R[D.uid]?super.reloadTile(D):this.loadTile(D)}loadAndProcessGeoJSON(D,R){return S._(this,void 0,void 0,function*(){let O=yield this.loadGeoJSON(D,R);if(delete this._pendingRequest,typeof O!="object")throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`);if(Me(O,!0),D.filter){const H=S.bA(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(H.result==="error")throw new Error(H.value.map(se=>`${se.key}: ${se.message}`).join(", "));O={type:"FeatureCollection",features:O.features.filter(se=>H.value.evaluate({zoom:0},se))}}return O})}loadGeoJSON(D,R){return S._(this,void 0,void 0,function*(){const{promoteId:O}=D;if(D.request){const H=yield S.h(D.request,R);return this._dataUpdateable=_t(H.data,O)?Pr(H.data,O):void 0,H.data}if(typeof D.data=="string")try{const H=JSON.parse(D.data);return this._dataUpdateable=_t(H,O)?Pr(H,O):void 0,H}catch{throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`)}if(!D.dataDiff)throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${D.source}`);return function(H,te,se){var ce,Q,pe,be;if(te.removeAll&&H.clear(),te.remove)for(const ve of te.remove)H.delete(ve);if(te.add)for(const ve of te.add){const _e=rn(ve,se);_e!=null&&H.set(_e,ve)}if(te.update)for(const ve of te.update){let _e=H.get(ve.id);if(_e==null)continue;const ot=!ve.removeAllProperties&&(((ce=ve.removeProperties)===null||ce===void 0?void 0:ce.length)>0||((Q=ve.addOrUpdateProperties)===null||Q===void 0?void 0:Q.length)>0);if((ve.newGeometry||ve.removeAllProperties||ot)&&(_e=Object.assign({},_e),H.set(ve.id,_e),ot&&(_e.properties=Object.assign({},_e.properties))),ve.newGeometry&&(_e.geometry=ve.newGeometry),ve.removeAllProperties)_e.properties={};else if(((pe=ve.removeProperties)===null||pe===void 0?void 0:pe.length)>0)for(const nt of ve.removeProperties)Object.prototype.hasOwnProperty.call(_e.properties,nt)&&delete _e.properties[nt];if(((be=ve.addOrUpdateProperties)===null||be===void 0?void 0:be.length)>0)for(const{key:nt,value:Tt}of ve.addOrUpdateProperties)_e.properties[nt]=Tt}}(this._dataUpdateable,D.dataDiff,O),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(D){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(D){return this._geoJSONIndex.getClusterExpansionZoom(D.clusterId)}getClusterChildren(D){return this._geoJSONIndex.getChildren(D.clusterId)}getClusterLeaves(D){return this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset)}}class Mi{constructor(D){this.self=D,this.actor=new S.C(D),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(R,O)=>{if(this.externalWorkerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.externalWorkerSourceTypes[R]=O},this.self.addProtocol=S.bg,this.self.removeProtocol=S.bh,this.self.registerRTLTextPlugin=R=>{if(S.bB.isParsed())throw new Error("RTL text plugin already registered.");S.bB.setMethods(R)},this.actor.registerMessageHandler("LDT",(R,O)=>this._getDEMWorkerSource(R,O.source).loadTile(O)),this.actor.registerMessageHandler("RDT",(R,O)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(R,O.source).removeTile(O)})),this.actor.registerMessageHandler("GCEZ",(R,O)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(R,O.type,O.source).getClusterExpansionZoom(O)})),this.actor.registerMessageHandler("GCC",(R,O)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(R,O.type,O.source).getClusterChildren(O)})),this.actor.registerMessageHandler("GCL",(R,O)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(R,O.type,O.source).getClusterLeaves(O)})),this.actor.registerMessageHandler("LD",(R,O)=>this._getWorkerSource(R,O.type,O.source).loadData(O)),this.actor.registerMessageHandler("GD",(R,O)=>this._getWorkerSource(R,O.type,O.source).getData()),this.actor.registerMessageHandler("LT",(R,O)=>this._getWorkerSource(R,O.type,O.source).loadTile(O)),this.actor.registerMessageHandler("RT",(R,O)=>this._getWorkerSource(R,O.type,O.source).reloadTile(O)),this.actor.registerMessageHandler("AT",(R,O)=>this._getWorkerSource(R,O.type,O.source).abortTile(O)),this.actor.registerMessageHandler("RMT",(R,O)=>this._getWorkerSource(R,O.type,O.source).removeTile(O)),this.actor.registerMessageHandler("RS",(R,O)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[R]||!this.workerSources[R][O.type]||!this.workerSources[R][O.type][O.source])return;const H=this.workerSources[R][O.type][O.source];delete this.workerSources[R][O.type][O.source],H.removeSource!==void 0&&H.removeSource(O)})),this.actor.registerMessageHandler("RM",R=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[R],delete this.availableImages[R],delete this.workerSources[R],delete this.demWorkerSources[R]})),this.actor.registerMessageHandler("SR",(R,O)=>S._(this,void 0,void 0,function*(){this.referrer=O})),this.actor.registerMessageHandler("SRPS",(R,O)=>this._syncRTLPluginState(R,O)),this.actor.registerMessageHandler("IS",(R,O)=>S._(this,void 0,void 0,function*(){this.self.importScripts(O)})),this.actor.registerMessageHandler("SI",(R,O)=>this._setImages(R,O)),this.actor.registerMessageHandler("UL",(R,O)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(R).update(O.layers,O.removedIds)})),this.actor.registerMessageHandler("SL",(R,O)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(R).replace(O)}))}_setImages(D,R){return S._(this,void 0,void 0,function*(){this.availableImages[D]=R;for(const O in this.workerSources[D]){const H=this.workerSources[D][O];for(const te in H)H[te].availableImages=R}})}_syncRTLPluginState(D,R){return S._(this,void 0,void 0,function*(){if(S.bB.isParsed())return S.bB.getState();if(R.pluginStatus!=="loading")return S.bB.setState(R),R;const O=R.pluginURL;if(this.self.importScripts(O),S.bB.isParsed()){const H={pluginStatus:"loaded",pluginURL:O};return S.bB.setState(H),H}throw S.bB.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${O}`)})}_getAvailableImages(D){let R=this.availableImages[D];return R||(R=[]),R}_getLayerIndex(D){let R=this.layerIndexes[D];return R||(R=this.layerIndexes[D]=new d),R}_getWorkerSource(D,R,O){if(this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][R]||(this.workerSources[D][R]={}),!this.workerSources[D][R][O]){const H={sendAsync:(te,se)=>(te.targetMapId=D,this.actor.sendAsync(te,se))};switch(R){case"vector":this.workerSources[D][R][O]=new X(H,this._getLayerIndex(D),this._getAvailableImages(D));break;case"geojson":this.workerSources[D][R][O]=new Mr(H,this._getLayerIndex(D),this._getAvailableImages(D));break;default:this.workerSources[D][R][O]=new this.externalWorkerSourceTypes[R](H,this._getLayerIndex(D),this._getAvailableImages(D))}}return this.workerSources[D][R][O]}_getDEMWorkerSource(D,R){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][R]||(this.demWorkerSources[D][R]=new V),this.demWorkerSources[D][R]}}return S.i(self)&&(self.worker=new Mi(self)),Mi}),v("index",["exports","./shared"],function(S,d){var $="4.4.1";let ie,me;const X={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:m=>new Promise((t,s)=>{const l=requestAnimationFrame(t);m.signal.addEventListener("abort",()=>{cancelAnimationFrame(l),s(d.c())})}),getImageData(m,t=0){return this.getImageCanvasContext(m).getImageData(-t,-t,m.width+2*t,m.height+2*t)},getImageCanvasContext(m){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=m.width,t.height=m.height,s.drawImage(m,0,0,m.width,m.height),s},resolveURL:m=>(ie||(ie=document.createElement("a")),ie.href=m,ie.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(me==null&&(me=matchMedia("(prefers-reduced-motion: reduce)")),me.matches)}};class V{static testProp(t){if(!V.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in V.docStyle)return t[s];return t[0]}static create(t,s,l){const h=window.document.createElement(t);return s!==void 0&&(h.className=s),l&&l.appendChild(h),h}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){V.docStyle&&V.selectProp&&(V.userSelect=V.docStyle[V.selectProp],V.docStyle[V.selectProp]="none")}static enableDrag(){V.docStyle&&V.selectProp&&(V.docStyle[V.selectProp]=V.userSelect)}static setTransform(t,s){t.style[V.transformProp]=s}static addEventListener(t,s,l,h={}){t.addEventListener(s,l,"passive"in h?h:h.capture)}static removeEventListener(t,s,l,h={}){t.removeEventListener(s,l,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",V.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",V.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",V.suppressClickInternal,!0)},0)}static getScale(t){const s=t.getBoundingClientRect();return{x:s.width/t.offsetWidth||1,y:s.height/t.offsetHeight||1,boundingClientRect:s}}static getPoint(t,s,l){const h=s.boundingClientRect;return new d.P((l.clientX-h.left)/s.x-t.clientLeft,(l.clientY-h.top)/s.y-t.clientTop)}static mousePos(t,s){const l=V.getScale(t);return V.getPoint(t,l,s)}static touchPos(t,s){const l=[],h=V.getScale(t);for(let g=0;g<s.length;g++)l.push(V.getPoint(t,h,s[g]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}V.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,V.selectProp=V.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),V.transformProp=V.testProp(["transform","WebkitTransform"]);const Te={supported:!1,testSupport:function(m){!yt&&Me&&(oe?ne(m):ke=m)}};let ke,Me,yt=!1,oe=!1;function ne(m){const t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Me),m.isContextLost())return;Te.supported=!0}catch{}m.deleteTexture(t),yt=!0}var he;typeof document<"u"&&(Me=document.createElement("img"),Me.onload=()=>{ke&&ne(ke),ke=null,oe=!0},Me.onerror=()=>{yt=!0,ke=null},Me.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let t,s,l,h;m.resetRequestQueue=()=>{t=[],s=0,l=0,h={}},m.addThrottleControl=T=>{const E=l++;return h[E]=T,E},m.removeThrottleControl=T=>{delete h[T],x()},m.getImage=(T,E,A=!0)=>new Promise((M,F)=>{Te.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),d.e(T,{type:"image"}),t.push({abortController:E,requestParameters:T,supportImageRefresh:A,state:"queued",onError:N=>{F(N)},onSuccess:N=>{M(N)}}),x()});const g=T=>d._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:E,supportImageRefresh:A,onError:M,onSuccess:F,abortController:N}=T,U=A===!1&&!d.i(self)&&!d.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce((J,re)=>J&&re==="accept",!0));s++;const K=U?b(E,N):d.m(E,N);try{const J=yield K;delete T.abortController,T.state="completed",J.data instanceof HTMLImageElement||d.b(J.data)?F(J):J.data&&F({data:yield(Z=J.data,typeof createImageBitmap=="function"?d.d(Z):d.f(Z)),cacheControl:J.cacheControl,expires:J.expires})}catch(J){delete T.abortController,M(J)}finally{s--,x()}var Z}),x=()=>{const T=(()=>{for(const E of Object.keys(h))if(h[E]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=s;E<T&&t.length>0;E++){const A=t.shift();A.abortController.signal.aborted?E--:g(A)}},b=(T,E)=>new Promise((A,M)=>{const F=new Image,N=T.url,U=T.credentials;U&&U==="include"?F.crossOrigin="use-credentials":(U&&U==="same-origin"||!d.s(N))&&(F.crossOrigin="anonymous"),E.signal.addEventListener("abort",()=>{F.src="",M(d.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,A({data:F})},F.onerror=()=>{F.onerror=F.onload=null,E.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=N})}(he||(he={})),he.resetRequestQueue();class Ie{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Be(m){var t=new d.A(3);return t[0]=m[0],t[1]=m[1],t[2]=m[2],t}var Re,$e=function(m,t,s){return m[0]=t[0]-s[0],m[1]=t[1]-s[1],m[2]=t[2]-s[2],m};Re=new d.A(3),d.A!=Float32Array&&(Re[0]=0,Re[1]=0,Re[2]=0);var Xe=function(m){var t=m[0],s=m[1];return t*t+s*s};function xt(m){const t=[];if(typeof m=="string")t.push({id:"default",url:m});else if(m&&m.length>0){const s=[];for(const{id:l,url:h}of m){const g=`${l}${h}`;s.indexOf(g)===-1&&(s.push(g),t.push({id:l,url:h}))}}return t}function rt(m,t,s){const l=m.split("?");return l[0]+=`${t}${s}`,l.join("?")}(function(){var m=new d.A(2);d.A!=Float32Array&&(m[0]=0,m[1]=0)})();class pt{constructor(t,s,l,h){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(s,h)}update(t,s,l){const{width:h,height:g}=t,x=!(this.size&&this.size[0]===h&&this.size[1]===g||l),{context:b}=this,{gl:T}=b;if(this.useMipmap=!!(s&&s.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!s||s.premultiply!==!1)),x)this.size=[h,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||d.b(t)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,t):T.texImage2D(T.TEXTURE_2D,0,this.format,h,g,0,this.format,T.UNSIGNED_BYTE,t.data);else{const{x:E,y:A}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||d.b(t)?T.texSubImage2D(T.TEXTURE_2D,0,E,A,T.RGBA,T.UNSIGNED_BYTE,t):T.texSubImage2D(T.TEXTURE_2D,0,E,A,h,g,T.RGBA,T.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(t,s,l){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),l!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,l||t),this.filter=t),s!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function oi(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ut extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let l=!0;const h=s.data||s.spriteData;return this._validateStretch(s.stretchX,h&&h.width)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,h&&h.height)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,s){if(!t)return!0;let l=0;for(const h of t){if(h[0]<l||h[1]<h[0]||s<h[1])return!1;l=h[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const l=s.spriteData,h=l&&l.width||s.data.width,g=l&&l.height||s.data.height;return!(t[0]<0||h<t[0]||t[1]<0||g<t[1]||t[2]<0||h<t[2]||t[3]<0||g<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,l=!0){const h=this.getImage(t);if(l&&(h.data.width!==s.data.width||h.data.height!==s.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=h.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((s,l)=>{let h=!0;if(!this.isLoaded())for(const g of t)this.images[g]||(h=!1);this.isLoaded()||h?s(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:s})})}_getImagesForIds(t){const s={};for(const l of t){let h=this.getImage(l);h||(this.fire(new d.k("styleimagemissing",{id:l})),h=this.getImage(l)),h?s[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],l=this.getImage(t);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},g=new d.I(h,l);this.patterns[t]={bin:h,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new pt(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:s,h:l}=d.p(t),h=this.atlasImage;h.resize({width:s||1,height:l||1});for(const g in this.patterns){const{bin:x}=this.patterns[g],b=x.x+1,T=x.y+1,E=this.getImage(g).data,A=E.width,M=E.height;d.R.copy(E,h,{x:0,y:0},{x:b,y:T},{width:A,height:M}),d.R.copy(E,h,{x:0,y:M-1},{x:b,y:T-1},{width:A,height:1}),d.R.copy(E,h,{x:0,y:0},{x:b,y:T+M},{width:A,height:1}),d.R.copy(E,h,{x:A-1,y:0},{x:b-1,y:T},{width:1,height:M}),d.R.copy(E,h,{x:0,y:0},{x:b+A,y:T},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||d.w(`Image with ID: "${s}" was not found`),oi(l)&&this.updateImage(s,l)}}}const ei=1e20;function Ri(m,t,s,l,h,g,x,b,T){for(let E=t;E<t+l;E++)Pn(m,s*g+E,g,h,x,b,T);for(let E=s;E<s+h;E++)Pn(m,E*g+t,1,l,x,b,T)}function Pn(m,t,s,l,h,g,x){g[0]=0,x[0]=-ei,x[1]=ei,h[0]=m[t];for(let b=1,T=0,E=0;b<l;b++){h[b]=m[t+b*s];const A=b*b;do{const M=g[T];E=(h[b]-h[M]+A-M*M)/(b-M)/2}while(E<=x[T]&&--T>-1);T++,g[T]=b,x[T]=E,x[T+1]=ei}for(let b=0,T=0;b<l;b++){for(;x[T+1]<b;)T++;const E=g[T],A=b-E;m[t+b*s]=h[E]+A*A}}class Fi{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return d._(this,void 0,void 0,function*(){const s=[];for(const g in t)for(const x of t[g])s.push(this._getAndCacheGlyphsPromise(g,x));const l=yield Promise.all(s),h={};for(const{stack:g,id:x,glyph:b}of l)h[g]||(h[g]={}),h[g][x]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return h})}_getAndCacheGlyphsPromise(t,s){return d._(this,void 0,void 0,function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[s];if(h!==void 0)return{stack:t,id:s,glyph:h};if(h=this._tinySDF(l,t,s),h)return l.glyphs[s]=h,{stack:t,id:s,glyph:h};const g=Math.floor(s/256);if(256*g>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[g])return{stack:t,id:s,glyph:h};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[g]){const b=Fi.loadGlyphRange(t,g,this.url,this.requestManager);l.requests[g]=b}const x=yield l.requests[g];for(const b in x)this._doesCharSupportLocalGlyph(+b)||(l.glyphs[+b]=x[+b]);return l.ranges[g]=!0,{stack:t,id:s,glyph:x[s]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(d.u["CJK Unified Ideographs"](t)||d.u["Hangul Syllables"](t)||d.u.Hiragana(t)||d.u.Katakana(t))}_tinySDF(t,s,l){const h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let g=t.tinySDF;if(!g){let b="400";/bold/i.test(s)?b="900":/medium/i.test(s)?b="500":/light/i.test(s)&&(b="200"),g=t.tinySDF=new Fi.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:h,fontWeight:b})}const x=g.draw(String.fromCharCode(l));return{id:l,bitmap:new d.o({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}Fi.loadGlyphRange=function(m,t,s,l){return d._(this,void 0,void 0,function*(){const h=256*t,g=h+255,x=l.transformRequest(s.replace("{fontstack}",m).replace("{range}",`${h}-${g}`),"Glyphs"),b=yield d.l(x,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${t}, ${h}-${g}`);const T={};for(const E of d.n(b.data))T[E.id]=E;return T})},Fi.TinySDF=class{constructor({fontSize:m=24,buffer:t=3,radius:s=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:x="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=s;const b=this.size=m+4*t,T=this._createCanvas(b),E=this.ctx=T.getContext("2d",{willReadFrequently:!0});E.font=`${x} ${g} ${m}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(m){const t=document.createElement("canvas");return t.width=t.height=m,t}draw(m){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(m),x=Math.ceil(s),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),T=Math.min(this.size-this.buffer,x+Math.ceil(l)),E=b+2*this.buffer,A=T+2*this.buffer,M=Math.max(E*A,0),F=new Uint8ClampedArray(M),N={data:F,width:E,height:A,glyphWidth:b,glyphHeight:T,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(b===0||T===0)return N;const{ctx:U,buffer:K,gridInner:Z,gridOuter:J}=this;U.clearRect(K,K,b,T),U.fillText(m,K,K+x);const re=U.getImageData(K,K,b,T);J.fill(ei,0,M),Z.fill(0,0,M);for(let W=0;W<T;W++)for(let ae=0;ae<b;ae++){const de=re.data[4*(W*b+ae)+3]/255;if(de===0)continue;const fe=(W+K)*E+ae+K;if(de===1)J[fe]=0,Z[fe]=ei;else{const we=.5-de;J[fe]=we>0?we*we:0,Z[fe]=we<0?we*we:0}}Ri(J,0,0,E,A,E,this.f,this.v,this.z),Ri(Z,K,K,b,T,E,this.f,this.v,this.z);for(let W=0;W<M;W++){const ae=Math.sqrt(J[W])-Math.sqrt(Z[W]);F[W]=Math.round(255-255*(ae/this.radius+this.cutoff))}return N}};class Ye{constructor(){this.specification=d.v.light.position}possiblyEvaluate(t,s){return d.y(t.expression.evaluate(s))}interpolate(t,s,l){return{x:d.z.number(t.x,s.x,l),y:d.z.number(t.y,s.y,l),z:d.z.number(t.z,s.z,l)}}}let ft;class mt extends d.E{constructor(t){super(),ft=ft||new d.q({anchor:new d.D(d.v.light.anchor),position:new Ye,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(ft),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(d.r,t,s))for(const l in t){const h=t[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,l){return(!l||l.validate!==!1)&&d.t(this,t.call(d.x,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}class Et{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const l=t.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,s)),this.dashEntry[l]}getDashRanges(t,s,l){const h=[];let g=t.length%2==1?-t[t.length-1]*l:0,x=t[0]*l,b=!0;h.push({left:g,right:x,isDash:b,zeroLength:t[0]===0});let T=t[0];for(let E=1;E<t.length;E++){b=!b;const A=t[E];g=T*l,T+=A,x=T*l,h.push({left:g,right:x,isDash:b,zeroLength:A===0})}return h}addRoundDash(t,s,l){const h=s/2;for(let g=-l;g<=l;g++){const x=this.width*(this.nextRow+l+g);let b=0,T=t[b];for(let E=0;E<this.width;E++){E/T.right>1&&(T=t[++b]);const A=Math.abs(E-T.left),M=Math.abs(E-T.right),F=Math.min(A,M);let N;const U=g/l*(h+1);if(T.isDash){const K=h-Math.abs(U);N=Math.sqrt(F*F+K*K)}else N=h-Math.sqrt(F*F+U*U);this.data[x+E]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(t){for(let b=t.length-1;b>=0;--b){const T=t[b],E=t[b+1];T.zeroLength?t.splice(b,1):E&&E.isDash===T.isDash&&(E.left=T.left,t.splice(b,1))}const s=t[0],l=t[t.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const h=this.width*this.nextRow;let g=0,x=t[g];for(let b=0;b<this.width;b++){b/x.right>1&&(x=t[++g]);const T=Math.abs(b-x.left),E=Math.abs(b-x.right),A=Math.min(T,E);this.data[h+b]=Math.max(0,Math.min(255,(x.isDash?A:-A)+128))}}addDash(t,s){const l=s?7:0,h=2*l+1;if(this.nextRow+h>this.height)return d.w("LineAtlas out of space"),null;let g=0;for(let b=0;b<t.length;b++)g+=t[b];if(g!==0){const b=this.width/g,T=this.getDashRanges(t,this.width,b);s?this.addRoundDash(T,b,l):this.addRegularDash(T)}const x={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:g};return this.nextRow+=h,this.dirty=!0,x}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const zt="maplibre_preloaded_worker_pool";class Ui{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ui.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[zt]}numActive(){return Object.keys(this.active).length}}const dn=Math.floor(X.hardwareConcurrency/2);let Mn,Bi;function $i(){return Mn||(Mn=new Ui),Mn}Ui.workerCount=d.B(globalThis)?Math.max(Math.min(dn,3),1):1;class Ir{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let h=0;h<l.length;h++){const g=new d.C(l[h],s);g.name=`Worker ${h}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:t,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,s){for(const l of this.actors)l.registerMessageHandler(t,s)}}function Oo(){return Bi||(Bi=new Ir($i(),d.G),Bi.registerMessageHandler("GR",(m,t,s)=>d.m(t,s))),Bi}function No(m,t){const s=d.F();return d.H(s,s,[1,1,0]),d.J(s,s,[.5*m.width,.5*m.height,1]),d.K(s,s,m.calculatePosMatrix(t.toUnwrapped()))}function ka(m,t,s,l,h,g){const x=function(M,F,N){if(M)for(const U of M){const K=F[U];if(K&&K.source===N&&K.type==="fill-extrusion")return!0}else for(const U in F){const K=F[U];if(K.source===N&&K.type==="fill-extrusion")return!0}return!1}(h&&h.layers,t,m.id),b=g.maxPitchScaleFactor(),T=m.tilesIn(l,b,x);T.sort(fr);const E=[];for(const M of T)E.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(t,s,m._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,h,g,b,No(m.transform,M.tileID))});const A=function(M){const F={},N={};for(const U of M){const K=U.queryResults,Z=U.wrappedTileID,J=N[Z]=N[Z]||{};for(const re in K){const W=K[re],ae=J[re]=J[re]||{},de=F[re]=F[re]||[];for(const fe of W)ae[fe.featureIndex]||(ae[fe.featureIndex]=!0,de.push(fe))}}return F}(E);for(const M in A)A[M].forEach(F=>{const N=F.feature,U=m.getFeatureState(N.layer["source-layer"],N.id);N.source=N.layer.source,N.layer["source-layer"]&&(N.sourceLayer=N.layer["source-layer"]),N.state=U});return A}function fr(m,t){const s=m.tileID,l=t.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function Gr(m,t,s){return d._(this,void 0,void 0,function*(){let l=m;if(m.url?l=(yield d.h(t.transformRequest(m.url,"Source"),s)).data:yield X.frameAsync(s),!l)return null;const h=d.L(d.e(l,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map(g=>g.id)),h})}class xi{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof d.M?new d.M(t.lng,t.lat):d.M.convert(t),this}setSouthWest(t){return this._sw=t instanceof d.M?new d.M(t.lng,t.lat):d.M.convert(t),this}extend(t){const s=this._sw,l=this._ne;let h,g;if(t instanceof d.M)h=t,g=t;else{if(!(t instanceof xi))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(xi.convert(t)):this.extend(d.M.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(d.M.convert(t)):this;if(h=t._sw,g=t._ne,!h||!g)return this}return s||l?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),l.lng=Math.max(g.lng,l.lng),l.lat=Math.max(g.lat,l.lat)):(this._sw=new d.M(h.lng,h.lat),this._ne=new d.M(g.lng,g.lat)),this}getCenter(){return new d.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.M(this.getWest(),this.getNorth())}getSouthEast(){return new d.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:l}=d.M.convert(t);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(t){return t instanceof xi?t:t&&new xi(t)}static fromLngLat(t,s=0){const l=360*s/40075017,h=l/Math.cos(Math.PI/180*t.lat);return new xi(new d.M(t.lng-h,t.lat-l),new d.M(t.lng+h,t.lat+l))}}class jo{constructor(t,s,l){this.bounds=xi.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),l=Math.floor(d.N(this.bounds.getWest())*s),h=Math.floor(d.O(this.bounds.getNorth())*s),g=Math.ceil(d.N(this.bounds.getEast())*s),x=Math.ceil(d.O(this.bounds.getSouth())*s);return t.x>=l&&t.x<g&&t.y>=h&&t.y<x}}class ye extends d.E{constructor(t,s,l,h){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.L(s,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Gr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(d.e(this,t),t.bounds&&(this.tileBounds=new jo(t.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new d.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(t){return d._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((g,x)=>{t.reloadPromise={resolve:g,reject:x}})}else t.actor=this.dispatcher.getActor(),h="LT";t.abortController=new AbortController;try{const g=yield t.actor.sendAsync({type:h,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,g)}catch(g){if(delete t.abortController,t.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,s){if(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Wr extends d.E{constructor(t,s,l,h){super(),this.id=t,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},s),d.e(this,d.L(s,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Gr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(d.e(this,t),t.bounds&&(this.tileBounds=new jo(t.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new d.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return d.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return d._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield he.getImage(this.map._requestManager.transformRequest(s,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,g=h.gl,x=l.data;t.texture=this.map.painter.getTileTexture(x.width),t.texture?t.texture.update(x,{useMipmap:!0}):(t.texture=new pt(h,x,g.RGBA,{useMipmap:!0}),t.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),h.extTextureFilterAnisotropic&&g.texParameterf(g.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}})}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class Rs extends Wr{constructor(t,s,l,h){super(t,s,l,h),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t){return d._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const h=yield he.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){const g=h.data;this.map._refreshExpiredTiles&&h.cacheControl&&h.expires&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const x=d.b(g)&&d.S()?g:yield this.readImageNow(g),b={type:this.type,uid:t.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const T=yield t.actor.sendAsync({type:"LDT",data:b});t.dem=T,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}})}readImageNow(t){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.U()){const s=t.width+2,l=t.height+2;try{return new d.R({width:s,height:l},yield d.V(t,-1,-1,s,l))}catch{}}return X.getImageData(t,1)})}_getNeighboringTiles(t){const s=t.canonical,l=Math.pow(2,s.z),h=(s.x-1+l)%l,g=s.x===0?t.wrap-1:t.wrap,x=(s.x+1+l)%l,b=s.x+1===l?t.wrap+1:t.wrap,T={};return T[new d.Q(t.overscaledZ,g,s.z,h,s.y).key]={backfilled:!1},T[new d.Q(t.overscaledZ,b,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(T[new d.Q(t.overscaledZ,g,s.z,h,s.y-1).key]={backfilled:!1},T[new d.Q(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},T[new d.Q(t.overscaledZ,b,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<l&&(T[new d.Q(t.overscaledZ,g,s.z,h,s.y+1).key]={backfilled:!1},T[new d.Q(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},T[new d.Q(t.overscaledZ,b,s.z,x,s.y+1).key]={backfilled:!1}),T}unloadTile(t){return d._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class Dt extends d.E{constructor(t,s,l,h){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(h),this._data=s.data,this._options=d.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const g=d.W/this.tileSize;this.workerOptions=d.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*g,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*g,extent:d.W,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:d.W,radius:(s.clusterRadius||50)*g,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return d._(this,void 0,void 0,function*(){const t=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:s,offset:l}})}_updateWorkerData(t){return d._(this,void 0,void 0,function*(){const s=d.e({type:this.type},this.workerOptions);t?s.dataDiff=t:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(X.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let h=null;l.resourceTiming&&l.resourceTiming[this.id]&&(h=l.resourceTiming[this.id].slice(0));const g={dataType:"source"};this._collectResourceTiming&&h&&h.length>0&&d.e(g,{resourceTiming:h}),this.fire(new d.k("data",Object.assign(Object.assign({},g),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},g),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(l))}})}loaded(){return this._pendingLoads===0}loadTile(t){return d._(this,void 0,void 0,function*(){const s=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const h=yield this.actor.sendAsync({type:s,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(h,this.map.painter,s==="RT")})}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Jt=d.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Cr extends d.E{constructor(t,s,l,h){super(),this.id=t,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=s}load(t){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield he.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,t&&(this.coordinates=t),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new d.j(s))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(d.Y.fromLngLat);this.tileID=function(h){let g=1/0,x=1/0,b=-1/0,T=-1/0;for(const F of h)g=Math.min(g,F.x),x=Math.min(x,F.y),b=Math.max(b,F.x),T=Math.max(T,F.y);const E=Math.max(b-g,T-x),A=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),M=Math.pow(2,A);return new d.a0(A,Math.floor((g+b)/2*M),Math.floor((x+T)/2*M))}(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map(h=>this.tileID.getTilePoint(h)._round());return this._boundsArray=new d.Z,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,d.W,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,d.W),this._boundsArray.emplaceBack(l[2].x,l[2].y,d.W,d.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Jt.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new pt(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const g=this.tiles[h];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Vo extends Cr{constructor(t,s,l,h){super(t,s,l,h),this.roundZoom=!0,this.type="video",this.options=s}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield d.a2(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new d.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new d.j(new d.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Jt.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new pt(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const g=this.tiles[h];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Fs extends Cr{constructor(t,s,l,h){super(t,s,l,h),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(x=>typeof x!="number"))||this.fire(new d.j(new d.a1(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a1(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new d.j(new d.a1(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a1(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a1(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Jt.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new pt(s,this.canvas,l.RGBA,{premultiply:!0});let h=!1;for(const g in this.tiles){const x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,h=!0)}h&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Uo={},Er=m=>{switch(m){case"geojson":return Dt;case"image":return Cr;case"raster":return Wr;case"raster-dem":return Rs;case"vector":return ye;case"video":return Vo;case"canvas":return Fs}return Uo[m]},$o="RTLPluginLoaded";class Ia extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Oo()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return d._(this,arguments,void 0,function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=X.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k($o))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ze=null;function pn(){return ze||(ze=new Ia),ze}class fn{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=d.a3(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,g){const x={};if(!g)return x;for(const b of h){const T=b.layerIds.map(E=>g.getLayer(E)).filter(Boolean);if(T.length!==0){b.layers=T,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(E=>T.filter(A=>A.id===E)[0]));for(const E of T)x[E.id]=b}}return x}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const g=this.buckets[h];if(g instanceof d.a5){if(this.hasSymbolBuckets=!0,!l)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const g=this.buckets[h];if(g instanceof d.a5&&g.hasRTLText){this.hasRTLText=!0,pn().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const g=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(h).queryRadius(g))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new d.a4}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pt(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pt(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,l,h,g,x,b,T,E,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:A,transform:T,params:b,queryPadding:this.queryPadding*E},t,s,l):{}}querySourceFeatures(t,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),g=s&&s.sourceLayer?s.sourceLayer:"",x=h._geojsonTileLayer||h[g];if(!x)return;const b=d.a6(s&&s.filter),{z:T,x:E,y:A}=this.tileID.canonical,M={z:T,x:E,y:A};for(let F=0;F<x.length;F++){const N=x.feature(F);if(b.needGeometry){const Z=d.a7(N,!0);if(!b.filter(new d.a8(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!b.filter(new d.a8(this.tileID.overscaledZ),N))continue;const U=l.getId(N,g),K=new d.a9(N,T,E,A,U);K.tile=M,t.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const l=d.aa(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(s)if(this.expirationTime<s)h=!0;else{const g=this.expirationTime-s;g?this.expirationTime=l+Math.max(g,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!s.style.hasLayer(h))continue;const g=this.buckets[h],x=g.layers[0].sourceLayer||"_geojsonTileLayer",b=l[x],T=t[x];if(!b||!T||Object.keys(T).length===0)continue;g.update(T,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const E=s&&s.style&&s.style.getLayer(h);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<X.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=X.now()+t}setDependencies(t,s){const l={};for(const h of s)l[h]=!0;this.dependencies[t]=l}hasDependency(t,s){for(const l of t){const h=this.dependencies[l];if(h){for(const g of s)if(h[g])return!0}}return!1}}class Zo{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,l){const h=t.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const g={value:s,timeout:void 0};if(l!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},l)),this.data[h].push(g),this.order.push(h),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const l=t.wrapped().key,h=s===void 0?0:this.data[l].indexOf(s),g=this.data[l][h];return this.data[l].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(g.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const l in this.data)for(const h of this.data[l])t(h.value)||s.push(h);for(const l of s)this.remove(l.value.tileID,l)}}class uo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,l){const h=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},d.e(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==h&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const g in this.state[t][h])l[g]||(this.deletedStates[t][h][g]=null)}else for(const g in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][g]===null&&delete this.deletedStates[t][h][g]}removeFeatureState(t,s,l){if(this.deletedStates[t]===null)return;const h=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&s!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,s){const l=String(s),h=d.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const g=this.deletedStates[t][s];if(g===null)return{};for(const x in g)delete h[x]}return h}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const g={};for(const x in this.stateChanges[h])this.state[h][x]||(this.state[h][x]={}),d.e(this.state[h][x],this.stateChanges[h][x]),g[x]=this.state[h][x];l[h]=g}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const g={};if(this.deletedStates[h]===null)for(const x in this.state[h])g[x]={},this.state[h][x]={};else for(const x in this.deletedStates[h]){if(this.deletedStates[h][x]===null)this.state[h][x]={};else for(const b of Object.keys(this.deletedStates[h][x]))delete this.state[h][x][b];g[x]=this.state[h][x]}l[h]=l[h]||{},d.e(l[h],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in t)t[h].setFeatureState(l,s)}}class Pe extends d.E{constructor(t,s,l){super(),this.id=t,this.dispatcher=l,this.on("data",h=>this._dataHandler(h)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,g,x,b)=>{const T=new(Er(g.type))(h,g,x,b);if(T.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${T.id}`);return T})(t,s,l,this),this._tiles={},this._cache=new Zo(0,h=>this._unloadTile(h)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new uo,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s,l){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,s,l)}catch(h){t.state="errored",h.status!==404?this._source.fire(new d.j(h,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new d.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(wt).map(t=>t.key)}getRenderableIds(t){const s=[];for(const l in this._tiles)this._isIdRenderable(l,t)&&s.push(this._tiles[l]);return t?s.sort((l,h)=>{const g=l.tileID,x=h.tileID,b=new d.P(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),T=new d.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-x.overscaledZ||T.y-b.y||T.x-b.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(wt).map(l=>l.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){return d._(this,void 0,void 0,function*(){const l=this._tiles[t];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,t,s))})}_tileLoaded(t,s,l){t.timeAdded=X.now(),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let h=0;h<s.length;h++){const g=s[h];if(t.neighboringTiles&&t.neighboringTiles[g]){const x=this.getTileByID(g);l(t,x),l(x,t)}}function l(h,g){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let x=g.tileID.canonical.x-h.tileID.canonical.x;const b=g.tileID.canonical.y-h.tileID.canonical.y,T=Math.pow(2,h.tileID.canonical.z),E=g.tileID.key;x===0&&b===0||Math.abs(b)>1||(Math.abs(x)>1&&(Math.abs(x+T)===1?x+=T:Math.abs(x-T)===1&&(x-=T)),g.dem&&h.dem&&(h.dem.backfillBorder(g.dem,x,b),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,l,h){for(const g in this._tiles){let x=this._tiles[g];if(h[g]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>l)continue;let b=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const E=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[E.key],x&&x.hasData()&&(b=E)}let T=b;for(;T.overscaledZ>s;)if(T=T.scaledTo(T.overscaledZ-1),t[T.key]){h[b.key]=b;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=t.overscaledZ-1;l>=s;l--){const h=t.scaledTo(l),g=this._getLoadedTile(h);if(g)return g}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(g)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const l={};for(const h in this._tiles){const g=this._tiles[h];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),l[g.tileID.key]=g}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}_updateCoveredAndRetainedTiles(t,s,l,h,g,x){const b={},T={},E=Object.keys(t),A=X.now();for(const M of E){const F=t[M],N=this._tiles[M];if(!N||N.fadeEndTime!==0&&N.fadeEndTime<=A)continue;const U=this.findLoadedParent(F,s),K=this.findLoadedSibling(F),Z=U||K||null;Z&&(this._addTile(Z.tileID),b[Z.tileID.key]=Z.tileID),T[M]=F}this._retainLoadedChildren(T,h,l,t);for(const M in b)t[M]||(this._coveredTiles[M]=!0,t[M]=b[M]);if(x){const M={},F={};for(const N of g)this._tiles[N.key].hasData()?M[N.key]=N:F[N.key]=N;for(const N in F){const U=F[N].children(this._source.maxzoom);this._tiles[U[0].key]&&this._tiles[U[1].key]&&this._tiles[U[2].key]&&this._tiles[U[3].key]&&(M[U[0].key]=t[U[0].key]=U[0],M[U[1].key]=t[U[1].key]=U[1],M[U[2].key]=t[U[2].key]=U[2],M[U[3].key]=t[U[3].key]=U[3],delete F[N])}for(const N in F){const U=F[N],K=this.findLoadedParent(U,this._source.minzoom),Z=this.findLoadedSibling(U),J=K||Z||null;if(J){M[J.tileID.key]=t[J.tileID.key]=J.tileID;for(const re in M)M[re].isChildOf(J.tileID)&&delete M[re]}}for(const N in this._tiles)M[N]||(this._coveredTiles[N]=!0)}}update(t,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=s,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new d.Q(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(l=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter(A=>this._source.hasTile(A)))):l=[];const h=t.coveringZoomLevel(this._source),g=Math.max(h-Pe.maxOverzooming,this._source.minzoom),x=Math.max(h+Pe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const M of l)if(M.canonical.z>this._source.minzoom){const F=M.scaledTo(M.canonical.z-1);A[F.key]=F;const N=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));A[N.key]=N}l=l.concat(Object.values(A))}const b=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(l,h);gt(this._source.type)&&this._updateCoveredAndRetainedTiles(T,g,x,h,l,s);for(const A in T)this._tiles[A].clearFadeHold();const E=d.ab(this._tiles,T);for(const A of E){const M=this._tiles[A];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){var l;const h={},g={},x=Math.max(s-Pe.maxOverzooming,this._source.minzoom),b=Math.max(s+Pe.maxUnderzooming,this._source.minzoom),T={};for(const E of t){const A=this._addTile(E);h[E.key]=E,A.hasData()||s<this._source.maxzoom&&(T[E.key]=E)}this._retainLoadedChildren(T,s,b,h);for(const E of t){let A=this._tiles[E.key];if(A.hasData())continue;if(s+1>this._source.maxzoom){const F=E.children(this._source.maxzoom)[0],N=this.getTile(F);if(N&&N.hasData()){h[F.key]=F;continue}}else{const F=E.children(this._source.maxzoom);if(h[F[0].key]&&h[F[1].key]&&h[F[2].key]&&h[F[3].key])continue}let M=A.wasRequested();for(let F=E.overscaledZ-1;F>=x;--F){const N=E.scaledTo(F);if(g[N.key])break;if(g[N.key]=!0,A=this.getTile(N),!A&&M&&(A=this._addTile(N)),A){const U=A.hasData();if((U||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||M)&&(h[N.key]=N),M=A.wasRequested(),U)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let l,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}s.push(h.key);const g=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(g),l)break;h=g}for(const g of s)this._loadedParentTiles[g]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const s=this._tiles[t].tileID,l=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=l}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const l=s;return s||(s=new fn(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,t.key,s.state)),s.uses++,this._tiles[t.key]=s,l||this._source.fire(new d.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=s.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(t){const s=t.sourceDataType;t.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,l){const h=[],g=this.transform;if(!g)return h;const x=l?g.getCameraQueryGeometry(t):t,b=t.map(U=>g.pointCoordinate(U,this.terrain)),T=x.map(U=>g.pointCoordinate(U,this.terrain)),E=this.getIds();let A=1/0,M=1/0,F=-1/0,N=-1/0;for(const U of T)A=Math.min(A,U.x),M=Math.min(M,U.y),F=Math.max(F,U.x),N=Math.max(N,U.y);for(let U=0;U<E.length;U++){const K=this._tiles[E[U]];if(K.holdingForFade())continue;const Z=K.tileID,J=Math.pow(2,g.zoom-K.tileID.overscaledZ),re=s*K.queryPadding*d.W/K.tileSize/J,W=[Z.getTilePoint(new d.Y(A,M)),Z.getTilePoint(new d.Y(F,N))];if(W[0].x-re<d.W&&W[0].y-re<d.W&&W[1].x+re>=0&&W[1].y+re>=0){const ae=b.map(fe=>Z.getTilePoint(fe)),de=T.map(fe=>Z.getTilePoint(fe));h.push({tile:K,tileID:Z,queryGeometry:ae,cameraQueryGeometry:de,scale:J})}}return h}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(gt(this._source.type)){const t=X.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=t)return!0}return!1}setFeatureState(t,s,l){this._state.updateState(t=t||"_geojsonTileLayer",s,l)}removeFeatureState(t,s,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,l)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,l){const h=this._tiles[t];h&&h.setDependencies(s,l)}reloadTilesForDependencies(t,s){for(const l in this._tiles)this._tiles[l].hasDependency(t,s)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(t,s))}}function wt(m,t){const s=Math.abs(2*m.wrap)-+(m.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return m.overscaledZ-t.overscaledZ||l-s||t.canonical.y-m.canonical.y||t.canonical.x-m.canonical.x}function gt(m){return m==="raster"||m==="image"||m==="video"}Pe.maxOverzooming=10,Pe.maxUnderzooming=3;class nn{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=d.ac(t,0,1);let s=1,l=this._distances[s];const h=t*this.paddedLength+this.padding;for(;l<h&&s<this._distances.length;)l=this._distances[++s];const g=s-1,x=this._distances[g],b=l-x,T=b>0?(h-x)/b:0;return this.points[g].mult(1-T).add(this.points[s].mult(T))}}function rn(m,t){let s=!0;return m==="always"||m!=="never"&&t!=="never"||(s=!1),s}class _t{constructor(t,s,l){const h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(s/l);for(let x=0;x<this.xCellCount*this.yCellCount;x++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,l,h,g){this._forEachCell(s,l,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(g)}insertCircle(t,s,l,h){this._forEachCell(s-h,l-h,s+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(l),this.circles.push(h)}_insertBoxCell(t,s,l,h,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,s,l,h,g,x){this.circleCells[g].push(x)}_query(t,s,l,h,g,x,b){if(l<0||t>this.width||h<0||s>this.height)return[];const T=[];if(t<=0&&s<=0&&this.width<=l&&this.height<=h){if(g)return[{key:null,x1:t,y1:s,x2:l,y2:h}];for(let E=0;E<this.boxKeys.length;E++)T.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const A=this.circles[3*E],M=this.circles[3*E+1],F=this.circles[3*E+2];T.push({key:this.circleKeys[E],x1:A-F,y1:M-F,x2:A+F,y2:M+F})}}else this._forEachCell(t,s,l,h,this._queryCell,T,{hitTest:g,overlapMode:x,seenUids:{box:{},circle:{}}},b);return T}query(t,s,l,h){return this._query(t,s,l,h,!1,null)}hitTest(t,s,l,h,g,x){return this._query(t,s,l,h,!0,g,x).length>0}hitTestCircle(t,s,l,h,g){const x=t-l,b=t+l,T=s-l,E=s+l;if(b<0||x>this.width||E<0||T>this.height)return!1;const A=[];return this._forEachCell(x,T,b,E,this._queryCellCircle,A,{hitTest:!0,overlapMode:h,circle:{x:t,y:s,radius:l},seenUids:{box:{},circle:{}}},g),A.length>0}_queryCell(t,s,l,h,g,x,b,T){const{seenUids:E,hitTest:A,overlapMode:M}=b,F=this.boxCells[g];if(F!==null){const U=this.bboxes;for(const K of F)if(!E.box[K]){E.box[K]=!0;const Z=4*K,J=this.boxKeys[K];if(t<=U[Z+2]&&s<=U[Z+3]&&l>=U[Z+0]&&h>=U[Z+1]&&(!T||T(J))&&(!A||!rn(M,J.overlapMode))&&(x.push({key:J,x1:U[Z],y1:U[Z+1],x2:U[Z+2],y2:U[Z+3]}),A))return!0}}const N=this.circleCells[g];if(N!==null){const U=this.circles;for(const K of N)if(!E.circle[K]){E.circle[K]=!0;const Z=3*K,J=this.circleKeys[K];if(this._circleAndRectCollide(U[Z],U[Z+1],U[Z+2],t,s,l,h)&&(!T||T(J))&&(!A||!rn(M,J.overlapMode))){const re=U[Z],W=U[Z+1],ae=U[Z+2];if(x.push({key:J,x1:re-ae,y1:W-ae,x2:re+ae,y2:W+ae}),A)return!0}}}return!1}_queryCellCircle(t,s,l,h,g,x,b,T){const{circle:E,seenUids:A,overlapMode:M}=b,F=this.boxCells[g];if(F!==null){const U=this.bboxes;for(const K of F)if(!A.box[K]){A.box[K]=!0;const Z=4*K,J=this.boxKeys[K];if(this._circleAndRectCollide(E.x,E.y,E.radius,U[Z+0],U[Z+1],U[Z+2],U[Z+3])&&(!T||T(J))&&!rn(M,J.overlapMode))return x.push(!0),!0}}const N=this.circleCells[g];if(N!==null){const U=this.circles;for(const K of N)if(!A.circle[K]){A.circle[K]=!0;const Z=3*K,J=this.circleKeys[K];if(this._circlesCollide(U[Z],U[Z+1],U[Z+2],E.x,E.y,E.radius)&&(!T||T(J))&&!rn(M,J.overlapMode))return x.push(!0),!0}}}_forEachCell(t,s,l,h,g,x,b,T){const E=this._convertToXCellCoord(t),A=this._convertToYCellCoord(s),M=this._convertToXCellCoord(l),F=this._convertToYCellCoord(h);for(let N=E;N<=M;N++)for(let U=A;U<=F;U++)if(g.call(this,t,s,l,h,this.xCellCount*U+N,x,b,T))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,l,h,g,x){const b=h-t,T=g-s,E=l+x;return E*E>b*b+T*T}_circleAndRectCollide(t,s,l,h,g,x,b){const T=(x-h)/2,E=Math.abs(t-(h+T));if(E>T+l)return!1;const A=(b-g)/2,M=Math.abs(s-(g+A));if(M>A+l)return!1;if(E<=T||M<=A)return!0;const F=E-T,N=M-A;return F*F+N*N<=l*l}}function Pr(m,t,s,l,h){const g=d.F();return t?(d.J(g,g,[1/h,1/h,1]),s||d.ad(g,g,l.angle)):d.K(g,l.labelPlaneMatrix,m),g}function Mr(m,t,s,l,h){if(t){const g=d.ae(m);return d.J(g,g,[h,h,1]),s||d.ad(g,g,-l.angle),g}return l.glCoordMatrix}function Mi(m,t,s){let l;s?(l=[m.x,m.y,s(m.x,m.y),1],d.af(l,l,t)):(l=[m.x,m.y,0,1],function(g,x,b){const T=x[0],E=x[1];g[0]=b[0]*T+b[4]*E+b[12],g[1]=b[1]*T+b[5]*E+b[13],g[3]=b[3]*T+b[7]*E+b[15]}(l,l,t));const h=l[3];return{point:new d.P(l[0]/h,l[1]/h),signedDistanceFromCamera:h,isOccluded:!1}}function G(m,t){return .5+m/t*.5}function D(m,t){return m.x>=-t[0]&&m.x<=t[0]&&m.y>=-t[1]&&m.y<=t[1]}function R(m,t,s,l,h,g,x,b,T,E,A,M,F,N,U){const K=l?m.textSizeData:m.iconSizeData,Z=d.ag(K,s.transform.zoom),J=[256/s.width*2+1,256/s.height*2+1],re=l?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;re.clear();const W=m.lineVertexArray,ae=l?m.text.placedSymbolArray:m.icon.placedSymbolArray,de=s.transform.width/s.transform.height;let fe=!1;for(let we=0;we<ae.length;we++){const Ce=ae.get(we);if(Ce.hidden||Ce.writingMode===d.ah.vertical&&!fe){ot(Ce.numGlyphs,re);continue}fe=!1;const Ze=Mi(new d.P(Ce.anchorX,Ce.anchorY),t,U);if(!D(Ze.point,J)){ot(Ce.numGlyphs,re);continue}const qe=G(s.transform.cameraToCenterDistance,Ze.signedDistanceFromCamera),Ee=d.ai(K,Z,Ce),Ae=x?Ee/qe:Ee*qe,Ke={getElevation:U,labelPlaneMatrix:h,lineVertexArray:W,pitchWithMap:x,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:E,tileAnchorPoint:new d.P(Ce.anchorX,Ce.anchorY),unwrappedTileID:A,width:M,height:F,translation:N},dt=te(Ke,Ce,Ae,!1,b,t,g,m.glyphOffsetArray,re,de,T);fe=dt.useVertical,(dt.notEnoughRoom||fe||dt.needsFlipping&&te(Ke,Ce,Ae,!0,b,t,g,m.glyphOffsetArray,re,de,T).notEnoughRoom)&&ot(Ce.numGlyphs,re)}l?m.text.dynamicLayoutVertexBuffer.updateData(re):m.icon.dynamicLayoutVertexBuffer.updateData(re)}function O(m,t,s,l,h,g,x,b){const T=g.glyphStartIndex+g.numGlyphs,E=g.lineStartIndex,A=g.lineStartIndex+g.lineLength,M=t.getoffsetX(g.glyphStartIndex),F=t.getoffsetX(T-1),N=ve(m*M,s,l,h,g.segment,E,A,b,x);if(!N)return null;const U=ve(m*F,s,l,h,g.segment,E,A,b,x);return U?b.projectionCache.anyProjectionOccluded?null:{first:N,last:U}:null}function H(m,t,s,l){return m===d.ah.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*l?{useVertical:!0}:(m===d.ah.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function te(m,t,s,l,h,g,x,b,T,E,A){const M=s/24,F=t.lineOffsetX*M,N=t.lineOffsetY*M;let U;if(t.numGlyphs>1){const K=t.glyphStartIndex+t.numGlyphs,Z=t.lineStartIndex,J=t.lineStartIndex+t.lineLength,re=O(M,b,F,N,l,t,A,m);if(!re)return{notEnoughRoom:!0};const W=Mi(re.first.point,x,m.getElevation).point,ae=Mi(re.last.point,x,m.getElevation).point;if(h&&!l){const de=H(t.writingMode,W,ae,E);if(de)return de}U=[re.first];for(let de=t.glyphStartIndex+1;de<K-1;de++)U.push(ve(M*b.getoffsetX(de),F,N,l,t.segment,Z,J,m,A));U.push(re.last)}else{if(h&&!l){const Z=Mi(m.tileAnchorPoint,g,m.getElevation).point,J=t.lineStartIndex+t.segment+1,re=new d.P(m.lineVertexArray.getx(J),m.lineVertexArray.gety(J)),W=Mi(re,g,m.getElevation),ae=W.signedDistanceFromCamera>0?W.point:function(fe,we,Ce,Ze,qe,Ee){return se(fe,we,Ce,1,qe,Ee)}(m.tileAnchorPoint,re,Z,0,g,m),de=H(t.writingMode,Z,ae,E);if(de)return de}const K=ve(M*b.getoffsetX(t.glyphStartIndex),F,N,l,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,m,A);if(!K||m.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[K]}for(const K of U)d.aj(T,K.point,K.angle);return{}}function se(m,t,s,l,h,g){const x=m.add(m.sub(t)._unit()),b=h!==void 0?Mi(x,h,g.getElevation).point:Q(x.x,x.y,g).point,T=s.sub(b);return s.add(T._mult(l/T.mag()))}function ce(m,t,s){const l=t.projectionCache;if(l.projections[m])return l.projections[m];const h=new d.P(t.lineVertexArray.getx(m),t.lineVertexArray.gety(m)),g=Q(h.x,h.y,t);if(g.signedDistanceFromCamera>0)return l.projections[m]=g.point,l.anyProjectionOccluded=l.anyProjectionOccluded||g.isOccluded,g.point;const x=m-s.direction;return function(b,T,E,A,M){return se(b,T,E,A,void 0,M)}(s.distanceFromAnchor===0?t.tileAnchorPoint:new d.P(t.lineVertexArray.getx(x),t.lineVertexArray.gety(x)),h,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,t)}function Q(m,t,s){const l=m+s.translation[0],h=t+s.translation[1];let g;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(g=s.projection.projectTileCoordinates(l,h,s.unwrappedTileID,s.getElevation),g.point.x=(.5*g.point.x+.5)*s.width,g.point.y=(.5*-g.point.y+.5)*s.height):(g=Mi(new d.P(l,h),s.labelPlaneMatrix,s.getElevation),g.isOccluded=!1),g}function pe(m,t,s){return m._unit()._perp()._mult(t*s)}function be(m,t,s,l,h,g,x,b,T){if(b.projectionCache.offsets[m])return b.projectionCache.offsets[m];const E=s.add(t);if(m+T.direction<l||m+T.direction>=h)return b.projectionCache.offsets[m]=E,E;const A=ce(m+T.direction,b,T),M=pe(A.sub(s),x,T.direction),F=s.add(M),N=A.add(M);return b.projectionCache.offsets[m]=d.ak(g,E,F,N)||E,b.projectionCache.offsets[m]}function ve(m,t,s,l,h,g,x,b,T){const E=l?m-t:m+t;let A=E>0?1:-1,M=0;l&&(A*=-1,M=Math.PI),A<0&&(M+=Math.PI);let F,N=A>0?g+h:g+h+1;b.projectionCache.cachedAnchorPoint?F=b.projectionCache.cachedAnchorPoint:(F=Q(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=F);let U,K,Z=F,J=F,re=0,W=0;const ae=Math.abs(E),de=[];let fe;for(;re+W<=ae;){if(N+=A,N<g||N>=x)return null;re+=W,J=Z,K=U;const Ze={absOffsetX:ae,direction:A,distanceFromAnchor:re,previousVertex:J};if(Z=ce(N,b,Ze),s===0)de.push(J),fe=Z.sub(J);else{let qe;const Ee=Z.sub(J);qe=Ee.mag()===0?pe(ce(N+A,b,Ze).sub(Z),s,A):pe(Ee,s,A),K||(K=J.add(qe)),U=be(N,qe,Z,g,x,K,s,b,Ze),de.push(K),fe=U.sub(K)}W=fe.mag()}const we=fe._mult((ae-re)/W)._add(K||J),Ce=M+Math.atan2(Z.y-J.y,Z.x-J.x);return de.push(we),{point:we,angle:T?Ce:0,path:de}}const _e=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ot(m,t){for(let s=0;s<m;s++){const l=t.length;t.resize(l+4),t.float32.set(_e,3*l)}}const nt=100;class Tt{constructor(t,s,l=new _t(t.width+200,t.height+200,25),h=new _t(t.width+200,t.height+200,25)){this.transform=t,this.mapProjection=s,this.grid=l,this.ignoredGrid=h,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+nt,this.screenBottomBoundary=t.height+nt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,l,h,g,x,b,T,E,A,M){const F=t.anchorPointX+T[0],N=t.anchorPointY+T[1],U=this.projectAndGetPerspectiveRatio(h,F,N,g,A),K=this._projectCollisionBox(t,l,h,g,x,b,T,U,A,M),[Z,J,re,W]=K.box;return this.mapProjection.useSpecialProjectionForSymbols&&(x?K.allPointsOccluded:this.mapProjection.isOccluded(F,N,g))||U.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Z,J,re,W)||s!=="always"&&this.grid.hitTest(Z,J,re,W,s,E)?{box:[Z,J,re,W],placeable:!1,offscreen:!1}:{box:[Z,J,re,W],placeable:!0,offscreen:this.isOffscreen(Z,J,re,W)}}placeCollisionCircles(t,s,l,h,g,x,b,T,E,A,M,F,N,U,K,Z){const J=[],re=new d.P(s.anchorX,s.anchorY),W=this.getPerspectiveRatio(x,re.x,re.y,b,Z),ae=(M?g/W:g*W)/d.ap,de={getElevation:Z,labelPlaneMatrix:T,lineVertexArray:l,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:re,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:K},fe=O(ae,h,s.lineOffsetX*ae,s.lineOffsetY*ae,!1,s,!1,de);let we=!1,Ce=!1,Ze=!0;if(fe){const qe=.5*N*W+U,Ee=new d.P(-100,-100),Ae=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Ke=new nn,dt=fe.first,Le=fe.last;let Ne=[];for(let bt=dt.path.length-1;bt>=1;bt--)Ne.push(dt.path[bt]);for(let bt=1;bt<Le.path.length;bt++)Ne.push(Le.path[bt]);const ct=2.5*qe;if(E){const bt=this.projectPathToScreenSpace(Ne,de,E);Ne=bt.some(It=>It.signedDistanceFromCamera<=0)?[]:bt.map(It=>It.point)}let Ht=[];if(Ne.length>0){const bt=Ne[0].clone(),It=Ne[0].clone();for(let Kt=1;Kt<Ne.length;Kt++)bt.x=Math.min(bt.x,Ne[Kt].x),bt.y=Math.min(bt.y,Ne[Kt].y),It.x=Math.max(It.x,Ne[Kt].x),It.y=Math.max(It.y,Ne[Kt].y);Ht=bt.x>=Ee.x&&It.x<=Ae.x&&bt.y>=Ee.y&&It.y<=Ae.y?[Ne]:It.x<Ee.x||bt.x>Ae.x||It.y<Ee.y||bt.y>Ae.y?[]:d.al([Ne],Ee.x,Ee.y,Ae.x,Ae.y)}for(const bt of Ht){Ke.reset(bt,.25*qe);let It=0;It=Ke.length<=.5*qe?1:Math.ceil(Ke.paddedLength/ct)+1;for(let Kt=0;Kt<It;Kt++){const qi=Kt/Math.max(It-1,1),er=Ke.lerp(qi),Xt=er.x+nt,vn=er.y+nt;J.push(Xt,vn,qe,0);const sn=Xt-qe,Gi=vn-qe,Wi=Xt+qe,tr=vn+qe;if(Ze=Ze&&this.isOffscreen(sn,Gi,Wi,tr),Ce=Ce||this.isInsideGrid(sn,Gi,Wi,tr),t!=="always"&&this.grid.hitTestCircle(Xt,vn,qe,t,F)&&(we=!0,!A))return{circles:[],offscreen:!1,collisionDetected:we}}}}return{circles:!A&&we||!Ce||W<this.perspectiveRatioCutoff?[]:J,offscreen:Ze,collisionDetected:we}}projectPathToScreenSpace(t,s,l){return t.map(h=>Mi(h,l,s.getElevation))}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,h=1/0,g=-1/0,x=-1/0;for(const A of t){const M=new d.P(A.x+nt,A.y+nt);l=Math.min(l,M.x),h=Math.min(h,M.y),g=Math.max(g,M.x),x=Math.max(x,M.y),s.push(M)}const b=this.grid.query(l,h,g,x).concat(this.ignoredGrid.query(l,h,g,x)),T={},E={};for(const A of b){const M=A.key;if(T[M.bucketInstanceId]===void 0&&(T[M.bucketInstanceId]={}),T[M.bucketInstanceId][M.featureIndex])continue;const F=[new d.P(A.x1,A.y1),new d.P(A.x2,A.y1),new d.P(A.x2,A.y2),new d.P(A.x1,A.y2)];d.am(s,F)&&(T[M.bucketInstanceId][M.featureIndex]=!0,E[M.bucketInstanceId]===void 0&&(E[M.bucketInstanceId]=[]),E[M.bucketInstanceId].push(M.featureIndex))}return E}insertCollisionBox(t,s,l,h,g,x){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:x,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,l,h,g,x){const b=l?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:g,collisionGroupID:x,overlapMode:s};for(let E=0;E<t.length;E+=4)b.insertCircle(T,t[E],t[E+1],t[E+2])}projectAndGetPerspectiveRatio(t,s,l,h,g){const x=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,h,g):Mi(new d.P(s,l),t,g);return{point:new d.P((x.point.x+1)/2*this.transform.width+nt,(1-x.point.y)/2*this.transform.height+nt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5,isOccluded:x.isOccluded,signedDistanceFromCamera:x.signedDistanceFromCamera}}getPerspectiveRatio(t,s,l,h,g){const x=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,h,g):Mi(new d.P(s,l),t,g);return .5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5}isOffscreen(t,s,l,h){return l<nt||t>=this.screenRightBoundary||h<nt||s>this.screenBottomBoundary}isInsideGrid(t,s,l,h){return l>=0&&t<this.gridRightBoundary&&h>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=d.an([]);return d.H(t,t,[-100,-100,0]),t}_projectCollisionBox(t,s,l,h,g,x,b,T,E,A){const M=s*T.perspectiveRatio;let F=new d.P(1,0),N=new d.P(0,1);const U=new d.P(t.anchorPointX+b[0],t.anchorPointY+b[1]);if(x&&!g){const qe=this.projectAndGetPerspectiveRatio(l,U.x+1,U.y,h,E).point.sub(T.point).unit(),Ee=Math.atan(qe.y/qe.x)+(qe.x<0?Math.PI:0),Ae=Math.sin(Ee),Ke=Math.cos(Ee);F=new d.P(Ke,Ae),N=new d.P(-Ae,Ke)}else if(!x&&g){const qe=-this.transform.angle,Ee=Math.sin(qe),Ae=Math.cos(qe);F=new d.P(Ae,Ee),N=new d.P(-Ee,Ae)}let K=T.point,Z=M;if(g){K=U;const qe=this.transform.zoom-Math.floor(this.transform.zoom);Z=Math.pow(2,-qe),Z*=this.mapProjection.getPitchedTextCorrection(this.transform,U,h),A||(Z*=d.ac(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}A&&(K=K.add(F.mult(A.x*Z)).add(N.mult(A.y*Z)));const J=t.x1*Z,re=t.x2*Z,W=(J+re)/2,ae=t.y1*Z,de=t.y2*Z,fe=(ae+de)/2,we=[{offsetX:J,offsetY:ae},{offsetX:W,offsetY:ae},{offsetX:re,offsetY:ae},{offsetX:re,offsetY:fe},{offsetX:re,offsetY:de},{offsetX:W,offsetY:de},{offsetX:J,offsetY:de},{offsetX:J,offsetY:fe}];let Ce=[];for(const{offsetX:qe,offsetY:Ee}of we)Ce.push(new d.P(K.x+F.x*qe+N.x*Ee,K.y+F.y*qe+N.y*Ee));let Ze=!1;if(g){const qe=Ce.map(Ee=>this.projectAndGetPerspectiveRatio(l,Ee.x,Ee.y,h,E));Ze=qe.some(Ee=>!Ee.isOccluded),Ce=qe.map(Ee=>Ee.point)}else Ze=!0;return{box:d.ao(Ce),allPointsOccluded:!Ze}}}function ht(m,t,s){return t*(d.W/(m.tileSize*Math.pow(2,s-m.tileID.overscaledZ)))}class Ct{constructor(t,s,l,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Nt{constructor(t,s,l,h,g){this.text=new Ct(t?t.text:null,s,l,g),this.icon=new Ct(t?t.icon:null,s,h,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Wt{constructor(t,s,l){this.text=t,this.icon=s,this.skipFade=l}}class wi{constructor(){this.invProjMatrix=d.F(),this.viewportMatrix=d.F(),this.circles=[]}}class vt{constructor(t,s,l,h,g){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=g}}class ti{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[t]}}function ki(m,t,s,l,h){const{horizontalAlign:g,verticalAlign:x}=d.au(m);return new d.P(-(g-.5)*t+l[0]*h,-(x-.5)*s+l[1]*h)}class mn{constructor(t,s,l,h,g,x){this.transform=t.clone(),this.terrain=l,this.collisionIndex=new Tt(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new ti(g),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const s=this.terrain;return s?(l,h)=>s.getElevation(t,l,h):null}getBucketParts(t,s,l,h){const g=l.getBucket(s),x=l.latestFeatureIndex;if(!g||!x||s.id!==g.layerIds[0])return;const b=l.collisionBoxArray,T=g.layers[0].layout,E=g.layers[0].paint,A=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),M=l.tileSize/d.W,F=l.tileID.toUnwrapped(),N=this.transform.calculatePosMatrix(F),U=T.get("text-pitch-alignment")==="map",K=T.get("text-rotation-alignment")==="map",Z=ht(l,1,this.transform.zoom),J=this.collisionIndex.mapProjection.translatePosition(this.transform,l,E.get("text-translate"),E.get("text-translate-anchor")),re=this.collisionIndex.mapProjection.translatePosition(this.transform,l,E.get("icon-translate"),E.get("icon-translate-anchor")),W=Pr(N,U,K,this.transform,Z);let ae=null;if(U){const fe=Mr(N,U,K,this.transform,Z);ae=d.K([],this.transform.labelPlaneMatrix,fe)}this.retainedQueryData[g.bucketInstanceId]=new vt(g.bucketInstanceId,x,g.sourceLayerIndex,g.index,l.tileID);const de={bucket:g,layout:T,translationText:J,translationIcon:re,posMatrix:N,unwrappedTileID:F,textLabelPlaneMatrix:W,labelToScreenMatrix:ae,scale:A,textPixelRatio:M,holdingForFade:l.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:d.ag(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(const fe of g.sortKeyRanges){const{sortKey:we,symbolInstanceStart:Ce,symbolInstanceEnd:Ze}=fe;t.push({sortKey:we,symbolInstanceStart:Ce,symbolInstanceEnd:Ze,parameters:de})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:de})}attemptAnchorPlacement(t,s,l,h,g,x,b,T,E,A,M,F,N,U,K,Z,J,re,W){const ae=d.aq[t.textAnchor],de=[t.textOffset0,t.textOffset1],fe=ki(ae,l,h,de,g),we=this.collisionIndex.placeCollisionBox(s,F,T,E,A,b,x,Z,M.predicate,W,fe);if((!re||this.collisionIndex.placeCollisionBox(re,F,T,E,A,b,x,J,M.predicate,W,fe).placeable)&&we.placeable){let Ce;if(this.prevPlacement&&this.prevPlacement.variableOffsets[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID].text&&(Ce=this.prevPlacement.variableOffsets[N.crossTileID].anchor),N.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[N.crossTileID]={textOffset:de,width:l,height:h,anchor:ae,textBoxScale:g,prevAnchor:Ce},this.markUsedJustification(U,ae,N,K),U.allowVerticalPlacement&&(this.markUsedOrientation(U,K,N),this.placedOrientations[N.crossTileID]=K),{shift:fe,placedGlyphBoxes:we}}}placeLayerBucketPart(t,s,l){const{bucket:h,layout:g,translationText:x,translationIcon:b,posMatrix:T,unwrappedTileID:E,textLabelPlaneMatrix:A,labelToScreenMatrix:M,textPixelRatio:F,holdingForFade:N,collisionBoxArray:U,partiallyEvaluatedTextSize:K,collisionGroup:Z}=t.parameters,J=g.get("text-optional"),re=g.get("icon-optional"),W=d.ar(g,"text-overlap","text-allow-overlap"),ae=W==="always",de=d.ar(g,"icon-overlap","icon-allow-overlap"),fe=de==="always",we=g.get("text-rotation-alignment")==="map",Ce=g.get("text-pitch-alignment")==="map",Ze=g.get("icon-text-fit")!=="none",qe=g.get("symbol-z-order")==="viewport-y",Ee=ae&&(fe||!h.hasIconData()||re),Ae=fe&&(ae||!h.hasTextData()||J);!h.collisionArrays&&U&&h.deserializeCollisionBoxes(U);const Ke=this._getTerrainElevationFunc(this.retainedQueryData[h.bucketInstanceId].tileID),dt=(Le,Ne,ct)=>{var Ht,bt;if(s[Le.crossTileID])return;if(N)return void(this.placements[Le.crossTileID]=new Wt(!1,!1,!1));let It=!1,Kt=!1,qi=!0,er=null,Xt={box:null,placeable:!1,offscreen:null},vn={box:null,placeable:!1,offscreen:null},sn=null,Gi=null,Wi=null,tr=0,bo=0,ol=0;Ne.textFeatureIndex?tr=Ne.textFeatureIndex:Le.useRuntimeCollisionCircles&&(tr=Le.featureIndex),Ne.verticalTextFeatureIndex&&(bo=Ne.verticalTextFeatureIndex);const rs=Ne.textBox;if(rs){const Oi=Hi=>{let Ki=d.ah.horizontal;if(h.allowVerticalPlacement&&!Hi&&this.prevPlacement){const Ai=this.prevPlacement.placedOrientations[Le.crossTileID];Ai&&(this.placedOrientations[Le.crossTileID]=Ai,Ki=Ai,this.markUsedOrientation(h,Ki,Le))}return Ki},ir=(Hi,Ki)=>{if(h.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&Ne.verticalTextBox){for(const Ai of h.writingModes)if(Ai===d.ah.vertical?(Xt=Ki(),vn=Xt):Xt=Hi(),Xt&&Xt.placeable)break}else Xt=Hi()},Qr=Le.textAnchorOffsetStartIndex,os=Le.textAnchorOffsetEndIndex;if(os===Qr){const Hi=(Ki,Ai)=>{const ni=this.collisionIndex.placeCollisionBox(Ki,W,F,T,E,Ce,we,x,Z.predicate,Ke);return ni&&ni.placeable&&(this.markUsedOrientation(h,Ai,Le),this.placedOrientations[Le.crossTileID]=Ai),ni};ir(()=>Hi(rs,d.ah.horizontal),()=>{const Ki=Ne.verticalTextBox;return h.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&Ki?Hi(Ki,d.ah.vertical):{box:null,offscreen:null}}),Oi(Xt&&Xt.placeable)}else{let Hi=d.aq[(bt=(Ht=this.prevPlacement)===null||Ht===void 0?void 0:Ht.variableOffsets[Le.crossTileID])===null||bt===void 0?void 0:bt.anchor];const Ki=(ni,ss,Vc)=>{const Ci=ni.x2-ni.x1,Bh=ni.y2-ni.y1,al=Le.textBoxScale,ll=Ze&&de==="never"?ss:null;let eo=null,Oh=W==="never"?1:2,Uc="never";Hi&&Oh++;for(let $c=0;$c<Oh;$c++){for(let Zc=Qr;Zc<os;Zc++){const cl=h.textAnchorOffsets.get(Zc);if(Hi&&cl.textAnchor!==Hi)continue;const as=this.attemptAnchorPlacement(cl,ni,Ci,Bh,al,we,Ce,F,T,E,Z,Uc,Le,h,Vc,x,b,ll,Ke);if(as&&(eo=as.placedGlyphBoxes,eo&&eo.placeable))return It=!0,er=as.shift,eo}Hi?Hi=null:Uc=W}return l&&!eo&&(eo={box:this.collisionIndex.placeCollisionBox(rs,"always",F,T,E,Ce,we,x,Z.predicate,Ke,new d.P(0,0)).box,offscreen:!1,placeable:!1}),eo};ir(()=>Ki(rs,Ne.iconBox,d.ah.horizontal),()=>{const ni=Ne.verticalTextBox;return h.allowVerticalPlacement&&(!Xt||!Xt.placeable)&&Le.numVerticalGlyphVertices>0&&ni?Ki(ni,Ne.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Xt&&(It=Xt.placeable,qi=Xt.offscreen);const Ai=Oi(Xt&&Xt.placeable);if(!It&&this.prevPlacement){const ni=this.prevPlacement.variableOffsets[Le.crossTileID];ni&&(this.variableOffsets[Le.crossTileID]=ni,this.markUsedJustification(h,ni.anchor,Le,Ai))}}}if(sn=Xt,It=sn&&sn.placeable,qi=sn&&sn.offscreen,Le.useRuntimeCollisionCircles){const Oi=h.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex),ir=d.ai(h.textSizeData,K,Oi),Qr=g.get("text-padding");Gi=this.collisionIndex.placeCollisionCircles(W,Oi,h.lineVertexArray,h.glyphOffsetArray,ir,T,E,A,M,l,Ce,Z.predicate,Le.collisionCircleDiameter,Qr,x,Ke),Gi.circles.length&&Gi.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),It=ae||Gi.circles.length>0&&!Gi.collisionDetected,qi=qi&&Gi.offscreen}if(Ne.iconFeatureIndex&&(ol=Ne.iconFeatureIndex),Ne.iconBox){const Oi=ir=>this.collisionIndex.placeCollisionBox(ir,de,F,T,E,Ce,we,b,Z.predicate,Ke,Ze&&er?er:void 0);vn&&vn.placeable&&Ne.verticalIconBox?(Wi=Oi(Ne.verticalIconBox),Kt=Wi.placeable):(Wi=Oi(Ne.iconBox),Kt=Wi.placeable),qi=qi&&Wi.offscreen}const So=J||Le.numHorizontalGlyphVertices===0&&Le.numVerticalGlyphVertices===0,sl=re||Le.numIconVertices===0;So||sl?sl?So||(Kt=Kt&&It):It=Kt&&It:Kt=It=Kt&&It;const jc=Kt&&Wi.placeable;if(It&&sn.placeable&&this.collisionIndex.insertCollisionBox(sn.box,W,g.get("text-ignore-placement"),h.bucketInstanceId,vn&&vn.placeable&&bo?bo:tr,Z.ID),jc&&this.collisionIndex.insertCollisionBox(Wi.box,de,g.get("icon-ignore-placement"),h.bucketInstanceId,ol,Z.ID),Gi&&It&&this.collisionIndex.insertCollisionCircles(Gi.circles,W,g.get("text-ignore-placement"),h.bucketInstanceId,tr,Z.ID),l&&this.storeCollisionData(h.bucketInstanceId,ct,Ne,sn,Wi,Gi),Le.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Le.crossTileID]=new Wt(It||Ee,Kt||Ae,qi||h.justReloaded),s[Le.crossTileID]=!0};if(qe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Le=h.getSortedSymbolIndexes(this.transform.angle);for(let Ne=Le.length-1;Ne>=0;--Ne){const ct=Le[Ne];dt(h.symbolInstances.get(ct),h.collisionArrays[ct],ct)}}else for(let Le=t.symbolInstanceStart;Le<t.symbolInstanceEnd;Le++)dt(h.symbolInstances.get(Le),h.collisionArrays[Le],Le);if(l&&h.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[h.bucketInstanceId];d.as(Le.invProjMatrix,T),Le.viewportMatrix=this.collisionIndex.getViewportMatrix()}h.justReloaded=!1}storeCollisionData(t,s,l,h,g,x){if(l.textBox||l.iconBox){let b,T;this.collisionBoxArrays.has(t)?b=this.collisionBoxArrays.get(t):(b=new Map,this.collisionBoxArrays.set(t,b)),b.has(s)?T=b.get(s):(T={text:null,icon:null},b.set(s,T)),l.textBox&&(T.text=h.box),l.iconBox&&(T.icon=g.box)}if(x){let b=this.collisionCircleArrays[t];b===void 0&&(b=this.collisionCircleArrays[t]=new wi);for(let T=0;T<x.circles.length;T+=4)b.circles.push(x.circles[T+0]),b.circles.push(x.circles[T+1]),b.circles.push(x.circles[T+2]),b.circles.push(x.collisionDetected?1:0)}}markUsedJustification(t,s,l,h){let g;g=h===d.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.at(s)];const x=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const b of x)b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=g>=0&&b!==g?0:l.crossTileID)}markUsedOrientation(t,s,l){const h=s===d.ah.horizontal||s===d.ah.horizontalOnly?s:0,g=s===d.ah.vertical?s:0,x=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const b of x)t.text.placedSymbolArray.get(b).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const h=s?s.symbolFadeChange(t):1,g=s?s.opacities:{},x=s?s.variableOffsets:{},b=s?s.placedOrientations:{};for(const T in this.placements){const E=this.placements[T],A=g[T];A?(this.opacities[T]=new Nt(A,h,E.text,E.icon),l=l||E.text!==A.text.placed||E.icon!==A.icon.placed):(this.opacities[T]=new Nt(null,h,E.text,E.icon,E.skipFade),l=l||E.text||E.icon)}for(const T in g){const E=g[T];if(!this.opacities[T]){const A=new Nt(E,h,!1,!1);A.isHidden()||(this.opacities[T]=A,l=l||E.text.placed||E.icon.placed)}}for(const T in x)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=x[T]);for(const T in b)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=b[T]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const l={};for(const h of s){const g=h.getBucket(t);g&&h.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(t,s,l,h){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const g=t.layers[0],x=g.layout,b=new Nt(null,0,!1,!1,!0),T=x.get("text-allow-overlap"),E=x.get("icon-allow-overlap"),A=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=x.get("text-rotation-alignment")==="map",F=x.get("text-pitch-alignment")==="map",N=x.get("icon-text-fit")!=="none",U=new Nt(null,0,T&&(E||!t.hasIconData()||x.get("icon-optional")),E&&(T||!t.hasTextData()||x.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const K=(J,re,W)=>{for(let ae=0;ae<re/4;ae++)J.opacityVertexArray.emplaceBack(W);J.hasVisibleVertices=J.hasVisibleVertices||W!==Bs},Z=this.collisionBoxArrays.get(t.bucketInstanceId);for(let J=0;J<t.symbolInstances.length;J++){const re=t.symbolInstances.get(J),{numHorizontalGlyphVertices:W,numVerticalGlyphVertices:ae,crossTileID:de}=re;let fe=this.opacities[de];l[de]?fe=b:fe||(fe=U,this.opacities[de]=fe),l[de]=!0;const we=re.numIconVertices>0,Ce=this.placedOrientations[re.crossTileID],Ze=Ce===d.ah.vertical,qe=Ce===d.ah.horizontal||Ce===d.ah.horizontalOnly;if(W>0||ae>0){const Ae=gn(fe.text);K(t.text,W,Ze?Bs:Ae),K(t.text,ae,qe?Bs:Ae);const Ke=fe.text.isHidden();[re.rightJustifiedTextSymbolIndex,re.centerJustifiedTextSymbolIndex,re.leftJustifiedTextSymbolIndex].forEach(Ne=>{Ne>=0&&(t.text.placedSymbolArray.get(Ne).hidden=Ke||Ze?1:0)}),re.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(re.verticalPlacedTextSymbolIndex).hidden=Ke||qe?1:0);const dt=this.variableOffsets[re.crossTileID];dt&&this.markUsedJustification(t,dt.anchor,re,Ce);const Le=this.placedOrientations[re.crossTileID];Le&&(this.markUsedJustification(t,"left",re,Le),this.markUsedOrientation(t,Le,re))}if(we){const Ae=gn(fe.icon),Ke=!(N&&re.verticalPlacedIconSymbolIndex&&Ze);re.placedIconSymbolIndex>=0&&(K(t.icon,re.numIconVertices,Ke?Ae:Bs),t.icon.placedSymbolArray.get(re.placedIconSymbolIndex).hidden=fe.icon.isHidden()),re.verticalPlacedIconSymbolIndex>=0&&(K(t.icon,re.numVerticalIconVertices,Ke?Bs:Ae),t.icon.placedSymbolArray.get(re.verticalPlacedIconSymbolIndex).hidden=fe.icon.isHidden())}const Ee=Z&&Z.has(J)?Z.get(J):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ae=t.collisionArrays[J];if(Ae){let Ke=new d.P(0,0);if(Ae.textBox||Ae.verticalTextBox){let dt=!0;if(A){const Le=this.variableOffsets[de];Le?(Ke=ki(Le.anchor,Le.width,Le.height,Le.textOffset,Le.textBoxScale),M&&Ke._rotate(F?this.transform.angle:-this.transform.angle)):dt=!1}if(Ae.textBox||Ae.verticalTextBox){let Le;Ae.textBox&&(Le=Ze),Ae.verticalTextBox&&(Le=qe),An(t.textCollisionBox.collisionVertexArray,fe.text.placed,!dt||Le,Ee.text,Ke.x,Ke.y)}}if(Ae.iconBox||Ae.verticalIconBox){const dt=!!(!qe&&Ae.verticalIconBox);let Le;Ae.iconBox&&(Le=dt),Ae.verticalIconBox&&(Le=!dt),An(t.iconCollisionBox.collisionVertexArray,fe.icon.placed,Le,Ee.icon,N?Ke.x:0,N?Ke.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=J.invProjMatrix,t.placementViewportMatrix=J.viewportMatrix,t.collisionCircleArray=J.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function An(m,t,s,l,h,g){l&&l.length!==0||(l=[0,0,0,0]);const x=l[0]-nt,b=l[1]-nt,T=l[2]-nt,E=l[3]-nt;m.emplaceBack(t?1:0,s?1:0,h||0,g||0,x,b),m.emplaceBack(t?1:0,s?1:0,h||0,g||0,T,b),m.emplaceBack(t?1:0,s?1:0,h||0,g||0,T,E),m.emplaceBack(t?1:0,s?1:0,h||0,g||0,x,E)}const Ii=Math.pow(2,25),qo=Math.pow(2,24),Ep=Math.pow(2,17),Ot=Math.pow(2,16),Ql=Math.pow(2,9),ec=Math.pow(2,8),zn=Math.pow(2,1);function gn(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,s=Math.floor(127*m.opacity);return s*Ii+t*qo+s*Ep+t*Ot+s*Ql+t*ec+s*zn+t}const Bs=0;function yn(){return{isOccluded:(m,t,s)=>!1,getPitchedTextCorrection:(m,t,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(m,t,s,l){throw new Error("Not implemented.")},translatePosition:(m,t,s,l)=>function(h,g,x,b,T=!1){if(!x[0]&&!x[1])return[0,0];const E=T?b==="map"?h.angle:0:b==="viewport"?-h.angle:0;if(E){const A=Math.sin(E),M=Math.cos(E);x=[x[0]*M-x[1]*A,x[0]*A+x[1]*M]}return[T?x[0]:ht(g,x[0],h.zoom),T?x[1]:ht(g,x[1],h.zoom)]}(m,t,s,l),getCircleRadiusCorrection:m=>1}}class Zn{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,l,h,g){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(x,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((b,T)=>b.sortKey-T.sortKey));this._currentPartIndex<x.length;)if(s.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,g())return!0;return!1}}class eh{constructor(t,s,l,h,g,x,b,T){this.placement=new mn(t,yn(),s,x,b,T),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,s,l){const h=X.now(),g=()=>!this._forceFullPlacement&&X.now()-h>2;for(;this._currentPlacementIndex>=0;){const x=s[t[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=b)&&(!x.maxzoom||x.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Zn(x)),this._inProgressLayer.continuePlacement(l[x.source],this.placement,this._showCollisionBoxes,x,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ar=512/d.W/2;class bi{constructor(t,s,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let g=0;g<s.length;g++){const x=s.get(g),b=x.key,T=h.get(b);T?T.push(x):h.set(b,[x])}for(const[g,x]of h){const b={positions:x.map(T=>({x:Math.floor(T.anchorX*Ar),y:Math.floor(T.anchorY*Ar)})),crossTileIDs:x.map(T=>T.crossTileID)};if(b.positions.length>128){const T=new d.av(b.positions.length,16,Uint16Array);for(const{x:E,y:A}of b.positions)T.add(E,A);T.finish(),delete b.positions,b.index=T}this._symbolsByKey[g]=b}}getScaledCoordinates(t,s){const{x:l,y:h,z:g}=this.tileID.canonical,{x,y:b,z:T}=s.canonical,E=Ar/Math.pow(2,T-g),A=(b*d.W+t.anchorY)*E,M=h*d.W*Ar;return{x:Math.floor((x*d.W+t.anchorX)*E-l*d.W*Ar),y:Math.floor(A-M)}}findMatches(t,s,l){const h=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let g=0;g<t.length;g++){const x=t.get(g);if(x.crossTileID)continue;const b=this._symbolsByKey[x.key];if(!b)continue;const T=this.getScaledCoordinates(x,s);if(b.index){const E=b.index.range(T.x-h,T.y-h,T.x+h,T.y+h).sort();for(const A of E){const M=b.crossTileIDs[A];if(!l[M]){l[M]=!0,x.crossTileID=M;break}}}else if(b.positions)for(let E=0;E<b.positions.length;E++){const A=b.positions[E],M=b.crossTileIDs[E];if(Math.abs(A.x-T.x)<=h&&Math.abs(A.y-T.y)<=h&&!l[M]){l[M]=!0,x.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Os{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ho{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const l in this.indexes){const h=this.indexes[l],g={};for(const x in h){const b=h[x];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),g[b.tileID.key]=b}this.indexes[l]=g}this.lng=t}addBucket(t,s,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<s.symbolInstances.length;g++)s.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const b in x){const T=x[b];T.tileID.isChildOf(t)&&T.findMatches(s.symbolInstances,t,h)}else{const b=x[t.scaledTo(Number(g)).key];b&&b.findMatches(s.symbolInstances,t,h)}}for(let g=0;g<s.symbolInstances.length;g++){const x=s.symbolInstances.get(g);x.crossTileID||(x.crossTileID=l.generate(),h[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new bi(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const l of s.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let s=!1;for(const l in this.indexes){const h=this.indexes[l];for(const g in h)t[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[g]),delete h[g],s=!0)}return s}}class hi{constructor(){this.layerIndexes={},this.crossTileIDs=new Os,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,l){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new ho);let g=!1;const x={};h.handleWrapJump(l);for(const b of s){const T=b.getBucket(t);T&&t.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(b.tileID,T,this.crossTileIDs)&&(g=!0),x[T.bucketInstanceId]=!0)}return h.removeStaleBuckets(x)&&(g=!0),g}pruneUnusedLayers(t){const s={};t.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const po=(m,t)=>d.t(m,t&&t.filter(s=>s.identifier!=="source.canvas")),Qn=d.aw();class Ca extends d.E{constructor(t,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const h=this.sourceCaches[l].getSource().type;h!=="vector"&&h!=="geojson"||this.sourceCaches[l].reload()}},this.map=t,this.dispatcher=new Ir($i(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,h)=>this.getGlyphs(l,h)),this.dispatcher.registerMessageHandler("GI",(l,h)=>this.getImages(l,h)),this.imageManager=new Ut,this.imageManager.setEventedParent(this),this.glyphManager=new Fi(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Et(256,512),this.crossTileSymbolIndex=new hi,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),pn().on($o,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const h=this.sourceCaches[l.sourceId];if(!h)return;const g=h.getSource();if(g&&g.vectorLayerIds)for(const x in this._layers){const b=this._layers[x];b.source===g.id&&this._validateLayer(b)}})}loadURL(t,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const h=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController,d.h(h,this._loadStyleRequest).then(g=>{this._loadStyleRequest=null,this._load(g.data,s,l)}).catch(g=>{this._loadStyleRequest=null,g&&this.fire(new d.j(g))})}loadJSON(t,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,X.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(t,s,l)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(Qn,{validate:!1})}_load(t,s,l){var h;const g=s.transformStyle?s.transformStyle(l,t):t;if(!s.validate||!po(this,d.x(g))){this._loaded=!0,this.stylesheet=g;for(const x in g.sources)this.addSource(x,g.sources[x],{validate:!1});g.sprite?this._loadSprite(g.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(g.glyphs),this._createLayers(),this.light=new mt(this.stylesheet.light),this.map.setTerrain((h=this.stylesheet.terrain)!==null&&h!==void 0?h:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const t=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of t){const l=d.aA(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(t,s=!1,l=void 0){let h;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(g,x,b,T){return d._(this,void 0,void 0,function*(){const E=xt(g),A=b>1?"@2x":"",M={},F={};for(const{id:N,url:U}of E){const K=x.transformRequest(rt(U,A,".json"),"SpriteJSON");M[N]=d.h(K,T);const Z=x.transformRequest(rt(U,A,".png"),"SpriteImage");F[N]=he.getImage(Z,T)}return yield Promise.all([...Object.values(M),...Object.values(F)]),function(N,U){return d._(this,void 0,void 0,function*(){const K={};for(const Z in N){K[Z]={};const J=X.getImageCanvasContext((yield U[Z]).data),re=(yield N[Z]).data;for(const W in re){const{width:ae,height:de,x:fe,y:we,sdf:Ce,pixelRatio:Ze,stretchX:qe,stretchY:Ee,content:Ae,textFitWidth:Ke,textFitHeight:dt}=re[W];K[Z][W]={data:null,pixelRatio:Ze,sdf:Ce,stretchX:qe,stretchY:Ee,content:Ae,textFitWidth:Ke,textFitHeight:dt,spriteData:{width:ae,height:de,x:fe,y:we,context:J}}}}return K})}(M,F)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(g=>{if(this._spriteRequest=null,g)for(const x in g){this._spritesImagesIds[x]=[];const b=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(T=>!(T in g)):[];for(const T of b)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in g[x]){const E=x==="default"?T:`${x}:${T}`;this._spritesImagesIds[x].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,g[x][T],!1):this.imageManager.addImage(E,g[x][T]),s&&(this._changedImages[E]=!0)}}}).catch(g=>{this._spriteRequest=null,h=g,this.fire(new d.j(h))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),l&&l(h)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const l=t.sourceLayer;if(!l)return;const h=s.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.j(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const s=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s);const l=[];for(const h of t)s[h]&&l.push(s[h]);return l}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const h=this._layers[l];h.type!=="custom"&&(t[l]=h.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(s){const h=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(h.length||g.length)&&this._updateWorkerLayers(h,g);for(const x in this._updatedSources){const b=this._updatedSources[x];if(b==="reload")this._reloadSource(x);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const l={};for(const h in this.sourceCaches){const g=this.sourceCaches[h];l[h]=g.used,g.used=!1}for(const h of this._order){const g=this._layers[h];g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const h in l){const g=this.sourceCaches[h];!!l[h]!=!!g.used&&g.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){var l;this._checkLoaded();const h=this.serialize();if(t=s.transformStyle?s.transformStyle(h,t):t,((l=s.validate)===null||l===void 0||l)&&po(this,d.x(t)))return!1;(t=d.aB(t)).layers=d.az(t.layers);const g=d.aC(h,t),x=this._getOperationsToPerform(g);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const b of x.operations)b();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const s=[],l=[];for(const h of t)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,h.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,h.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,h.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,h.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,h.args));break;case"addSource":s.push(()=>this.addSource.apply(this,h.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,h.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,h.args));break;case"setLight":s.push(()=>this.setLight.apply(this,h.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,h.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,h.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,h.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,h.args));break;case"setTransition":s.push(()=>{});break;default:l.push(h.command)}return{operations:s,unimplemented:l}}addImage(t,s){if(this.getImage(t))return this.fire(new d.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new d.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,l={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(d.x.source,`sources.${t}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const h=this.sourceCaches[t]=new Pe(t,s,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t})),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new d.j(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.sourceCaches[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,l={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new d.j(new Error(`Layer "${h}" already exists on this map.`)));let g;if(t.type==="custom"){if(po(this,d.aD(t)))return;g=d.aA(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=d.aB(t),t=d.e(t,{source:h})),this._validate(d.x.layer,`layers.${h}`,t,{arrayIndex:-1},l))return;g=d.aA(t),this._validateLayer(g),g.setEventedParent(this,{layer:{id:h}})}const x=s?this._order.indexOf(s):this._order.length;if(s&&x===-1)this.fire(new d.j(new Error(`Cannot add layer "${h}" before non-existing layer "${s}".`)));else{if(this._order.splice(x,0,h),this._layerOrderChanged=!0,this._layers[h]=g,this._removedLayers[h]&&g.source&&g.type!=="custom"){const b=this._removedLayers[h];delete this._removedLayers[h],b.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new d.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const l=this._order.indexOf(t);this._order.splice(l,1);const h=s?this._order.indexOf(s):this._order.length;s&&h===-1?this.fire(new d.j(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,l){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===s&&h.maxzoom===l||(s!=null&&(h.minzoom=s),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,l={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!d.aE(h.filter,s))return s==null?(h.filter=void 0,void this._updateLayer(h)):void(this._validate(d.x.filter,`layers.${h.id}.filter`,s,null,l)||(h.filter=d.aB(s),this._updateLayer(h)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return d.aB(this.getLayer(t).filter)}setLayoutProperty(t,s,l,h={}){this._checkLoaded();const g=this.getLayer(t);g?d.aE(g.getLayoutProperty(s),l)||(g.setLayoutProperty(s,l,h),this._updateLayer(g)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const l=this.getLayer(t);if(l)return l.getLayoutProperty(s);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,l,h={}){this._checkLoaded();const g=this.getLayer(t);g?d.aE(g.getPaintProperty(s),l)||(g.setPaintProperty(s,l,h)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const l=t.source,h=t.sourceLayer,g=this.sourceCaches[l];if(g===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const x=g.getSource().type;x==="geojson"&&h?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||h?(t.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),g.setFeatureState(h,t.id,s)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const l=t.source,h=this.sourceCaches[l];if(h===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const g=h.getSource().type,x=g==="vector"?t.sourceLayer:void 0;g!=="vector"||x?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(x,t.id,s):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,l=t.sourceLayer,h=this.sourceCaches[s];if(h!==void 0)return h.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,t.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=d.aF(this.sourceCaches,g=>g.serialize()),s=this._serializeByIds(this._order),l=this.map.getTerrain()||void 0,h=this.stylesheet;return d.aG({version:h.version,name:h.name,metadata:h.metadata,light:h.light,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,sources:t,layers:s,terrain:l},g=>g!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=x=>this._layers[x].type==="fill-extrusion",l={},h=[];for(let x=this._order.length-1;x>=0;x--){const b=this._order[x];if(s(b)){l[b]=x;for(const T of t){const E=T[b];if(E)for(const A of E)h.push(A)}}}h.sort((x,b)=>b.intersectionZ-x.intersectionZ);const g=[];for(let x=this._order.length-1;x>=0;x--){const b=this._order[x];if(s(b))for(let T=h.length-1;T>=0;T--){const E=h[T].feature;if(l[E.layer.id]<x)break;g.push(E),h.pop()}else for(const T of t){const E=T[b];if(E)for(const A of E)g.push(A.feature)}}return g}queryRenderedFeatures(t,s,l){s&&s.filter&&this._validate(d.x.filter,"queryRenderedFeatures.filter",s.filter,null,s);const h={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const b of s.layers){const T=this._layers[b];if(!T)return this.fire(new d.j(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];h[T.source]=!0}}const g=[];s.availableImages=this._availableImages;const x=this._serializedAllLayers();for(const b in this.sourceCaches)s.layers&&!h[b]||g.push(ka(this.sourceCaches[b],this._layers,x,t,s,l));return this.placement&&g.push(function(b,T,E,A,M,F,N){const U={},K=F.queryRenderedSymbols(A),Z=[];for(const J of Object.keys(K).map(Number))Z.push(N[J]);Z.sort(fr);for(const J of Z){const re=J.featureIndex.lookupSymbolFeatures(K[J.bucketInstanceId],T,J.bucketIndex,J.sourceLayerIndex,M.filter,M.layers,M.availableImages,b);for(const W in re){const ae=U[W]=U[W]||[],de=re[W];de.sort((fe,we)=>{const Ce=J.featureSortOrder;if(Ce){const Ze=Ce.indexOf(fe.featureIndex);return Ce.indexOf(we.featureIndex)-Ze}return we.featureIndex-fe.featureIndex});for(const fe of de)ae.push(fe)}}for(const J in U)U[J].forEach(re=>{const W=re.feature,ae=E[b[J].source].getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=ae});return U}(this._layers,x,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,s){s&&s.filter&&this._validate(d.x.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[t];return l?function(h,g){const x=h.getRenderableIds().map(E=>h.getTileByID(E)),b=[],T={};for(let E=0;E<x.length;E++){const A=x[E],M=A.tileID.canonical.key;T[M]||(T[M]=!0,A.querySourceFeatures(b,g))}return b}(l,s):[]}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const x in t)if(!d.aE(t[x],l[x])){h=!0;break}if(!h)return;const g={now:X.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(g)}_validate(t,s,l,h,g={}){return(!g||g.validate!==!1)&&po(this,t.call(d.x,d.e({key:s,style:this.serialize(),value:l,styleSpec:d.v},h)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),pn().off($o,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,l,h,g=!1){let x=!1,b=!1;const T={};for(const E of this._order){const A=this._layers[E];if(A.type!=="symbol")continue;if(!T[A.source]){const F=this.sourceCaches[A.source];T[A.source]=F.getRenderableIds(!0).map(N=>F.getTileByID(N)).sort((N,U)=>U.tileID.overscaledZ-N.tileID.overscaledZ||(N.tileID.isLessThan(U.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(A,T[A.source],t.center.lng);x=x||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(X.now(),t.zoom))&&(this.pauseablePlacement=new eh(t,this.map.terrain,this._order,g,s,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(X.now()),b=!0),x&&this.pauseablePlacement.placement.setStale()),b||x)for(const E of this._order){const A=this._layers[E];A.type==="symbol"&&this.placement.updateLayerOpacities(A,T[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(X.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s){return d._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const h=this.sourceCaches[s.source];return h&&h.setDependencies(s.tileID.key,s.type,s.icons),l})}getGlyphs(t,s){return d._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),h=this.sourceCaches[s.source];return h&&h.setDependencies(s.tileID.key,s.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(d.x.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,s,l={},h){this._checkLoaded();const g=[{id:t,url:s}],x=[...xt(this.stylesheet.sprite),...g];this._validate(d.x.sprite,"sprite",x,null,l)||(this.stylesheet.sprite=x,this._loadSprite(g,!0,h))}removeSprite(t){this._checkLoaded();const s=xt(this.stylesheet.sprite);if(s.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===t),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return xt(this.stylesheet.sprite)}setSprite(t,s={},l){this._checkLoaded(),t&&this._validate(d.x.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}}var mr=d.X([{name:"a_pos",type:"Int16",components:2}]),tc="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Go={prelude:Lt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Lt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Lt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Lt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Lt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Lt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Lt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Lt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Lt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Lt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Lt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Lt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Lt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Lt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Lt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Lt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Lt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Lt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Lt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Lt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Lt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Lt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Lt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Lt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",tc),terrainDepth:Lt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",tc),terrainCoords:Lt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",tc)};function Lt(m,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/attribute ([\w]+) ([\w]+)/g),h=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=g?g.concat(h):h,b={};return{fragmentSource:m=m.replace(s,(T,E,A,M,F)=>(b[F]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${A} ${M} ${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = u_${F};
#endif
`)),vertexSource:t=t.replace(s,(T,E,A,M,F)=>{const N=M==="float"?"vec2":"vec4",U=F.match(/color/)?"color":N;return b[F]?E==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${N} a_${F};
varying ${A} ${M} ${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${U}(a_${F}, u_${F}_t);
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${N} a_${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = a_${F};
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = unpack_mix_${U}(a_${F}, u_${F}_t);
#else
    ${A} ${M} ${F} = u_${F};
#endif
`}),staticAttributes:l,staticUniforms:x}}class Ea{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,l,h,g,x,b,T,E){this.context=t;let A=this.boundPaintVertexBuffers.length!==h.length;for(let M=0;!A&&M<h.length;M++)this.boundPaintVertexBuffers[M]!==h[M]&&(A=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||A||this.boundIndexBuffer!==g||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==E?this.freshBind(s,l,h,g,x,b,T,E):(t.bindVertexArray.set(this.vao),b&&b.bind(),g&&g.dynamicDraw&&g.bind(),T&&T.bind(),E&&E.bind())}freshBind(t,s,l,h,g,x,b,T){const E=t.numAttributes,A=this.context,M=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=T,s.enableAttributes(M,t);for(const F of l)F.enableAttributes(M,t);x&&x.enableAttributes(M,t),b&&b.enableAttributes(M,t),T&&T.enableAttributes(M,t),s.bind(),s.setVertexAttribPointers(M,t,g);for(const F of l)F.bind(),F.setVertexAttribPointers(M,t,g);x&&(x.bind(),x.setVertexAttribPointers(M,t,g)),h&&h.bind(),b&&(b.bind(),b.setVertexAttribPointers(M,t,g)),T&&(T.bind(),T.setVertexAttribPointers(M,t,g)),A.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Wo(m){const t=[];for(let s=0;s<m.length;s++){if(m[s]===null)continue;const l=m[s].split(" ");t.push(l.pop())}return t}class ic{constructor(t,s,l,h,g,x){const b=t.gl;this.program=b.createProgram();const T=Wo(s.staticAttributes),E=l?l.getBinderAttributes():[],A=T.concat(E),M=Go.prelude.staticUniforms?Wo(Go.prelude.staticUniforms):[],F=s.staticUniforms?Wo(s.staticUniforms):[],N=l?l.getBinderUniforms():[],U=M.concat(F).concat(N),K=[];for(const fe of U)K.indexOf(fe)<0&&K.push(fe);const Z=l?l.defines():[];g&&Z.push("#define OVERDRAW_INSPECTOR;"),x&&Z.push("#define TERRAIN3D;");const J=Z.concat(Go.prelude.fragmentSource,s.fragmentSource).join(`
`),re=Z.concat(Go.prelude.vertexSource,s.vertexSource).join(`
`),W=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(W,J),b.compileShader(W),!b.getShaderParameter(W,b.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${b.getShaderInfoLog(W)}`);b.attachShader(this.program,W);const ae=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(ae,re),b.compileShader(ae),!b.getShaderParameter(ae,b.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${b.getShaderInfoLog(ae)}`);b.attachShader(this.program,ae),this.attributes={};const de={};this.numAttributes=A.length;for(let fe=0;fe<this.numAttributes;fe++)A[fe]&&(b.bindAttribLocation(this.program,fe,A[fe]),this.attributes[A[fe]]=fe);if(b.linkProgram(this.program),!b.getProgramParameter(this.program,b.LINK_STATUS))throw new Error(`Program failed to link: ${b.getProgramInfoLog(this.program)}`);b.deleteShader(ae),b.deleteShader(W);for(let fe=0;fe<K.length;fe++){const we=K[fe];if(we&&!de[we]){const Ce=b.getUniformLocation(this.program,we);Ce&&(de[we]=Ce)}}this.fixedUniforms=h(t,de),this.terrainUniforms=((fe,we)=>({u_depth:new d.aH(fe,we.u_depth),u_terrain:new d.aH(fe,we.u_terrain),u_terrain_dim:new d.aI(fe,we.u_terrain_dim),u_terrain_matrix:new d.aJ(fe,we.u_terrain_matrix),u_terrain_unpack:new d.aK(fe,we.u_terrain_unpack),u_terrain_exaggeration:new d.aI(fe,we.u_terrain_exaggeration)}))(t,de),this.binderUniforms=l?l.getUniforms(t,de):[]}draw(t,s,l,h,g,x,b,T,E,A,M,F,N,U,K,Z,J,re){const W=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(h),t.setColorMode(g),t.setCullFace(x),T){t.activeTexture.set(W.TEXTURE2),W.bindTexture(W.TEXTURE_2D,T.depthTexture),t.activeTexture.set(W.TEXTURE3),W.bindTexture(W.TEXTURE_2D,T.texture);for(const de in this.terrainUniforms)this.terrainUniforms[de].set(T[de])}for(const de in this.fixedUniforms)this.fixedUniforms[de].set(b[de]);K&&K.setUniforms(t,this.binderUniforms,N,{zoom:U});let ae=0;switch(s){case W.LINES:ae=2;break;case W.TRIANGLES:ae=3;break;case W.LINE_STRIP:ae=1}for(const de of F.get()){const fe=de.vaos||(de.vaos={});(fe[E]||(fe[E]=new Ea)).bind(t,this,A,K?K.getPaintVertexBuffers():[],M,de.vertexOffset,Z,J,re),W.drawElements(s,de.primitiveLength*ae,W.UNSIGNED_SHORT,de.primitiveOffset*ae*2)}}}function Pa(m,t,s){const l=1/ht(s,1,t.transform.tileZoom),h=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,t.transform.tileZoom)/h,x=g*(s.tileID.canonical.x+s.tileID.wrap*h),b=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[x>>16,b>>16],u_pixel_coord_lower:[65535&x,65535&b]}}const Ns=(m,t,s,l)=>{const h=t.style.light,g=h.properties.get("position"),x=[g.x,g.y,g.z],b=function(){var E=new d.A(9);return d.A!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[5]=0,E[6]=0,E[7]=0),E[0]=1,E[4]=1,E[8]=1,E}();h.properties.get("anchor")==="viewport"&&function(E,A){var M=Math.sin(A),F=Math.cos(A);E[0]=F,E[1]=M,E[2]=0,E[3]=-M,E[4]=F,E[5]=0,E[6]=0,E[7]=0,E[8]=1}(b,-t.transform.angle),function(E,A,M){var F=A[0],N=A[1],U=A[2];E[0]=F*M[0]+N*M[3]+U*M[6],E[1]=F*M[1]+N*M[4]+U*M[7],E[2]=F*M[2]+N*M[5]+U*M[8]}(x,x,b);const T=h.properties.get("color");return{u_matrix:m,u_lightpos:x,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+s,u_opacity:l}},nc=(m,t,s,l,h,g,x)=>d.e(Ns(m,t,s,l),Pa(g,t,x),{u_height_factor:-Math.pow(2,h.overscaledZ)/x.tileSize/8}),Ma=m=>({u_matrix:m}),js=(m,t,s,l)=>d.e(Ma(m),Pa(s,t,l)),Aa=(m,t)=>({u_matrix:m,u_world:t}),Vs=(m,t,s,l,h)=>d.e(js(m,t,s,l),{u_world:h}),Pp=(m,t,s,l)=>{const h=m.transform;let g,x;if(l.paint.get("circle-pitch-alignment")==="map"){const b=ht(s,1,h.zoom);g=!0,x=[b,b]}else g=!1,x=h.pixelsToGLUnits;return{u_camera_to_center_distance:h.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(t.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:x}},Mp=(m,t,s)=>({u_matrix:m,u_inv_matrix:t,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),rc=(m,t,s=1)=>({u_matrix:m,u_color:t,u_overlay:0,u_overlay_scale:s}),th=m=>({u_matrix:m}),fo=(m,t,s,l)=>({u_matrix:m,u_extrude_scale:ht(t,1,s),u_intensity:l});function za(m,t){const s=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new d.Y(0,l/s).toLngLat().lat,new d.Y(0,(l+1)/s).toLngLat().lat]}const on=(m,t,s,l)=>{const h=m.transform;return{u_matrix:ac(m,t,s,l),u_ratio:1/ht(t,1,h.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Dn=(m,t,s,l,h)=>d.e(on(m,t,s,h),{u_image:0,u_image_height:l}),oc=(m,t,s,l,h)=>{const g=m.transform,x=sc(t,g);return{u_matrix:ac(m,t,s,h),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ht(t,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[x,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Da=(m,t,s,l,h,g)=>{const x=m.lineAtlas,b=sc(t,m.transform),T=s.layout.get("line-cap")==="round",E=x.getDash(l.from,T),A=x.getDash(l.to,T),M=E.width*h.fromScale,F=A.width*h.toScale;return d.e(on(m,t,s,g),{u_patternscale_a:[b/M,-E.height/2],u_patternscale_b:[b/F,-A.height/2],u_sdfgamma:x.width/(256*Math.min(M,F)*m.pixelRatio)/2,u_image:0,u_tex_y_a:E.y,u_tex_y_b:A.y,u_mix:h.t})};function sc(m,t){return 1/ht(m,1,t.tileZoom)}function ac(m,t,s,l){return m.translatePosMatrix(l?l.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Ho=(m,t,s,l,h)=>{return{u_matrix:m,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(x=h.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(g=h.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Ap(h.paint.get("raster-hue-rotate"))};var g,x};function Ap(m){m*=Math.PI/180;const t=Math.sin(m),s=Math.cos(m);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const ih=(m,t,s,l,h,g,x,b,T,E,A,M,F,N)=>{const U=x.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:U.cameraToCenterDistance,u_pitch:U.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:U.width/U.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:E,u_is_text:+M,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:g,u_texsize:F,u_texture:0,u_translation:A,u_pitched_scale:N}},nh=(m,t,s,l,h,g,x,b,T,E,A,M,F,N,U)=>{const K=x.transform;return d.e(ih(m,t,s,l,h,g,x,b,T,E,A,M,F,U),{u_gamma_scale:l?Math.cos(K._pitch)*K.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:+N})},zp=(m,t,s,l,h,g,x,b,T,E,A,M,F,N)=>d.e(nh(m,t,s,l,h,g,x,b,T,E,A,!0,M,!0,N),{u_texsize_icon:F,u_texture_icon:1}),Dp=(m,t,s)=>({u_matrix:m,u_opacity:t,u_color:s}),Lp=(m,t,s,l,h,g)=>d.e(function(x,b,T,E){const A=T.imageManager.getPattern(x.from.toString()),M=T.imageManager.getPattern(x.to.toString()),{width:F,height:N}=T.imageManager.getPixelSize(),U=Math.pow(2,E.tileID.overscaledZ),K=E.tileSize*Math.pow(2,T.transform.tileZoom)/U,Z=K*(E.tileID.canonical.x+E.tileID.wrap*U),J=K*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[F,N],u_mix:b.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/ht(E,1,T.transform.tileZoom),u_pixel_coord_upper:[Z>>16,J>>16],u_pixel_coord_lower:[65535&Z,65535&J]}}(l,g,s,h),{u_matrix:m,u_opacity:t}),La={fillExtrusion:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_lightpos:new d.aL(m,t.u_lightpos),u_lightintensity:new d.aI(m,t.u_lightintensity),u_lightcolor:new d.aL(m,t.u_lightcolor),u_vertical_gradient:new d.aI(m,t.u_vertical_gradient),u_opacity:new d.aI(m,t.u_opacity)}),fillExtrusionPattern:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_lightpos:new d.aL(m,t.u_lightpos),u_lightintensity:new d.aI(m,t.u_lightintensity),u_lightcolor:new d.aL(m,t.u_lightcolor),u_vertical_gradient:new d.aI(m,t.u_vertical_gradient),u_height_factor:new d.aI(m,t.u_height_factor),u_image:new d.aH(m,t.u_image),u_texsize:new d.aM(m,t.u_texsize),u_pixel_coord_upper:new d.aM(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aM(m,t.u_pixel_coord_lower),u_scale:new d.aL(m,t.u_scale),u_fade:new d.aI(m,t.u_fade),u_opacity:new d.aI(m,t.u_opacity)}),fill:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix)}),fillPattern:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_image:new d.aH(m,t.u_image),u_texsize:new d.aM(m,t.u_texsize),u_pixel_coord_upper:new d.aM(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aM(m,t.u_pixel_coord_lower),u_scale:new d.aL(m,t.u_scale),u_fade:new d.aI(m,t.u_fade)}),fillOutline:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_world:new d.aM(m,t.u_world)}),fillOutlinePattern:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_world:new d.aM(m,t.u_world),u_image:new d.aH(m,t.u_image),u_texsize:new d.aM(m,t.u_texsize),u_pixel_coord_upper:new d.aM(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aM(m,t.u_pixel_coord_lower),u_scale:new d.aL(m,t.u_scale),u_fade:new d.aI(m,t.u_fade)}),circle:(m,t)=>({u_camera_to_center_distance:new d.aI(m,t.u_camera_to_center_distance),u_scale_with_map:new d.aH(m,t.u_scale_with_map),u_pitch_with_map:new d.aH(m,t.u_pitch_with_map),u_extrude_scale:new d.aM(m,t.u_extrude_scale),u_device_pixel_ratio:new d.aI(m,t.u_device_pixel_ratio),u_matrix:new d.aJ(m,t.u_matrix)}),collisionBox:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_pixel_extrude_scale:new d.aM(m,t.u_pixel_extrude_scale)}),collisionCircle:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_inv_matrix:new d.aJ(m,t.u_inv_matrix),u_camera_to_center_distance:new d.aI(m,t.u_camera_to_center_distance),u_viewport_size:new d.aM(m,t.u_viewport_size)}),debug:(m,t)=>({u_color:new d.aN(m,t.u_color),u_matrix:new d.aJ(m,t.u_matrix),u_overlay:new d.aH(m,t.u_overlay),u_overlay_scale:new d.aI(m,t.u_overlay_scale)}),clippingMask:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix)}),heatmap:(m,t)=>({u_extrude_scale:new d.aI(m,t.u_extrude_scale),u_intensity:new d.aI(m,t.u_intensity),u_matrix:new d.aJ(m,t.u_matrix)}),heatmapTexture:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_world:new d.aM(m,t.u_world),u_image:new d.aH(m,t.u_image),u_color_ramp:new d.aH(m,t.u_color_ramp),u_opacity:new d.aI(m,t.u_opacity)}),hillshade:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_image:new d.aH(m,t.u_image),u_latrange:new d.aM(m,t.u_latrange),u_light:new d.aM(m,t.u_light),u_shadow:new d.aN(m,t.u_shadow),u_highlight:new d.aN(m,t.u_highlight),u_accent:new d.aN(m,t.u_accent)}),hillshadePrepare:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_image:new d.aH(m,t.u_image),u_dimension:new d.aM(m,t.u_dimension),u_zoom:new d.aI(m,t.u_zoom),u_unpack:new d.aK(m,t.u_unpack)}),line:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_ratio:new d.aI(m,t.u_ratio),u_device_pixel_ratio:new d.aI(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.aM(m,t.u_units_to_pixels)}),lineGradient:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_ratio:new d.aI(m,t.u_ratio),u_device_pixel_ratio:new d.aI(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.aM(m,t.u_units_to_pixels),u_image:new d.aH(m,t.u_image),u_image_height:new d.aI(m,t.u_image_height)}),linePattern:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_texsize:new d.aM(m,t.u_texsize),u_ratio:new d.aI(m,t.u_ratio),u_device_pixel_ratio:new d.aI(m,t.u_device_pixel_ratio),u_image:new d.aH(m,t.u_image),u_units_to_pixels:new d.aM(m,t.u_units_to_pixels),u_scale:new d.aL(m,t.u_scale),u_fade:new d.aI(m,t.u_fade)}),lineSDF:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_ratio:new d.aI(m,t.u_ratio),u_device_pixel_ratio:new d.aI(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.aM(m,t.u_units_to_pixels),u_patternscale_a:new d.aM(m,t.u_patternscale_a),u_patternscale_b:new d.aM(m,t.u_patternscale_b),u_sdfgamma:new d.aI(m,t.u_sdfgamma),u_image:new d.aH(m,t.u_image),u_tex_y_a:new d.aI(m,t.u_tex_y_a),u_tex_y_b:new d.aI(m,t.u_tex_y_b),u_mix:new d.aI(m,t.u_mix)}),raster:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_tl_parent:new d.aM(m,t.u_tl_parent),u_scale_parent:new d.aI(m,t.u_scale_parent),u_buffer_scale:new d.aI(m,t.u_buffer_scale),u_fade_t:new d.aI(m,t.u_fade_t),u_opacity:new d.aI(m,t.u_opacity),u_image0:new d.aH(m,t.u_image0),u_image1:new d.aH(m,t.u_image1),u_brightness_low:new d.aI(m,t.u_brightness_low),u_brightness_high:new d.aI(m,t.u_brightness_high),u_saturation_factor:new d.aI(m,t.u_saturation_factor),u_contrast_factor:new d.aI(m,t.u_contrast_factor),u_spin_weights:new d.aL(m,t.u_spin_weights)}),symbolIcon:(m,t)=>({u_is_size_zoom_constant:new d.aH(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,t.u_is_size_feature_constant),u_size_t:new d.aI(m,t.u_size_t),u_size:new d.aI(m,t.u_size),u_camera_to_center_distance:new d.aI(m,t.u_camera_to_center_distance),u_pitch:new d.aI(m,t.u_pitch),u_rotate_symbol:new d.aH(m,t.u_rotate_symbol),u_aspect_ratio:new d.aI(m,t.u_aspect_ratio),u_fade_change:new d.aI(m,t.u_fade_change),u_matrix:new d.aJ(m,t.u_matrix),u_label_plane_matrix:new d.aJ(m,t.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,t.u_coord_matrix),u_is_text:new d.aH(m,t.u_is_text),u_pitch_with_map:new d.aH(m,t.u_pitch_with_map),u_is_along_line:new d.aH(m,t.u_is_along_line),u_is_variable_anchor:new d.aH(m,t.u_is_variable_anchor),u_texsize:new d.aM(m,t.u_texsize),u_texture:new d.aH(m,t.u_texture),u_translation:new d.aM(m,t.u_translation),u_pitched_scale:new d.aI(m,t.u_pitched_scale)}),symbolSDF:(m,t)=>({u_is_size_zoom_constant:new d.aH(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,t.u_is_size_feature_constant),u_size_t:new d.aI(m,t.u_size_t),u_size:new d.aI(m,t.u_size),u_camera_to_center_distance:new d.aI(m,t.u_camera_to_center_distance),u_pitch:new d.aI(m,t.u_pitch),u_rotate_symbol:new d.aH(m,t.u_rotate_symbol),u_aspect_ratio:new d.aI(m,t.u_aspect_ratio),u_fade_change:new d.aI(m,t.u_fade_change),u_matrix:new d.aJ(m,t.u_matrix),u_label_plane_matrix:new d.aJ(m,t.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,t.u_coord_matrix),u_is_text:new d.aH(m,t.u_is_text),u_pitch_with_map:new d.aH(m,t.u_pitch_with_map),u_is_along_line:new d.aH(m,t.u_is_along_line),u_is_variable_anchor:new d.aH(m,t.u_is_variable_anchor),u_texsize:new d.aM(m,t.u_texsize),u_texture:new d.aH(m,t.u_texture),u_gamma_scale:new d.aI(m,t.u_gamma_scale),u_device_pixel_ratio:new d.aI(m,t.u_device_pixel_ratio),u_is_halo:new d.aH(m,t.u_is_halo),u_translation:new d.aM(m,t.u_translation),u_pitched_scale:new d.aI(m,t.u_pitched_scale)}),symbolTextAndIcon:(m,t)=>({u_is_size_zoom_constant:new d.aH(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,t.u_is_size_feature_constant),u_size_t:new d.aI(m,t.u_size_t),u_size:new d.aI(m,t.u_size),u_camera_to_center_distance:new d.aI(m,t.u_camera_to_center_distance),u_pitch:new d.aI(m,t.u_pitch),u_rotate_symbol:new d.aH(m,t.u_rotate_symbol),u_aspect_ratio:new d.aI(m,t.u_aspect_ratio),u_fade_change:new d.aI(m,t.u_fade_change),u_matrix:new d.aJ(m,t.u_matrix),u_label_plane_matrix:new d.aJ(m,t.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,t.u_coord_matrix),u_is_text:new d.aH(m,t.u_is_text),u_pitch_with_map:new d.aH(m,t.u_pitch_with_map),u_is_along_line:new d.aH(m,t.u_is_along_line),u_is_variable_anchor:new d.aH(m,t.u_is_variable_anchor),u_texsize:new d.aM(m,t.u_texsize),u_texsize_icon:new d.aM(m,t.u_texsize_icon),u_texture:new d.aH(m,t.u_texture),u_texture_icon:new d.aH(m,t.u_texture_icon),u_gamma_scale:new d.aI(m,t.u_gamma_scale),u_device_pixel_ratio:new d.aI(m,t.u_device_pixel_ratio),u_is_halo:new d.aH(m,t.u_is_halo),u_translation:new d.aM(m,t.u_translation),u_pitched_scale:new d.aI(m,t.u_pitched_scale)}),background:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_opacity:new d.aI(m,t.u_opacity),u_color:new d.aN(m,t.u_color)}),backgroundPattern:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_opacity:new d.aI(m,t.u_opacity),u_image:new d.aH(m,t.u_image),u_pattern_tl_a:new d.aM(m,t.u_pattern_tl_a),u_pattern_br_a:new d.aM(m,t.u_pattern_br_a),u_pattern_tl_b:new d.aM(m,t.u_pattern_tl_b),u_pattern_br_b:new d.aM(m,t.u_pattern_br_b),u_texsize:new d.aM(m,t.u_texsize),u_mix:new d.aI(m,t.u_mix),u_pattern_size_a:new d.aM(m,t.u_pattern_size_a),u_pattern_size_b:new d.aM(m,t.u_pattern_size_b),u_scale_a:new d.aI(m,t.u_scale_a),u_scale_b:new d.aI(m,t.u_scale_b),u_pixel_coord_upper:new d.aM(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aM(m,t.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(m,t.u_tile_units_to_pixels)}),terrain:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_texture:new d.aH(m,t.u_texture),u_ele_delta:new d.aI(m,t.u_ele_delta)}),terrainDepth:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_ele_delta:new d.aI(m,t.u_ele_delta)}),terrainCoords:(m,t)=>({u_matrix:new d.aJ(m,t.u_matrix),u_texture:new d.aH(m,t.u_texture),u_terrain_coords_id:new d.aI(m,t.u_terrain_coords_id),u_ele_delta:new d.aI(m,t.u_ele_delta)})};class lc{constructor(t,s,l){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ra={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class cc{constructor(t,s,l,h){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=h,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let l=0;l<this.attributes.length;l++){const h=s.attributes[this.attributes[l].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,s,l){for(let h=0;h<this.attributes.length;h++){const g=this.attributes[h],x=s.attributes[g.name];x!==void 0&&t.vertexAttribPointer(x,g.components,t[Ra[g.type]],!1,this.itemSize,g.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Us=new WeakMap;function Ln(m){var t;if(Us.has(m))return Us.get(m);{const s=(t=m.getParameter(m.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Us.set(m,s),s}}class Rt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class uc extends Rt{getDefault(){return d.aP.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class $s extends Rt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Zs extends Rt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Rp extends Rt{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Fa extends Rt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Fp extends Rt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ko extends Rt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Bp extends Rt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class rh extends Rt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Op extends Rt{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class oh extends Rt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class hc extends Rt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class sh extends Rt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class ah extends Rt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class lh extends Rt{getDefault(){return d.aP.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ch extends Rt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class mo extends Rt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class uh extends Rt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Np extends Rt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class jp extends Rt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class hh extends Rt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class qs extends Rt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Vp extends Rt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ba extends Rt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Up extends Rt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class $p extends Rt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class dh extends Rt{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ph extends Rt{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const l=this.gl;Ln(l)?l.bindVertexArray(t):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class fh extends Rt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class dc extends Rt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class mh extends Rt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Xo extends Rt{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class zr extends Xo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class pc extends Xo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class fc extends Xo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class mc{constructor(t,s,l,h,g){this.context=t,this.width=s,this.height=l;const x=t.gl,b=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new zr(t,b),h)this.depthAttachment=g?new fc(t,b):new pc(t,b);else if(g)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class di{constructor(t,s,l){this.blendFunction=t,this.blendColor=s,this.mask=l}}di.Replace=[1,0],di.disabled=new di(di.Replace,d.aP.transparent,[!1,!1,!1,!1]),di.unblended=new di(di.Replace,d.aP.transparent,[!0,!0,!0,!0]),di.alphaBlended=new di([1,771],d.aP.transparent,[!0,!0,!0,!0]);class gc{constructor(t){var s,l;if(this.gl=t,this.clearColor=new uc(this),this.clearDepth=new $s(this),this.clearStencil=new Zs(this),this.colorMask=new Rp(this),this.depthMask=new Fa(this),this.stencilMask=new Fp(this),this.stencilFunc=new Ko(this),this.stencilOp=new Bp(this),this.stencilTest=new rh(this),this.depthRange=new Op(this),this.depthTest=new oh(this),this.depthFunc=new hc(this),this.blend=new sh(this),this.blendFunc=new ah(this),this.blendColor=new lh(this),this.blendEquation=new ch(this),this.cullFace=new mo(this),this.cullFaceSide=new uh(this),this.frontFace=new Np(this),this.program=new jp(this),this.activeTexture=new hh(this),this.viewport=new qs(this),this.bindFramebuffer=new Vp(this),this.bindRenderbuffer=new Ba(this),this.bindTexture=new Up(this),this.bindVertexBuffer=new $p(this),this.bindElementBuffer=new dh(this),this.bindVertexArray=new ph(this),this.pixelStoreUnpack=new fh(this),this.pixelStoreUnpackPremultiplyAlpha=new dc(this),this.pixelStoreUnpackFlipY=new mh(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Ln(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:h==null?void 0:h.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:h==null?void 0:h.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h==null?void 0:h.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new lc(this,t,s)}createVertexBuffer(t,s,l){return new cc(this,t,s,l)}createRenderbuffer(t,s,l){const h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,t,s,l),this.bindRenderbuffer.set(null),g}createFramebuffer(t,s,l,h){return new mc(this,t,s,l,h)}clear({color:t,depth:s,stencil:l}){const h=this.gl;let g=0;t&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(g|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(g)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){d.aE(t.blendFunction,di.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Ln(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return Ln(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class St{constructor(t,s,l){this.func=t,this.mask=s,this.range=l}}St.ReadOnly=!1,St.ReadWrite=!0,St.disabled=new St(519,St.ReadOnly,[0,1]);const Gs=7680;class ii{constructor(t,s,l,h,g,x){this.test=t,this.ref=s,this.mask=l,this.fail=h,this.depthFail=g,this.pass=x}}ii.disabled=new ii({func:519,mask:0},0,0,Gs,Gs,Gs);class Qt{constructor(t,s,l){this.enable=t,this.mode=s,this.frontFace=l}}let Oa;function gh(m,t,s,l,h){const g=m.context,x=g.gl,b=m.useProgram("collisionBox"),T=[];let E=0,A=0;for(let J=0;J<l.length;J++){const re=l[J],W=t.getTile(re).getBucket(s);if(!W)continue;const ae=h?W.textCollisionBox:W.iconCollisionBox,de=W.collisionCircleArray;if(de.length>0){const fe=d.F();d.aQ(fe,W.placementInvProjMatrix,m.transform.glCoordMatrix),d.aQ(fe,fe,W.placementViewportMatrix),T.push({circleArray:de,circleOffset:A,transform:re.posMatrix,invTransform:fe,coord:re}),E+=de.length/4,A=E}ae&&b.draw(g,x.LINES,St.disabled,ii.disabled,m.colorModeForRenderPass(),Qt.disabled,{u_matrix:re.posMatrix,u_pixel_extrude_scale:[1/(M=m.transform).width,1/M.height]},m.style.map.terrain&&m.style.map.terrain.getTerrainData(re),s.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,null,m.transform.zoom,null,null,ae.collisionVertexBuffer)}var M;if(!h||!T.length)return;const F=m.useProgram("collisionCircle"),N=new d.aR;N.resize(4*E),N._trim();let U=0;for(const J of T)for(let re=0;re<J.circleArray.length/4;re++){const W=4*re,ae=J.circleArray[W+0],de=J.circleArray[W+1],fe=J.circleArray[W+2],we=J.circleArray[W+3];N.emplace(U++,ae,de,fe,we,0),N.emplace(U++,ae,de,fe,we,1),N.emplace(U++,ae,de,fe,we,2),N.emplace(U++,ae,de,fe,we,3)}(!Oa||Oa.length<2*E)&&(Oa=function(J){const re=2*J,W=new d.aT;W.resize(re),W._trim();for(let ae=0;ae<re;ae++){const de=6*ae;W.uint16[de+0]=4*ae+0,W.uint16[de+1]=4*ae+1,W.uint16[de+2]=4*ae+2,W.uint16[de+3]=4*ae+2,W.uint16[de+4]=4*ae+3,W.uint16[de+5]=4*ae+0}return W}(E));const K=g.createIndexBuffer(Oa,!0),Z=g.createVertexBuffer(N,d.aS.members,!0);for(const J of T){const re=Mp(J.transform,J.invTransform,m.transform);F.draw(g,x.TRIANGLES,St.disabled,ii.disabled,m.colorModeForRenderPass(),Qt.disabled,re,m.style.map.terrain&&m.style.map.terrain.getTerrainData(J.coord),s.id,Z,K,d.$.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,m.transform.zoom,null,null,null)}Z.destroy(),K.destroy()}Qt.disabled=new Qt(!1,1029,2305),Qt.backCCW=new Qt(!0,1029,2305);const yc=d.an(new Float32Array(16));function Zp(m,t,s,l,h,g){const{horizontalAlign:x,verticalAlign:b}=d.au(m);return new d.P((-(x-.5)*t/h+l[0])*g,(-(b-.5)*s/h+l[1])*g)}function yh(m,t,s,l,h,g){const x=t.tileAnchorPoint.add(new d.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let b=l.mult(g);return s||(b=b.rotate(-h)),Mi(x.add(b),t.labelPlaneMatrix,t.getElevation).point}if(s){const b=Q(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(m),T=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return m.add(l.rotate(T))}return m.add(l)}function Na(m,t,s,l,h,g,x,b,T,E,A,M,F,N){const U=m.text.placedSymbolArray,K=m.text.dynamicLayoutVertexArray,Z=m.icon.dynamicLayoutVertexArray,J={};K.clear();for(let re=0;re<U.length;re++){const W=U.get(re),ae=W.hidden||!W.crossTileID||m.allowVerticalPlacement&&!W.placedOrientation?null:l[W.crossTileID];if(ae){const de=new d.P(W.anchorX,W.anchorY),fe={getElevation:N,width:h.width,height:h.height,labelPlaneMatrix:g,lineVertexArray:null,pitchWithMap:s,projection:A,projectionCache:null,tileAnchorPoint:de,translation:M,unwrappedTileID:F},we=s?Mi(de,x,N):Q(de.x,de.y,fe),Ce=G(h.cameraToCenterDistance,we.signedDistanceFromCamera);let Ze=d.ai(m.textSizeData,T,W)*Ce/d.ap;s&&(Ze*=m.tilePixelRatio/b);const{width:qe,height:Ee,anchor:Ae,textOffset:Ke,textBoxScale:dt}=ae,Le=Zp(Ae,qe,Ee,Ke,dt,Ze),Ne=A.getPitchedTextCorrection(h,de.add(new d.P(M[0],M[1])),F),ct=yh(we.point,fe,t,Le,h.angle,Ne),Ht=m.allowVerticalPlacement&&W.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let bt=0;bt<W.numGlyphs;bt++)d.aj(K,ct,Ht);E&&W.associatedIconIndex>=0&&(J[W.associatedIconIndex]={shiftedAnchor:ct,angle:Ht})}else ot(W.numGlyphs,K)}if(E){Z.clear();const re=m.icon.placedSymbolArray;for(let W=0;W<re.length;W++){const ae=re.get(W);if(ae.hidden)ot(ae.numGlyphs,Z);else{const de=J[W];if(de)for(let fe=0;fe<ae.numGlyphs;fe++)d.aj(Z,de.shiftedAnchor,de.angle);else ot(ae.numGlyphs,Z)}}m.icon.dynamicLayoutVertexBuffer.updateData(Z)}m.text.dynamicLayoutVertexBuffer.updateData(K)}function ja(m,t,s){return s.iconsInText&&t?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Ws(m,t,s,l,h,g,x,b,T,E,A,M){const F=m.context,N=F.gl,U=m.transform,K=yn(),Z=b==="map",J=T==="map",re=b!=="viewport"&&s.layout.get("symbol-placement")!=="point",W=Z&&!J&&!re,ae=!J&&re,de=!s.layout.get("symbol-sort-key").isConstant();let fe=!1;const we=m.depthModeForSublayer(0,St.ReadOnly),Ce=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ze=[],qe=K.getCircleRadiusCorrection(U);for(const Ee of l){const Ae=t.getTile(Ee),Ke=Ae.getBucket(s);if(!Ke)continue;const dt=h?Ke.text:Ke.icon;if(!dt||!dt.segments.get().length||!dt.hasVisibleVertices)continue;const Le=dt.programConfigurations.get(s.id),Ne=h||Ke.sdfIcons,ct=h?Ke.textSizeData:Ke.iconSizeData,Ht=J||U.pitch!==0,bt=m.useProgram(ja(Ne,h,Ke),Le),It=d.ag(ct,U.zoom),Kt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Ee);let qi,er,Xt,vn,sn=[0,0],Gi=null;if(h)er=Ae.glyphAtlasTexture,Xt=N.LINEAR,qi=Ae.glyphAtlasTexture.size,Ke.iconsInText&&(sn=Ae.imageAtlasTexture.size,Gi=Ae.imageAtlasTexture,vn=Ht||m.options.rotating||m.options.zooming||ct.kind==="composite"||ct.kind==="camera"?N.LINEAR:N.NEAREST);else{const ni=s.layout.get("icon-size").constantOr(0)!==1||Ke.iconsNeedLinear;er=Ae.imageAtlasTexture,Xt=Ne||m.options.rotating||m.options.zooming||ni||Ht?N.LINEAR:N.NEAREST,qi=Ae.imageAtlasTexture.size}const Wi=ht(Ae,1,m.transform.zoom),tr=ae?Ee.posMatrix:yc,bo=Pr(tr,J,Z,m.transform,Wi),ol=Mr(tr,J,Z,m.transform,Wi),rs=Mr(Ee.posMatrix,J,Z,m.transform,Wi),So=K.translatePosition(m.transform,Ae,g,x),sl=Ce&&Ke.hasTextData(),jc=s.layout.get("icon-text-fit")!=="none"&&sl&&Ke.hasIconData();if(re){const ni=m.style.map.terrain?(Vc,Ci)=>m.style.map.terrain.getElevation(Ee,Vc,Ci):null,ss=s.layout.get("text-rotation-alignment")==="map";R(Ke,Ee.posMatrix,m,h,bo,rs,J,E,ss,K,Ee.toUnwrapped(),U.width,U.height,So,ni)}const Oi=Ee.posMatrix,ir=h&&Ce||jc,Qr=re||ir?yc:bo,os=ol,Hi=Ne&&s.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ki;Ki=Ne?Ke.iconsInText?zp(ct.kind,It,W,J,re,ir,m,Oi,Qr,os,So,qi,sn,qe):nh(ct.kind,It,W,J,re,ir,m,Oi,Qr,os,So,h,qi,!0,qe):ih(ct.kind,It,W,J,re,ir,m,Oi,Qr,os,So,h,qi,qe);const Ai={program:bt,buffers:dt,uniformValues:Ki,atlasTexture:er,atlasTextureIcon:Gi,atlasInterpolation:Xt,atlasInterpolationIcon:vn,isSDF:Ne,hasHalo:Hi};if(de&&Ke.canOverlap){fe=!0;const ni=dt.segments.get();for(const ss of ni)Ze.push({segments:new d.$([ss]),sortKey:ss.sortKey,state:Ai,terrainData:Kt})}else Ze.push({segments:dt.segments,sortKey:0,state:Ai,terrainData:Kt})}fe&&Ze.sort((Ee,Ae)=>Ee.sortKey-Ae.sortKey);for(const Ee of Ze){const Ae=Ee.state;if(F.activeTexture.set(N.TEXTURE0),Ae.atlasTexture.bind(Ae.atlasInterpolation,N.CLAMP_TO_EDGE),Ae.atlasTextureIcon&&(F.activeTexture.set(N.TEXTURE1),Ae.atlasTextureIcon&&Ae.atlasTextureIcon.bind(Ae.atlasInterpolationIcon,N.CLAMP_TO_EDGE)),Ae.isSDF){const Ke=Ae.uniformValues;Ae.hasHalo&&(Ke.u_is_halo=1,Va(Ae.buffers,Ee.segments,s,m,Ae.program,we,A,M,Ke,Ee.terrainData)),Ke.u_is_halo=0}Va(Ae.buffers,Ee.segments,s,m,Ae.program,we,A,M,Ae.uniformValues,Ee.terrainData)}}function Va(m,t,s,l,h,g,x,b,T,E){const A=l.context;h.draw(A,A.gl.TRIANGLES,g,x,b,Qt.disabled,T,E,s.id,m.layoutVertexBuffer,m.indexBuffer,t,s.paint,l.transform.zoom,m.programConfigurations.get(s.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Hr(m,t,s,l,h){if(!s||!l||!l.imageAtlas)return;const g=l.imageAtlas.patternPositions;let x=g[s.to.toString()],b=g[s.from.toString()];if(!x&&b&&(x=b),!b&&x&&(b=x),!x||!b){const T=h.getPaintProperty(t);x=g[T],b=g[T]}x&&b&&m.setConstantPatternPositions(x,b)}function go(m,t,s,l,h,g,x){const b=m.context.gl,T="fill-pattern",E=s.paint.get(T),A=E&&E.constantOr(1),M=s.getCrossfadeParameters();let F,N,U,K,Z;x?(N=A&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=b.LINES):(N=A?"fillPattern":"fill",F=b.TRIANGLES);const J=E.constantOr(null);for(const re of l){const W=t.getTile(re);if(A&&!W.patternsLoaded())continue;const ae=W.getBucket(s);if(!ae)continue;const de=ae.programConfigurations.get(s.id),fe=m.useProgram(N,de),we=m.style.map.terrain&&m.style.map.terrain.getTerrainData(re);A&&(m.context.activeTexture.set(b.TEXTURE0),W.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),de.updatePaintBuffers(M)),Hr(de,T,J,W,s);const Ce=we?re:null,Ze=m.translatePosMatrix(Ce?Ce.posMatrix:re.posMatrix,W,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(x){K=ae.indexBuffer2,Z=ae.segments2;const qe=[b.drawingBufferWidth,b.drawingBufferHeight];U=N==="fillOutlinePattern"&&A?Vs(Ze,m,M,W,qe):Aa(Ze,qe)}else K=ae.indexBuffer,Z=ae.segments,U=A?js(Ze,m,M,W):Ma(Ze);fe.draw(m.context,F,h,m.stencilModeForClipping(re),g,Qt.disabled,U,we,s.id,ae.layoutVertexBuffer,K,Z,s.paint,m.transform.zoom,de)}}function _n(m,t,s,l,h,g,x){const b=m.context,T=b.gl,E="fill-extrusion-pattern",A=s.paint.get(E),M=A.constantOr(1),F=s.getCrossfadeParameters(),N=s.paint.get("fill-extrusion-opacity"),U=A.constantOr(null);for(const K of l){const Z=t.getTile(K),J=Z.getBucket(s);if(!J)continue;const re=m.style.map.terrain&&m.style.map.terrain.getTerrainData(K),W=J.programConfigurations.get(s.id),ae=m.useProgram(M?"fillExtrusionPattern":"fillExtrusion",W);M&&(m.context.activeTexture.set(T.TEXTURE0),Z.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),W.updatePaintBuffers(F)),Hr(W,E,U,Z,s);const de=m.translatePosMatrix(K.posMatrix,Z,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),fe=s.paint.get("fill-extrusion-vertical-gradient"),we=M?nc(de,m,fe,N,K,F,Z):Ns(de,m,fe,N);ae.draw(b,b.gl.TRIANGLES,h,g,x,Qt.backCCW,we,re,s.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,s.paint,m.transform.zoom,W,m.style.map.terrain&&J.centroidVertexBuffer)}}function _h(m,t,s,l,h,g,x){const b=m.context,T=b.gl,E=s.fbo;if(!E)return;const A=m.useProgram("hillshade"),M=m.style.map.terrain&&m.style.map.terrain.getTerrainData(t);b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,E.colorAttachment.get()),A.draw(b,T.TRIANGLES,h,g,x,Qt.disabled,((F,N,U,K)=>{const Z=U.paint.get("hillshade-shadow-color"),J=U.paint.get("hillshade-highlight-color"),re=U.paint.get("hillshade-accent-color");let W=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);U.paint.get("hillshade-illumination-anchor")==="viewport"&&(W-=F.transform.angle);const ae=!F.options.moving;return{u_matrix:K?K.posMatrix:F.transform.calculatePosMatrix(N.tileID.toUnwrapped(),ae),u_image:0,u_latrange:za(0,N.tileID),u_light:[U.paint.get("hillshade-exaggeration"),W],u_shadow:Z,u_highlight:J,u_accent:re}})(m,s,l,M?t:null),M,l.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function vh(m,t,s,l,h,g){const x=m.context,b=x.gl,T=t.dem;if(T&&T.data){const E=T.dim,A=T.stride,M=T.getPixels();if(x.activeTexture.set(b.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||m.getTileTexture(A),t.demTexture){const N=t.demTexture;N.update(M,{premultiply:!1}),N.bind(b.NEAREST,b.CLAMP_TO_EDGE)}else t.demTexture=new pt(x,M,b.RGBA,{premultiply:!1}),t.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);x.activeTexture.set(b.TEXTURE0);let F=t.fbo;if(!F){const N=new pt(x,{width:E,height:E,data:null},b.RGBA);N.bind(b.LINEAR,b.CLAMP_TO_EDGE),F=t.fbo=x.createFramebuffer(E,E,!0,!1),F.colorAttachment.set(N.texture)}x.bindFramebuffer.set(F.framebuffer),x.viewport.set([0,0,E,E]),m.useProgram("hillshadePrepare").draw(x,b.TRIANGLES,l,h,g,Qt.disabled,((N,U)=>{const K=U.stride,Z=d.F();return d.aO(Z,0,d.W,-d.W,0,0,1),d.H(Z,Z,[0,-d.W,0]),{u_matrix:Z,u_image:1,u_dimension:[K,K],u_zoom:N.overscaledZ,u_unpack:U.getUnpackVector()}})(t.tileID,T),null,s.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function _c(m,t,s,l,h,g){const x=l.paint.get("raster-fade-duration");if(!g&&x>0){const b=X.now(),T=(b-m.timeAdded)/x,E=t?(b-t.timeAdded)/x:-1,A=s.getSource(),M=h.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),F=!t||Math.abs(t.tileID.overscaledZ-M)>Math.abs(m.tileID.overscaledZ-M),N=F&&m.refreshedUponExpiration?1:d.ac(F?T:1-E,0,1);return m.refreshedUponExpiration&&T>=1&&(m.refreshedUponExpiration=!1),t?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}const yo=new d.aP(1,0,0,1),Ua=new d.aP(0,1,0,1),$a=new d.aP(0,0,1,1),Hs=new d.aP(1,0,1,1),Za=new d.aP(0,1,1,1);function vc(m,t,s,l){Dr(m,0,t+s/2,m.transform.width,s,l)}function _o(m,t,s,l){Dr(m,t-s/2,0,s,m.transform.height,l)}function Dr(m,t,s,l,h,g){const x=m.context,b=x.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*m.pixelRatio,s*m.pixelRatio,l*m.pixelRatio,h*m.pixelRatio),x.clear({color:g}),b.disable(b.SCISSOR_TEST)}function xh(m,t,s){const l=m.context,h=l.gl,g=s.posMatrix,x=m.useProgram("debug"),b=St.disabled,T=ii.disabled,E=m.colorModeForRenderPass(),A="$debug",M=m.style.map.terrain&&m.style.map.terrain.getTerrainData(s);l.activeTexture.set(h.TEXTURE0);const F=t.getTileByID(s.key).latestRawTileData,N=Math.floor((F&&F.byteLength||0)/1024),U=t.getTile(s).tileSize,K=512/Math.min(U,512)*(s.overscaledZ/m.transform.zoom)*.5;let Z=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Z+=` => ${s.overscaledZ}`),function(J,re){J.initDebugOverlayCanvas();const W=J.debugOverlayCanvas,ae=J.context.gl,de=J.debugOverlayCanvas.getContext("2d");de.clearRect(0,0,W.width,W.height),de.shadowColor="white",de.shadowBlur=2,de.lineWidth=1.5,de.strokeStyle="white",de.textBaseline="top",de.font="bold 36px Open Sans, sans-serif",de.fillText(re,5,5),de.strokeText(re,5,5),J.debugOverlayTexture.update(W),J.debugOverlayTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}(m,`${Z} ${N}kB`),x.draw(l,h.TRIANGLES,b,T,di.alphaBlended,Qt.disabled,rc(g,d.aP.transparent,K),null,A,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),x.draw(l,h.LINE_STRIP,b,T,E,Qt.disabled,rc(g,d.aP.red),M,A,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function qa(m,t,s){const l=m.context,h=l.gl,g=m.colorModeForRenderPass(),x=new St(h.LEQUAL,St.ReadWrite,m.depthRangeFor3D),b=m.useProgram("terrain"),T=t.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,m.width,m.height]);for(const E of s){const A=m.renderToTexture.getTexture(E),M=t.getTerrainData(E.tileID);l.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,A.texture);const F={u_matrix:m.transform.calculatePosMatrix(E.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(m.transform.zoom)};b.draw(l,h.TRIANGLES,x,ii.disabled,g,Qt.backCCW,F,M,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}}class Mt{constructor(t,s){this.context=new gc(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Pe.maxUnderzooming+Pe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new hi}resize(t,s,l){if(this.width=Math.floor(t*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,s=new d.aW;s.emplaceBack(0,0),s.emplaceBack(d.W,0),s.emplaceBack(0,d.W),s.emplaceBack(d.W,d.W),this.tileExtentBuffer=t.createVertexBuffer(s,mr.members),this.tileExtentSegments=d.$.simpleSegment(0,0,4,2);const l=new d.aW;l.emplaceBack(0,0),l.emplaceBack(d.W,0),l.emplaceBack(0,d.W),l.emplaceBack(d.W,d.W),this.debugBuffer=t.createVertexBuffer(l,mr.members),this.debugSegments=d.$.simpleSegment(0,0,4,5);const h=new d.Z;h.emplaceBack(0,0,0,0),h.emplaceBack(d.W,0,d.W,0),h.emplaceBack(0,d.W,0,d.W),h.emplaceBack(d.W,d.W,d.W,d.W),this.rasterBoundsBuffer=t.createVertexBuffer(h,Jt.members),this.rasterBoundsSegments=d.$.simpleSegment(0,0,4,2);const g=new d.aW;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,mr.members),this.viewportSegments=d.$.simpleSegment(0,0,4,2);const x=new d.aX;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(x);const b=new d.aY;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);const T=this.context.gl;this.stencilClearMode=new ii({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.F();d.aO(l,0,this.width,this.height,0,0,1),d.J(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,St.disabled,this.stencilClearMode,di.disabled,Qt.disabled,th(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const l=this.context,h=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(di.disabled),l.setDepthMode(St.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of s){const b=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);g.draw(l,h.TRIANGLES,St.disabled,new ii({func:h.ALWAYS,mask:0},b,255,h.KEEP,h.KEEP,h.REPLACE),di.disabled,Qt.disabled,th(x.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new ii({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new ii({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,l=t.sort((x,b)=>b.overscaledZ-x.overscaledZ),h=l[l.length-1].overscaledZ,g=l[0].overscaledZ-h+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let b=0;b<g;b++)x[b+h]=new ii({func:s.GEQUAL,mask:255},b+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=g,[x,l]}return[{[h]:ii.disabled},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new di([t.CONSTANT_COLOR,t.ONE],new d.aP(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?di.unblended:di.alphaBlended}depthModeForSublayer(t,s,l){if(!this.opaquePassEnabledForLayer())return St.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new St(l||this.context.gl.LEQUAL,s,[h,h])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(X.now()),this.imageManager.beginFrame();const l=this.style._order,h=this.style.sourceCaches,g={},x={},b={};for(const T in h){const E=h[T];E.used&&E.prepare(this.context),g[T]=E.getVisibleCoordinates(),x[T]=g[T].slice().reverse(),b[T]=E.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<l.length;T++)if(this.style._layers[l[T]].is3D()){this.opaquePassCutoff=T;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const T of l){const E=this.style._layers[T];if(!E.hasOffscreenPass()||E.isHidden(this.transform.zoom))continue;const A=x[E.source];(E.type==="custom"||A.length)&&this.renderLayer(this,h[E.source],E,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?d.aP.black:d.aP.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[l[this.currentLayer]],E=h[T.source],A=g[T.source];this._renderTileClippingMasks(T,A),this.renderLayer(this,E,T,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const T=this.style._layers[l[this.currentLayer]],E=h[T.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(T))continue;const A=(T.type==="symbol"?b:x)[T.source];this._renderTileClippingMasks(T,g[T.source]),this.renderLayer(this,E,T,A)}if(this.options.showTileBoundaries){const T=function(E,A){let M=null;const F=Object.values(E._layers).flatMap(Z=>Z.source&&!Z.isHidden(A)?[E.sourceCaches[Z.source]]:[]),N=F.filter(Z=>Z.getSource().type==="vector"),U=F.filter(Z=>Z.getSource().type!=="vector"),K=Z=>{(!M||M.getSource().maxzoom<Z.getSource().maxzoom)&&(M=Z)};return N.forEach(Z=>K(Z)),M||U.forEach(Z=>K(Z)),M}(this.style,this.transform.zoom);T&&function(E,A,M){for(let F=0;F<M.length;F++)xh(E,A,M[F])}(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const E=T.transform.padding;vc(T,T.transform.height-(E.top||0),3,yo),vc(T,E.bottom||0,3,Ua),_o(T,E.left||0,3,$a),_o(T,T.transform.width-(E.right||0),3,Hs);const A=T.transform.centerPoint;(function(M,F,N,U){Dr(M,F-1,N-10,2,20,U),Dr(M,F-10,N-1,20,2,U)})(T,A.x,T.transform.height-A.y,Za)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=t?!d.aZ(s,l):!d.a_(s,l)),h||(h=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),h&&(d.a$(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(g,x){const b=g.context,T=b.gl,E=di.unblended,A=new St(T.LEQUAL,St.ReadWrite,[0,1]),M=x.getTerrainMesh(),F=x.sourceCache.getRenderableTiles(),N=g.useProgram("terrainDepth");b.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),b.clear({color:d.aP.transparent,depth:1});for(const U of F){const K=x.getTerrainData(U.tileID),Z={u_matrix:g.transform.calculatePosMatrix(U.tileID.toUnwrapped()),u_ele_delta:x.getMeshFrameDelta(g.transform.zoom)};N.draw(b,T.TRIANGLES,A,ii.disabled,E,Qt.backCCW,Z,K,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain),function(g,x){const b=g.context,T=b.gl,E=di.unblended,A=new St(T.LEQUAL,St.ReadWrite,[0,1]),M=x.getTerrainMesh(),F=x.getCoordsTexture(),N=x.sourceCache.getRenderableTiles(),U=g.useProgram("terrainCoords");b.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),b.clear({color:d.aP.transparent,depth:1}),x.coordsIndex=[];for(const K of N){const Z=x.getTerrainData(K.tileID);b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,F.texture);const J={u_matrix:g.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(g.transform.zoom)};U.draw(b,T.TRIANGLES,A,ii.disabled,E,Qt.backCCW,J,Z,"terrain",M.vertexBuffer,M.indexBuffer,M.segments),x.coordsIndex.push(K.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain))}renderLayer(t,s,l,h){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(h||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(g,x,b,T,E){if(g.renderPass!=="translucent")return;const A=ii.disabled,M=g.colorModeForRenderPass();(b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,N,U,K,Z,J,re,W,ae){const de=N.transform,fe=yn(),we=Z==="map",Ce=J==="map";for(const Ze of F){const qe=K.getTile(Ze),Ee=qe.getBucket(U);if(!Ee||!Ee.text||!Ee.text.segments.get().length)continue;const Ae=d.ag(Ee.textSizeData,de.zoom),Ke=ht(qe,1,N.transform.zoom),dt=Pr(Ze.posMatrix,Ce,we,N.transform,Ke),Le=U.layout.get("icon-text-fit")!=="none"&&Ee.hasIconData();if(Ae){const Ne=Math.pow(2,de.zoom-qe.tileID.overscaledZ),ct=N.style.map.terrain?(bt,It)=>N.style.map.terrain.getElevation(Ze,bt,It):null,Ht=fe.translatePosition(de,qe,re,W);Na(Ee,we,Ce,ae,de,dt,Ze.posMatrix,Ne,Ae,Le,fe,Ht,Ze.toUnwrapped(),ct)}}}(T,g,b,x,b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),E),b.paint.get("icon-opacity").constantOr(1)!==0&&Ws(g,x,b,T,!1,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),b.layout.get("icon-rotation-alignment"),b.layout.get("icon-pitch-alignment"),b.layout.get("icon-keep-upright"),A,M),b.paint.get("text-opacity").constantOr(1)!==0&&Ws(g,x,b,T,!0,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.layout.get("text-keep-upright"),A,M),x.map.showCollisionBoxes&&(gh(g,x,b,T,!0),gh(g,x,b,T,!1))})(t,s,l,h,this.style.placement.variableOffsets);break;case"circle":(function(g,x,b,T){if(g.renderPass!=="translucent")return;const E=b.paint.get("circle-opacity"),A=b.paint.get("circle-stroke-width"),M=b.paint.get("circle-stroke-opacity"),F=!b.layout.get("circle-sort-key").isConstant();if(E.constantOr(1)===0&&(A.constantOr(1)===0||M.constantOr(1)===0))return;const N=g.context,U=N.gl,K=g.depthModeForSublayer(0,St.ReadOnly),Z=ii.disabled,J=g.colorModeForRenderPass(),re=[];for(let W=0;W<T.length;W++){const ae=T[W],de=x.getTile(ae),fe=de.getBucket(b);if(!fe)continue;const we=fe.programConfigurations.get(b.id),Ce=g.useProgram("circle",we),Ze=fe.layoutVertexBuffer,qe=fe.indexBuffer,Ee=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ae),Ae={programConfiguration:we,program:Ce,layoutVertexBuffer:Ze,indexBuffer:qe,uniformValues:Pp(g,ae,de,b),terrainData:Ee};if(F){const Ke=fe.segments.get();for(const dt of Ke)re.push({segments:new d.$([dt]),sortKey:dt.sortKey,state:Ae})}else re.push({segments:fe.segments,sortKey:0,state:Ae})}F&&re.sort((W,ae)=>W.sortKey-ae.sortKey);for(const W of re){const{programConfiguration:ae,program:de,layoutVertexBuffer:fe,indexBuffer:we,uniformValues:Ce,terrainData:Ze}=W.state;de.draw(N,U.TRIANGLES,K,Z,J,Qt.disabled,Ce,Ze,b.id,fe,we,W.segments,b.paint,g.transform.zoom,ae)}})(t,s,l,h);break;case"heatmap":(function(g,x,b,T){if(b.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const E=g.context,A=E.gl,M=ii.disabled,F=new di([A.ONE,A.ONE],d.aP.transparent,[!0,!0,!0,!0]);(function(N,U,K){const Z=N.gl;N.activeTexture.set(Z.TEXTURE1),N.viewport.set([0,0,U.width/4,U.height/4]);let J=K.heatmapFbo;if(J)Z.bindTexture(Z.TEXTURE_2D,J.colorAttachment.get()),N.bindFramebuffer.set(J.framebuffer);else{const re=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,re),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),J=K.heatmapFbo=N.createFramebuffer(U.width/4,U.height/4,!1,!1),function(W,ae,de,fe){var we,Ce;const Ze=W.gl,qe=(we=W.HALF_FLOAT)!==null&&we!==void 0?we:Ze.UNSIGNED_BYTE,Ee=(Ce=W.RGBA16F)!==null&&Ce!==void 0?Ce:Ze.RGBA;Ze.texImage2D(Ze.TEXTURE_2D,0,Ee,ae.width/4,ae.height/4,0,Ze.RGBA,qe,null),fe.colorAttachment.set(de)}(N,U,re,J)}})(E,g,b),E.clear({color:d.aP.transparent});for(let N=0;N<T.length;N++){const U=T[N];if(x.hasRenderableParent(U))continue;const K=x.getTile(U),Z=K.getBucket(b);if(!Z)continue;const J=Z.programConfigurations.get(b.id),re=g.useProgram("heatmap",J),{zoom:W}=g.transform;re.draw(E,A.TRIANGLES,St.disabled,M,F,Qt.disabled,fo(U.posMatrix,K,W,b.paint.get("heatmap-intensity")),null,b.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,b.paint,g.transform.zoom,J)}E.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(E,A){const M=E.context,F=M.gl,N=A.heatmapFbo;if(!N)return;M.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,N.colorAttachment.get()),M.activeTexture.set(F.TEXTURE1);let U=A.colorRampTexture;U||(U=A.colorRampTexture=new pt(M,A.colorRamp,F.RGBA)),U.bind(F.LINEAR,F.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(M,F.TRIANGLES,St.disabled,ii.disabled,E.colorModeForRenderPass(),Qt.disabled,((K,Z,J,re)=>{const W=d.F();d.aO(W,0,K.width,K.height,0,0,1);const ae=K.context.gl;return{u_matrix:W,u_world:[ae.drawingBufferWidth,ae.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Z.paint.get("heatmap-opacity")}})(E,A),null,A.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,A.paint,E.transform.zoom)}(g,b))})(t,s,l,h);break;case"line":(function(g,x,b,T){if(g.renderPass!=="translucent")return;const E=b.paint.get("line-opacity"),A=b.paint.get("line-width");if(E.constantOr(1)===0||A.constantOr(1)===0)return;const M=g.depthModeForSublayer(0,St.ReadOnly),F=g.colorModeForRenderPass(),N=b.paint.get("line-dasharray"),U=b.paint.get("line-pattern"),K=U.constantOr(1),Z=b.paint.get("line-gradient"),J=b.getCrossfadeParameters(),re=K?"linePattern":N?"lineSDF":Z?"lineGradient":"line",W=g.context,ae=W.gl;let de=!0;for(const fe of T){const we=x.getTile(fe);if(K&&!we.patternsLoaded())continue;const Ce=we.getBucket(b);if(!Ce)continue;const Ze=Ce.programConfigurations.get(b.id),qe=g.context.program.get(),Ee=g.useProgram(re,Ze),Ae=de||Ee.program!==qe,Ke=g.style.map.terrain&&g.style.map.terrain.getTerrainData(fe),dt=U.constantOr(null);if(dt&&we.imageAtlas){const ct=we.imageAtlas,Ht=ct.patternPositions[dt.to.toString()],bt=ct.patternPositions[dt.from.toString()];Ht&&bt&&Ze.setConstantPatternPositions(Ht,bt)}const Le=Ke?fe:null,Ne=K?oc(g,we,b,J,Le):N?Da(g,we,b,N,J,Le):Z?Dn(g,we,b,Ce.lineClipsArray.length,Le):on(g,we,b,Le);if(K)W.activeTexture.set(ae.TEXTURE0),we.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Ze.updatePaintBuffers(J);else if(N&&(Ae||g.lineAtlas.dirty))W.activeTexture.set(ae.TEXTURE0),g.lineAtlas.bind(W);else if(Z){const ct=Ce.gradients[b.id];let Ht=ct.texture;if(b.gradientVersion!==ct.version){let bt=256;if(b.stepInterpolant){const It=x.getSource().maxzoom,Kt=fe.canonical.z===It?Math.ceil(1<<g.transform.maxZoom-fe.canonical.z):1;bt=d.ac(d.aU(Ce.maxLineLength/d.W*1024*Kt),256,W.maxTextureSize)}ct.gradient=d.aV({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:bt,image:ct.gradient||void 0,clips:Ce.lineClipsArray}),ct.texture?ct.texture.update(ct.gradient):ct.texture=new pt(W,ct.gradient,ae.RGBA),ct.version=b.gradientVersion,Ht=ct.texture}W.activeTexture.set(ae.TEXTURE0),Ht.bind(b.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}Ee.draw(W,ae.TRIANGLES,M,g.stencilModeForClipping(fe),F,Qt.disabled,Ne,Ke,b.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,b.paint,g.transform.zoom,Ze,Ce.layoutVertexBuffer2),de=!1}})(t,s,l,h);break;case"fill":(function(g,x,b,T){const E=b.paint.get("fill-color"),A=b.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const M=g.colorModeForRenderPass(),F=b.paint.get("fill-pattern"),N=g.opaquePassEnabledForLayer()&&!F.constantOr(1)&&E.constantOr(d.aP.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===N){const U=g.depthModeForSublayer(1,g.renderPass==="opaque"?St.ReadWrite:St.ReadOnly);go(g,x,b,T,U,M,!1)}if(g.renderPass==="translucent"&&b.paint.get("fill-antialias")){const U=g.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,St.ReadOnly);go(g,x,b,T,U,M,!0)}})(t,s,l,h);break;case"fill-extrusion":(function(g,x,b,T){const E=b.paint.get("fill-extrusion-opacity");if(E!==0&&g.renderPass==="translucent"){const A=new St(g.context.gl.LEQUAL,St.ReadWrite,g.depthRangeFor3D);if(E!==1||b.paint.get("fill-extrusion-pattern").constantOr(1))_n(g,x,b,T,A,ii.disabled,di.disabled),_n(g,x,b,T,A,g.stencilModeFor3D(),g.colorModeForRenderPass());else{const M=g.colorModeForRenderPass();_n(g,x,b,T,A,ii.disabled,M)}}})(t,s,l,h);break;case"hillshade":(function(g,x,b,T){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const E=g.context,A=g.depthModeForSublayer(0,St.ReadOnly),M=g.colorModeForRenderPass(),[F,N]=g.renderPass==="translucent"?g.stencilConfigForOverlap(T):[{},T];for(const U of N){const K=x.getTile(U);K.needsHillshadePrepare!==void 0&&K.needsHillshadePrepare&&g.renderPass==="offscreen"?vh(g,K,b,A,ii.disabled,M):g.renderPass==="translucent"&&_h(g,U,K,b,A,F[U.overscaledZ],M)}E.viewport.set([0,0,g.width,g.height])})(t,s,l,h);break;case"raster":(function(g,x,b,T){if(g.renderPass!=="translucent"||b.paint.get("raster-opacity")===0||!T.length)return;const E=g.context,A=E.gl,M=x.getSource(),F=g.useProgram("raster"),N=g.colorModeForRenderPass(),[U,K]=M instanceof Cr?[{},T]:g.stencilConfigForOverlap(T),Z=K[K.length-1].overscaledZ,J=!g.options.moving;for(const re of K){const W=g.depthModeForSublayer(re.overscaledZ-Z,b.paint.get("raster-opacity")===1?St.ReadWrite:St.ReadOnly,A.LESS),ae=x.getTile(re);ae.registerFadeDuration(b.paint.get("raster-fade-duration"));const de=x.findLoadedParent(re,0),fe=x.findLoadedSibling(re),we=_c(ae,de||fe||null,x,b,g.transform,g.style.map.terrain);let Ce,Ze;const qe=b.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;E.activeTexture.set(A.TEXTURE0),ae.texture.bind(qe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(A.TEXTURE1),de?(de.texture.bind(qe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),Ce=Math.pow(2,de.tileID.overscaledZ-ae.tileID.overscaledZ),Ze=[ae.tileID.canonical.x*Ce%1,ae.tileID.canonical.y*Ce%1]):ae.texture.bind(qe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);const Ee=g.style.map.terrain&&g.style.map.terrain.getTerrainData(re),Ae=Ee?re:null,Ke=Ae?Ae.posMatrix:g.transform.calculatePosMatrix(re.toUnwrapped(),J),dt=Ho(Ke,Ze||[0,0],Ce||1,we,b);M instanceof Cr?F.draw(E,A.TRIANGLES,W,ii.disabled,N,Qt.disabled,dt,Ee,b.id,M.boundsBuffer,g.quadTriangleIndexBuffer,M.boundsSegments):F.draw(E,A.TRIANGLES,W,U[re.overscaledZ],N,Qt.disabled,dt,Ee,b.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}})(t,s,l,h);break;case"background":(function(g,x,b,T){const E=b.paint.get("background-color"),A=b.paint.get("background-opacity");if(A===0)return;const M=g.context,F=M.gl,N=g.transform,U=N.tileSize,K=b.paint.get("background-pattern");if(g.isPatternMissing(K))return;const Z=!K&&E.a===1&&A===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==Z)return;const J=ii.disabled,re=g.depthModeForSublayer(0,Z==="opaque"?St.ReadWrite:St.ReadOnly),W=g.colorModeForRenderPass(),ae=g.useProgram(K?"backgroundPattern":"background"),de=T||N.coveringTiles({tileSize:U,terrain:g.style.map.terrain});K&&(M.activeTexture.set(F.TEXTURE0),g.imageManager.bind(g.context));const fe=b.getCrossfadeParameters();for(const we of de){const Ce=T?we.posMatrix:g.transform.calculatePosMatrix(we.toUnwrapped()),Ze=K?Lp(Ce,A,g,K,{tileID:we,tileSize:U},fe):Dp(Ce,A,E),qe=g.style.map.terrain&&g.style.map.terrain.getTerrainData(we);ae.draw(M,F.TRIANGLES,re,J,W,Qt.disabled,Ze,qe,b.id,g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}})(t,0,l,h);break;case"custom":(function(g,x,b){const T=g.context,E=b.implementation;if(g.renderPass==="offscreen"){const A=E.prerender;A&&(g.setCustomLayerDefaults(),T.setColorMode(g.colorModeForRenderPass()),A.call(E,T.gl,g.transform.customLayerMatrix()),T.setDirty(),g.setBaseState())}else if(g.renderPass==="translucent"){g.setCustomLayerDefaults(),T.setColorMode(g.colorModeForRenderPass()),T.setStencilMode(ii.disabled);const A=E.renderingMode==="3d"?new St(g.context.gl.LEQUAL,St.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,St.ReadOnly);T.setDepthMode(A),E.render(T.gl,g.transform.customLayerMatrix()),T.setDirty(),g.setBaseState(),T.bindFramebuffer.set(null)}})(t,0,l)}}translatePosMatrix(t,s,l,h,g){if(!l[0]&&!l[1])return t;const x=g?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(x){const E=Math.sin(x),A=Math.cos(x);l=[l[0]*A-l[1]*E,l[0]*E+l[1]*A]}const b=[g?l[0]:ht(s,l[0],this.transform.zoom),g?l[1]:ht(s,l[1],this.transform.zoom),0],T=new Float32Array(16);return d.H(T,t,b),T}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!s||!l}useProgram(t,s){this.cache=this.cache||{};const l=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new ic(this.context,Go[t],s,La[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new pt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}class Yo{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,l){const h=Math.pow(2,l),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const T=1/(b=d.af([],b,t))[3]/s*h;return d.b0(b,b,[T,T,1/b[3],T])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const T=function(F,N){var U=N[0],K=N[1],Z=N[2],J=U*U+K*K+Z*Z;return J>0&&(J=1/Math.sqrt(J)),F[0]=N[0]*J,F[1]=N[1]*J,F[2]=N[2]*J,F}([],function(F,N,U){var K=N[0],Z=N[1],J=N[2],re=U[0],W=U[1],ae=U[2];return F[0]=Z*ae-J*W,F[1]=J*re-K*ae,F[2]=K*W-Z*re,F}([],$e([],g[b[0]],g[b[1]]),$e([],g[b[2]],g[b[1]]))),E=-((A=T)[0]*(M=g[b[1]])[0]+A[1]*M[1]+A[2]*M[2]);var A,M;return T.concat(E)});return new Yo(g,x)}}class Ga{constructor(t,s){this.min=t,this.max=s,this.center=function(l,h,g){return l[0]=.5*h[0],l[1]=.5*h[1],l[2]=.5*h[2],l}([],function(l,h,g){return l[0]=h[0]+g[0],l[1]=h[1]+g[1],l[2]=h[2]+g[2],l}([],this.min,this.max))}quadrant(t){const s=[t%2==0,t<2],l=Be(this.min),h=Be(this.max);for(let g=0;g<s.length;g++)l[g]=s[g]?this.min[g]:this.center[g],h[g]=s[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new Ga(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let h=0;h<t.planes.length;h++){const g=t.planes[h];let x=0;for(let b=0;b<s.length;b++)d.b1(g,s[b])>=0&&x++;if(x===0)return 0;x!==s.length&&(l=!1)}if(l)return 2;for(let h=0;h<3;h++){let g=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let b=0;b<t.points.length;b++){const T=t.points[b][h]-this.min[h];g=Math.min(g,T),x=Math.max(x,T)}if(x<0||g>this.max[h]-this.min[h])return 0}return 1}}class Ks{constructor(t=0,s=0,l=0,h=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=l,this.right=h}interpolate(t,s,l){return s.top!=null&&t.top!=null&&(this.top=d.z.number(t.top,s.top,l)),s.bottom!=null&&t.bottom!=null&&(this.bottom=d.z.number(t.bottom,s.bottom,l)),s.left!=null&&t.left!=null&&(this.left=d.z.number(t.left,s.left,l)),s.right!=null&&t.right!=null&&(this.right=d.z.number(t.right,s.right,l)),this}getCenter(t,s){const l=d.ac((this.left+t-this.right)/2,0,t),h=d.ac((this.top+s-this.bottom)/2,0,s);return new d.P(l,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ks(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Jo=85.051129;class xc{constructor(t,s,l,h,g){this.tileSize=512,this._renderWorldCopies=g===void 0||!!g,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=h??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ks,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new xc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-d.b2(t,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var l=new d.A(4);return d.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,h,g){var x=h[0],b=h[1],T=h[2],E=h[3],A=Math.sin(g),M=Math.cos(g);l[0]=x*M+T*A,l[1]=b*M+E*A,l[2]=x*-A+T*M,l[3]=b*-A+E*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=d.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,l){this._unmodified=!1,this._edgeInsets.interpolate(t,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new d.b3(0,t)];if(this._renderWorldCopies){const l=this.pointCoordinate(new d.P(0,0)),h=this.pointCoordinate(new d.P(this.width,0)),g=this.pointCoordinate(new d.P(this.width,this.height)),x=this.pointCoordinate(new d.P(0,this.height)),b=Math.floor(Math.min(l.x,h.x,g.x,x.x)),T=Math.floor(Math.max(l.x,h.x,g.x,x.x)),E=1;for(let A=b-E;A<=T+E;A++)A!==0&&s.push(new d.b3(A,t))}return s}coveringTiles(t){var s,l;let h=this.coveringZoomLevel(t);const g=h;if(t.minzoom!==void 0&&h<t.minzoom)return[];t.maxzoom!==void 0&&h>t.maxzoom&&(h=t.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),b=d.Y.fromLngLat(this.center),T=Math.pow(2,h),E=[T*x.x,T*x.y,0],A=[T*b.x,T*b.y,0],M=Yo.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,h);let F=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=h);const N=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,U=W=>({aabb:new Ga([W*T,0,0],[(W+1)*T,T,0]),zoom:0,x:0,y:0,wrap:W,fullyVisible:!1}),K=[],Z=[],J=h,re=t.reparseOverscaled?g:h;if(this._renderWorldCopies)for(let W=1;W<=3;W++)K.push(U(-W)),K.push(U(W));for(K.push(U(0));K.length>0;){const W=K.pop(),ae=W.x,de=W.y;let fe=W.fullyVisible;if(!fe){const Ee=W.aabb.intersects(M);if(Ee===0)continue;fe=Ee===2}const we=t.terrain?E:A,Ce=W.aabb.distanceX(we),Ze=W.aabb.distanceY(we),qe=Math.max(Math.abs(Ce),Math.abs(Ze));if(W.zoom===J||qe>N+(1<<J-W.zoom)-2&&W.zoom>=F){const Ee=J-W.zoom,Ae=E[0]-.5-(ae<<Ee),Ke=E[1]-.5-(de<<Ee);Z.push({tileID:new d.Q(W.zoom===J?re:W.zoom,W.wrap,W.zoom,ae,de),distanceSq:Xe([A[0]-.5-ae,A[1]-.5-de]),tileDistanceToCamera:Math.sqrt(Ae*Ae+Ke*Ke)})}else for(let Ee=0;Ee<4;Ee++){const Ae=(ae<<1)+Ee%2,Ke=(de<<1)+(Ee>>1),dt=W.zoom+1;let Le=W.aabb.quadrant(Ee);if(t.terrain){const Ne=new d.Q(dt,W.wrap,dt,Ae,Ke),ct=t.terrain.getMinMaxElevation(Ne),Ht=(s=ct.minElevation)!==null&&s!==void 0?s:this.elevation,bt=(l=ct.maxElevation)!==null&&l!==void 0?l:this.elevation;Le=new Ga([Le.min[0],Le.min[1],Ht],[Le.max[0],Le.max[1],bt])}K.push({aabb:Le,zoom:dt,x:Ae,y:Ke,wrap:W.wrap,fullyVisible:fe})}}return Z.sort((W,ae)=>W.distanceSq-ae.distanceSq).map(W=>W.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=d.ac(t.lat,-85.051129,Jo);return new d.P(d.N(t.lng)*this.worldSize,d.O(s)*this.worldSize)}unproject(t){return new d.Y(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,h=this.pointLocation(this.centerPoint,t),g=t.getElevationForLngLatZoom(h,this.tileZoom);if(!(this.elevation-g))return;const x=l+s-g,b=Math.cos(this._pitch)*this.cameraToCenterDistance/x/d.b4(1,h.lat),T=this.scaleZoom(b/this.tileSize);this._elevation=g,this._center=h,this.zoom=T}setLocationAtPoint(t,s){const l=this.pointCoordinate(s),h=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(t),x=new d.Y(g.x-(l.x-h.x),g.y-(l.y-h.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),s.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return d.Y.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const F=s.pointCoordinate(t);if(F!=null)return F}const l=[t.x,t.y,0,1],h=[t.x,t.y,1,1];d.af(l,l,this.pixelMatrixInverse),d.af(h,h,this.pixelMatrixInverse);const g=l[3],x=h[3],b=l[1]/g,T=h[1]/x,E=l[2]/g,A=h[2]/x,M=E===A?0:(0-E)/(A-E);return new d.Y(d.z.number(l[0]/g,h[0]/x,M)/this.worldSize,d.z.number(b,T,M)/this.worldSize)}coordinatePoint(t,s=0,l=this.pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,s,1];return d.af(h,h,l),new d.P(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new xi().extend(this.pointLocation(new d.P(0,t))).extend(this.pointLocation(new d.P(this.width,t))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new xi([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Jo])}calculatePosMatrix(t,s=!1){const l=t.key,h=s?this._alignedPosMatrixCache:this._posMatrixCache;if(h[l])return h[l];const g=t.canonical,x=this.worldSize/this.zoomScale(g.z),b=g.x+Math.pow(2,g.z)*t.wrap,T=d.an(new Float64Array(16));return d.H(T,T,[b*x,g.y*x,0]),d.J(T,T,[x/d.W,x/d.W,1]),d.K(T,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,T),h[l]=new Float32Array(T),h[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,s){s=d.ac(+s,this.minZoom,this.maxZoom);const l={center:new d.M(t.lng,t.lat),zoom:s};let h=this.lngRange;if(!this._renderWorldCopies&&h===null){const W=179.9999999999;h=[-W,W]}const g=this.tileSize*this.zoomScale(l.zoom);let x=0,b=g,T=0,E=g,A=0,M=0;const{x:F,y:N}=this.size;if(this.latRange){const W=this.latRange;x=d.O(W[1])*g,b=d.O(W[0])*g,b-x<N&&(A=N/(b-x))}h&&(T=d.b2(d.N(h[0])*g,0,g),E=d.b2(d.N(h[1])*g,0,g),E<T&&(E+=g),E-T<F&&(M=F/(E-T)));const{x:U,y:K}=this.project.call({worldSize:g},t);let Z,J;const re=Math.max(M||0,A||0);if(re){const W=new d.P(M?(E+T)/2:U,A?(b+x)/2:K);return l.center=this.unproject.call({worldSize:g},W).wrap(),l.zoom+=this.scaleZoom(re),l}if(this.latRange){const W=N/2;K-W<x&&(J=x+W),K+W>b&&(J=b-W)}if(h){const W=(T+E)/2;let ae=U;this._renderWorldCopies&&(ae=d.b2(U,W-g/2,W+g/2));const de=F/2;ae-de<T&&(Z=T+de),ae+de>E&&(Z=E-de)}if(Z!==void 0||J!==void 0){const W=new d.P(Z??U,J??K);l.center=this.unproject.call({worldSize:g},W).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b4(1,this.center.lat)*this.worldSize;let h=d.an(new Float64Array(16));d.J(h,h,[this.width/2,-this.height/2,1]),d.H(h,h,[1,-1,0]),this.labelPlaneMatrix=h,h=d.an(new Float64Array(16)),d.J(h,h,[1,-1,1]),d.H(h,h,[-1,-1,0]),d.J(h,h,[2/this.width,2/this.height,1]),this.glCoordMatrix=h;const g=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this.minElevationForCurrentTile),b=g-x*this._pixelPerMeter/Math.cos(this._pitch),T=x<0?b:g,E=Math.PI/2+this._pitch,A=this._fov*(.5+t.y/this.height),M=Math.sin(A)*T/Math.sin(d.ac(Math.PI-E-A,.01,Math.PI-.01)),F=this.getHorizon(),N=2*Math.atan(F/this.cameraToCenterDistance)*(.5+t.y/(2*F)),U=Math.sin(N)*T/Math.sin(d.ac(Math.PI-E-N,.01,Math.PI-.01)),K=Math.min(M,U),Z=1.01*(Math.cos(Math.PI/2-this._pitch)*K+T),J=this.height/50;h=new Float64Array(16),d.b5(h,this._fov,this.width/this.height,J,Z),h[8]=2*-t.x/this.width,h[9]=2*t.y/this.height,d.J(h,h,[1,-1,1]),d.H(h,h,[0,0,-this.cameraToCenterDistance]),d.b6(h,h,this._pitch),d.ad(h,h,this.angle),d.H(h,h,[-s,-l,0]),this.mercatorMatrix=d.J([],h,[this.worldSize,this.worldSize,this.worldSize]),d.J(h,h,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.K(new Float64Array(16),this.labelPlaneMatrix,h),d.H(h,h,[0,0,-this.elevation]),this.modelViewProjectionMatrix=h,this.invModelViewProjectionMatrix=d.as([],h),this.pixelMatrix3D=d.K(new Float64Array(16),this.labelPlaneMatrix,h);const re=this.width%2/2,W=this.height%2/2,ae=Math.cos(this.angle),de=Math.sin(this.angle),fe=s-Math.round(s)+ae*re+de*W,we=l-Math.round(l)+ae*W+de*re,Ce=new Float64Array(h);if(d.H(Ce,Ce,[fe>.5?fe-1:fe,we>.5?we-1:we,0]),this.alignedModelViewProjectionMatrix=Ce,h=d.as(new Float64Array(16),this.pixelMatrix),!h)throw new Error("failed to invert matrix");this.pixelMatrixInverse=h,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new d.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return d.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let l=s.x,h=s.y,g=s.x,x=s.y;for(const b of t)l=Math.min(l,b.x),h=Math.min(h,b.y),g=Math.max(g,b.x),x=Math.max(x,b.y);return[new d.P(l,h),new d.P(g,h),new d.P(g,x),new d.P(l,x),new d.P(l,h)]}}lngLatToCameraDepth(t,s){const l=this.locationCoordinate(t),h=[l.x*this.worldSize,l.y*this.worldSize,s,1];return d.af(h,h,this.modelViewProjectionMatrix),h[2]/h[3]}}function wh(m,t){let s,l=!1,h=null,g=null;const x=()=>{h=null,l&&(m.apply(g,s),h=setTimeout(x,t),l=!1)};return(...b)=>(l=!0,g=this,s=b,h||x(),h)}class wc{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(l=h)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}},this._updateHash=wh(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),x=Math.round(s.lng*g)/g,b=Math.round(s.lat*g)/g,T=this._map.getBearing(),E=this._map.getPitch();let A="";if(A+=t?`/${x}/${b}/${l}`:`${l}/${b}/${x}`,(T||E)&&(A+="/"+Math.round(10*T)/10),E&&(A+=`/${Math.round(E)}`),this._hashName){const M=this._hashName;let F=!1;const N=window.location.hash.slice(1).split("&").map(U=>{const K=U.split("=")[0];return K===M?(F=!0,`${K}=${A}`):U}).filter(U=>U);return F||N.push(`${M}=${A}`),`#${N.join("&")}`}return`#${A}`}}const Wa={linearity:.3,easing:d.b7(0,0,.3,1)},bc=d.e({deceleration:2500,maxSpeed:1400},Wa),Ha=d.e({deceleration:20,maxSpeed:1400},Wa),Ka=d.e({deceleration:1e3,maxSpeed:360},Wa),Sc=d.e({deceleration:1e3,maxSpeed:90},Wa);class Tc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:X.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=X.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(s.pan.mag()){const g=vo(s.pan.mag(),l,d.e({},bc,t||{}));h.offset=s.pan.mult(g.amount/s.pan.mag()),h.center=this._map.transform.center,Xs(h,g)}if(s.zoom){const g=vo(s.zoom,l,Ha);h.zoom=this._map.transform.zoom+g.amount,Xs(h,g)}if(s.bearing){const g=vo(s.bearing,l,Ka);h.bearing=this._map.transform.bearing+d.ac(g.amount,-179,179),Xs(h,g)}if(s.pitch){const g=vo(s.pitch,l,Sc);h.pitch=this._map.transform.pitch+g.amount,Xs(h,g)}if(h.zoom||h.bearing){const g=s.pinchAround===void 0?s.around:s.pinchAround;h.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),d.e(h,{noMoveStart:!0})}}function Xs(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function vo(m,t,s){const{maxSpeed:l,linearity:h,deceleration:g}=s,x=d.ac(m*h/(t/1e3),-l,l),b=Math.abs(x)/(g*h);return{easing:s.easing,duration:1e3*b,amount:x*(b/2)}}class Zi extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l,h={}){const g=V.mousePos(s.getCanvas(),l),x=s.unproject(g);super(t,d.e({point:g,lngLat:x,originalEvent:l},h)),this._defaultPrevented=!1,this.target=s}}class xo extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l){const h=t==="touchend"?l.changedTouches:l.touches,g=V.touchPos(s.getCanvasContainer(),h),x=g.map(T=>s.unproject(T)),b=g.reduce((T,E,A,M)=>T.add(E.div(M.length)),new d.P(0,0));super(t,{points:g,point:b,lngLats:x,lngLat:s.unproject(b),originalEvent:l}),this._defaultPrevented=!1}}class bh extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class kc{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new bh(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Zi(t.type,this._map,t))}mouseup(t){this._map.fire(new Zi(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Zi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Zi(t.type,this._map,t))}mouseover(t){this._map.fire(new Zi(t.type,this._map,t))}mouseout(t){this._map.fire(new Zi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new xo(t.type,this._map,t))}touchmove(t){this._map.fire(new xo(t.type,this._map,t))}touchend(t){this._map.fire(new xo(t.type,this._map,t))}touchcancel(t){this._map.fire(new xo(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qp{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Zi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Zi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Zi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qo{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(d.P.convert(t),this._map.terrain)}}class Ys{constructor(t,s){this._map=t,this._tr=new Qo(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(V.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=V.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(h.x,l.x),x=Math.max(h.x,l.x),b=Math.min(h.y,l.y),T=Math.max(h.y,l.y);V.setTransform(this._box,`translate(${g}px,${b}px)`),this._box.style.width=x-g+"px",this._box.style.height=T-b+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const l=this._startPos,h=s;if(this.reset(),V.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new d.k(t,{originalEvent:s}))}}function Js(m,t){if(m.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${t.length}`);const s={};for(let l=0;l<m.length;l++)s[m[l].identifier]=t[l];return s}class Sh{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){const g=new d.P(0,0);for(const x of h)g._add(x);return g.div(h.length)}(s),this.touches=Js(l,s)))}touchmove(t,s,l){if(this.aborted||!this.centroid)return;const h=Js(l,s);for(const g in this.touches){const x=h[g];(!x||x.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,s,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class Xa{constructor(t){this.singleTap=new Sh(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,l){this.singleTap.touchstart(t,s,l)}touchmove(t,s,l){this.singleTap.touchmove(t,s,l)}touchend(t,s,l){const h=this.singleTap.touchend(t,s,l);if(h){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(h)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class Ya{constructor(t){this._tr=new Qo(t),this._zoomIn=new Xa({numTouches:1,numTaps:2}),this._zoomOut=new Xa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,l){this._zoomIn.touchstart(t,s,l),this._zoomOut.touchstart(t,s,l)}touchmove(t,s,l){this._zoomIn.touchmove(t,s,l),this._zoomOut.touchmove(t,s,l)}touchend(t,s,l){const h=this._zoomIn.touchend(t,s,l),g=this._zoomOut.touchend(t,s,l),x=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(h)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wo{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=s.length?s[0]:s;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&V.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Gp={0:1,2:2};class Ja{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=V.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(s,l){const h=Gp[l];return s.buttons===void 0||(s.buttons&h)!==h}(t,this._eventButton)}isValidEndEvent(t){return V.mouseButton(t)===this._eventButton}}class si{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Lr=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=t=>{t.preventDefault()}},Rn=({enable:m,clickTolerance:t,bearingDegreesPerPixelMoved:s=.8})=>{const l=new Ja({checkCorrectEvent:h=>V.mouseButton(h)===0&&h.ctrlKey||V.mouseButton(h)===2});return new wo({clickTolerance:t,move:(h,g)=>({bearingDelta:(g.x-h.x)*s}),moveStateManager:l,enable:m,assignEvents:Lr})},Qa=({enable:m,clickTolerance:t,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new Ja({checkCorrectEvent:h=>V.mouseButton(h)===0&&h.ctrlKey||V.mouseButton(h)===2});return new wo({clickTolerance:t,move:(h,g)=>({pitchDelta:(g.y-h.y)*s}),moveStateManager:l,enable:m,assignEvents:Lr})};class Ic{constructor(t,s){this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,s,l){return this._calculateTransform(t,s,l)}touchmove(t,s,l){if(this._active&&!(l.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,s,l)}touchend(t,s,l){this._calculateTransform(t,s,l),this._active&&l.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,l){l.length>0&&(this._active=!0);const h=Js(l,s),g=new d.P(0,0),x=new d.P(0,0);let b=0;for(const E in h){const A=h[E],M=this._touches[E];M&&(g._add(A),x._add(A.sub(M)),b++,h[E]=A)}if(this._touches=h,b<this.minTouchs()||!x.mag())return;const T=x.div(b);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(b),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class el{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,l){if(!this._firstTwoTouches)return;t.preventDefault();const[h,g]=this._firstTwoTouches,x=Rr(l,s,h),b=Rr(l,s,g);if(!x||!b)return;const T=this._aroundCenter?null:x.add(b).div(2);return this._move([x,b],T,t)}touchend(t,s,l){if(!this._firstTwoTouches)return;const[h,g]=this._firstTwoTouches,x=Rr(l,s,h),b=Rr(l,s,g);x&&b||(this._active&&V.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Rr(m,t,s){for(let l=0;l<m.length;l++)if(m[l].identifier===s)return t[l]}function es(m,t){return Math.log(m/t)/Math.LN2}class tl extends el{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(es(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:es(this._distance,l),pinchAround:s}}}function Cc(m,t){return 180*m.angleWith(t)/Math.PI}class Ec extends el{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s,l){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Cc(this._vector,h),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,l=Cc(t,this._startVector);return Math.abs(l)<s}}function il(m){return Math.abs(m.y)>Math.abs(m.x)}class Pc extends el{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,l){super.touchstart(t,s,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,il(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),g=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,g,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,l){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,g=s.mag()>=2;if(!h&&!g)return;if(!h||!g)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const x=t.y>0==s.y>0;return il(t)&&il(s)&&x}}const Th={panStep:100,bearingStep:15,pitchStep:10};class Kr{constructor(t){this._tr=new Qo(t);const s=Th;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,l=0,h=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:b=>{const T=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:kh,zoom:s?Math.round(T.zoom)+s*(t.shiftKey?2:1):T.zoom,bearing:T.bearing+l*this._bearingStep,pitch:T.pitch+h*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:T.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kh(m){return m*(2-m)}const Mc=4.000244140625;class Ac{constructor(t,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new Qo(t),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=X.now(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%Mc==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=V.mousePos(this._map.getCanvas(),t),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?d.M.convert(this._aroundCenter?l.center:l.unproject(s)):d.M.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>Mc?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&T!==0&&(T=1/T);const E=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(E*T))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,l=this._startZoom,h=this._easing;let g,x=!1;if(this._type==="wheel"&&l&&h){const b=Math.min((X.now()-this._lastWheelEventTime)/200,1),T=h(b);g=d.z.number(l,s,T),b<1?this._frameId||(this._frameId=!0):x=!0}else g=s,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:g-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=d.b8;if(this._prevEase){const l=this._prevEase,h=(X.now()-l.start)/l.duration,g=l.easing(h+.01)-l.easing(h),x=.27/Math.sqrt(g*g+1e-4)*.01,b=Math.sqrt(.0729-x*x);s=d.b7(x,b,.25,1)}return this._prevEase={start:X.now(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class zc{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ih{constructor(t){this._tr=new Qo(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ch{constructor(){this._tap=new Xa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,l){if(!this._swipePoint)if(this._tapTime){const h=s[0],g=t.timeStamp-this._tapTime<500,x=this._tapPoint.dist(h)<30;g&&x?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,s,l)}touchmove(t,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=s[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,s,l)}touchend(t,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(t,s,l);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dc{constructor(t,s,l){this._el=t,this._mousePan=s,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ts{constructor(t,s,l){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Lc{constructor(t,s,l,h){this._el=t,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class qn{constructor(t,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=V.create("div","maplibregl-cooperative-gesture-screen",t);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=s,this._container.appendChild(h);const g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=l,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(V.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){this._enabled&&t&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Fn=m=>m.zoom||m.drag||m.pitch||m.rotate;class Eh extends d.k{}function Gn(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Qs{constructor(t,s){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,g)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=h.type==="renderFrame"?void 0:h,b={needsRenderFrame:!1},T={},E={},A=h.touches,M=A?this._getMapTouches(A):void 0,F=M?V.touchPos(this._map.getCanvas(),M):V.mousePos(this._map.getCanvas(),h);for(const{handlerName:K,handler:Z,allowed:J}of this._handlers){if(!Z.isEnabled())continue;let re;this._blockedByActive(E,J,K)?Z.reset():Z[g||h.type]&&(re=Z[g||h.type](h,F,M),this.mergeHandlerResult(b,T,re,K,x),re&&re.needsRenderFrame&&this._triggerRenderFrame()),(re||Z.isActive())&&(E[K]=Z)}const N={};for(const K in this._previousActiveHandlers)E[K]||(N[K]=x);this._previousActiveHandlers=E,(Object.keys(N).length||Gn(b))&&(this._changes.push([b,T,N]),this._triggerRenderFrame()),(Object.keys(E).length||Gn(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=b;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tc(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,g,x]of this._listeners)V.addEventListener(h,g,h===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,s,l]of this._listeners)V.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new kc(s,t));const h=s.boxZoom=new Ys(s,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const g=s.cooperativeGestures=new qn(s,t.cooperativeGestures);this._add("cooperativeGestures",g),t.cooperativeGestures&&g.enable();const x=new Ya(s),b=new Ih(s);s.doubleClickZoom=new zc(b,x),this._add("tapZoom",x),this._add("clickZoom",b),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const T=new Ch;this._add("tapDragZoom",T);const E=s.touchPitch=new Pc(s);this._add("touchPitch",E),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const A=Rn(t),M=Qa(t);s.dragRotate=new ts(t,A,M),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const F=(({enable:re,clickTolerance:W})=>{const ae=new Ja({checkCorrectEvent:de=>V.mouseButton(de)===0&&!de.ctrlKey});return new wo({clickTolerance:W,move:(de,fe)=>({around:fe,panDelta:fe.sub(de)}),activateOnStart:!0,moveStateManager:ae,enable:re,assignEvents:Lr})})(t),N=new Ic(t,s);s.dragPan=new Dc(l,F,N),this._add("mousePan",F),this._add("touchPan",N,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const U=new Ec,K=new tl;s.touchZoomRotate=new Lc(l,K,U,T),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate);const Z=s.scrollZoom=new Ac(s,()=>this._triggerRenderFrame());this._add("scrollZoom",Z,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const J=s.keyboard=new Kr(s);this._add("keyboard",J),t.interactive&&t.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new qp(s))}_add(t,s,l){this._handlers.push({handlerName:t,handler:s,allowed:l}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fn(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,l){for(const h in t)if(h!==l&&(!s||s.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const l of t)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(t,s,l,h,g){if(!l)return;d.e(t,l);const x={handlerName:h,originalEvent:l.originalEvent||g};l.zoomDelta!==void 0&&(s.zoom=x),l.panDelta!==void 0&&(s.drag=x),l.pitchDelta!==void 0&&(s.pitch=x),l.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const t={},s={},l={};for(const[h,g,x]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new d.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),d.e(s,g),d.e(l,x);this._updateMapTransform(t,s,l),this._changes=[]}_updateMapTransform(t,s,l){const h=this._map,g=h._getTransformForUpdate(),x=h.terrain;if(!(Gn(t)||x&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:b,zoomDelta:T,bearingDelta:E,pitchDelta:A,around:M,pinchAround:F}=t;F!==void 0&&(M=F),h._stop(!0),M=M||h.transform.centerPoint;const N=g.pointLocation(b?M.sub(b):M);E&&(g.bearing+=E),A&&(g.pitch+=A),T&&(g.zoom+=T),x?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?g.center=g.pointLocation(g.centerPoint.sub(b)):g.setLocationAtPoint(N,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,g.setLocationAtPoint(N,M)):g.setLocationAtPoint(N,M),h._applyUpdatedTransform(g),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,l,!0)}_fireEvents(t,s,l){const h=Fn(this._eventsInProgress),g=Fn(t),x={};for(const M in t){const{originalEvent:F}=t[M];this._eventsInProgress[M]||(x[`${M}start`]=F),this._eventsInProgress[M]=t[M]}!h&&g&&this._fireEvent("movestart",g.originalEvent);for(const M in x)this._fireEvent(M,x[M]);g&&this._fireEvent("move",g.originalEvent);for(const M in t){const{originalEvent:F}=t[M];this._fireEvent(M,F)}const b={};let T;for(const M in this._eventsInProgress){const{handlerName:F,originalEvent:N}=this._eventsInProgress[M];this._handlersById[F].isActive()||(delete this._eventsInProgress[M],T=s[F]||N,b[`${M}end`]=T)}for(const M in b)this._fireEvent(M,b[M]);const E=Fn(this._eventsInProgress),A=(h||g)&&!E;if(A&&this._terrainMovement&&(this._map._elevationFreeze=!1,this._terrainMovement=!1,this._map.transform.recalculateZoom(this._map.terrain)),l&&A){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;!M||!M.essential&&X.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:T})),F(this._map.getBearing())&&this._map.resetNorth()):(F(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new d.k(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Eh("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Wp extends d.E{constructor(t,s){super(),this._renderFrameCallback=()=>{const l=Math.min((X.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.M(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,l){return t=d.P.convert(t).mult(-1),this.panTo(this.transform.center,d.e({offset:t},s),l)}panTo(t,s,l){return this.easeTo(d.e({center:t},s),l)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,l){return this.easeTo(d.e({zoom:t},s),l)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,l){return this.easeTo(d.e({bearing:t},s),l)}resetNorth(t,s){return this.rotateTo(0,d.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=xi.convert(t);const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,s)}_cameraForBoxAndBearing(t,s,l,h){const g={top:0,bottom:0,right:0,left:0};if(typeof(h=d.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const Ee=h.padding;h.padding={top:Ee,bottom:Ee,right:Ee,left:Ee}}h.padding=d.e(g,h.padding);const x=this.transform,b=x.padding,T=new xi(t,s),E=x.project(T.getNorthWest()),A=x.project(T.getNorthEast()),M=x.project(T.getSouthEast()),F=x.project(T.getSouthWest()),N=d.b9(-l),U=E.rotate(N),K=A.rotate(N),Z=M.rotate(N),J=F.rotate(N),re=new d.P(Math.max(U.x,K.x,J.x,Z.x),Math.max(U.y,K.y,J.y,Z.y)),W=new d.P(Math.min(U.x,K.x,J.x,Z.x),Math.min(U.y,K.y,J.y,Z.y)),ae=re.sub(W),de=(x.width-(b.left+b.right+h.padding.left+h.padding.right))/ae.x,fe=(x.height-(b.top+b.bottom+h.padding.top+h.padding.bottom))/ae.y;if(fe<0||de<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const we=Math.min(x.scaleZoom(x.scale*Math.min(de,fe)),h.maxZoom),Ce=d.P.convert(h.offset),Ze=new d.P((h.padding.left-h.padding.right)/2,(h.padding.top-h.padding.bottom)/2).rotate(d.b9(l)),qe=Ce.add(Ze).mult(x.scale/x.zoomScale(we));return{center:x.unproject(E.add(M).div(2).sub(qe)),zoom:we,bearing:l}}fitBounds(t,s,l){return this._fitInternal(this.cameraForBounds(t,s),s,l)}fitScreenCoordinates(t,s,l,h,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(t)),this.transform.pointLocation(d.P.convert(s)),l,h),h,g)}_fitInternal(t,s,l){return t?(delete(s=d.e(t,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(t,s){this.stop();const l=this._getTransformForUpdate();let h=!1,g=!1,x=!1;return"zoom"in t&&l.zoom!==+t.zoom&&(h=!0,l.zoom=+t.zoom),t.center!==void 0&&(l.center=d.M.convert(t.center)),"bearing"in t&&l.bearing!==+t.bearing&&(g=!0,l.bearing=+t.bearing),"pitch"in t&&l.pitch!==+t.pitch&&(x=!0,l.pitch=+t.pitch),t.padding==null||l.isPaddingEqual(t.padding)||(l.padding=t.padding),this._applyUpdatedTransform(l),this.fire(new d.k("movestart",s)).fire(new d.k("move",s)),h&&this.fire(new d.k("zoomstart",s)).fire(new d.k("zoom",s)).fire(new d.k("zoomend",s)),g&&this.fire(new d.k("rotatestart",s)).fire(new d.k("rotate",s)).fire(new d.k("rotateend",s)),x&&this.fire(new d.k("pitchstart",s)).fire(new d.k("pitch",s)).fire(new d.k("pitchend",s)),this.fire(new d.k("moveend",s))}calculateCameraOptionsFromTo(t,s,l,h=0){const g=d.Y.fromLngLat(t,s),x=d.Y.fromLngLat(l,h),b=x.x-g.x,T=x.y-g.y,E=x.z-g.z,A=Math.hypot(b,T,E);if(A===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(b,T),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),N=180*Math.atan2(b,-T)/Math.PI;let U=180*Math.acos(M/A)/Math.PI;return U=E<0?90-U:90+U,{center:x.toLngLat(),zoom:F,pitch:U,bearing:N}}easeTo(t,s){var l;this._stop(!1,t.easeId),((t=d.e({offset:[0,0],duration:500,easing:d.b8},t)).animate===!1||!t.essential&&X.prefersReducedMotion)&&(t.duration=0);const h=this._getTransformForUpdate(),g=this.getZoom(),x=this.getBearing(),b=this.getPitch(),T=this.getPadding(),E="bearing"in t?this._normalizeBearing(t.bearing,x):x,A="pitch"in t?+t.pitch:b,M="padding"in t?t.padding:h.padding,F=d.P.convert(t.offset);let N=h.centerPoint.add(F);const U=h.pointLocation(N),{center:K,zoom:Z}=h.getConstrained(d.M.convert(t.center||U),(l=t.zoom)!==null&&l!==void 0?l:g);this._normalizeCenter(K);const J=h.project(U),re=h.project(K).sub(J),W=h.zoomScale(Z-g);let ae,de;t.around&&(ae=d.M.convert(t.around),de=h.locationPoint(ae));const fe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Z!==g,this._rotating=this._rotating||x!==E,this._pitching=this._pitching||A!==b,this._padding=!h.isPaddingEqual(M),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,fe),this.terrain&&this._prepareElevation(K),this._ease(we=>{if(this._zooming&&(h.zoom=d.z.number(g,Z,we)),this._rotating&&(h.bearing=d.z.number(x,E,we)),this._pitching&&(h.pitch=d.z.number(b,A,we)),this._padding&&(h.interpolatePadding(T,M,we),N=h.centerPoint.add(F)),this.terrain&&!t.freezeElevation&&this._updateElevation(we),ae)h.setLocationAtPoint(ae,de);else{const Ce=h.zoomScale(h.zoom-g),Ze=Z>g?Math.min(2,W):Math.max(.5,W),qe=Math.pow(Ze,1-we),Ee=h.unproject(J.add(re.mult(we*qe)).mult(Ce));h.setLocationAtPoint(h.renderWorldCopies?Ee.wrap():Ee,N)}this._applyUpdatedTransform(h),this._fireMoveEvents(s)},we=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s,we)},t),this}_prepareEase(t,s,l={}){this._moving=!0,s||l.moving||this.fire(new d.k("movestart",t)),this._zooming&&!l.zooming&&this.fire(new d.k("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new d.k("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new d.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(s-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.elevation=d.z.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const s=t.clone(),{center:l,zoom:h,pitch:g,bearing:x,elevation:b}=this.transformCameraUpdate(s);l&&(s.center=l),h!==void 0&&(s.zoom=h),g!==void 0&&(s.pitch=g),x!==void 0&&(s.bearing=x),b!==void 0&&(s.elevation=b),this.transform.apply(s)}_fireMoveEvents(t){this.fire(new d.k("move",t)),this._zooming&&this.fire(new d.k("zoom",t)),this._rotating&&this.fire(new d.k("rotate",t)),this._pitching&&this.fire(new d.k("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,h=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new d.k("zoomend",t)),h&&this.fire(new d.k("rotateend",t)),g&&this.fire(new d.k("pitchend",t)),this.fire(new d.k("moveend",t))}flyTo(t,s){var l;if(!t.essential&&X.prefersReducedMotion){const Ne=d.L(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ne,s)}this.stop(),t=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b8},t);const h=this._getTransformForUpdate(),g=this.getZoom(),x=this.getBearing(),b=this.getPitch(),T=this.getPadding(),E="bearing"in t?this._normalizeBearing(t.bearing,x):x,A="pitch"in t?+t.pitch:b,M="padding"in t?t.padding:h.padding,F=d.P.convert(t.offset);let N=h.centerPoint.add(F);const U=h.pointLocation(N),{center:K,zoom:Z}=h.getConstrained(d.M.convert(t.center||U),(l=t.zoom)!==null&&l!==void 0?l:g);this._normalizeCenter(K);const J=h.zoomScale(Z-g),re=h.project(U),W=h.project(K).sub(re);let ae=t.curve;const de=Math.max(h.width,h.height),fe=de/J,we=W.mag();if("minZoom"in t){const Ne=d.ac(Math.min(t.minZoom,g,Z),h.minZoom,h.maxZoom),ct=de/h.zoomScale(Ne-g);ae=Math.sqrt(ct/we*2)}const Ce=ae*ae;function Ze(Ne){const ct=(fe*fe-de*de+(Ne?-1:1)*Ce*Ce*we*we)/(2*(Ne?fe:de)*Ce*we);return Math.log(Math.sqrt(ct*ct+1)-ct)}function qe(Ne){return(Math.exp(Ne)-Math.exp(-Ne))/2}function Ee(Ne){return(Math.exp(Ne)+Math.exp(-Ne))/2}const Ae=Ze(!1);let Ke=function(Ne){return Ee(Ae)/Ee(Ae+ae*Ne)},dt=function(Ne){return de*((Ee(Ae)*(qe(ct=Ae+ae*Ne)/Ee(ct))-qe(Ae))/Ce)/we;var ct},Le=(Ze(!0)-Ae)/ae;if(Math.abs(we)<1e-6||!isFinite(Le)){if(Math.abs(de-fe)<1e-6)return this.easeTo(t,s);const Ne=fe<de?-1:1;Le=Math.abs(Math.log(fe/de))/ae,dt=()=>0,Ke=ct=>Math.exp(Ne*ae*ct)}return t.duration="duration"in t?+t.duration:1e3*Le/("screenSpeed"in t?+t.screenSpeed/ae:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=x!==E,this._pitching=A!==b,this._padding=!h.isPaddingEqual(M),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(K),this._ease(Ne=>{const ct=Ne*Le,Ht=1/Ke(ct);h.zoom=Ne===1?Z:g+h.scaleZoom(Ht),this._rotating&&(h.bearing=d.z.number(x,E,Ne)),this._pitching&&(h.pitch=d.z.number(b,A,Ne)),this._padding&&(h.interpolatePadding(T,M,Ne),N=h.centerPoint.add(F)),this.terrain&&!t.freezeElevation&&this._updateElevation(Ne);const bt=Ne===1?K:h.unproject(re.add(W.mult(dt(ct))).mult(Ht));h.setLocationAtPoint(h.renderWorldCopies?bt.wrap():bt,N),this._applyUpdatedTransform(h),this._fireMoveEvents(s)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,s)}return t||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(t,s,l){l.animate===!1||l.duration===0?(t(1),s()):(this._easeStart=X.now(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=d.b2(t,-180,180);const l=Math.abs(t-s);return Math.abs(t-360-s)<l&&(t-=360),Math.abs(t+360-s)<l&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const l=t.lng-s.center.lng;t.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(d.M.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Ph={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Mh{constructor(t=Ph){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=V.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=V.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const l=this._map._getUIString(`AttributionControl.${s}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const s=this._map.style.sourceCaches;for(const h in s){const g=s[h];if(g.used||g.usedForTerrain){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter(h=>String(h).trim()),t.sort((h,g)=>h.length-g.length),t=t.filter((h,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(h)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Rc{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=V.create("div","maplibregl-ctrl");const s=V.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){V.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ea{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const h of l)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Xr=d.X([{name:"a_pos3d",type:"Int16",components:3}]);class We extends d.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];const l={};for(const h of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.posMatrix=new Float64Array(16),d.aO(h.posMatrix,0,d.W,0,d.W,0,1),this._tiles[h.key]=new fn(h,this.tileSize));for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(t){for(const s in this._tiles){const l=this._tiles[s];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID;if(h.canonical.equals(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16),d.aO(g.posMatrix,0,d.W,0,d.W,0,1),s[l]=g}else if(h.canonical.isChildOf(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=h.canonical.z-t.canonical.z,b=h.canonical.x-(h.canonical.x>>x<<x),T=h.canonical.y-(h.canonical.y>>x<<x),E=d.W>>x;d.aO(g.posMatrix,0,E,0,E,0,1),d.H(g.posMatrix,g.posMatrix,[-b*E,-T*E,0]),s[l]=g}else if(t.canonical.isChildOf(h.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=t.canonical.z-h.canonical.z,b=t.canonical.x-(t.canonical.x>>x<<x),T=t.canonical.y-(t.canonical.y>>x<<x),E=d.W>>x;d.aO(g.posMatrix,0,d.W,0,d.W,0,1),d.H(g.posMatrix,g.posMatrix,[b*E,T*E,0]),d.J(g.posMatrix,g.posMatrix,[1/2**x,1/2**x,0]),s[l]=g}}return s}getSourceTile(t,s){const l=this.sourceCache._source;let h=t.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!g||!g.dem)&&s)for(;h>=l.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(t.scaledTo(h--).key);return g}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=t)}}class Ah{constructor(t,s,l){this.painter=t,this.sourceCache=new We(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,l,h=d.W){var g;if(!(s>=0&&s<h&&l>=0&&l<h))return 0;const x=this.getTerrainData(t),b=(g=x.tile)===null||g===void 0?void 0:g.dem;if(!b)return 0;const T=function(U,K,Z){var J=K[0],re=K[1];return U[0]=Z[0]*J+Z[4]*re+Z[12],U[1]=Z[1]*J+Z[5]*re+Z[13],U}([],[s/h*d.W,l/h*d.W],x.u_terrain_matrix),E=[T[0]*b.dim,T[1]*b.dim],A=Math.floor(E[0]),M=Math.floor(E[1]),F=E[0]-A,N=E[1]-M;return b.get(A,M)*(1-F)*(1-N)+b.get(A+1,M)*F*(1-N)+b.get(A,M+1)*(1-F)*N+b.get(A+1,M+1)*F*N}getElevationForLngLatZoom(t,s){const{tileID:l,mercatorX:h,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(l,h%d.W,g%d.W,d.W)}getElevation(t,s,l,h=d.W){return this.getDEMElevation(t,s,l,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,g=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new pt(h,g,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new pt(h,new d.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const h=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new pt(h,s.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),s.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const h=this.sourceCache.sourceCache._source.maxzoom;let g=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?g=t.canonical.z-h:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>g<<g),b=t.canonical.y-(t.canonical.y>>g<<g),T=d.ba(new Float64Array(16),[1/(d.W<<g),1/(d.W<<g),0]);d.H(T,T,[x*d.W,b*d.W,0]),this._demMatrixCache[t.key]={matrix:T,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,l=s.width/devicePixelRatio,h=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new pt(s.context,{width:l,height:h,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new pt(s.context,{width:l,height:h,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,x=0;g<this._coordsTextureSize;g++)for(let b=0;b<this._coordsTextureSize;b++,x+=4)s[x+0]=255&b,s[x+1]=255&g,s[x+2]=b>>8<<4|g>>8,s[x+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),h=new pt(t,l,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,h=l.gl,g=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(g,b-x-1,1,1,h.RGBA,h.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const T=s[0]+(s[2]>>4<<8),E=s[1]+((15&s[2])<<8),A=this.coordsIndex[255-s[3]],M=A&&this.sourceCache.getTileByID(A);if(!M)return null;const F=this._coordsTextureSize,N=(1<<M.tileID.canonical.z)*F;return new d.Y((M.tileID.canonical.x*F+T)/N+M.tileID.wrap,(M.tileID.canonical.y*F+E)/N,this.getElevation(M.tileID,T,E,F))}depthAtPoint(t){const s=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,s=new d.bb,l=new d.aY,h=this.meshSize,g=d.W/h,x=h*h;for(let M=0;M<=h;M++)for(let F=0;F<=h;F++)s.emplaceBack(F*g,M*g,0);for(let M=0;M<x;M+=h+1)for(let F=0;F<h;F++)l.emplaceBack(F+M,h+F+M+1,h+F+M+2),l.emplaceBack(F+M,h+F+M+2,F+M+1);const b=s.length,T=b+2*(h+1);for(const M of[0,1])for(let F=0;F<=h;F++)for(const N of[0,1])s.emplaceBack(F*g,M*d.W,N);for(let M=0;M<2*h;M+=2)l.emplaceBack(T+M,T+M+1,T+M+3),l.emplaceBack(T+M,T+M+3,T+M+2),l.emplaceBack(b+M,b+M+3,b+M+1),l.emplaceBack(b+M,b+M+2,b+M+3);const E=s.length,A=E+2*(h+1);for(const M of[0,1])for(let F=0;F<=h;F++)for(const N of[0,1])s.emplaceBack(M*d.W,F*g,N);for(let M=0;M<2*h;M+=2)l.emplaceBack(E+M,E+M+1,E+M+3),l.emplaceBack(E+M,E+M+3,E+M+2),l.emplaceBack(A+M,A+M+3,A+M+1),l.emplaceBack(A+M,A+M+2,A+M+3);return this._mesh={indexBuffer:t.createIndexBuffer(l),vertexBuffer:t.createVertexBuffer(s,Xr.members),segments:d.$.simpleSegment(0,0,s.length,l.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*d.bc/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,s){var l;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,s){const l=d.Y.fromLngLat(t.wrap()),h=(1<<s)*d.W,g=l.x*h,x=l.y*h,b=Math.floor(g/d.W),T=Math.floor(x/d.W);return{tileID:new d.Q(s,0,s,b,T),mercatorX:g,mercatorY:x}}}class ta{constructor(t,s,l){this._context=t,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new pt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:t,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>t.id!==s),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const gr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class zh{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new ta(t.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(s)),this._coordsDescendingInv={};for(const l in t.sourceCaches){this._coordsDescendingInv[l]={};const h=t.sourceCaches[l].getVisibleCoordinates();for(const g of h){const x=this.terrain.sourceCache.getTerrainCoords(g);for(const b in x)this._coordsDescendingInv[l][b]||(this._coordsDescendingInv[l][b]=[]),this._coordsDescendingInv[l][b].push(x[b])}}this._coordsDescendingInvStr={};for(const l of t._order){const h=t._layers[l],g=h.source;if(gr[h.type]&&!this._coordsDescendingInvStr[g]){this._coordsDescendingInvStr[g]={};for(const x in this._coordsDescendingInv[g])this._coordsDescendingInvStr[g][x]=this._coordsDescendingInv[g][x].map(b=>b.key).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsDescendingInvStr){const g=this._coordsDescendingInvStr[h][l.tileID.key];g&&g!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const s=t.type,l=this.painter,h=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(gr[s]&&(this._prevType&&gr[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(t.id),!h))return!0;if(gr[this._prevType]||gr[s]&&h){this._prevType=s;const g=this._stacks.length-1,x=this._stacks[g]||[];for(const b of this._renderableTiles){if(this.pool.isFull()&&(qa(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(b),b.rtt[g]){const E=this.pool.getObjectForId(b.rtt[g].id);if(E.stamp===b.rtt[g].stamp){this.pool.useObject(E);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),b.rtt[g]={id:T.id,stamp:T.stamp},l.context.bindFramebuffer.set(T.fbo.framebuffer),l.context.clear({color:d.aP.transparent,stencil:0}),l.currentStencilSource=void 0;for(let E=0;E<x.length;E++){const A=l.style._layers[x[E]],M=A.source?this._coordsDescendingInv[A.source][b.tileID.key]:[b.tileID];l.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),l._renderTileClippingMasks(A,M),l.renderLayer(l,l.style.sourceCaches[A.source],A,M),A.source&&(b.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][b.tileID.key])}}return qa(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),gr[s]}return!1}}const Ue={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Fc=$,Hp={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ph,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Dh=m=>{m.touchstart=m.dragStart,m.touchmoveWindow=m.dragMove,m.touchend=m.dragEnd},Bc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Lh{constructor(t,s,l=!1){this.mousedown=x=>{this.startMouse(d.e({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),V.mousePos(this.element,x)),V.addEventListener(window,"mousemove",this.mousemove),V.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,V.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),V.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const h=t.dragRotate._mouseRotate.getClickTolerance(),g=t.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Rn({clickTolerance:h,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:b,bearingDegreesPerPixelMoved:T=.8})=>{const E=new si;return new wo({clickTolerance:b,move:(A,M)=>({bearingDelta:(M.x-A.x)*T}),moveStateManager:E,enable:x,assignEvents:Dh})})({clickTolerance:h,enable:!0}),this.map=t,l&&(this.mousePitch=Qa({clickTolerance:g,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:b,pitchDegreesPerPixelMoved:T=-.5})=>{const E=new si;return new wo({clickTolerance:b,move:(A,M)=>({pitchDelta:(M.y-A.y)*T}),moveStateManager:E,enable:x,assignEvents:Dh})})({clickTolerance:g,enable:!0})),V.addEventListener(s,"mousedown",this.mousedown),V.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(s,"touchcancel",this.reset)}startMouse(t,s){this.mouseRotate.dragStart(t,s),this.mousePitch&&this.mousePitch.dragStart(t,s),V.disableDrag()}startTouch(t,s){this.touchRotate.dragStart(t,s),this.touchPitch&&this.touchPitch.dragStart(t,s),V.disableDrag()}moveMouse(t,s){const l=this.map,{bearingDelta:h}=this.mouseRotate.dragMove(t,s)||{};if(h&&l.setBearing(l.getBearing()+h),this.mousePitch){const{pitchDelta:g}=this.mousePitch.dragMove(t,s)||{};g&&l.setPitch(l.getPitch()+g)}}moveTouch(t,s){const l=this.map,{bearingDelta:h}=this.touchRotate.dragMove(t,s)||{};if(h&&l.setBearing(l.getBearing()+h),this.touchPitch){const{pitchDelta:g}=this.touchPitch.dragMove(t,s)||{};g&&l.setPitch(l.getPitch()+g)}}off(){const t=this.element;V.removeEventListener(t,"mousedown",this.mousedown),V.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend),V.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){V.enableDrag(),V.removeEventListener(window,"mousemove",this.mousemove),V.removeEventListener(window,"mouseup",this.mouseup),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend)}}let Yr;function Rh(m,t,s){const l=new d.M(m.lng,m.lat);if(m=new d.M(m.lng,m.lat),t){const h=new d.M(m.lng-360,m.lat),g=new d.M(m.lng+360,m.lat),x=s.locationPoint(m).distSqr(t);s.locationPoint(h).distSqr(t)<x?m=h:s.locationPoint(g).distSqr(t)<x&&(m=g)}for(;Math.abs(m.lng-s.center.lng)>180;){const h=s.locationPoint(m);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;m.lng>s.center.lng?m.lng-=360:m.lng+=360}return m.lng!==l.lng&&s.locationPoint(m).y>s.height/2-s.getHorizon()?m:l}const Oc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Jr(m,t,s){const l=m.classList;for(const h in Oc)l.remove(`maplibregl-${s}-anchor-${h}`);l.add(`maplibregl-${s}-anchor-${t}`)}class Zt extends d.E{constructor(t){if(super(),this._onKeyPress=s=>{const l=s.code,h=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const h=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!h)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Rh(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),s&&s.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,`${Oc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${g}`),X.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=d.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div");const s=V.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${h}px`),s.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const g=V.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const x=V.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const b=V.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const J of T){const re=V.createNS("http://www.w3.org/2000/svg","ellipse");re.setAttributeNS(null,"opacity","0.04"),re.setAttributeNS(null,"cx","10.5"),re.setAttributeNS(null,"cy","5.80029008"),re.setAttributeNS(null,"rx",J.rx),re.setAttributeNS(null,"ry",J.ry),b.appendChild(re)}const E=V.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const A=V.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(A);const M=V.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const F=V.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(F);const N=V.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(6.0, 7.0)"),N.setAttributeNS(null,"fill","#FFFFFF");const U=V.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=V.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const Z=V.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#FFFFFF"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962"),U.appendChild(K),U.appendChild(Z),x.appendChild(b),x.appendChild(E),x.appendChild(M),x.appendChild(N),x.appendChild(U),s.appendChild(x),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(s),this._offset=d.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Jr(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=d.M.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const h=this._map,g=h.terrain.depthAtPoint(this._pos),x=h.terrain.getElevationForLngLatZoom(this._lngLat,h.transform.tileZoom);if(h.transform.lngLatToCameraDepth(this._lngLat,x)-g<.006)return void(this._element.style.opacity=this._opacity);const b=-this._offset.y/h.transform._pixelPerMeter,T=Math.sin(h.getPitch()*Math.PI/180)*b,E=h.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),A=h.transform.lngLatToCameraDepth(this._lngLat,x+T)-E>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=d.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,s){return t===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const nl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let is=0,ns=!1;const Fh={maxWidth:100,unit:"metric"};function Nc(m,t,s){const l=s&&s.maxWidth||100,h=m._container.clientHeight/2,g=m.unproject([0,h]),x=m.unproject([l,h]),b=g.distanceTo(x);if(s&&s.unit==="imperial"){const T=3.2808*b;T>5280?ia(t,l,T/5280,m._getUIString("ScaleControl.Miles")):ia(t,l,T,m._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?ia(t,l,b/1852,m._getUIString("ScaleControl.NauticalMiles")):b>=1e3?ia(t,l,b/1e3,m._getUIString("ScaleControl.Kilometers")):ia(t,l,b,m._getUIString("ScaleControl.Meters"))}function ia(m,t,s,l){const h=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let b=g/x;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(T){const E=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*E)/E}(b),x*b}(s);m.style.width=t*(h/s)+"px",m.innerHTML=`${h}&nbsp;${l}`}const yr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},rl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function et(m){if(m){if(typeof m=="number"){const t=Math.round(Math.abs(m)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,m),"top-left":new d.P(t,t),"top-right":new d.P(-t,t),bottom:new d.P(0,-m),"bottom-left":new d.P(t,-t),"bottom-right":new d.P(-t,-t),left:new d.P(m,0),right:new d.P(-m,0)}}if(m instanceof d.P||Array.isArray(m)){const t=d.P.convert(m);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:d.P.convert(m.center||[0,0]),top:d.P.convert(m.top||[0,0]),"top-left":d.P.convert(m["top-left"]||[0,0]),"top-right":d.P.convert(m["top-right"]||[0,0]),bottom:d.P.convert(m.bottom||[0,0]),"bottom-left":d.P.convert(m["bottom-left"]||[0,0]),"bottom-right":d.P.convert(m["bottom-right"]||[0,0]),left:d.P.convert(m.left||[0,0]),right:d.P.convert(m.right||[0,0])}}return et(new d.P(0,0))}const lt=$;S.AJAXError=d.bf,S.Evented=d.E,S.LngLat=d.M,S.MercatorCoordinate=d.Y,S.Point=d.P,S.addProtocol=d.bg,S.config=d.a,S.removeProtocol=d.bh,S.AttributionControl=Mh,S.BoxZoomHandler=Ys,S.CanvasSource=Fs,S.CooperativeGesturesHandler=qn,S.DoubleClickZoomHandler=zc,S.DragPanHandler=Dc,S.DragRotateHandler=ts,S.EdgeInsets=Ks,S.FullscreenControl=class extends d.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var t;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=s==null?void 0:s.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){V.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=V.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);V.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=Dt,S.GeolocateControl=class extends d.E{constructor(m){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new d.M(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,h=this._map.getBearing(),g=d.e({bearing:h},this.options.fitBoundsOptions),x=xi.fromLngLat(s,l);this._map.fitBounds(x,g,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new d.M(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ns)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=V.create("button","maplibregl-ctrl-geolocate",this._container),V.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Zt({element:this._dotElement}),this._circleElement=V.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")),this.fire(new d.k("userlocationlostfocus")))})}},this.options=d.e({},nl,m)}onAdd(m){return this._map=m,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return d._(this,arguments,void 0,function*(t=!1){if(Yr!==void 0&&!t)return Yr;if(window.navigator.permissions===void 0)return Yr=!!window.navigator.geolocation,Yr;try{Yr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Yr=!!window.navigator.geolocation}return Yr})}().then(t=>this._setupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,is=0,ns=!1}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),s=m.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),t=m.getSouthEast(),s=m.getNorthEast(),l=t.distanceTo(s),h=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":is--,ns=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart")),this.fire(new d.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),is++,is>1?(m={maximumAge:6e5,timeout:0},ns=!0):(m=this.options.positionOptions,ns=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.Hash=wc,S.ImageSource=Cr,S.KeyboardHandler=Kr,S.LngLatBounds=xi,S.LogoControl=Rc,S.Map=class extends Wp{constructor(m){d.bd.mark(d.be.create);const t=Object.assign(Object.assign({},Hp),m);if(t.minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(t.minPitch!=null&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(t.maxPitch!=null&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new xc(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),{bearingSnap:t.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ea,this._controls=[],this._mapId=d.a3(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._maxTileCacheZoomLevels=t.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=t.preserveDrawingBuffer===!0,this._antialias=t.antialias===!0,this._trackResize=t.trackResize===!0,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles===!0,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions===!0,this._collectResourceTiming=t.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ue),t.locale),this._clickTolerance=t.clickTolerance,this._overridePixelRatio=t.pixelRatio,this._maxCanvasSize=t.maxCanvasSize,this.transformCameraUpdate=t.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=t.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=he.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ie(t.transformRequest),typeof t.container=="string"){if(this._container=document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const l=wh(h=>{this._trackResize&&!this._removed&&this.resize(h)._update()},50);this._resizeObserver=new ResizeObserver(h=>{s?l(h):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Qs(this,t),this._hash=t.hash&&new wc(typeof t.hash=="string"&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,d.e({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,this._validateStyle=t.validateStyle,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new Mh(typeof t.attributionControl=="boolean"?void 0:t.attributionControl)),t.maplibreLogo&&this.addControl(new Rc,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new d.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new d.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new d.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=m.onAdd(this);this._controls.push(m);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,t,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,t,s,l)}resize(m){var t;const s=this._containerDimensions(),l=s[0],h=s[1],g=this._getClampedPixelRatio(l,h);if(this._resizeCanvas(l,h,g),this.painter.resize(l,h,g),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const T=this._getClampedPixelRatio(l,h);this._resizeCanvas(l,h,T),this.painter.resize(l,h,T)}this.transform.resize(l,h),(t=this._requestedCameraState)===null||t===void 0||t.resize(l,h);const x=!this._moving;return x&&(this.stop(),this.fire(new d.k("movestart",m)).fire(new d.k("move",m))),this.fire(new d.k("resize",m)),x&&this.fire(new d.k("moveend",m)),this}_getClampedPixelRatio(m,t){const{0:s,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),g=m*h,x=t*h;return Math.min(g>s?s/g:1,x>l?l/x:1)*h}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(xi.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(d.M.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.pointLocation(d.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,t,s){if(m==="mouseenter"||m==="mouseover"){let l=!1;return{layer:t,listener:s,delegates:{mousemove:g=>{const x=this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[];x.length?l||(l=!0,s.call(this,new Zi(m,this,g.originalEvent,{features:x}))):l=!1},mouseout:()=>{l=!1}}}}if(m==="mouseleave"||m==="mouseout"){let l=!1;return{layer:t,listener:s,delegates:{mousemove:x=>{(this.getLayer(t)?this.queryRenderedFeatures(x.point,{layers:[t]}):[]).length?l=!0:l&&(l=!1,s.call(this,new Zi(m,this,x.originalEvent)))},mouseout:x=>{l&&(l=!1,s.call(this,new Zi(m,this,x.originalEvent)))}}}}{const l=h=>{const g=this.getLayer(t)?this.queryRenderedFeatures(h.point,{layers:[t]}):[];g.length&&(h.features=g,s.call(this,h),delete h.features)};return{layer:t,listener:s,delegates:{[m]:l}}}}on(m,t,s){if(s===void 0)return super.on(m,t);const l=this._createDelegatedListener(m,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(l);for(const h in l.delegates)this.on(h,l.delegates[h]);return this}once(m,t,s){if(s===void 0)return super.once(m,t);const l=this._createDelegatedListener(m,t,s);for(const h in l.delegates)this.once(h,l.delegates[h]);return this}off(m,t,s){return s===void 0?super.off(m,t):(this._delegatedListeners&&this._delegatedListeners[m]&&(l=>{const h=this._delegatedListeners[m];for(let g=0;g<h.length;g++){const x=h[g];if(x.layer===t&&x.listener===s){for(const b in x.delegates)this.off(b,x.delegates[b]);return h.splice(g,1),this}}})(),this)}queryRenderedFeatures(m,t){if(!this.style)return[];let s;const l=m instanceof d.P||Array.isArray(m),h=l?m:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:m)||{},h instanceof d.P||typeof h[0]=="number")s=[d.P.convert(h)];else{const g=d.P.convert(h[0]),x=d.P.convert(h[1]);s=[g,new d.P(x.x,g.y),x,new d.P(g.x,x.y),g]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(m,t){return this.style.querySourceFeatures(m,t)}setStyle(m,t){return(t=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(m,t))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,t));const s=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Ca(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,t,s):this.style.loadJSON(m,t,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,t){if(typeof m=="string"){const s=this._requestManager.transformRequest(m,"Style");d.h(s,new AbortController).then(l=>{this._updateDiff(l.data,t)}).catch(l=>{l&&this.fire(new d.j(l))})}else typeof m=="object"&&this._updateDiff(m,t)}_updateDiff(m,t){try{this.style.setState(m,t)&&this._update(!0)}catch(s){d.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(m,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(m,t){return this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)}isSourceLoaded(m){const t=this.style&&this.style.sourceCaches[m];if(t!==void 0)return t.loaded();this.fire(new d.j(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const t=this.style.sourceCaches[m.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&t.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===m.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ah(this.painter,t,m),this.painter.renderToTexture=new zh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==m.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:m})),this}getTerrain(){var m,t;return(t=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const t in m){const s=m[t]._tiles;for(const l in s){const h=s[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,t,s={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:g,stretchY:x,content:b,textFitWidth:T,textFitHeight:E}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||d.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:M,data:F}=t,N=t;return this.style.addImage(m,{data:new d.R({width:A,height:M},new Uint8Array(F)),pixelRatio:l,stretchX:g,stretchY:x,content:b,textFitWidth:T,textFitHeight:E,sdf:h,version:0,userImage:N}),N.onAdd&&N.onAdd(this,m),this}}{const{width:A,height:M,data:F}=X.getImageData(t);this.style.addImage(m,{data:new d.R({width:A,height:M},F),pixelRatio:l,stretchX:g,stretchY:x,content:b,textFitWidth:T,textFitHeight:E,sdf:h,version:0})}}updateImage(m,t){const s=this.style.getImage(m);if(!s)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||d.b(t)?X.getImageData(t):t,{width:h,height:g,data:x}=l;if(h===void 0||g===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==s.data.width||g!==s.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(t instanceof HTMLImageElement||d.b(t));return s.data.replace(x,b),this.style.updateImage(m,s),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return he.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,t){return this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)}moveLayer(m,t){return this.style.moveLayer(m,t),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,t,s){return this.style.setLayerZoomRange(m,t,s),this._update(!0)}setFilter(m,t,s={}){return this.style.setFilter(m,t,s),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,t,s,l={}){return this.style.setPaintProperty(m,t,s,l),this._update(!0)}getPaintProperty(m,t){return this.style.getPaintProperty(m,t)}setLayoutProperty(m,t,s,l={}){return this.style.setLayoutProperty(m,t,s,l),this._update(!0)}getLayoutProperty(m,t){return this.style.getLayoutProperty(m,t)}setGlyphs(m,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,t,s,l=>{l||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,t,s=>{s||this._update(!0)}),this}setLight(m,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,t){return this.style.setFeatureState(m,t),this._update()}removeFeatureState(m,t){return this.style.removeFeatureState(m,t),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,t=0;return this._container&&(m=this._container.clientWidth||400,t=this._container.clientHeight||300),[m,t]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const t=this._canvasContainer=V.create("div","maplibregl-canvas-container",m);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=V.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const h=this._controlContainer=V.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{g[x]=V.create("div",`maplibregl-ctrl-${x} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,t,s){this._canvas.width=Math.floor(s*m),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const m={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:m},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});const s=this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m);if(!s){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new Mt(s,this.transform),Te.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const h=this.transform.zoom,g=X.now();this.style.zoomHistory.update(h,g);const x=new d.a8(h,{now:g,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),b=x.crossFadingFactor();b===1&&b===this._crossFadingFactor||(s=!0,this._crossFadingFactor=b),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bd.mark(d.be.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,d.bd.mark(d.be.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),he.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),V.remove(this._canvasContainer),V.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bd.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,X.frameAsync(this._frameRequest).then(m=>{d.bd.frame(m),this._frameRequest=null,this._render(m)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Fc}getCameraTargetElevation(){return this.transform.elevation}},S.MapMouseEvent=Zi,S.MapTouchEvent=xo,S.MapWheelEvent=bh,S.Marker=Zt,S.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);t.title=l,t.setAttribute("aria-label",l)},this.options=d.e({},Bc,m),this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),V.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),V.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=V.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Lh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,t){const s=V.create("button",m,this._container);return s.type="button",s.addEventListener("click",t),s}},S.Popup=class extends d.E{constructor(m){super(),this.remove=()=>(this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=V.create("div","maplibregl-popup",this._map.getContainer()),this._tip=V.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Rh(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!t)return;const l=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let h=this.options.anchor;const g=et(this.options.offset);if(!h){const b=this._container.offsetWidth,T=this._container.offsetHeight;let E;E=l.y+g.bottom.y<T?["top"]:l.y>this._map.transform.height-T?["bottom"]:[],l.x<b/2?E.push("left"):l.x>this._map.transform.width-b/2&&E.push("right"),h=E.length===0?"bottom":E.join("-")}let x=l.add(g[h]);this.options.subpixelPositioning||(x=x.round()),V.setTransform(this._container,`${Oc[h]} translate(${x.x}px,${x.y}px)`),Jr(this._container,h,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(yr),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=d.M.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=m;l=s.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=V.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(rl);m&&m.focus()}},S.RasterDEMTileSource=Rs,S.RasterTileSource=Wr,S.ScaleControl=class{constructor(m){this._onMove=()=>{Nc(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Nc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Fh),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=Ac,S.Style=Ca,S.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=V.create("button","maplibregl-ctrl-terrain",this._container),V.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){V.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=Pc,S.TwoFingersTouchRotateHandler=Ec,S.TwoFingersTouchZoomHandler=tl,S.TwoFingersTouchZoomRotateHandler=Lc,S.VectorTileSource=ye,S.VideoSource=Vo,S.addSourceType=(m,t)=>d._(void 0,void 0,void 0,function*(){if(Er(m))throw new Error(`A source type called "${m}" already exists.`);((s,l)=>{Uo[s]=l})(m,t)}),S.clearPrewarmedResources=function(){const m=Mn;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(zt),Mn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return pn().getRTLTextPluginStatus()},S.getVersion=function(){return lt},S.getWorkerCount=function(){return Ui.workerCount},S.getWorkerUrl=function(){return d.a.WORKER_URL},S.importScriptInWorkers=function(m){return Oo().broadcast("IS",m)},S.prewarm=function(){$i().acquire(zt)},S.setMaxParallelImageRequests=function(m){d.a.MAX_PARALLEL_IMAGE_REQUESTS=m},S.setRTLTextPlugin=function(m,t){return pn().setRTLTextPlugin(m,t)},S.setWorkerCount=function(m){Ui.workerCount=m},S.setWorkerUrl=function(m){d.a.WORKER_URL=m}});var k=c;return k})})(Sx);var jn=Sx.exports;kt();kt();kt();kt();kt();kt();function _3(n){const o={},c={},p={};for(const v in n)if(v.startsWith("on"))o[v]=n[v];else if(Ix.includes(v))c[v]=n[v];else if(kx.includes(v))p[v]=n[v];else if(!v.startsWith("initial")&&v!=="container"&&v!=="style")throw Error(`unknown map option key ${v}`);return[p,o,c]}function Tp(n){const o={},c={};for(const p in n)if(p.startsWith("on"))o[p]=n[p];else{const v=p.startsWith("initial")?p[7].toLowerCase()+p.substring(8):p;if(c[v])throw new Error(`duplicate key ${v}`);c[v]=n[p]}return[c,o]}function kp(n,o){return Object.keys(n).filter(p=>n[p]in o).sort()}function Ul(n,o){if(n===o)return!0;if(!n||!o)return!1;if(Array.isArray(n)){if(!Array.isArray(o)||n.length!==o.length)return!1;for(let c=0;c<n.length;c++)if(!Ul(n[c],o[c]))return!1;return!0}else if(Array.isArray(o))return!1;if(typeof n=="object"&&typeof o=="object"){const c=Object.keys(n),p=Object.keys(o);if(c.length!==p.length)return!1;for(const v of c)if(!Object.prototype.hasOwnProperty.call(o,v)||!Ul(n[v],o[v]))return!1;return!0}return!1}function v3(n,o){const c=Array.isArray(n)?n[0]:n?n.x:0,p=Array.isArray(n)?n[1]:n?n.y:0,v=Array.isArray(o)?o[0]:o?o.x:0,k=Array.isArray(o)?o[1]:o?o.y:0;return c===v&&p===k}function Ip(n,o,c){o.forEach(p=>{p!==""&&c.indexOf(p)===-1&&n.classList.remove(p)}),c.forEach(p=>{p!==""&&(o.indexOf(p)===-1||!n.classList.contains(p))&&n.classList.add(p)})}function x3(n,o,c,p){n.forEach(v=>{v!==""&&o.indexOf(v)===-1&&p(v)}),o.forEach(v=>{v!==""&&n.indexOf(v)===-1&&c(v)})}var J0={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mouseout:"onMouseOut",mousemove:"onMouseMove",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",click:"onClick",dblclick:"onDblClick",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchcancel:"onTouchCancel",touchmove:"onTouchMove",movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd",wheel:"onWheel",resize:"onResize",remove:"onRemove",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",webglcontextlost:"onWebglContextLost",webglcontextrestored:"onWebglContextRestored",load:"onLoad",render:"onRender",idle:"onIdle",error:"onError",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",dataloading:"onDataLoading",styledataloading:"onStyleDataLoading",sourcedataloading:"onSourceDataLoading",tiledataloading:"onTileDataLoading",styleimagemissing:"onStyleImageMissing",dataabort:"onDataAbort",sourcedataabort:"onSourceDataAbort",terrain:"onTerrain"},kx=["maxBounds","minZoom","maxZoom","minPitch","maxPitch","renderWorldCopies","pixelRatio"],Ix=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch","cooperativeGestures"],Q0="https://demotiles.maplibre.org/style.json",w3=class{constructor({mapStyle:n=Q0,padding:o},c,p){li(this,"reactiveOptions",{});li(this,"handlerOptions",{});li(this,"eventNames",[]);li(this,"callbacks");li(this,"_map");li(this,"padding");li(this,"mapStyle");li(this,"controlledSources",{});li(this,"controlledLayers",{});li(this,"controlledTerrain",null);li(this,"_onStyleError",n=>{n.error.name!=="AbortError"&&console.error(n.error)});li(this,"_onMapEvent",n=>{var p,v;const o=n.type,c=J0[o];this.callbacks[c]?(v=(p=this.callbacks)[c])==null||v.call(p,n):console.info("not managed RMap event",o,n)});this.mapStyle=n,this.padding=o;const[v,k]=Tp(c);this.callbacks=k;const S={...v,container:p,style:n},d=new jn.Map(S);d.style.on("error",this._onStyleError),o&&d.setPadding(o),this._map=d,this._updateCallbacks(k)}setProps({mapStyle:n=Q0,styleDiffing:o=!0,styleTransformStyle:c,padding:p},v){const[k,S,d]=_3(v);this._updateCallbacks(S),this._updateStyle(n,{diff:o,transformStyle:c}),this._updateReactiveOptions(k,{padding:p}),this._updateHandlers(d)}getControlledTerrain(){return this.controlledTerrain}setControlledTerrain(n){this.controlledTerrain=n}getControlledLayer(n){return this.controlledLayers[n]??null}setControlledLayer(n,o){o?this.controlledLayers[n]=o:delete this.controlledLayers[n]}getControlledSource(n){return this.controlledSources[n]??null}setControlledSource(n,o){o?this.controlledSources[n]=o:delete this.controlledSources[n]}_updateStyle(n,o){const c=this.mapStyle;n!==c&&(this.mapStyle=n,this._map.setStyle(n,{diff:o.diff,transformStyle:(p,v)=>{const k=p?Object.fromEntries(Object.entries(p==null?void 0:p.sources).filter(([$])=>$ in this.controlledSources)):{},S=p?p.layers.filter($=>$.id in this.controlledLayers):[],d={...v,sources:{...v.sources,...k},layers:[...v.layers,...S],terrain:this.controlledTerrain?p==null?void 0:p.terrain:v.terrain};return o.transformStyle?o.transformStyle(p,d):d}}))}_updateReactiveOptions(n,{padding:o}){const c=this.reactiveOptions;this.reactiveOptions=n;for(const p of kx)if(p in n&&!Ul(c[p],n[p])){const v=`set${p[0].toUpperCase()}${p.substring(1)}`;this._map[v](n[p])}o&&!Ul(this.padding,o)&&this._map.setPadding(o),this.padding=o}_updateCallbacks(n={}){this.callbacks=n;const o=kp(J0,n);this.eventNames.join("-")!==o.join("-")&&(x3(this.eventNames,o,c=>this._map.on(c,this._onMapEvent),c=>this._map.off(c,this._onMapEvent)),this.eventNames=o)}_updateHandlers(n){const o=this.handlerOptions;this.handlerOptions=n;for(const c of Ix){const p=n[c]??!0,v=o[c]??!0;Ul(p,v)||(p?this._map[c].enable(p):this._map[c].disable())}}get map(){return this._map}destroy(){this._updateCallbacks(),this._map.remove()}};kt();var Cp=Ve.createContext({mapManager:void 0});kt();var dm=typeof window<"u"?Ve.useLayoutEffect:Ve.useEffect,b3={height:"100%"},S3=Ve.forwardRef(function({children:o,style:c,id:p,className:v,onMounted:k,mapStyle:S,styleDiffing:d,styleTransformStyle:$,padding:ie,...me},X){const V=Ve.useRef(null),Te=Ve.useRef({mapManager:void 0}),ke=Ve.useRef(!0),[,Me]=Ve.useState(0);dm(()=>{Te.current.mapManager?ke.current?Te.current.mapManager.setProps({mapStyle:S,padding:ie,styleDiffing:d,styleTransformStyle:$},me):ke.current=!0:(Te.current.mapManager=new w3({mapStyle:S,styleDiffing:d,padding:ie},me,V.current),k&&k(Te.current.mapManager.map),Me(oe=>oe+1),ke.current=!1)}),dm(()=>()=>{Te.current.mapManager&&(Te.current.mapManager.destroy(),Te.current.mapManager=void 0)},[]),Ve.useImperativeHandle(X,()=>{var oe;return((oe=Te.current.mapManager)==null?void 0:oe.map)||null},[]),dm(()=>{if(!v)return;const oe=V.current;return v.split(" ").map(ne=>oe.classList.add(ne)),()=>void v.split(" ").map(ne=>oe.classList.remove(ne))},[v]);const yt=Ve.useMemo(()=>({position:"relative",width:"100%",height:"100%",...c}),[c]);return at.jsx("div",{ref:V,id:p,style:yt,children:Te.current.mapManager&&at.jsx(Cp.Provider,{value:Te.current,children:at.jsx("div",{className:"maplibregl-children",style:b3,children:o})})})});kt();kt();kt();function Qu(){const n=Ve.useContext(Cp);if(!n.mapManager)throw new Error("use useMap in components inside <RMap />");return n.mapManager.map}var ev={dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",click:"onClick"},pm=Ve.memo(Ve.forwardRef(function(o,c){var $e;const{longitude:p,latitude:v,children:k,...S}=o,d=Qu(),[$,ie]=Tp(S),me=Ve.useRef($),X=Ve.useRef();X.current=ie;const V=Ve.useMemo(()=>{const Xe={...$,element:k?document.createElement("div"):void 0},xt=new jn.Marker(Xe);return xt.setLngLat([p,v]),xt},[]),Te=kp(ev,ie).join("-");Ve.useEffect(()=>{function Xe(rt){var Ut,ei,Ri;const pt=rt.type,oi=ev[pt];(Ut=X.current)!=null&&Ut[oi]?(Ri=(ei=X.current)[oi])==null||Ri.call(ei,rt):console.info("not managed RMarker event",pt,rt)}const xt=Te.split("-");return xt.forEach(rt=>{rt==="click"?V.getElement().addEventListener("click",Xe):V.on(rt,Xe)}),()=>{xt.forEach(rt=>{rt==="click"?V.getElement().removeEventListener("click",Xe):V.off(rt,Xe)})}},[Te,V]),Ve.useEffect(()=>(V.addTo(d),()=>void V.remove()),[]);const{className:ke,offset:Me,draggable:yt,clickTolerance:oe=0,rotation:ne,rotationAlignment:he,pitchAlignment:Ie,opacity:Be,opacityWhenCovered:Re}=$;return Ve.useImperativeHandle(c,()=>V,[V]),me.current.className!==ke&&Ip(V._element,(($e=me.current.className)==null?void 0:$e.split(" "))||[],(ke==null?void 0:ke.split(" "))||[]),(V.getLngLat().lng!==p||V.getLngLat().lat!==v)&&V.setLngLat([p,v]),Me&&!v3(V.getOffset(),Me)&&V.setOffset(Me),V.isDraggable()!==yt&&V.setDraggable(yt),V._clickTolerance!==oe&&(V._clickTolerance=oe),V.getRotation()!==ne&&V.setRotation(ne),V.getRotationAlignment()!==he&&V.setRotationAlignment(he),V.getPitchAlignment()!==Ie&&V.setPitchAlignment(Ie),(V._opacity!==Be||V._opacityWhenCovered!==Re)&&V.setOpacity(Be,Re),me.current=$,k?Ju.createPortal(k,V.getElement()):null}));kt();kt();var fm={map_click:"onMapClick",map_move:"onMapMove"},tv=Ve.memo(Ve.forwardRef(function(o,c){var ne;const{longitude:p,latitude:v,children:k,...S}=o,d=Qu();console.log("render RPopup",d);const[$,ie]=Tp(S),me=Ve.useRef(null),X=Ve.useRef($),V=Ve.useRef();V.current=ie;const Te=Ve.useMemo(()=>document.createElement("div"),[]);me.current||(me.current=new jn.Popup({...$,closeButton:!0,closeOnClick:!1,closeOnMove:!1}),p!==void 0&&v!==void 0&&me.current.setLngLat([p,v]));const ke=kp(fm,ie).join("-");Ve.useEffect(()=>{function he(Re){var xt,rt,pt;const $e=Re.type,Xe=fm[$e]||fm[`map_${$e}`];(xt=V.current)!=null&&xt[Xe]?(pt=(rt=V.current)[Xe])==null||pt.call(rt,Re):console.info("not managed RPopup event",$e,Re)}if(ke==="")return;const Ie=ke.split("-"),Be=me.current;return Ie.forEach(Re=>{Re.startsWith("map_")?d.on(Re.substring(4),he):Be.on(Re,he)}),()=>{Ie.forEach(Re=>{Re.startsWith("map_")?d.off(Re.substring(4),he):Be.off(Re,he)})}},[ke,d]),Ve.useEffect(()=>(me.current.setDOMContent(Te).addTo(d),()=>void me.current.remove()),[Te,d]);const{offset:Me,maxWidth:yt="240px",className:oe}=$;return Ve.useImperativeHandle(c,()=>me.current,[me]),me.current.isOpen()&&(p!==void 0&&v!==void 0&&(me.current.getLngLat().lng!==p||me.current.getLngLat().lat!==v)&&me.current.setLngLat([p,v]),Me&&!Ul(me.current.options.offset,Me)&&me.current.setOffset(Me),X.current.className!==oe&&Ip(Te,((ne=X.current.className)==null?void 0:ne.split(" "))||[],(oe==null?void 0:oe.split(" "))||[]),me.current.getMaxWidth()!==yt&&me.current.setMaxWidth(yt)),X.current=$,Ju.createPortal(k,Te)}));kt();kt();function T3(n,o,c){var p;if((p=n.style)!=null&&p._loaded&&(o.type==="background"||o.type==="custom"||o.source&&n.getSource(o.source)))return n.addLayer(o,c&&n.getLayer(c)?c:void 0),n.getLayer(o.id)}function k3(n,{beforeId:o,...c},{beforeId:p,...v}){var d,$;if(v.type==="custom"||c.type==="custom")return;p!==o&&n.moveLayer(c.id,o),c.type!=="background"&&c.type!=="custom"&&v.filter!==c.filter&&n.setFilter(c.id,c.filter);const k=v,S=c;if(k.layout!==S.layout){if(S.layout)for(const ie of Object.keys(S.layout))S.layout[ie]!==((d=k.layout)==null?void 0:d[ie])&&n.setLayoutProperty(c.id,ie,S.layout[ie]);for(const ie in k.layout)Object.prototype.hasOwnProperty.call(S.layout,ie)||n.setLayoutProperty(c.id,ie,void 0)}if(k.paint!==S.paint){if(S.paint)for(const ie of Object.keys(S.paint))S.paint[ie]!==(($=k.paint)==null?void 0:$[ie])&&n.setPaintProperty(c.id,ie,S.paint[ie]);for(const ie in k.paint)Object.prototype.hasOwnProperty.call(S.paint,ie)||n.setPaintProperty(c.id,ie,void 0)}(k.minzoom!==S.minzoom||k.maxzoom!==S.maxzoom)&&S.minzoom&&S.maxzoom&&n.setLayerZoomRange(c.id,S.minzoom,S.maxzoom)}Ve.memo(Ve.forwardRef(function(o,c){var Te;const{beforeId:p,...v}=o,k=v.id,S=Ve.useContext(Cp);if(!S.mapManager)throw new Error("use <RLayer /> component inside <RMap />");const d=S.mapManager.map,$=Ve.useRef(k);if(k!==$.current)throw new Error(`RLayer id should not change. "${k}" "${$.current}". If you defined id as const string add a "key" prop to your RLayer component`);const ie=S.mapManager.getControlledLayer(k)??o,[,me]=Ve.useState(0),X=Ve.useCallback(()=>me(ke=>ke+1),[]);if(o.type!==ie.type)throw new Error(`RLayer type should not change. "${o.type}" "${ie.type}"`);Ve.useEffect(()=>(d.on("styledata",X),d.style._loaded&&X(),()=>{var ke;d.off("styledata",X),d.style&&d.style._loaded&&d.getLayer(k)&&d.removeLayer(k),(ke=S.mapManager)==null||ke.setControlledLayer(k,null)}),[d,k,S,X]);let V=((Te=d.style)==null?void 0:Te._loaded)&&d.getLayer(k);return V?k3(d,o,ie):(V=T3(d,v,p),V&&d.off("styledata",X)),Ve.useImperativeHandle(c,()=>V||null,[V]),S.mapManager.setControlledLayer(k,o),null}));kt();kt();function I3(n,o,c){var p;if((p=n.style)!=null&&p._loaded)return n.addSource(o,c),n.getSource(o)}function C3(n,o,c){switch(o.type){case"image":{const p=c,v=o;p.url!==v.url&&n.updateImage({url:v.url,coordinates:v.coordinates}),p.coordinates!==v.coordinates&&n.setCoordinates(v.coordinates);break}case"video":{const p=c,v=o;p.coordinates!==v.coordinates&&n.setCoordinates(v.coordinates);break}case"geojson":{const p=c,v=o;p.data!==v.data&&n.setData(v.data),(p.cluster!==v.cluster||p.clusterMaxZoom!==v.clusterMaxZoom||p.clusterRadius!==v.clusterRadius)&&n.setClusterOptions({cluster:v.cluster,clusterMaxZoom:v.clusterMaxZoom,clusterRadius:v.clusterRadius});break}case"raster":case"raster-dem":case"vector":{const p=c,v=o;p.tiles!==v.tiles&&v.tiles&&n.setTiles(v.tiles),p.url!==v.url&&v.url&&n.setUrl(v.url);break}}}var E3=Ve.memo(Ve.forwardRef(function(o,c){var Te;const{id:p,...v}=o,k=Ve.useContext(Cp);if(!k.mapManager)throw new Error("use <RSource /> component inside <RMap />");const S=k.mapManager.map,d=Ve.useRef(p);if(p!==d.current)throw new Error(`RSource id should not change. "${p}" "${d.current}". If you defined id as const string add a "key" prop to your RSource component`);const{id:$,...ie}=k.mapManager.getControlledSource(p)??o;if(v.type!==ie.type)throw new Error(`RSource type should not change. "${v.type}" "${ie.type}"`);const[,me]=Ve.useState(0),X=Ve.useCallback(()=>void setTimeout(()=>me(ke=>ke+1),0),[]);Ve.useEffect(()=>(S.on("styledata",X),S.style._loaded&&X(),()=>{var ke,Me;if(S.off("styledata",X),S.style&&S.getSource(p)){const yt=(ke=S.getStyle())==null?void 0:ke.layers;if(yt)for(const oe of yt)oe.type!=="background"&&oe.type!=="custom"&&oe.source===p&&S.removeLayer(oe.id);S.removeSource(p)}(Me=k.mapManager)==null||Me.setControlledSource(p,null)}),[S,p,k,X]);let V=((Te=S.style)==null?void 0:Te._loaded)&&S.getSource(p);return V?C3(V,v,ie):(V=I3(S,p,v),V&&S.off("styledata",X)),Ve.useImperativeHandle(c,()=>V||null,[V]),k.mapManager.setControlledSource(p,o),null}));kt();kt();kt();kt();var iv="#ffe64b",nv=50,P3=class extends jn.Marker{constructor(o){const c=!o||!o.element;c&&(o??(o={}),o.element=Sl.create("div","maplibregl-gradient-marker"),o.className&&o.element.classList.add(o.className));super(o);li(this,"_icon");li(this,"_height",nv);li(this,"_text");li(this,"_popup");li(this,"_iconElement");li(this,"_textElement");li(this,"_onActive",o=>{this._element.contains(o.originalEvent.target)&&(this._map.once("mouseup",this._onInactive),this._map.once("touchend",this._onInactive),this._element.classList.add("active"))});li(this,"_onInactive",()=>{this._element.classList.remove("active")});if(this._draggable&&this._element.classList.add("draggable"),this._anchor=o&&o.anchor||"bottom",this._color=o&&o.color||iv,this._icon=o&&o.icon,this._text=o&&o.text,c){this._defaultMarker=!0,this._element.setAttribute("aria-label","Map marker"),this._element.setAttribute("tabindex","0"),this.setScale(this._scale),this.setColor(this._color);const p=Sl.create("div","marker");Sl.create("div","ovale",p),this._text?(this._textElement=Sl.create("div","text",p),this._textElement.innerText=this._text):this._icon&&(this._iconElement=Sl.create("i",this._icon,p));const v=Sl.create("div","target");this._element.appendChild(p),this._element.appendChild(v)}}addTo(o){return jn.Marker.prototype.addTo.apply(this,[o]),this._map.on("mousedown",this._onActive),this._map.on("touchstart",this._onActive),this}remove(){return this._map&&(this._map.off("mousedown",this._onActive),this._map.off("touchstart",this._onActive)),jn.Marker.prototype.remove.apply(this),this}setIcon(o){return this._icon=o,this._iconElement&&(this._iconElement.className=this._icon||""),this}getIcon(){return this._icon}setText(o){return this._text=o,this._textElement&&(this._textElement.innerText=this._text||""),this}getText(){return this._text}setColor(o){return this._color=o||iv,this._element.style.setProperty("--marker-color",this._color),this}getColor(){return this._color}setScale(o=1,c=nv){return this._scale=o,this._height=c*this._scale,this._element.style.setProperty("--marker-size",`${this._height}px`),this}getScale(){return this._scale}setPopup(o){return this._popup&&(this._popup.remove(),delete this._popup,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o&&("offset"in o.options||(o instanceof jn.Popup?o.options.offset=this._height+Y0:o.options.offset={mainAxis:this._height+Y0}),this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex")||"",this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)),this}setDraggable(o){return jn.Marker.prototype.setDraggable.apply(this,[o]),this._element.classList.toggle("draggable",o),this}};kt();var rv={dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",click:"onClick"};Ve.memo(Ve.forwardRef(function(o,c){var xt;const{longitude:p,latitude:v,...k}=o,S=Qu(),[d,$]=Tp(k),ie=Ve.useRef(d),me=Ve.useRef();me.current=$;const X=Ve.useMemo(()=>{const rt=new P3({...d,anchor:"bottom"});return rt.setLngLat([p,v]),rt},[]),V=kp(rv,$).join("-");Ve.useEffect(()=>{function rt(oi){var Ri,Pn,Fi;const Ut=oi.type,ei=rv[Ut];(Ri=me.current)!=null&&Ri[ei]?(Fi=(Pn=me.current)[ei])==null||Fi.call(Pn,oi):console.info("not managed RGradientMarker event",Ut,oi)}const pt=V.split("-");return pt.forEach(oi=>{oi==="click"?X.getElement().addEventListener("click",rt):X.on(oi,rt)}),()=>{pt.forEach(oi=>{oi==="click"?X.getElement().removeEventListener("click",rt):X.off(oi,rt)})}},[V,X]),Ve.useEffect(()=>(X.addTo(S),()=>void X.remove()),[]);const{scale:Te,color:ke,text:Me,icon:yt,className:oe,draggable:ne,clickTolerance:he=0,rotation:Ie,rotationAlignment:Be,pitchAlignment:Re,opacity:$e,opacityWhenCovered:Xe}=d;return Ve.useImperativeHandle(c,()=>X,[X]),ie.current.className!==oe&&Ip(X._element,((xt=ie.current.className)==null?void 0:xt.split(" "))||[],(oe==null?void 0:oe.split(" "))||[]),(X.getLngLat().lng!==p||X.getLngLat().lat!==v)&&X.setLngLat([p,v]),X.isDraggable()!==ne&&X.setDraggable(ne),X._clickTolerance!==he&&(X._clickTolerance=he),X.getRotation()!==Ie&&X.setRotation(Ie),X.getRotationAlignment()!==Be&&X.setRotationAlignment(Be),X.getPitchAlignment()!==Re&&X.setPitchAlignment(Re),(X._opacity!==$e||X._opacityWhenCovered!==Xe)&&X.setOpacity($e,Xe),X.getColor()!==ke&&X.setColor(ke),X.getScale()!==Te&&X.setScale(Te),X.getText()!==Me&&X.setText(Me),X.getIcon()!==yt&&X.setIcon(yt),ie.current=d,null}));kt();kt();kt();kt();function Cx({position:n,className:o="maplibregl-ctrl maplibregl-ctrl-group"}){var k;const c=Qu(),p=Ve.useRef(),v=Ve.useRef({className:o});if(!p.current){const S=document.createElement("div");S.className=o,p.current=S}return Ve.useEffect(()=>{const S=p.current;if(S&&!S.parentElement){const d=c._controlPositions[n];if(!d)throw new Error(`Unable to add control, position ${n} doesn't exists`);n.indexOf("bottom")!==-1?d.insertBefore(S,d.firstChild):d.appendChild(S)}return()=>{p.current&&p.current.remove()}},[c,n]),v.current.className!==o&&Ip(p.current,((k=v.current.className)==null?void 0:k.split(" "))||[],(o==null?void 0:o.split(" "))||[]),v.current={className:o},{container:p.current}}function M3({height:n=27}){return at.jsxs("svg",{width:n*21/27,height:n,viewBox:"-10.5 -10.5 21 27",fill:"none",version:"1.1",id:"svg3",xmlns:"http://www.w3.org/2000/svg",children:[at.jsx("path",{fill:"#82b4fe",fillRule:"evenodd",d:"m 0.04378077,-7.0160133 c -3.95934197,-0.025693 -7.19979577,2.9709105 -7.22395607,6.67957072 -0.021351,3.28396108 1.6024867,4.88716988 3.3609363,6.62322508 1.2259466,1.2102943 2.5172339,2.4851233 3.36206037,4.4390285 0.056993,0.04631 0.095121,0.07722 0.1114948,0.09183 a 0.41450831,0.41450831 0 0 0 0.2727553,0.103225 0.41515047,0.41515047 0 0 0 0.2741963,-0.09961 c 0.00438,-0.0039 0.012527,-0.0074 0.022479,-0.01165 0.027304,-0.01171 0.068791,-0.02955 0.090222,-0.0789 C 1.1559887,8.7954149 2.4656545,7.5377628 3.7164045,6.3367792 5.4974902,4.626493 7.158975,3.0309869 7.1802478,-0.24301718 7.2043965,-3.9517594 4.0032063,-6.9901745 0.04378537,-7.016023 Z m -0.06903,10.6235008 C 1.9352357,3.6202595 3.5351559,2.0173639 3.5480768,0.02733852 3.5610008,-1.9626869 1.9821136,-3.5862858 0.02154667,-3.5990486 -1.9390213,-3.6118206 -3.5388592,-2.0089214 -3.5518634,-0.01889648 -3.5647874,1.9711289 -1.9858982,3.5947246 -0.02533123,3.6074875 Z"}),at.jsx("path",{fill:"white",d:"m -2.4911489,12.068709 c -0.3270955,-0.0022 -0.5946317,0.359604 -0.5975214,0.807906 l -0.014767,2.269118 c -0.00295,0.448302 0.2598305,0.813445 0.587006,0.815611 l 5.0075702,0.03259 c 0.3270965,0.0022 0.5946306,-0.359606 0.5975218,-0.807909 l 0.014775,-2.269117 c 0.00304,-0.44838 -0.259831,-0.813523 -0.5870064,-0.815609 z"}),at.jsxs("g",{children:[at.jsx("circle",{cx:"0",cy:"0",r:"2",fill:"white",id:"circle1"}),at.jsxs("g",{stroke:"white",strokeWidth:"1",fill:"none",id:"g3",children:[at.jsx("ellipse",{rx:"10",ry:"4.5",id:"ellipse1",cx:"0",cy:"0"}),at.jsx("ellipse",{rx:"10",ry:"4.5",transform:"rotate(60)",id:"ellipse2",cx:"0",cy:"0"}),at.jsx("ellipse",{rx:"10",ry:"4.5",transform:"rotate(120)",id:"ellipse3",cx:"0",cy:"0"})]}),at.jsx("animateTransform",{attributeName:"transform",type:"rotate",dur:"25s",values:"0 0 0;360 0 0;",repeatCount:"indefinite"})]})]})}var A3=Ve.memo(function({position:o="bottom-left"}){const{container:c}=Cx({position:o,className:"maplibregl-ctrl"});return Ju.createPortal(at.jsx(M3,{height:30}),c)});kt();kt();kt();function z3(n){const o=Ve.useRef(()=>{throw new Error("Cannot call an event handler while rendering.")});return o.current=n,Ve.useCallback((...c)=>{var p;return(p=o.current)==null?void 0:p.call(o,...c)},[o])}function Ta({position:n="top-right",factory:o,onRemove:c}){const p=Qu(),v=Ve.useMemo(()=>o(p),[p]),k=z3(c||null);return Ve.useEffect(()=>(console.log("useControl useEffect"),p.hasControl(v)||(console.log("map addControl"),p.addControl(v,n)),()=>{k&&k(p),p.hasControl(v)?(console.log("map removeControl uhh"),p.removeControl(v)):console.log("map has not control",v)}),[p,v,k,n]),v}var ov=Ve.memo(Ve.forwardRef(function({position:o="bottom-right",...c},p){const v=Ta({position:o,factory:()=>new jn.AttributionControl(c)});return Ve.useImperativeHandle(p,()=>v),null}));kt();var D3=Ve.memo(Ve.forwardRef(function({position:o="top-right",...c},p){const v=Ta({position:o,factory:()=>new jn.FullscreenControl(c)});return Ve.useImperativeHandle(p,()=>v),null}));kt();var L3=Ve.memo(Ve.forwardRef(function({position:o="top-right",...c},p){const v=Ta({position:o,factory:()=>new jn.GeolocateControl(c)});return Ve.useImperativeHandle(p,()=>v),null}));kt();var sv=Ve.memo(Ve.forwardRef(function({position:o="bottom-left",...c},p){const v=Ta({position:o,factory:()=>new jn.LogoControl(c)});return Ve.useImperativeHandle(p,()=>v),null}));kt();var R3=Ve.memo(Ve.forwardRef(function({position:o="top-right",...c},p){const v=Ta({position:o,factory:()=>new jn.NavigationControl(c)});return Ve.useImperativeHandle(p,()=>v),null}));kt();var F3=Ve.memo(Ve.forwardRef(function({position:o="bottom-left",...c},p){const v=Ta({position:o,factory:()=>new jn.ScaleControl(c)});return Ve.useImperativeHandle(p,()=>v),null}));kt();var B3=Ve.memo(Ve.forwardRef(function({position:o="top-right",...c},p){const v=Ta({position:o,factory:()=>new jn.TerrainControl(c)});return Ve.useImperativeHandle(p,()=>v),null}));kt();kt();kt();kt();function Ex(n){var o,c,p="";if(typeof n=="string"||typeof n=="number")p+=n;else if(typeof n=="object")if(Array.isArray(n)){var v=n.length;for(o=0;o<v;o++)n[o]&&(c=Ex(n[o]))&&(p&&(p+=" "),p+=c)}else for(c in n)n[c]&&(p&&(p+=" "),p+=c);return p}function av(){for(var n,o,c=0,p="",v=arguments.length;c<v;c++)(n=arguments[c])&&(o=Ex(n))&&(p&&(p+=" "),p+=o);return p}const O3=a3;var cv;(cv=new URL(window.location.toString()).searchParams.get("classes"))==null||cv.split("|").forEach(n=>{document.body.classList.add(n)});const mm={lng:6.498,lat:46.089},kd={lng:6.2,lat:46.089},lv={lng:6.382560880284075,lat:46.41406563675616},N3=["https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"];function j3(){const{container:n}=Cx({position:"top-left"});return Ju.createPortal(at.jsxs(at.Fragment,{children:[at.jsx("button",{className:"maplibregl-ctrl-geolocate ring-1",type:"button",title:"Find my location","aria-label":"Find my location",children:at.jsx("span",{className:"maplibregl-ctrl-icon","aria-hidden":"true"})}),at.jsx("button",{className:"maplibregl-ctrl-geolocate maplibregl-ctrl-geolocate-active",type:"button",title:"Find my location","aria-label":"Find my location",children:at.jsx("span",{className:"maplibregl-ctrl-icon","aria-hidden":"true"})}),at.jsx("button",{className:"maplibregl-ctrl-geolocate maplibregl-ctrl-geolocate-active-error",type:"button",title:"Find my location","aria-label":"Find my location",children:at.jsx("span",{className:"maplibregl-ctrl-icon","aria-hidden":"true"})}),at.jsx("button",{className:"maplibregl-ctrl-geolocate maplibregl-ctrl-geolocate-background",type:"button",title:"Find my location","aria-label":"Find my location",children:at.jsx("span",{className:"maplibregl-ctrl-icon","aria-hidden":"true"})}),at.jsx("button",{className:"maplibregl-ctrl-geolocate maplibregl-ctrl-geolocate-background-error",type:"button",title:"Find my location","aria-label":"Find my location",children:at.jsx("span",{className:"maplibregl-ctrl-icon","aria-hidden":"true"})}),at.jsx("button",{className:"maplibregl-ctrl-geolocate maplibregl-ctrl-geolocate-waiting",type:"button",title:"Find my location","aria-label":"Find my location",children:at.jsx("span",{className:"maplibregl-ctrl-icon","aria-hidden":"true"})}),at.jsx("button",{className:"maplibregl-ctrl-geolocate",type:"button",title:"Find my location","aria-label":"Find my location",disabled:!0,children:at.jsx("span",{className:"maplibregl-ctrl-icon","aria-hidden":"true"})})]}),n)}const V3={transform:"translate(-50%, -50%) translate(148px, 250px) rotateX(0deg) rotateZ(0deg)",width:"297px",height:"297px",opacity:1},U3={transform:"translate(-50%, -50%) translate(148px, 250px) rotateX(0deg) rotateZ(0deg)",opacity:1};function gu({className:n,theme:o,scheme:c="light"}){const p=Ve.useRef(null);return at.jsx("div",{className:av("map-container",c),children:at.jsxs(S3,{ref:p,initialCenter:mm,initialZoom:8,initialAttributionControl:!1,className:av(n,`shadow-md maplibregl-theme-${o}`),mapStyle:O3,onClick:v=>console.log(v.lngLat),children:[at.jsx(E3,{type:"raster-dem",id:"terrarium",tiles:N3,encoding:"terrarium",tileSize:256}),at.jsxs(pm,{longitude:lv.lng,latitude:lv.lat,children:[at.jsx("div",{className:"maplibregl-user-location-accuracy-circle maplibregl-marker maplibregl-marker-anchor-center",style:V3}),at.jsx("div",{className:"maplibregl-user-location-dot maplibregl-marker maplibregl-marker-anchor-center",style:U3})]}),at.jsx(pm,{longitude:kd.lng,latitude:kd.lat}),at.jsx(pm,{longitude:kd.lng,latitude:kd.lat}),at.jsx(tv,{longitude:mm.lng,latitude:mm.lat,children:"Hello world !"}),at.jsxs(tv,{longitude:5.74,latitude:45.95,children:["Hello world !",at.jsx("button",{className:"maplibregl-popup-close-button",children:"×"})]}),at.jsx(A3,{position:"top-left"}),at.jsx(D3,{}),at.jsx(L3,{showAccuracyCircle:!0,showUserLocation:!0,trackUserLocation:!0}),at.jsx(R3,{}),at.jsx(B3,{source:"terrarium"}),at.jsx(sv,{compact:!1}),at.jsx(sv,{compact:!0}),at.jsx(F3,{}),at.jsx(ov,{compact:!1}),at.jsx(ov,{compact:!0}),at.jsx(j3,{}),at.jsxs("div",{className:"ml-title",children:[o," ",c]})]})})}function $3(){return at.jsx(at.Fragment,{children:at.jsxs("div",{id:"app",children:[at.jsx(gu,{theme:"classic",scheme:"light"}),at.jsx(gu,{theme:"classic",scheme:"dark"}),at.jsx(gu,{theme:"modern",scheme:"light"}),at.jsx(gu,{theme:"modern",scheme:"dark"}),at.jsx(gu,{theme:"legacy",scheme:"light"})]})})}gm.createRoot(document.getElementById("root")).render(at.jsx($3,{}));
